function Hv(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in e)){const a=Object.getOwnPropertyDescriptor(r,s);a&&Object.defineProperty(e,s,a.get?a:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function Kv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ah={exports:{}},Do={},ih={exports:{}},Je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Va=Symbol.for("react.element"),Gv=Symbol.for("react.portal"),Yv=Symbol.for("react.fragment"),Qv=Symbol.for("react.strict_mode"),qv=Symbol.for("react.profiler"),Xv=Symbol.for("react.provider"),Jv=Symbol.for("react.context"),Zv=Symbol.for("react.forward_ref"),ex=Symbol.for("react.suspense"),tx=Symbol.for("react.memo"),nx=Symbol.for("react.lazy"),lp=Symbol.iterator;function rx(e){return e===null||typeof e!="object"?null:(e=lp&&e[lp]||e["@@iterator"],typeof e=="function"?e:null)}var oh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ch=Object.assign,uh={};function zl(e,t,n){this.props=e,this.context=t,this.refs=uh,this.updater=n||oh}zl.prototype.isReactComponent={};zl.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};zl.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function dh(){}dh.prototype=zl.prototype;function md(e,t,n){this.props=e,this.context=t,this.refs=uh,this.updater=n||oh}var hd=md.prototype=new dh;hd.constructor=md;ch(hd,zl.prototype);hd.isPureReactComponent=!0;var ap=Array.isArray,fh=Object.prototype.hasOwnProperty,gd={current:null},ph={key:!0,ref:!0,__self:!0,__source:!0};function mh(e,t,n){var r,s={},a=null,i=null;if(t!=null)for(r in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(a=""+t.key),t)fh.call(t,r)&&!ph.hasOwnProperty(r)&&(s[r]=t[r]);var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];s.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps,c)s[r]===void 0&&(s[r]=c[r]);return{$$typeof:Va,type:e,key:a,ref:i,props:s,_owner:gd.current}}function sx(e,t){return{$$typeof:Va,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function yd(e){return typeof e=="object"&&e!==null&&e.$$typeof===Va}function lx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var ip=/\/+/g;function Nc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?lx(""+e.key):t.toString(36)}function Fi(e,t,n,r,s){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(a){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case Va:case Gv:i=!0}}if(i)return i=e,s=s(i),e=r===""?"."+Nc(i,0):r,ap(s)?(n="",e!=null&&(n=e.replace(ip,"$&/")+"/"),Fi(s,t,n,"",function(d){return d})):s!=null&&(yd(s)&&(s=sx(s,n+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(ip,"$&/")+"/")+e)),t.push(s)),1;if(i=0,r=r===""?".":r+":",ap(e))for(var c=0;c<e.length;c++){a=e[c];var u=r+Nc(a,c);i+=Fi(a,t,n,u,s)}else if(u=rx(e),typeof u=="function")for(e=u.call(e),c=0;!(a=e.next()).done;)a=a.value,u=r+Nc(a,c++),i+=Fi(a,t,n,u,s);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function yi(e,t,n){if(e==null)return e;var r=[],s=0;return Fi(e,r,"","",function(a){return t.call(n,a,s++)}),r}function ax(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ln={current:null},Di={transition:null},ix={ReactCurrentDispatcher:ln,ReactCurrentBatchConfig:Di,ReactCurrentOwner:gd};function hh(){throw Error("act(...) is not supported in production builds of React.")}Je.Children={map:yi,forEach:function(e,t,n){yi(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return yi(e,function(){t++}),t},toArray:function(e){return yi(e,function(t){return t})||[]},only:function(e){if(!yd(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Je.Component=zl;Je.Fragment=Yv;Je.Profiler=qv;Je.PureComponent=md;Je.StrictMode=Qv;Je.Suspense=ex;Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ix;Je.act=hh;Je.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=ch({},e.props),s=e.key,a=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,i=gd.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)fh.call(t,u)&&!ph.hasOwnProperty(u)&&(r[u]=t[u]===void 0&&c!==void 0?c[u]:t[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:Va,type:e.type,key:s,ref:a,props:r,_owner:i}};Je.createContext=function(e){return e={$$typeof:Jv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Xv,_context:e},e.Consumer=e};Je.createElement=mh;Je.createFactory=function(e){var t=mh.bind(null,e);return t.type=e,t};Je.createRef=function(){return{current:null}};Je.forwardRef=function(e){return{$$typeof:Zv,render:e}};Je.isValidElement=yd;Je.lazy=function(e){return{$$typeof:nx,_payload:{_status:-1,_result:e},_init:ax}};Je.memo=function(e,t){return{$$typeof:tx,type:e,compare:t===void 0?null:t}};Je.startTransition=function(e){var t=Di.transition;Di.transition={};try{e()}finally{Di.transition=t}};Je.unstable_act=hh;Je.useCallback=function(e,t){return ln.current.useCallback(e,t)};Je.useContext=function(e){return ln.current.useContext(e)};Je.useDebugValue=function(){};Je.useDeferredValue=function(e){return ln.current.useDeferredValue(e)};Je.useEffect=function(e,t){return ln.current.useEffect(e,t)};Je.useId=function(){return ln.current.useId()};Je.useImperativeHandle=function(e,t,n){return ln.current.useImperativeHandle(e,t,n)};Je.useInsertionEffect=function(e,t){return ln.current.useInsertionEffect(e,t)};Je.useLayoutEffect=function(e,t){return ln.current.useLayoutEffect(e,t)};Je.useMemo=function(e,t){return ln.current.useMemo(e,t)};Je.useReducer=function(e,t,n){return ln.current.useReducer(e,t,n)};Je.useRef=function(e){return ln.current.useRef(e)};Je.useState=function(e){return ln.current.useState(e)};Je.useSyncExternalStore=function(e,t,n){return ln.current.useSyncExternalStore(e,t,n)};Je.useTransition=function(){return ln.current.useTransition()};Je.version="18.3.1";ih.exports=Je;var o=ih.exports;const ca=Kv(o),ox=Hv({__proto__:null,default:ca},[o]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cx=o,ux=Symbol.for("react.element"),dx=Symbol.for("react.fragment"),fx=Object.prototype.hasOwnProperty,px=cx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,mx={key:!0,ref:!0,__self:!0,__source:!0};function gh(e,t,n){var r,s={},a=null,i=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(i=t.ref);for(r in t)fx.call(t,r)&&!mx.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)s[r]===void 0&&(s[r]=t[r]);return{$$typeof:ux,type:e,key:a,ref:i,props:s,_owner:px.current}}Do.Fragment=dx;Do.jsx=gh;Do.jsxs=gh;ah.exports=Do;var l=ah.exports,su={},yh={exports:{}},An={},vh={exports:{}},xh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(R,A){var O=R.length;R.push(A);e:for(;0<O;){var _=O-1>>>1,B=R[_];if(0<s(B,A))R[_]=A,R[O]=B,O=_;else break e}}function n(R){return R.length===0?null:R[0]}function r(R){if(R.length===0)return null;var A=R[0],O=R.pop();if(O!==A){R[0]=O;e:for(var _=0,B=R.length,W=B>>>1;_<W;){var ue=2*(_+1)-1,pe=R[ue],Q=ue+1,he=R[Q];if(0>s(pe,O))Q<B&&0>s(he,pe)?(R[_]=he,R[Q]=O,_=Q):(R[_]=pe,R[ue]=O,_=ue);else if(Q<B&&0>s(he,O))R[_]=he,R[Q]=O,_=Q;else break e}}return A}function s(R,A){var O=R.sortIndex-A.sortIndex;return O!==0?O:R.id-A.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var i=Date,c=i.now();e.unstable_now=function(){return i.now()-c}}var u=[],d=[],g=1,v=null,y=3,x=!1,S=!1,j=!1,N=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function h(R){for(var A=n(d);A!==null;){if(A.callback===null)r(d);else if(A.startTime<=R)r(d),A.sortIndex=A.expirationTime,t(u,A);else break;A=n(d)}}function w(R){if(j=!1,h(R),!S)if(n(u)!==null)S=!0,Y(E);else{var A=n(d);A!==null&&Se(w,A.startTime-R)}}function E(R,A){S=!1,j&&(j=!1,m(z),z=-1),x=!0;var O=y;try{for(h(A),v=n(u);v!==null&&(!(v.expirationTime>A)||R&&!F());){var _=v.callback;if(typeof _=="function"){v.callback=null,y=v.priorityLevel;var B=_(v.expirationTime<=A);A=e.unstable_now(),typeof B=="function"?v.callback=B:v===n(u)&&r(u),h(A)}else r(u);v=n(u)}if(v!==null)var W=!0;else{var ue=n(d);ue!==null&&Se(w,ue.startTime-A),W=!1}return W}finally{v=null,y=O,x=!1}}var b=!1,L=null,z=-1,$=5,T=-1;function F(){return!(e.unstable_now()-T<$)}function Z(){if(L!==null){var R=e.unstable_now();T=R;var A=!0;try{A=L(!0,R)}finally{A?ae():(b=!1,L=null)}}else b=!1}var ae;if(typeof p=="function")ae=function(){p(Z)};else if(typeof MessageChannel<"u"){var Ce=new MessageChannel,ye=Ce.port2;Ce.port1.onmessage=Z,ae=function(){ye.postMessage(null)}}else ae=function(){N(Z,0)};function Y(R){L=R,b||(b=!0,ae())}function Se(R,A){z=N(function(){R(e.unstable_now())},A)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(R){R.callback=null},e.unstable_continueExecution=function(){S||x||(S=!0,Y(E))},e.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<R?Math.floor(1e3/R):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(R){switch(y){case 1:case 2:case 3:var A=3;break;default:A=y}var O=y;y=A;try{return R()}finally{y=O}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(R,A){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var O=y;y=R;try{return A()}finally{y=O}},e.unstable_scheduleCallback=function(R,A,O){var _=e.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?_+O:_):O=_,R){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=O+B,R={id:g++,callback:A,priorityLevel:R,startTime:O,expirationTime:B,sortIndex:-1},O>_?(R.sortIndex=O,t(d,R),n(u)===null&&R===n(d)&&(j?(m(z),z=-1):j=!0,Se(w,O-_))):(R.sortIndex=B,t(u,R),S||x||(S=!0,Y(E))),R},e.unstable_shouldYield=F,e.unstable_wrapCallback=function(R){var A=y;return function(){var O=y;y=A;try{return R.apply(this,arguments)}finally{y=O}}}})(xh);vh.exports=xh;var hx=vh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gx=o,En=hx;function oe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var wh=new Set,Sa={};function Vs(e,t){Nl(e,t),Nl(e+"Capture",t)}function Nl(e,t){for(Sa[e]=t,e=0;e<t.length;e++)wh.add(t[e])}var Lr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lu=Object.prototype.hasOwnProperty,yx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,op={},cp={};function vx(e){return lu.call(cp,e)?!0:lu.call(op,e)?!1:yx.test(e)?cp[e]=!0:(op[e]=!0,!1)}function xx(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function wx(e,t,n,r){if(t===null||typeof t>"u"||xx(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function an(e,t,n,r,s,a,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var Kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Kt[e]=new an(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Kt[t]=new an(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Kt[e]=new an(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Kt[e]=new an(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Kt[e]=new an(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Kt[e]=new an(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Kt[e]=new an(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Kt[e]=new an(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Kt[e]=new an(e,5,!1,e.toLowerCase(),null,!1,!1)});var vd=/[\-:]([a-z])/g;function xd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(vd,xd);Kt[t]=new an(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(vd,xd);Kt[t]=new an(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(vd,xd);Kt[t]=new an(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Kt[e]=new an(e,1,!1,e.toLowerCase(),null,!1,!1)});Kt.xlinkHref=new an("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Kt[e]=new an(e,1,!1,e.toLowerCase(),null,!0,!0)});function wd(e,t,n,r){var s=Kt.hasOwnProperty(t)?Kt[t]:null;(s!==null?s.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(wx(t,n,s,r)&&(n=null),r||s===null?vx(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=n===null?s.type===3?!1:"":n:(t=s.attributeName,r=s.attributeNamespace,n===null?e.removeAttribute(t):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var zr=gx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,vi=Symbol.for("react.element"),rl=Symbol.for("react.portal"),sl=Symbol.for("react.fragment"),Sd=Symbol.for("react.strict_mode"),au=Symbol.for("react.profiler"),Sh=Symbol.for("react.provider"),kh=Symbol.for("react.context"),kd=Symbol.for("react.forward_ref"),iu=Symbol.for("react.suspense"),ou=Symbol.for("react.suspense_list"),jd=Symbol.for("react.memo"),Qr=Symbol.for("react.lazy"),jh=Symbol.for("react.offscreen"),up=Symbol.iterator;function ql(e){return e===null||typeof e!="object"?null:(e=up&&e[up]||e["@@iterator"],typeof e=="function"?e:null)}var Ct=Object.assign,Cc;function sa(e){if(Cc===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Cc=t&&t[1]||""}return`
`+Cc+e}var bc=!1;function Ec(e,t){if(!e||bc)return"";bc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),a=r.stack.split(`
`),i=s.length-1,c=a.length-1;1<=i&&0<=c&&s[i]!==a[c];)c--;for(;1<=i&&0<=c;i--,c--)if(s[i]!==a[c]){if(i!==1||c!==1)do if(i--,c--,0>c||s[i]!==a[c]){var u=`
`+s[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=i&&0<=c);break}}}finally{bc=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?sa(e):""}function Sx(e){switch(e.tag){case 5:return sa(e.type);case 16:return sa("Lazy");case 13:return sa("Suspense");case 19:return sa("SuspenseList");case 0:case 2:case 15:return e=Ec(e.type,!1),e;case 11:return e=Ec(e.type.render,!1),e;case 1:return e=Ec(e.type,!0),e;default:return""}}function cu(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case sl:return"Fragment";case rl:return"Portal";case au:return"Profiler";case Sd:return"StrictMode";case iu:return"Suspense";case ou:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case kh:return(e.displayName||"Context")+".Consumer";case Sh:return(e._context.displayName||"Context")+".Provider";case kd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case jd:return t=e.displayName||null,t!==null?t:cu(e.type)||"Memo";case Qr:t=e._payload,e=e._init;try{return cu(e(t))}catch{}}return null}function kx(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cu(t);case 8:return t===Sd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ms(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Nh(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function jx(e){var t=Nh(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(i){r=""+i,a.call(this,i)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(i){r=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function xi(e){e._valueTracker||(e._valueTracker=jx(e))}function Ch(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Nh(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Zi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function uu(e,t){var n=t.checked;return Ct({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function dp(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=ms(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function bh(e,t){t=t.checked,t!=null&&wd(e,"checked",t,!1)}function du(e,t){bh(e,t);var n=ms(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?fu(e,t.type,n):t.hasOwnProperty("defaultValue")&&fu(e,t.type,ms(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function fp(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function fu(e,t,n){(t!=="number"||Zi(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var la=Array.isArray;function yl(e,t,n,r){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ms(n),t=null,s=0;s<e.length;s++){if(e[s].value===n){e[s].selected=!0,r&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function pu(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(oe(91));return Ct({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function pp(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(oe(92));if(la(n)){if(1<n.length)throw Error(oe(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:ms(n)}}function Eh(e,t){var n=ms(t.value),r=ms(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function mp(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Ah(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mu(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Ah(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var wi,Lh=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,s){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(wi=wi||document.createElement("div"),wi.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=wi.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ka(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var ua={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Nx=["Webkit","ms","Moz","O"];Object.keys(ua).forEach(function(e){Nx.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ua[t]=ua[e]})});function Ph(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||ua.hasOwnProperty(e)&&ua[e]?(""+t).trim():t+"px"}function Th(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Ph(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,s):e[n]=s}}var Cx=Ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hu(e,t){if(t){if(Cx[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(oe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(oe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(oe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(oe(62))}}function gu(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yu=null;function Nd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var vu=null,vl=null,xl=null;function hp(e){if(e=Ka(e)){if(typeof vu!="function")throw Error(oe(280));var t=e.stateNode;t&&(t=Ho(t),vu(e.stateNode,e.type,t))}}function Rh(e){vl?xl?xl.push(e):xl=[e]:vl=e}function zh(){if(vl){var e=vl,t=xl;if(xl=vl=null,hp(e),t)for(e=0;e<t.length;e++)hp(t[e])}}function _h(e,t){return e(t)}function Ih(){}var Ac=!1;function $h(e,t,n){if(Ac)return e(t,n);Ac=!0;try{return _h(e,t,n)}finally{Ac=!1,(vl!==null||xl!==null)&&(Ih(),zh())}}function ja(e,t){var n=e.stateNode;if(n===null)return null;var r=Ho(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(oe(231,t,typeof n));return n}var xu=!1;if(Lr)try{var Xl={};Object.defineProperty(Xl,"passive",{get:function(){xu=!0}}),window.addEventListener("test",Xl,Xl),window.removeEventListener("test",Xl,Xl)}catch{xu=!1}function bx(e,t,n,r,s,a,i,c,u){var d=Array.prototype.slice.call(arguments,3);try{t.apply(n,d)}catch(g){this.onError(g)}}var da=!1,eo=null,to=!1,wu=null,Ex={onError:function(e){da=!0,eo=e}};function Ax(e,t,n,r,s,a,i,c,u){da=!1,eo=null,bx.apply(Ex,arguments)}function Lx(e,t,n,r,s,a,i,c,u){if(Ax.apply(this,arguments),da){if(da){var d=eo;da=!1,eo=null}else throw Error(oe(198));to||(to=!0,wu=d)}}function Ws(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Mh(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function gp(e){if(Ws(e)!==e)throw Error(oe(188))}function Px(e){var t=e.alternate;if(!t){if(t=Ws(e),t===null)throw Error(oe(188));return t!==e?null:e}for(var n=e,r=t;;){var s=n.return;if(s===null)break;var a=s.alternate;if(a===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return gp(s),e;if(a===r)return gp(s),t;a=a.sibling}throw Error(oe(188))}if(n.return!==r.return)n=s,r=a;else{for(var i=!1,c=s.child;c;){if(c===n){i=!0,n=s,r=a;break}if(c===r){i=!0,r=s,n=a;break}c=c.sibling}if(!i){for(c=a.child;c;){if(c===n){i=!0,n=a,r=s;break}if(c===r){i=!0,r=a,n=s;break}c=c.sibling}if(!i)throw Error(oe(189))}}if(n.alternate!==r)throw Error(oe(190))}if(n.tag!==3)throw Error(oe(188));return n.stateNode.current===n?e:t}function Oh(e){return e=Px(e),e!==null?Fh(e):null}function Fh(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Fh(e);if(t!==null)return t;e=e.sibling}return null}var Dh=En.unstable_scheduleCallback,yp=En.unstable_cancelCallback,Tx=En.unstable_shouldYield,Rx=En.unstable_requestPaint,At=En.unstable_now,zx=En.unstable_getCurrentPriorityLevel,Cd=En.unstable_ImmediatePriority,Bh=En.unstable_UserBlockingPriority,no=En.unstable_NormalPriority,_x=En.unstable_LowPriority,Uh=En.unstable_IdlePriority,Bo=null,gr=null;function Ix(e){if(gr&&typeof gr.onCommitFiberRoot=="function")try{gr.onCommitFiberRoot(Bo,e,void 0,(e.current.flags&128)===128)}catch{}}var Jn=Math.clz32?Math.clz32:Ox,$x=Math.log,Mx=Math.LN2;function Ox(e){return e>>>=0,e===0?32:31-($x(e)/Mx|0)|0}var Si=64,ki=4194304;function aa(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ro(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,s=e.suspendedLanes,a=e.pingedLanes,i=n&268435455;if(i!==0){var c=i&~s;c!==0?r=aa(c):(a&=i,a!==0&&(r=aa(a)))}else i=n&~s,i!==0?r=aa(i):a!==0&&(r=aa(a));if(r===0)return 0;if(t!==0&&t!==r&&!(t&s)&&(s=r&-r,a=t&-t,s>=a||s===16&&(a&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Jn(t),s=1<<n,r|=e[n],t&=~s;return r}function Fx(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dx(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,s=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-Jn(a),c=1<<i,u=s[i];u===-1?(!(c&n)||c&r)&&(s[i]=Fx(c,t)):u<=t&&(e.expiredLanes|=c),a&=~c}}function Su(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Vh(){var e=Si;return Si<<=1,!(Si&4194240)&&(Si=64),e}function Lc(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Wa(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Jn(t),e[t]=n}function Bx(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-Jn(n),a=1<<s;t[s]=0,r[s]=-1,e[s]=-1,n&=~a}}function bd(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Jn(n),s=1<<r;s&t|e[r]&t&&(e[r]|=t),n&=~s}}var dt=0;function Wh(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Hh,Ed,Kh,Gh,Yh,ku=!1,ji=[],ls=null,as=null,is=null,Na=new Map,Ca=new Map,Xr=[],Ux="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vp(e,t){switch(e){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":as=null;break;case"mouseover":case"mouseout":is=null;break;case"pointerover":case"pointerout":Na.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ca.delete(t.pointerId)}}function Jl(e,t,n,r,s,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[s]},t!==null&&(t=Ka(t),t!==null&&Ed(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function Vx(e,t,n,r,s){switch(t){case"focusin":return ls=Jl(ls,e,t,n,r,s),!0;case"dragenter":return as=Jl(as,e,t,n,r,s),!0;case"mouseover":return is=Jl(is,e,t,n,r,s),!0;case"pointerover":var a=s.pointerId;return Na.set(a,Jl(Na.get(a)||null,e,t,n,r,s)),!0;case"gotpointercapture":return a=s.pointerId,Ca.set(a,Jl(Ca.get(a)||null,e,t,n,r,s)),!0}return!1}function Qh(e){var t=zs(e.target);if(t!==null){var n=Ws(t);if(n!==null){if(t=n.tag,t===13){if(t=Mh(n),t!==null){e.blockedOn=t,Yh(e.priority,function(){Kh(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Bi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=ju(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);yu=r,n.target.dispatchEvent(r),yu=null}else return t=Ka(n),t!==null&&Ed(t),e.blockedOn=n,!1;t.shift()}return!0}function xp(e,t,n){Bi(e)&&n.delete(t)}function Wx(){ku=!1,ls!==null&&Bi(ls)&&(ls=null),as!==null&&Bi(as)&&(as=null),is!==null&&Bi(is)&&(is=null),Na.forEach(xp),Ca.forEach(xp)}function Zl(e,t){e.blockedOn===t&&(e.blockedOn=null,ku||(ku=!0,En.unstable_scheduleCallback(En.unstable_NormalPriority,Wx)))}function ba(e){function t(s){return Zl(s,e)}if(0<ji.length){Zl(ji[0],e);for(var n=1;n<ji.length;n++){var r=ji[n];r.blockedOn===e&&(r.blockedOn=null)}}for(ls!==null&&Zl(ls,e),as!==null&&Zl(as,e),is!==null&&Zl(is,e),Na.forEach(t),Ca.forEach(t),n=0;n<Xr.length;n++)r=Xr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Xr.length&&(n=Xr[0],n.blockedOn===null);)Qh(n),n.blockedOn===null&&Xr.shift()}var wl=zr.ReactCurrentBatchConfig,so=!0;function Hx(e,t,n,r){var s=dt,a=wl.transition;wl.transition=null;try{dt=1,Ad(e,t,n,r)}finally{dt=s,wl.transition=a}}function Kx(e,t,n,r){var s=dt,a=wl.transition;wl.transition=null;try{dt=4,Ad(e,t,n,r)}finally{dt=s,wl.transition=a}}function Ad(e,t,n,r){if(so){var s=ju(e,t,n,r);if(s===null)Fc(e,t,r,lo,n),vp(e,r);else if(Vx(s,e,t,n,r))r.stopPropagation();else if(vp(e,r),t&4&&-1<Ux.indexOf(e)){for(;s!==null;){var a=Ka(s);if(a!==null&&Hh(a),a=ju(e,t,n,r),a===null&&Fc(e,t,r,lo,n),a===s)break;s=a}s!==null&&r.stopPropagation()}else Fc(e,t,r,null,n)}}var lo=null;function ju(e,t,n,r){if(lo=null,e=Nd(r),e=zs(e),e!==null)if(t=Ws(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Mh(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return lo=e,null}function qh(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zx()){case Cd:return 1;case Bh:return 4;case no:case _x:return 16;case Uh:return 536870912;default:return 16}default:return 16}}var ts=null,Ld=null,Ui=null;function Xh(){if(Ui)return Ui;var e,t=Ld,n=t.length,r,s="value"in ts?ts.value:ts.textContent,a=s.length;for(e=0;e<n&&t[e]===s[e];e++);var i=n-e;for(r=1;r<=i&&t[n-r]===s[a-r];r++);return Ui=s.slice(e,1<r?1-r:void 0)}function Vi(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Ni(){return!0}function wp(){return!1}function Ln(e){function t(n,r,s,a,i){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=a,this.target=i,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(n=e[c],this[c]=n?n(a):a[c]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Ni:wp,this.isPropagationStopped=wp,this}return Ct(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ni)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ni)},persist:function(){},isPersistent:Ni}),t}var _l={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pd=Ln(_l),Ha=Ct({},_l,{view:0,detail:0}),Gx=Ln(Ha),Pc,Tc,ea,Uo=Ct({},Ha,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Td,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ea&&(ea&&e.type==="mousemove"?(Pc=e.screenX-ea.screenX,Tc=e.screenY-ea.screenY):Tc=Pc=0,ea=e),Pc)},movementY:function(e){return"movementY"in e?e.movementY:Tc}}),Sp=Ln(Uo),Yx=Ct({},Uo,{dataTransfer:0}),Qx=Ln(Yx),qx=Ct({},Ha,{relatedTarget:0}),Rc=Ln(qx),Xx=Ct({},_l,{animationName:0,elapsedTime:0,pseudoElement:0}),Jx=Ln(Xx),Zx=Ct({},_l,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ew=Ln(Zx),tw=Ct({},_l,{data:0}),kp=Ln(tw),nw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lw(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=sw[e])?!!t[e]:!1}function Td(){return lw}var aw=Ct({},Ha,{key:function(e){if(e.key){var t=nw[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Vi(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?rw[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Td,charCode:function(e){return e.type==="keypress"?Vi(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Vi(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),iw=Ln(aw),ow=Ct({},Uo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),jp=Ln(ow),cw=Ct({},Ha,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Td}),uw=Ln(cw),dw=Ct({},_l,{propertyName:0,elapsedTime:0,pseudoElement:0}),fw=Ln(dw),pw=Ct({},Uo,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),mw=Ln(pw),hw=[9,13,27,32],Rd=Lr&&"CompositionEvent"in window,fa=null;Lr&&"documentMode"in document&&(fa=document.documentMode);var gw=Lr&&"TextEvent"in window&&!fa,Jh=Lr&&(!Rd||fa&&8<fa&&11>=fa),Np=" ",Cp=!1;function Zh(e,t){switch(e){case"keyup":return hw.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eg(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ll=!1;function yw(e,t){switch(e){case"compositionend":return eg(t);case"keypress":return t.which!==32?null:(Cp=!0,Np);case"textInput":return e=t.data,e===Np&&Cp?null:e;default:return null}}function vw(e,t){if(ll)return e==="compositionend"||!Rd&&Zh(e,t)?(e=Xh(),Ui=Ld=ts=null,ll=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Jh&&t.locale!=="ko"?null:t.data;default:return null}}var xw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!xw[e.type]:t==="textarea"}function tg(e,t,n,r){Rh(r),t=ao(t,"onChange"),0<t.length&&(n=new Pd("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var pa=null,Ea=null;function ww(e){fg(e,0)}function Vo(e){var t=ol(e);if(Ch(t))return e}function Sw(e,t){if(e==="change")return t}var ng=!1;if(Lr){var zc;if(Lr){var _c="oninput"in document;if(!_c){var Ep=document.createElement("div");Ep.setAttribute("oninput","return;"),_c=typeof Ep.oninput=="function"}zc=_c}else zc=!1;ng=zc&&(!document.documentMode||9<document.documentMode)}function Ap(){pa&&(pa.detachEvent("onpropertychange",rg),Ea=pa=null)}function rg(e){if(e.propertyName==="value"&&Vo(Ea)){var t=[];tg(t,Ea,e,Nd(e)),$h(ww,t)}}function kw(e,t,n){e==="focusin"?(Ap(),pa=t,Ea=n,pa.attachEvent("onpropertychange",rg)):e==="focusout"&&Ap()}function jw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Vo(Ea)}function Nw(e,t){if(e==="click")return Vo(t)}function Cw(e,t){if(e==="input"||e==="change")return Vo(t)}function bw(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var er=typeof Object.is=="function"?Object.is:bw;function Aa(e,t){if(er(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!lu.call(t,s)||!er(e[s],t[s]))return!1}return!0}function Lp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Pp(e,t){var n=Lp(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Lp(n)}}function sg(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?sg(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function lg(){for(var e=window,t=Zi();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Zi(e.document)}return t}function zd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Ew(e){var t=lg(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&sg(n.ownerDocument.documentElement,n)){if(r!==null&&zd(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=n.textContent.length,a=Math.min(r.start,s);r=r.end===void 0?a:Math.min(r.end,s),!e.extend&&a>r&&(s=r,r=a,a=s),s=Pp(n,a);var i=Pp(n,r);s&&i&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Aw=Lr&&"documentMode"in document&&11>=document.documentMode,al=null,Nu=null,ma=null,Cu=!1;function Tp(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Cu||al==null||al!==Zi(r)||(r=al,"selectionStart"in r&&zd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ma&&Aa(ma,r)||(ma=r,r=ao(Nu,"onSelect"),0<r.length&&(t=new Pd("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=al)))}function Ci(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var il={animationend:Ci("Animation","AnimationEnd"),animationiteration:Ci("Animation","AnimationIteration"),animationstart:Ci("Animation","AnimationStart"),transitionend:Ci("Transition","TransitionEnd")},Ic={},ag={};Lr&&(ag=document.createElement("div").style,"AnimationEvent"in window||(delete il.animationend.animation,delete il.animationiteration.animation,delete il.animationstart.animation),"TransitionEvent"in window||delete il.transitionend.transition);function Wo(e){if(Ic[e])return Ic[e];if(!il[e])return e;var t=il[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in ag)return Ic[e]=t[n];return e}var ig=Wo("animationend"),og=Wo("animationiteration"),cg=Wo("animationstart"),ug=Wo("transitionend"),dg=new Map,Rp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ys(e,t){dg.set(e,t),Vs(t,[e])}for(var $c=0;$c<Rp.length;$c++){var Mc=Rp[$c],Lw=Mc.toLowerCase(),Pw=Mc[0].toUpperCase()+Mc.slice(1);ys(Lw,"on"+Pw)}ys(ig,"onAnimationEnd");ys(og,"onAnimationIteration");ys(cg,"onAnimationStart");ys("dblclick","onDoubleClick");ys("focusin","onFocus");ys("focusout","onBlur");ys(ug,"onTransitionEnd");Nl("onMouseEnter",["mouseout","mouseover"]);Nl("onMouseLeave",["mouseout","mouseover"]);Nl("onPointerEnter",["pointerout","pointerover"]);Nl("onPointerLeave",["pointerout","pointerover"]);Vs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ia="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Tw=new Set("cancel close invalid load scroll toggle".split(" ").concat(ia));function zp(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,Lx(r,t,void 0,e),e.currentTarget=null}function fg(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],s=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var c=r[i],u=c.instance,d=c.currentTarget;if(c=c.listener,u!==a&&s.isPropagationStopped())break e;zp(s,c,d),a=u}else for(i=0;i<r.length;i++){if(c=r[i],u=c.instance,d=c.currentTarget,c=c.listener,u!==a&&s.isPropagationStopped())break e;zp(s,c,d),a=u}}}if(to)throw e=wu,to=!1,wu=null,e}function yt(e,t){var n=t[Pu];n===void 0&&(n=t[Pu]=new Set);var r=e+"__bubble";n.has(r)||(pg(t,e,2,!1),n.add(r))}function Oc(e,t,n){var r=0;t&&(r|=4),pg(n,e,r,t)}var bi="_reactListening"+Math.random().toString(36).slice(2);function La(e){if(!e[bi]){e[bi]=!0,wh.forEach(function(n){n!=="selectionchange"&&(Tw.has(n)||Oc(n,!1,e),Oc(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[bi]||(t[bi]=!0,Oc("selectionchange",!1,t))}}function pg(e,t,n,r){switch(qh(t)){case 1:var s=Hx;break;case 4:s=Kx;break;default:s=Ad}n=s.bind(null,t,n,e),s=void 0,!xu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),r?s!==void 0?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):s!==void 0?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function Fc(e,t,n,r,s){var a=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var i=r.tag;if(i===3||i===4){var c=r.stateNode.containerInfo;if(c===s||c.nodeType===8&&c.parentNode===s)break;if(i===4)for(i=r.return;i!==null;){var u=i.tag;if((u===3||u===4)&&(u=i.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;i=i.return}for(;c!==null;){if(i=zs(c),i===null)return;if(u=i.tag,u===5||u===6){r=a=i;continue e}c=c.parentNode}}r=r.return}$h(function(){var d=a,g=Nd(n),v=[];e:{var y=dg.get(e);if(y!==void 0){var x=Pd,S=e;switch(e){case"keypress":if(Vi(n)===0)break e;case"keydown":case"keyup":x=iw;break;case"focusin":S="focus",x=Rc;break;case"focusout":S="blur",x=Rc;break;case"beforeblur":case"afterblur":x=Rc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=Sp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Qx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=uw;break;case ig:case og:case cg:x=Jx;break;case ug:x=fw;break;case"scroll":x=Gx;break;case"wheel":x=mw;break;case"copy":case"cut":case"paste":x=ew;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=jp}var j=(t&4)!==0,N=!j&&e==="scroll",m=j?y!==null?y+"Capture":null:y;j=[];for(var p=d,h;p!==null;){h=p;var w=h.stateNode;if(h.tag===5&&w!==null&&(h=w,m!==null&&(w=ja(p,m),w!=null&&j.push(Pa(p,w,h)))),N)break;p=p.return}0<j.length&&(y=new x(y,S,null,n,g),v.push({event:y,listeners:j}))}}if(!(t&7)){e:{if(y=e==="mouseover"||e==="pointerover",x=e==="mouseout"||e==="pointerout",y&&n!==yu&&(S=n.relatedTarget||n.fromElement)&&(zs(S)||S[Pr]))break e;if((x||y)&&(y=g.window===g?g:(y=g.ownerDocument)?y.defaultView||y.parentWindow:window,x?(S=n.relatedTarget||n.toElement,x=d,S=S?zs(S):null,S!==null&&(N=Ws(S),S!==N||S.tag!==5&&S.tag!==6)&&(S=null)):(x=null,S=d),x!==S)){if(j=Sp,w="onMouseLeave",m="onMouseEnter",p="mouse",(e==="pointerout"||e==="pointerover")&&(j=jp,w="onPointerLeave",m="onPointerEnter",p="pointer"),N=x==null?y:ol(x),h=S==null?y:ol(S),y=new j(w,p+"leave",x,n,g),y.target=N,y.relatedTarget=h,w=null,zs(g)===d&&(j=new j(m,p+"enter",S,n,g),j.target=h,j.relatedTarget=N,w=j),N=w,x&&S)t:{for(j=x,m=S,p=0,h=j;h;h=el(h))p++;for(h=0,w=m;w;w=el(w))h++;for(;0<p-h;)j=el(j),p--;for(;0<h-p;)m=el(m),h--;for(;p--;){if(j===m||m!==null&&j===m.alternate)break t;j=el(j),m=el(m)}j=null}else j=null;x!==null&&_p(v,y,x,j,!1),S!==null&&N!==null&&_p(v,N,S,j,!0)}}e:{if(y=d?ol(d):window,x=y.nodeName&&y.nodeName.toLowerCase(),x==="select"||x==="input"&&y.type==="file")var E=Sw;else if(bp(y))if(ng)E=Cw;else{E=jw;var b=kw}else(x=y.nodeName)&&x.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(E=Nw);if(E&&(E=E(e,d))){tg(v,E,n,g);break e}b&&b(e,y,d),e==="focusout"&&(b=y._wrapperState)&&b.controlled&&y.type==="number"&&fu(y,"number",y.value)}switch(b=d?ol(d):window,e){case"focusin":(bp(b)||b.contentEditable==="true")&&(al=b,Nu=d,ma=null);break;case"focusout":ma=Nu=al=null;break;case"mousedown":Cu=!0;break;case"contextmenu":case"mouseup":case"dragend":Cu=!1,Tp(v,n,g);break;case"selectionchange":if(Aw)break;case"keydown":case"keyup":Tp(v,n,g)}var L;if(Rd)e:{switch(e){case"compositionstart":var z="onCompositionStart";break e;case"compositionend":z="onCompositionEnd";break e;case"compositionupdate":z="onCompositionUpdate";break e}z=void 0}else ll?Zh(e,n)&&(z="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(z="onCompositionStart");z&&(Jh&&n.locale!=="ko"&&(ll||z!=="onCompositionStart"?z==="onCompositionEnd"&&ll&&(L=Xh()):(ts=g,Ld="value"in ts?ts.value:ts.textContent,ll=!0)),b=ao(d,z),0<b.length&&(z=new kp(z,e,null,n,g),v.push({event:z,listeners:b}),L?z.data=L:(L=eg(n),L!==null&&(z.data=L)))),(L=gw?yw(e,n):vw(e,n))&&(d=ao(d,"onBeforeInput"),0<d.length&&(g=new kp("onBeforeInput","beforeinput",null,n,g),v.push({event:g,listeners:d}),g.data=L))}fg(v,t)})}function Pa(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ao(e,t){for(var n=t+"Capture",r=[];e!==null;){var s=e,a=s.stateNode;s.tag===5&&a!==null&&(s=a,a=ja(e,n),a!=null&&r.unshift(Pa(e,a,s)),a=ja(e,t),a!=null&&r.push(Pa(e,a,s))),e=e.return}return r}function el(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function _p(e,t,n,r,s){for(var a=t._reactName,i=[];n!==null&&n!==r;){var c=n,u=c.alternate,d=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&d!==null&&(c=d,s?(u=ja(n,a),u!=null&&i.unshift(Pa(n,u,c))):s||(u=ja(n,a),u!=null&&i.push(Pa(n,u,c)))),n=n.return}i.length!==0&&e.push({event:t,listeners:i})}var Rw=/\r\n?/g,zw=/\u0000|\uFFFD/g;function Ip(e){return(typeof e=="string"?e:""+e).replace(Rw,`
`).replace(zw,"")}function Ei(e,t,n){if(t=Ip(t),Ip(e)!==t&&n)throw Error(oe(425))}function io(){}var bu=null,Eu=null;function Au(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Lu=typeof setTimeout=="function"?setTimeout:void 0,_w=typeof clearTimeout=="function"?clearTimeout:void 0,$p=typeof Promise=="function"?Promise:void 0,Iw=typeof queueMicrotask=="function"?queueMicrotask:typeof $p<"u"?function(e){return $p.resolve(null).then(e).catch($w)}:Lu;function $w(e){setTimeout(function(){throw e})}function Dc(e,t){var n=t,r=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){e.removeChild(s),ba(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);ba(t)}function os(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Mp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Il=Math.random().toString(36).slice(2),ur="__reactFiber$"+Il,Ta="__reactProps$"+Il,Pr="__reactContainer$"+Il,Pu="__reactEvents$"+Il,Mw="__reactListeners$"+Il,Ow="__reactHandles$"+Il;function zs(e){var t=e[ur];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Pr]||n[ur]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Mp(e);e!==null;){if(n=e[ur])return n;e=Mp(e)}return t}e=n,n=e.parentNode}return null}function Ka(e){return e=e[ur]||e[Pr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ol(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(oe(33))}function Ho(e){return e[Ta]||null}var Tu=[],cl=-1;function vs(e){return{current:e}}function vt(e){0>cl||(e.current=Tu[cl],Tu[cl]=null,cl--)}function ht(e,t){cl++,Tu[cl]=e.current,e.current=t}var hs={},qt=vs(hs),mn=vs(!1),Os=hs;function Cl(e,t){var n=e.type.contextTypes;if(!n)return hs;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var s={},a;for(a in n)s[a]=t[a];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function hn(e){return e=e.childContextTypes,e!=null}function oo(){vt(mn),vt(qt)}function Op(e,t,n){if(qt.current!==hs)throw Error(oe(168));ht(qt,t),ht(mn,n)}function mg(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in t))throw Error(oe(108,kx(e)||"Unknown",s));return Ct({},n,r)}function co(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||hs,Os=qt.current,ht(qt,e),ht(mn,mn.current),!0}function Fp(e,t,n){var r=e.stateNode;if(!r)throw Error(oe(169));n?(e=mg(e,t,Os),r.__reactInternalMemoizedMergedChildContext=e,vt(mn),vt(qt),ht(qt,e)):vt(mn),ht(mn,n)}var jr=null,Ko=!1,Bc=!1;function hg(e){jr===null?jr=[e]:jr.push(e)}function Fw(e){Ko=!0,hg(e)}function xs(){if(!Bc&&jr!==null){Bc=!0;var e=0,t=dt;try{var n=jr;for(dt=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}jr=null,Ko=!1}catch(s){throw jr!==null&&(jr=jr.slice(e+1)),Dh(Cd,xs),s}finally{dt=t,Bc=!1}}return null}var ul=[],dl=0,uo=null,fo=0,$n=[],Mn=0,Fs=null,Cr=1,br="";function Ts(e,t){ul[dl++]=fo,ul[dl++]=uo,uo=e,fo=t}function gg(e,t,n){$n[Mn++]=Cr,$n[Mn++]=br,$n[Mn++]=Fs,Fs=e;var r=Cr;e=br;var s=32-Jn(r)-1;r&=~(1<<s),n+=1;var a=32-Jn(t)+s;if(30<a){var i=s-s%5;a=(r&(1<<i)-1).toString(32),r>>=i,s-=i,Cr=1<<32-Jn(t)+s|n<<s|r,br=a+e}else Cr=1<<a|n<<s|r,br=e}function _d(e){e.return!==null&&(Ts(e,1),gg(e,1,0))}function Id(e){for(;e===uo;)uo=ul[--dl],ul[dl]=null,fo=ul[--dl],ul[dl]=null;for(;e===Fs;)Fs=$n[--Mn],$n[Mn]=null,br=$n[--Mn],$n[Mn]=null,Cr=$n[--Mn],$n[Mn]=null}var Cn=null,Nn=null,St=!1,Xn=null;function yg(e,t){var n=On(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Dp(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Cn=e,Nn=os(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Cn=e,Nn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Fs!==null?{id:Cr,overflow:br}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=On(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Cn=e,Nn=null,!0):!1;default:return!1}}function Ru(e){return(e.mode&1)!==0&&(e.flags&128)===0}function zu(e){if(St){var t=Nn;if(t){var n=t;if(!Dp(e,t)){if(Ru(e))throw Error(oe(418));t=os(n.nextSibling);var r=Cn;t&&Dp(e,t)?yg(r,n):(e.flags=e.flags&-4097|2,St=!1,Cn=e)}}else{if(Ru(e))throw Error(oe(418));e.flags=e.flags&-4097|2,St=!1,Cn=e}}}function Bp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Cn=e}function Ai(e){if(e!==Cn)return!1;if(!St)return Bp(e),St=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Au(e.type,e.memoizedProps)),t&&(t=Nn)){if(Ru(e))throw vg(),Error(oe(418));for(;t;)yg(e,t),t=os(t.nextSibling)}if(Bp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(oe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Nn=os(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Nn=null}}else Nn=Cn?os(e.stateNode.nextSibling):null;return!0}function vg(){for(var e=Nn;e;)e=os(e.nextSibling)}function bl(){Nn=Cn=null,St=!1}function $d(e){Xn===null?Xn=[e]:Xn.push(e)}var Dw=zr.ReactCurrentBatchConfig;function ta(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(oe(309));var r=n.stateNode}if(!r)throw Error(oe(147,e));var s=r,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(i){var c=s.refs;i===null?delete c[a]:c[a]=i},t._stringRef=a,t)}if(typeof e!="string")throw Error(oe(284));if(!n._owner)throw Error(oe(290,e))}return e}function Li(e,t){throw e=Object.prototype.toString.call(t),Error(oe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Up(e){var t=e._init;return t(e._payload)}function xg(e){function t(m,p){if(e){var h=m.deletions;h===null?(m.deletions=[p],m.flags|=16):h.push(p)}}function n(m,p){if(!e)return null;for(;p!==null;)t(m,p),p=p.sibling;return null}function r(m,p){for(m=new Map;p!==null;)p.key!==null?m.set(p.key,p):m.set(p.index,p),p=p.sibling;return m}function s(m,p){return m=fs(m,p),m.index=0,m.sibling=null,m}function a(m,p,h){return m.index=h,e?(h=m.alternate,h!==null?(h=h.index,h<p?(m.flags|=2,p):h):(m.flags|=2,p)):(m.flags|=1048576,p)}function i(m){return e&&m.alternate===null&&(m.flags|=2),m}function c(m,p,h,w){return p===null||p.tag!==6?(p=Yc(h,m.mode,w),p.return=m,p):(p=s(p,h),p.return=m,p)}function u(m,p,h,w){var E=h.type;return E===sl?g(m,p,h.props.children,w,h.key):p!==null&&(p.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Qr&&Up(E)===p.type)?(w=s(p,h.props),w.ref=ta(m,p,h),w.return=m,w):(w=qi(h.type,h.key,h.props,null,m.mode,w),w.ref=ta(m,p,h),w.return=m,w)}function d(m,p,h,w){return p===null||p.tag!==4||p.stateNode.containerInfo!==h.containerInfo||p.stateNode.implementation!==h.implementation?(p=Qc(h,m.mode,w),p.return=m,p):(p=s(p,h.children||[]),p.return=m,p)}function g(m,p,h,w,E){return p===null||p.tag!==7?(p=Ms(h,m.mode,w,E),p.return=m,p):(p=s(p,h),p.return=m,p)}function v(m,p,h){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Yc(""+p,m.mode,h),p.return=m,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case vi:return h=qi(p.type,p.key,p.props,null,m.mode,h),h.ref=ta(m,null,p),h.return=m,h;case rl:return p=Qc(p,m.mode,h),p.return=m,p;case Qr:var w=p._init;return v(m,w(p._payload),h)}if(la(p)||ql(p))return p=Ms(p,m.mode,h,null),p.return=m,p;Li(m,p)}return null}function y(m,p,h,w){var E=p!==null?p.key:null;if(typeof h=="string"&&h!==""||typeof h=="number")return E!==null?null:c(m,p,""+h,w);if(typeof h=="object"&&h!==null){switch(h.$$typeof){case vi:return h.key===E?u(m,p,h,w):null;case rl:return h.key===E?d(m,p,h,w):null;case Qr:return E=h._init,y(m,p,E(h._payload),w)}if(la(h)||ql(h))return E!==null?null:g(m,p,h,w,null);Li(m,h)}return null}function x(m,p,h,w,E){if(typeof w=="string"&&w!==""||typeof w=="number")return m=m.get(h)||null,c(p,m,""+w,E);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case vi:return m=m.get(w.key===null?h:w.key)||null,u(p,m,w,E);case rl:return m=m.get(w.key===null?h:w.key)||null,d(p,m,w,E);case Qr:var b=w._init;return x(m,p,h,b(w._payload),E)}if(la(w)||ql(w))return m=m.get(h)||null,g(p,m,w,E,null);Li(p,w)}return null}function S(m,p,h,w){for(var E=null,b=null,L=p,z=p=0,$=null;L!==null&&z<h.length;z++){L.index>z?($=L,L=null):$=L.sibling;var T=y(m,L,h[z],w);if(T===null){L===null&&(L=$);break}e&&L&&T.alternate===null&&t(m,L),p=a(T,p,z),b===null?E=T:b.sibling=T,b=T,L=$}if(z===h.length)return n(m,L),St&&Ts(m,z),E;if(L===null){for(;z<h.length;z++)L=v(m,h[z],w),L!==null&&(p=a(L,p,z),b===null?E=L:b.sibling=L,b=L);return St&&Ts(m,z),E}for(L=r(m,L);z<h.length;z++)$=x(L,m,z,h[z],w),$!==null&&(e&&$.alternate!==null&&L.delete($.key===null?z:$.key),p=a($,p,z),b===null?E=$:b.sibling=$,b=$);return e&&L.forEach(function(F){return t(m,F)}),St&&Ts(m,z),E}function j(m,p,h,w){var E=ql(h);if(typeof E!="function")throw Error(oe(150));if(h=E.call(h),h==null)throw Error(oe(151));for(var b=E=null,L=p,z=p=0,$=null,T=h.next();L!==null&&!T.done;z++,T=h.next()){L.index>z?($=L,L=null):$=L.sibling;var F=y(m,L,T.value,w);if(F===null){L===null&&(L=$);break}e&&L&&F.alternate===null&&t(m,L),p=a(F,p,z),b===null?E=F:b.sibling=F,b=F,L=$}if(T.done)return n(m,L),St&&Ts(m,z),E;if(L===null){for(;!T.done;z++,T=h.next())T=v(m,T.value,w),T!==null&&(p=a(T,p,z),b===null?E=T:b.sibling=T,b=T);return St&&Ts(m,z),E}for(L=r(m,L);!T.done;z++,T=h.next())T=x(L,m,z,T.value,w),T!==null&&(e&&T.alternate!==null&&L.delete(T.key===null?z:T.key),p=a(T,p,z),b===null?E=T:b.sibling=T,b=T);return e&&L.forEach(function(Z){return t(m,Z)}),St&&Ts(m,z),E}function N(m,p,h,w){if(typeof h=="object"&&h!==null&&h.type===sl&&h.key===null&&(h=h.props.children),typeof h=="object"&&h!==null){switch(h.$$typeof){case vi:e:{for(var E=h.key,b=p;b!==null;){if(b.key===E){if(E=h.type,E===sl){if(b.tag===7){n(m,b.sibling),p=s(b,h.props.children),p.return=m,m=p;break e}}else if(b.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Qr&&Up(E)===b.type){n(m,b.sibling),p=s(b,h.props),p.ref=ta(m,b,h),p.return=m,m=p;break e}n(m,b);break}else t(m,b);b=b.sibling}h.type===sl?(p=Ms(h.props.children,m.mode,w,h.key),p.return=m,m=p):(w=qi(h.type,h.key,h.props,null,m.mode,w),w.ref=ta(m,p,h),w.return=m,m=w)}return i(m);case rl:e:{for(b=h.key;p!==null;){if(p.key===b)if(p.tag===4&&p.stateNode.containerInfo===h.containerInfo&&p.stateNode.implementation===h.implementation){n(m,p.sibling),p=s(p,h.children||[]),p.return=m,m=p;break e}else{n(m,p);break}else t(m,p);p=p.sibling}p=Qc(h,m.mode,w),p.return=m,m=p}return i(m);case Qr:return b=h._init,N(m,p,b(h._payload),w)}if(la(h))return S(m,p,h,w);if(ql(h))return j(m,p,h,w);Li(m,h)}return typeof h=="string"&&h!==""||typeof h=="number"?(h=""+h,p!==null&&p.tag===6?(n(m,p.sibling),p=s(p,h),p.return=m,m=p):(n(m,p),p=Yc(h,m.mode,w),p.return=m,m=p),i(m)):n(m,p)}return N}var El=xg(!0),wg=xg(!1),po=vs(null),mo=null,fl=null,Md=null;function Od(){Md=fl=mo=null}function Fd(e){var t=po.current;vt(po),e._currentValue=t}function _u(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Sl(e,t){mo=e,Md=fl=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(pn=!0),e.firstContext=null)}function Dn(e){var t=e._currentValue;if(Md!==e)if(e={context:e,memoizedValue:t,next:null},fl===null){if(mo===null)throw Error(oe(308));fl=e,mo.dependencies={lanes:0,firstContext:e}}else fl=fl.next=e;return t}var _s=null;function Dd(e){_s===null?_s=[e]:_s.push(e)}function Sg(e,t,n,r){var s=t.interleaved;return s===null?(n.next=n,Dd(t)):(n.next=s.next,s.next=n),t.interleaved=n,Tr(e,r)}function Tr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var qr=!1;function Bd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Er(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function cs(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,st&2){var s=r.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),r.pending=t,Tr(e,n)}return s=r.interleaved,s===null?(t.next=t,Dd(r)):(t.next=s.next,s.next=t),r.interleaved=t,Tr(e,n)}function Wi(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,bd(e,n)}}function Vp(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?s=a=i:a=a.next=i,n=n.next}while(n!==null);a===null?s=a=t:a=a.next=t}else s=a=t;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ho(e,t,n,r){var s=e.updateQueue;qr=!1;var a=s.firstBaseUpdate,i=s.lastBaseUpdate,c=s.shared.pending;if(c!==null){s.shared.pending=null;var u=c,d=u.next;u.next=null,i===null?a=d:i.next=d,i=u;var g=e.alternate;g!==null&&(g=g.updateQueue,c=g.lastBaseUpdate,c!==i&&(c===null?g.firstBaseUpdate=d:c.next=d,g.lastBaseUpdate=u))}if(a!==null){var v=s.baseState;i=0,g=d=u=null,c=a;do{var y=c.lane,x=c.eventTime;if((r&y)===y){g!==null&&(g=g.next={eventTime:x,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var S=e,j=c;switch(y=t,x=n,j.tag){case 1:if(S=j.payload,typeof S=="function"){v=S.call(x,v,y);break e}v=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=j.payload,y=typeof S=="function"?S.call(x,v,y):S,y==null)break e;v=Ct({},v,y);break e;case 2:qr=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,y=s.effects,y===null?s.effects=[c]:y.push(c))}else x={eventTime:x,lane:y,tag:c.tag,payload:c.payload,callback:c.callback,next:null},g===null?(d=g=x,u=v):g=g.next=x,i|=y;if(c=c.next,c===null){if(c=s.shared.pending,c===null)break;y=c,c=y.next,y.next=null,s.lastBaseUpdate=y,s.shared.pending=null}}while(!0);if(g===null&&(u=v),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=g,t=s.shared.interleaved,t!==null){s=t;do i|=s.lane,s=s.next;while(s!==t)}else a===null&&(s.shared.lanes=0);Bs|=i,e.lanes=i,e.memoizedState=v}}function Wp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(oe(191,s));s.call(r)}}}var Ga={},yr=vs(Ga),Ra=vs(Ga),za=vs(Ga);function Is(e){if(e===Ga)throw Error(oe(174));return e}function Ud(e,t){switch(ht(za,t),ht(Ra,e),ht(yr,Ga),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:mu(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=mu(t,e)}vt(yr),ht(yr,t)}function Al(){vt(yr),vt(Ra),vt(za)}function jg(e){Is(za.current);var t=Is(yr.current),n=mu(t,e.type);t!==n&&(ht(Ra,e),ht(yr,n))}function Vd(e){Ra.current===e&&(vt(yr),vt(Ra))}var kt=vs(0);function go(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Uc=[];function Wd(){for(var e=0;e<Uc.length;e++)Uc[e]._workInProgressVersionPrimary=null;Uc.length=0}var Hi=zr.ReactCurrentDispatcher,Vc=zr.ReactCurrentBatchConfig,Ds=0,jt=null,_t=null,Mt=null,yo=!1,ha=!1,_a=0,Bw=0;function Gt(){throw Error(oe(321))}function Hd(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!er(e[n],t[n]))return!1;return!0}function Kd(e,t,n,r,s,a){if(Ds=a,jt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Hi.current=e===null||e.memoizedState===null?Hw:Kw,e=n(r,s),ha){a=0;do{if(ha=!1,_a=0,25<=a)throw Error(oe(301));a+=1,Mt=_t=null,t.updateQueue=null,Hi.current=Gw,e=n(r,s)}while(ha)}if(Hi.current=vo,t=_t!==null&&_t.next!==null,Ds=0,Mt=_t=jt=null,yo=!1,t)throw Error(oe(300));return e}function Gd(){var e=_a!==0;return _a=0,e}function or(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mt===null?jt.memoizedState=Mt=e:Mt=Mt.next=e,Mt}function Bn(){if(_t===null){var e=jt.alternate;e=e!==null?e.memoizedState:null}else e=_t.next;var t=Mt===null?jt.memoizedState:Mt.next;if(t!==null)Mt=t,_t=e;else{if(e===null)throw Error(oe(310));_t=e,e={memoizedState:_t.memoizedState,baseState:_t.baseState,baseQueue:_t.baseQueue,queue:_t.queue,next:null},Mt===null?jt.memoizedState=Mt=e:Mt=Mt.next=e}return Mt}function Ia(e,t){return typeof t=="function"?t(e):t}function Wc(e){var t=Bn(),n=t.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=e;var r=_t,s=r.baseQueue,a=n.pending;if(a!==null){if(s!==null){var i=s.next;s.next=a.next,a.next=i}r.baseQueue=s=a,n.pending=null}if(s!==null){a=s.next,r=r.baseState;var c=i=null,u=null,d=a;do{var g=d.lane;if((Ds&g)===g)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var v={lane:g,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(c=u=v,i=r):u=u.next=v,jt.lanes|=g,Bs|=g}d=d.next}while(d!==null&&d!==a);u===null?i=r:u.next=c,er(r,t.memoizedState)||(pn=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=u,n.lastRenderedState=r}if(e=n.interleaved,e!==null){s=e;do a=s.lane,jt.lanes|=a,Bs|=a,s=s.next;while(s!==e)}else s===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Hc(e){var t=Bn(),n=t.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,a=t.memoizedState;if(s!==null){n.pending=null;var i=s=s.next;do a=e(a,i.action),i=i.next;while(i!==s);er(a,t.memoizedState)||(pn=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Ng(){}function Cg(e,t){var n=jt,r=Bn(),s=t(),a=!er(r.memoizedState,s);if(a&&(r.memoizedState=s,pn=!0),r=r.queue,Yd(Ag.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||Mt!==null&&Mt.memoizedState.tag&1){if(n.flags|=2048,$a(9,Eg.bind(null,n,r,s,t),void 0,null),Ot===null)throw Error(oe(349));Ds&30||bg(n,t,s)}return s}function bg(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=jt.updateQueue,t===null?(t={lastEffect:null,stores:null},jt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Eg(e,t,n,r){t.value=n,t.getSnapshot=r,Lg(t)&&Pg(e)}function Ag(e,t,n){return n(function(){Lg(t)&&Pg(e)})}function Lg(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!er(e,n)}catch{return!0}}function Pg(e){var t=Tr(e,1);t!==null&&Zn(t,e,1,-1)}function Hp(e){var t=or();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:e},t.queue=e,e=e.dispatch=Ww.bind(null,jt,e),[t.memoizedState,e]}function $a(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=jt.updateQueue,t===null?(t={lastEffect:null,stores:null},jt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Tg(){return Bn().memoizedState}function Ki(e,t,n,r){var s=or();jt.flags|=e,s.memoizedState=$a(1|t,n,void 0,r===void 0?null:r)}function Go(e,t,n,r){var s=Bn();r=r===void 0?null:r;var a=void 0;if(_t!==null){var i=_t.memoizedState;if(a=i.destroy,r!==null&&Hd(r,i.deps)){s.memoizedState=$a(t,n,a,r);return}}jt.flags|=e,s.memoizedState=$a(1|t,n,a,r)}function Kp(e,t){return Ki(8390656,8,e,t)}function Yd(e,t){return Go(2048,8,e,t)}function Rg(e,t){return Go(4,2,e,t)}function zg(e,t){return Go(4,4,e,t)}function _g(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Ig(e,t,n){return n=n!=null?n.concat([e]):null,Go(4,4,_g.bind(null,t,e),n)}function Qd(){}function $g(e,t){var n=Bn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Hd(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Mg(e,t){var n=Bn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Hd(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Og(e,t,n){return Ds&21?(er(n,t)||(n=Vh(),jt.lanes|=n,Bs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,pn=!0),e.memoizedState=n)}function Uw(e,t){var n=dt;dt=n!==0&&4>n?n:4,e(!0);var r=Vc.transition;Vc.transition={};try{e(!1),t()}finally{dt=n,Vc.transition=r}}function Fg(){return Bn().memoizedState}function Vw(e,t,n){var r=ds(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Dg(e))Bg(t,n);else if(n=Sg(e,t,n,r),n!==null){var s=sn();Zn(n,e,r,s),Ug(n,t,r)}}function Ww(e,t,n){var r=ds(e),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Dg(e))Bg(t,s);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var i=t.lastRenderedState,c=a(i,n);if(s.hasEagerState=!0,s.eagerState=c,er(c,i)){var u=t.interleaved;u===null?(s.next=s,Dd(t)):(s.next=u.next,u.next=s),t.interleaved=s;return}}catch{}finally{}n=Sg(e,t,s,r),n!==null&&(s=sn(),Zn(n,e,r,s),Ug(n,t,r))}}function Dg(e){var t=e.alternate;return e===jt||t!==null&&t===jt}function Bg(e,t){ha=yo=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ug(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,bd(e,n)}}var vo={readContext:Dn,useCallback:Gt,useContext:Gt,useEffect:Gt,useImperativeHandle:Gt,useInsertionEffect:Gt,useLayoutEffect:Gt,useMemo:Gt,useReducer:Gt,useRef:Gt,useState:Gt,useDebugValue:Gt,useDeferredValue:Gt,useTransition:Gt,useMutableSource:Gt,useSyncExternalStore:Gt,useId:Gt,unstable_isNewReconciler:!1},Hw={readContext:Dn,useCallback:function(e,t){return or().memoizedState=[e,t===void 0?null:t],e},useContext:Dn,useEffect:Kp,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Ki(4194308,4,_g.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ki(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ki(4,2,e,t)},useMemo:function(e,t){var n=or();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=or();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Vw.bind(null,jt,e),[r.memoizedState,e]},useRef:function(e){var t=or();return e={current:e},t.memoizedState=e},useState:Hp,useDebugValue:Qd,useDeferredValue:function(e){return or().memoizedState=e},useTransition:function(){var e=Hp(!1),t=e[0];return e=Uw.bind(null,e[1]),or().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=jt,s=or();if(St){if(n===void 0)throw Error(oe(407));n=n()}else{if(n=t(),Ot===null)throw Error(oe(349));Ds&30||bg(r,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,Kp(Ag.bind(null,r,a,e),[e]),r.flags|=2048,$a(9,Eg.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=or(),t=Ot.identifierPrefix;if(St){var n=br,r=Cr;n=(r&~(1<<32-Jn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=_a++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Bw++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Kw={readContext:Dn,useCallback:$g,useContext:Dn,useEffect:Yd,useImperativeHandle:Ig,useInsertionEffect:Rg,useLayoutEffect:zg,useMemo:Mg,useReducer:Wc,useRef:Tg,useState:function(){return Wc(Ia)},useDebugValue:Qd,useDeferredValue:function(e){var t=Bn();return Og(t,_t.memoizedState,e)},useTransition:function(){var e=Wc(Ia)[0],t=Bn().memoizedState;return[e,t]},useMutableSource:Ng,useSyncExternalStore:Cg,useId:Fg,unstable_isNewReconciler:!1},Gw={readContext:Dn,useCallback:$g,useContext:Dn,useEffect:Yd,useImperativeHandle:Ig,useInsertionEffect:Rg,useLayoutEffect:zg,useMemo:Mg,useReducer:Hc,useRef:Tg,useState:function(){return Hc(Ia)},useDebugValue:Qd,useDeferredValue:function(e){var t=Bn();return _t===null?t.memoizedState=e:Og(t,_t.memoizedState,e)},useTransition:function(){var e=Hc(Ia)[0],t=Bn().memoizedState;return[e,t]},useMutableSource:Ng,useSyncExternalStore:Cg,useId:Fg,unstable_isNewReconciler:!1};function Qn(e,t){if(e&&e.defaultProps){t=Ct({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Iu(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Ct({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Yo={isMounted:function(e){return(e=e._reactInternals)?Ws(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=sn(),s=ds(e),a=Er(r,s);a.payload=t,n!=null&&(a.callback=n),t=cs(e,a,s),t!==null&&(Zn(t,e,s,r),Wi(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=sn(),s=ds(e),a=Er(r,s);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=cs(e,a,s),t!==null&&(Zn(t,e,s,r),Wi(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=sn(),r=ds(e),s=Er(n,r);s.tag=2,t!=null&&(s.callback=t),t=cs(e,s,r),t!==null&&(Zn(t,e,r,n),Wi(t,e,r))}};function Gp(e,t,n,r,s,a,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,a,i):t.prototype&&t.prototype.isPureReactComponent?!Aa(n,r)||!Aa(s,a):!0}function Vg(e,t,n){var r=!1,s=hs,a=t.contextType;return typeof a=="object"&&a!==null?a=Dn(a):(s=hn(t)?Os:qt.current,r=t.contextTypes,a=(r=r!=null)?Cl(e,s):hs),t=new t(n,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Yo,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=a),t}function Yp(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Yo.enqueueReplaceState(t,t.state,null)}function $u(e,t,n,r){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},Bd(e);var a=t.contextType;typeof a=="object"&&a!==null?s.context=Dn(a):(a=hn(t)?Os:qt.current,s.context=Cl(e,a)),s.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(Iu(e,t,a,n),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&Yo.enqueueReplaceState(s,s.state,null),ho(e,n,s,r),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function Ll(e,t){try{var n="",r=t;do n+=Sx(r),r=r.return;while(r);var s=n}catch(a){s=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:s,digest:null}}function Kc(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Mu(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Yw=typeof WeakMap=="function"?WeakMap:Map;function Wg(e,t,n){n=Er(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){wo||(wo=!0,Gu=r),Mu(e,t)},n}function Hg(e,t,n){n=Er(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var s=t.value;n.payload=function(){return r(s)},n.callback=function(){Mu(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Mu(e,t),typeof r!="function"&&(us===null?us=new Set([this]):us.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),n}function Qp(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Yw;var s=new Set;r.set(t,s)}else s=r.get(t),s===void 0&&(s=new Set,r.set(t,s));s.has(n)||(s.add(n),e=o0.bind(null,e,t,n),t.then(e,e))}function qp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Xp(e,t,n,r,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Er(-1,1),t.tag=2,cs(n,t,1))),n.lanes|=1),e)}var Qw=zr.ReactCurrentOwner,pn=!1;function tn(e,t,n,r){t.child=e===null?wg(t,null,n,r):El(t,e.child,n,r)}function Jp(e,t,n,r,s){n=n.render;var a=t.ref;return Sl(t,s),r=Kd(e,t,n,r,a,s),n=Gd(),e!==null&&!pn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Rr(e,t,s)):(St&&n&&_d(t),t.flags|=1,tn(e,t,r,s),t.child)}function Zp(e,t,n,r,s){if(e===null){var a=n.type;return typeof a=="function"&&!rf(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=a,Kg(e,t,a,r,s)):(e=qi(n.type,null,r,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&s)){var i=a.memoizedProps;if(n=n.compare,n=n!==null?n:Aa,n(i,r)&&e.ref===t.ref)return Rr(e,t,s)}return t.flags|=1,e=fs(a,r),e.ref=t.ref,e.return=t,t.child=e}function Kg(e,t,n,r,s){if(e!==null){var a=e.memoizedProps;if(Aa(a,r)&&e.ref===t.ref)if(pn=!1,t.pendingProps=r=a,(e.lanes&s)!==0)e.flags&131072&&(pn=!0);else return t.lanes=e.lanes,Rr(e,t,s)}return Ou(e,t,n,r,s)}function Gg(e,t,n){var r=t.pendingProps,s=r.children,a=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ht(ml,jn),jn|=n;else{if(!(n&1073741824))return e=a!==null?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ht(ml,jn),jn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,ht(ml,jn),jn|=r}else a!==null?(r=a.baseLanes|n,t.memoizedState=null):r=n,ht(ml,jn),jn|=r;return tn(e,t,s,n),t.child}function Yg(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ou(e,t,n,r,s){var a=hn(n)?Os:qt.current;return a=Cl(t,a),Sl(t,s),n=Kd(e,t,n,r,a,s),r=Gd(),e!==null&&!pn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Rr(e,t,s)):(St&&r&&_d(t),t.flags|=1,tn(e,t,n,s),t.child)}function em(e,t,n,r,s){if(hn(n)){var a=!0;co(t)}else a=!1;if(Sl(t,s),t.stateNode===null)Gi(e,t),Vg(t,n,r),$u(t,n,r,s),r=!0;else if(e===null){var i=t.stateNode,c=t.memoizedProps;i.props=c;var u=i.context,d=n.contextType;typeof d=="object"&&d!==null?d=Dn(d):(d=hn(n)?Os:qt.current,d=Cl(t,d));var g=n.getDerivedStateFromProps,v=typeof g=="function"||typeof i.getSnapshotBeforeUpdate=="function";v||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(c!==r||u!==d)&&Yp(t,i,r,d),qr=!1;var y=t.memoizedState;i.state=y,ho(t,r,i,s),u=t.memoizedState,c!==r||y!==u||mn.current||qr?(typeof g=="function"&&(Iu(t,n,g,r),u=t.memoizedState),(c=qr||Gp(t,n,c,r,y,u,d))?(v||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),i.props=r,i.state=u,i.context=d,r=c):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,kg(e,t),c=t.memoizedProps,d=t.type===t.elementType?c:Qn(t.type,c),i.props=d,v=t.pendingProps,y=i.context,u=n.contextType,typeof u=="object"&&u!==null?u=Dn(u):(u=hn(n)?Os:qt.current,u=Cl(t,u));var x=n.getDerivedStateFromProps;(g=typeof x=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(c!==v||y!==u)&&Yp(t,i,r,u),qr=!1,y=t.memoizedState,i.state=y,ho(t,r,i,s);var S=t.memoizedState;c!==v||y!==S||mn.current||qr?(typeof x=="function"&&(Iu(t,n,x,r),S=t.memoizedState),(d=qr||Gp(t,n,d,r,y,S,u)||!1)?(g||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(r,S,u),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(r,S,u)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=S),i.props=r,i.state=S,i.context=u,r=d):(typeof i.componentDidUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=1024),r=!1)}return Fu(e,t,n,r,a,s)}function Fu(e,t,n,r,s,a){Yg(e,t);var i=(t.flags&128)!==0;if(!r&&!i)return s&&Fp(t,n,!1),Rr(e,t,a);r=t.stateNode,Qw.current=t;var c=i&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&i?(t.child=El(t,e.child,null,a),t.child=El(t,null,c,a)):tn(e,t,c,a),t.memoizedState=r.state,s&&Fp(t,n,!0),t.child}function Qg(e){var t=e.stateNode;t.pendingContext?Op(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Op(e,t.context,!1),Ud(e,t.containerInfo)}function tm(e,t,n,r,s){return bl(),$d(s),t.flags|=256,tn(e,t,n,r),t.child}var Du={dehydrated:null,treeContext:null,retryLane:0};function Bu(e){return{baseLanes:e,cachePool:null,transitions:null}}function qg(e,t,n){var r=t.pendingProps,s=kt.current,a=!1,i=(t.flags&128)!==0,c;if((c=i)||(c=e!==null&&e.memoizedState===null?!1:(s&2)!==0),c?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),ht(kt,s&1),e===null)return zu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=r.children,e=r.fallback,a?(r=t.mode,a=t.child,i={mode:"hidden",children:i},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=i):a=Xo(i,r,0,null),e=Ms(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Bu(n),t.memoizedState=Du,e):qd(t,i));if(s=e.memoizedState,s!==null&&(c=s.dehydrated,c!==null))return qw(e,t,i,r,c,s,n);if(a){a=r.fallback,i=t.mode,s=e.child,c=s.sibling;var u={mode:"hidden",children:r.children};return!(i&1)&&t.child!==s?(r=t.child,r.childLanes=0,r.pendingProps=u,t.deletions=null):(r=fs(s,u),r.subtreeFlags=s.subtreeFlags&14680064),c!==null?a=fs(c,a):(a=Ms(a,i,n,null),a.flags|=2),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,i=e.child.memoizedState,i=i===null?Bu(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},a.memoizedState=i,a.childLanes=e.childLanes&~n,t.memoizedState=Du,r}return a=e.child,e=a.sibling,r=fs(a,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function qd(e,t){return t=Xo({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Pi(e,t,n,r){return r!==null&&$d(r),El(t,e.child,null,n),e=qd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function qw(e,t,n,r,s,a,i){if(n)return t.flags&256?(t.flags&=-257,r=Kc(Error(oe(422))),Pi(e,t,i,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=r.fallback,s=t.mode,r=Xo({mode:"visible",children:r.children},s,0,null),a=Ms(a,s,i,null),a.flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,t.mode&1&&El(t,e.child,null,i),t.child.memoizedState=Bu(i),t.memoizedState=Du,a);if(!(t.mode&1))return Pi(e,t,i,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var c=r.dgst;return r=c,a=Error(oe(419)),r=Kc(a,r,void 0),Pi(e,t,i,r)}if(c=(i&e.childLanes)!==0,pn||c){if(r=Ot,r!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|i)?0:s,s!==0&&s!==a.retryLane&&(a.retryLane=s,Tr(e,s),Zn(r,e,s,-1))}return nf(),r=Kc(Error(oe(421))),Pi(e,t,i,r)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=c0.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,Nn=os(s.nextSibling),Cn=t,St=!0,Xn=null,e!==null&&($n[Mn++]=Cr,$n[Mn++]=br,$n[Mn++]=Fs,Cr=e.id,br=e.overflow,Fs=t),t=qd(t,r.children),t.flags|=4096,t)}function nm(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),_u(e.return,t,n)}function Gc(e,t,n,r,s){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=s)}function Xg(e,t,n){var r=t.pendingProps,s=r.revealOrder,a=r.tail;if(tn(e,t,r.children,n),r=kt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&nm(e,n,t);else if(e.tag===19)nm(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ht(kt,r),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;n!==null;)e=n.alternate,e!==null&&go(e)===null&&(s=n),n=n.sibling;n=s,n===null?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Gc(t,!1,s,n,a);break;case"backwards":for(n=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&go(e)===null){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Gc(t,!0,n,null,a);break;case"together":Gc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gi(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Rr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Bs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(oe(153));if(t.child!==null){for(e=t.child,n=fs(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=fs(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Xw(e,t,n){switch(t.tag){case 3:Qg(t),bl();break;case 5:jg(t);break;case 1:hn(t.type)&&co(t);break;case 4:Ud(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,s=t.memoizedProps.value;ht(po,r._currentValue),r._currentValue=s;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(ht(kt,kt.current&1),t.flags|=128,null):n&t.child.childLanes?qg(e,t,n):(ht(kt,kt.current&1),e=Rr(e,t,n),e!==null?e.sibling:null);ht(kt,kt.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Xg(e,t,n);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ht(kt,kt.current),r)break;return null;case 22:case 23:return t.lanes=0,Gg(e,t,n)}return Rr(e,t,n)}var Jg,Uu,Zg,ey;Jg=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Uu=function(){};Zg=function(e,t,n,r){var s=e.memoizedProps;if(s!==r){e=t.stateNode,Is(yr.current);var a=null;switch(n){case"input":s=uu(e,s),r=uu(e,r),a=[];break;case"select":s=Ct({},s,{value:void 0}),r=Ct({},r,{value:void 0}),a=[];break;case"textarea":s=pu(e,s),r=pu(e,r),a=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=io)}hu(n,r);var i;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var c=s[d];for(i in c)c.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Sa.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var u=r[d];if(c=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==c&&(u!=null||c!=null))if(d==="style")if(c){for(i in c)!c.hasOwnProperty(i)||u&&u.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in u)u.hasOwnProperty(i)&&c[i]!==u[i]&&(n||(n={}),n[i]=u[i])}else n||(a||(a=[]),a.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(a=a||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(a=a||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Sa.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&yt("scroll",e),a||c===u||(a=[])):(a=a||[]).push(d,u))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}};ey=function(e,t,n,r){n!==r&&(t.flags|=4)};function na(e,t){if(!St)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Yt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var s=e.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Jw(e,t,n){var r=t.pendingProps;switch(Id(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(t),null;case 1:return hn(t.type)&&oo(),Yt(t),null;case 3:return r=t.stateNode,Al(),vt(mn),vt(qt),Wd(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Ai(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Xn!==null&&(qu(Xn),Xn=null))),Uu(e,t),Yt(t),null;case 5:Vd(t);var s=Is(za.current);if(n=t.type,e!==null&&t.stateNode!=null)Zg(e,t,n,r,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(oe(166));return Yt(t),null}if(e=Is(yr.current),Ai(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[ur]=t,r[Ta]=a,e=(t.mode&1)!==0,n){case"dialog":yt("cancel",r),yt("close",r);break;case"iframe":case"object":case"embed":yt("load",r);break;case"video":case"audio":for(s=0;s<ia.length;s++)yt(ia[s],r);break;case"source":yt("error",r);break;case"img":case"image":case"link":yt("error",r),yt("load",r);break;case"details":yt("toggle",r);break;case"input":dp(r,a),yt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},yt("invalid",r);break;case"textarea":pp(r,a),yt("invalid",r)}hu(n,a),s=null;for(var i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="children"?typeof c=="string"?r.textContent!==c&&(a.suppressHydrationWarning!==!0&&Ei(r.textContent,c,e),s=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(a.suppressHydrationWarning!==!0&&Ei(r.textContent,c,e),s=["children",""+c]):Sa.hasOwnProperty(i)&&c!=null&&i==="onScroll"&&yt("scroll",r)}switch(n){case"input":xi(r),fp(r,a,!0);break;case"textarea":xi(r),mp(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=io)}r=s,t.updateQueue=r,r!==null&&(t.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Ah(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=i.createElement(n,{is:r.is}):(e=i.createElement(n),n==="select"&&(i=e,r.multiple?i.multiple=!0:r.size&&(i.size=r.size))):e=i.createElementNS(e,n),e[ur]=t,e[Ta]=r,Jg(e,t,!1,!1),t.stateNode=e;e:{switch(i=gu(n,r),n){case"dialog":yt("cancel",e),yt("close",e),s=r;break;case"iframe":case"object":case"embed":yt("load",e),s=r;break;case"video":case"audio":for(s=0;s<ia.length;s++)yt(ia[s],e);s=r;break;case"source":yt("error",e),s=r;break;case"img":case"image":case"link":yt("error",e),yt("load",e),s=r;break;case"details":yt("toggle",e),s=r;break;case"input":dp(e,r),s=uu(e,r),yt("invalid",e);break;case"option":s=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},s=Ct({},r,{value:void 0}),yt("invalid",e);break;case"textarea":pp(e,r),s=pu(e,r),yt("invalid",e);break;default:s=r}hu(n,s),c=s;for(a in c)if(c.hasOwnProperty(a)){var u=c[a];a==="style"?Th(e,u):a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Lh(e,u)):a==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&ka(e,u):typeof u=="number"&&ka(e,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Sa.hasOwnProperty(a)?u!=null&&a==="onScroll"&&yt("scroll",e):u!=null&&wd(e,a,u,i))}switch(n){case"input":xi(e),fp(e,r,!1);break;case"textarea":xi(e),mp(e);break;case"option":r.value!=null&&e.setAttribute("value",""+ms(r.value));break;case"select":e.multiple=!!r.multiple,a=r.value,a!=null?yl(e,!!r.multiple,a,!1):r.defaultValue!=null&&yl(e,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=io)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Yt(t),null;case 6:if(e&&t.stateNode!=null)ey(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(oe(166));if(n=Is(za.current),Is(yr.current),Ai(t)){if(r=t.stateNode,n=t.memoizedProps,r[ur]=t,(a=r.nodeValue!==n)&&(e=Cn,e!==null))switch(e.tag){case 3:Ei(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ei(r.nodeValue,n,(e.mode&1)!==0)}a&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ur]=t,t.stateNode=r}return Yt(t),null;case 13:if(vt(kt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(St&&Nn!==null&&t.mode&1&&!(t.flags&128))vg(),bl(),t.flags|=98560,a=!1;else if(a=Ai(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(oe(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(oe(317));a[ur]=t}else bl(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Yt(t),a=!1}else Xn!==null&&(qu(Xn),Xn=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||kt.current&1?It===0&&(It=3):nf())),t.updateQueue!==null&&(t.flags|=4),Yt(t),null);case 4:return Al(),Uu(e,t),e===null&&La(t.stateNode.containerInfo),Yt(t),null;case 10:return Fd(t.type._context),Yt(t),null;case 17:return hn(t.type)&&oo(),Yt(t),null;case 19:if(vt(kt),a=t.memoizedState,a===null)return Yt(t),null;if(r=(t.flags&128)!==0,i=a.rendering,i===null)if(r)na(a,!1);else{if(It!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=go(e),i!==null){for(t.flags|=128,na(a,!1),r=i.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)a=n,e=r,a.flags&=14680066,i=a.alternate,i===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,a.type=i.type,e=i.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ht(kt,kt.current&1|2),t.child}e=e.sibling}a.tail!==null&&At()>Pl&&(t.flags|=128,r=!0,na(a,!1),t.lanes=4194304)}else{if(!r)if(e=go(i),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),na(a,!0),a.tail===null&&a.tailMode==="hidden"&&!i.alternate&&!St)return Yt(t),null}else 2*At()-a.renderingStartTime>Pl&&n!==1073741824&&(t.flags|=128,r=!0,na(a,!1),t.lanes=4194304);a.isBackwards?(i.sibling=t.child,t.child=i):(n=a.last,n!==null?n.sibling=i:t.child=i,a.last=i)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=At(),t.sibling=null,n=kt.current,ht(kt,r?n&1|2:n&1),t):(Yt(t),null);case 22:case 23:return tf(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?jn&1073741824&&(Yt(t),t.subtreeFlags&6&&(t.flags|=8192)):Yt(t),null;case 24:return null;case 25:return null}throw Error(oe(156,t.tag))}function Zw(e,t){switch(Id(t),t.tag){case 1:return hn(t.type)&&oo(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Al(),vt(mn),vt(qt),Wd(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Vd(t),null;case 13:if(vt(kt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(oe(340));bl()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return vt(kt),null;case 4:return Al(),null;case 10:return Fd(t.type._context),null;case 22:case 23:return tf(),null;case 24:return null;default:return null}}var Ti=!1,Qt=!1,e0=typeof WeakSet=="function"?WeakSet:Set,Ne=null;function pl(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Et(e,t,r)}else n.current=null}function Vu(e,t,n){try{n()}catch(r){Et(e,t,r)}}var rm=!1;function t0(e,t){if(bu=so,e=lg(),zd(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var i=0,c=-1,u=-1,d=0,g=0,v=e,y=null;t:for(;;){for(var x;v!==n||s!==0&&v.nodeType!==3||(c=i+s),v!==a||r!==0&&v.nodeType!==3||(u=i+r),v.nodeType===3&&(i+=v.nodeValue.length),(x=v.firstChild)!==null;)y=v,v=x;for(;;){if(v===e)break t;if(y===n&&++d===s&&(c=i),y===a&&++g===r&&(u=i),(x=v.nextSibling)!==null)break;v=y,y=v.parentNode}v=x}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Eu={focusedElem:e,selectionRange:n},so=!1,Ne=t;Ne!==null;)if(t=Ne,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ne=e;else for(;Ne!==null;){t=Ne;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var j=S.memoizedProps,N=S.memoizedState,m=t.stateNode,p=m.getSnapshotBeforeUpdate(t.elementType===t.type?j:Qn(t.type,j),N);m.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var h=t.stateNode.containerInfo;h.nodeType===1?h.textContent="":h.nodeType===9&&h.documentElement&&h.removeChild(h.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(w){Et(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,Ne=e;break}Ne=t.return}return S=rm,rm=!1,S}function ga(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&e)===e){var a=s.destroy;s.destroy=void 0,a!==void 0&&Vu(t,n,a)}s=s.next}while(s!==r)}}function Qo(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Wu(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function ty(e){var t=e.alternate;t!==null&&(e.alternate=null,ty(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ur],delete t[Ta],delete t[Pu],delete t[Mw],delete t[Ow])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ny(e){return e.tag===5||e.tag===3||e.tag===4}function sm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ny(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Hu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=io));else if(r!==4&&(e=e.child,e!==null))for(Hu(e,t,n),e=e.sibling;e!==null;)Hu(e,t,n),e=e.sibling}function Ku(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Ku(e,t,n),e=e.sibling;e!==null;)Ku(e,t,n),e=e.sibling}var Vt=null,qn=!1;function Yr(e,t,n){for(n=n.child;n!==null;)ry(e,t,n),n=n.sibling}function ry(e,t,n){if(gr&&typeof gr.onCommitFiberUnmount=="function")try{gr.onCommitFiberUnmount(Bo,n)}catch{}switch(n.tag){case 5:Qt||pl(n,t);case 6:var r=Vt,s=qn;Vt=null,Yr(e,t,n),Vt=r,qn=s,Vt!==null&&(qn?(e=Vt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Vt.removeChild(n.stateNode));break;case 18:Vt!==null&&(qn?(e=Vt,n=n.stateNode,e.nodeType===8?Dc(e.parentNode,n):e.nodeType===1&&Dc(e,n),ba(e)):Dc(Vt,n.stateNode));break;case 4:r=Vt,s=qn,Vt=n.stateNode.containerInfo,qn=!0,Yr(e,t,n),Vt=r,qn=s;break;case 0:case 11:case 14:case 15:if(!Qt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var a=s,i=a.destroy;a=a.tag,i!==void 0&&(a&2||a&4)&&Vu(n,t,i),s=s.next}while(s!==r)}Yr(e,t,n);break;case 1:if(!Qt&&(pl(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){Et(n,t,c)}Yr(e,t,n);break;case 21:Yr(e,t,n);break;case 22:n.mode&1?(Qt=(r=Qt)||n.memoizedState!==null,Yr(e,t,n),Qt=r):Yr(e,t,n);break;default:Yr(e,t,n)}}function lm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new e0),t.forEach(function(r){var s=u0.bind(null,e,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Yn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var a=e,i=t,c=i;e:for(;c!==null;){switch(c.tag){case 5:Vt=c.stateNode,qn=!1;break e;case 3:Vt=c.stateNode.containerInfo,qn=!0;break e;case 4:Vt=c.stateNode.containerInfo,qn=!0;break e}c=c.return}if(Vt===null)throw Error(oe(160));ry(a,i,s),Vt=null,qn=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){Et(s,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)sy(t,e),t=t.sibling}function sy(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Yn(t,e),ir(e),r&4){try{ga(3,e,e.return),Qo(3,e)}catch(j){Et(e,e.return,j)}try{ga(5,e,e.return)}catch(j){Et(e,e.return,j)}}break;case 1:Yn(t,e),ir(e),r&512&&n!==null&&pl(n,n.return);break;case 5:if(Yn(t,e),ir(e),r&512&&n!==null&&pl(n,n.return),e.flags&32){var s=e.stateNode;try{ka(s,"")}catch(j){Et(e,e.return,j)}}if(r&4&&(s=e.stateNode,s!=null)){var a=e.memoizedProps,i=n!==null?n.memoizedProps:a,c=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{c==="input"&&a.type==="radio"&&a.name!=null&&bh(s,a),gu(c,i);var d=gu(c,a);for(i=0;i<u.length;i+=2){var g=u[i],v=u[i+1];g==="style"?Th(s,v):g==="dangerouslySetInnerHTML"?Lh(s,v):g==="children"?ka(s,v):wd(s,g,v,d)}switch(c){case"input":du(s,a);break;case"textarea":Eh(s,a);break;case"select":var y=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var x=a.value;x!=null?yl(s,!!a.multiple,x,!1):y!==!!a.multiple&&(a.defaultValue!=null?yl(s,!!a.multiple,a.defaultValue,!0):yl(s,!!a.multiple,a.multiple?[]:"",!1))}s[Ta]=a}catch(j){Et(e,e.return,j)}}break;case 6:if(Yn(t,e),ir(e),r&4){if(e.stateNode===null)throw Error(oe(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(j){Et(e,e.return,j)}}break;case 3:if(Yn(t,e),ir(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ba(t.containerInfo)}catch(j){Et(e,e.return,j)}break;case 4:Yn(t,e),ir(e);break;case 13:Yn(t,e),ir(e),s=e.child,s.flags&8192&&(a=s.memoizedState!==null,s.stateNode.isHidden=a,!a||s.alternate!==null&&s.alternate.memoizedState!==null||(Zd=At())),r&4&&lm(e);break;case 22:if(g=n!==null&&n.memoizedState!==null,e.mode&1?(Qt=(d=Qt)||g,Yn(t,e),Qt=d):Yn(t,e),ir(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!g&&e.mode&1)for(Ne=e,g=e.child;g!==null;){for(v=Ne=g;Ne!==null;){switch(y=Ne,x=y.child,y.tag){case 0:case 11:case 14:case 15:ga(4,y,y.return);break;case 1:pl(y,y.return);var S=y.stateNode;if(typeof S.componentWillUnmount=="function"){r=y,n=y.return;try{t=r,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(j){Et(r,n,j)}}break;case 5:pl(y,y.return);break;case 22:if(y.memoizedState!==null){im(v);continue}}x!==null?(x.return=y,Ne=x):im(v)}g=g.sibling}e:for(g=null,v=e;;){if(v.tag===5){if(g===null){g=v;try{s=v.stateNode,d?(a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(c=v.stateNode,u=v.memoizedProps.style,i=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=Ph("display",i))}catch(j){Et(e,e.return,j)}}}else if(v.tag===6){if(g===null)try{v.stateNode.nodeValue=d?"":v.memoizedProps}catch(j){Et(e,e.return,j)}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===e)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===e)break e;for(;v.sibling===null;){if(v.return===null||v.return===e)break e;g===v&&(g=null),v=v.return}g===v&&(g=null),v.sibling.return=v.return,v=v.sibling}}break;case 19:Yn(t,e),ir(e),r&4&&lm(e);break;case 21:break;default:Yn(t,e),ir(e)}}function ir(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(ny(n)){var r=n;break e}n=n.return}throw Error(oe(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(ka(s,""),r.flags&=-33);var a=sm(e);Ku(e,a,s);break;case 3:case 4:var i=r.stateNode.containerInfo,c=sm(e);Hu(e,c,i);break;default:throw Error(oe(161))}}catch(u){Et(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function n0(e,t,n){Ne=e,ly(e)}function ly(e,t,n){for(var r=(e.mode&1)!==0;Ne!==null;){var s=Ne,a=s.child;if(s.tag===22&&r){var i=s.memoizedState!==null||Ti;if(!i){var c=s.alternate,u=c!==null&&c.memoizedState!==null||Qt;c=Ti;var d=Qt;if(Ti=i,(Qt=u)&&!d)for(Ne=s;Ne!==null;)i=Ne,u=i.child,i.tag===22&&i.memoizedState!==null?om(s):u!==null?(u.return=i,Ne=u):om(s);for(;a!==null;)Ne=a,ly(a),a=a.sibling;Ne=s,Ti=c,Qt=d}am(e)}else s.subtreeFlags&8772&&a!==null?(a.return=s,Ne=a):am(e)}}function am(e){for(;Ne!==null;){var t=Ne;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Qt||Qo(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Qt)if(n===null)r.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:Qn(t.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&Wp(t,a,r);break;case 3:var i=t.updateQueue;if(i!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Wp(t,i,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var g=d.memoizedState;if(g!==null){var v=g.dehydrated;v!==null&&ba(v)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}Qt||t.flags&512&&Wu(t)}catch(y){Et(t,t.return,y)}}if(t===e){Ne=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ne=n;break}Ne=t.return}}function im(e){for(;Ne!==null;){var t=Ne;if(t===e){Ne=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ne=n;break}Ne=t.return}}function om(e){for(;Ne!==null;){var t=Ne;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Qo(4,t)}catch(u){Et(t,n,u)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var s=t.return;try{r.componentDidMount()}catch(u){Et(t,s,u)}}var a=t.return;try{Wu(t)}catch(u){Et(t,a,u)}break;case 5:var i=t.return;try{Wu(t)}catch(u){Et(t,i,u)}}}catch(u){Et(t,t.return,u)}if(t===e){Ne=null;break}var c=t.sibling;if(c!==null){c.return=t.return,Ne=c;break}Ne=t.return}}var r0=Math.ceil,xo=zr.ReactCurrentDispatcher,Xd=zr.ReactCurrentOwner,Fn=zr.ReactCurrentBatchConfig,st=0,Ot=null,Rt=null,Wt=0,jn=0,ml=vs(0),It=0,Ma=null,Bs=0,qo=0,Jd=0,ya=null,fn=null,Zd=0,Pl=1/0,kr=null,wo=!1,Gu=null,us=null,Ri=!1,ns=null,So=0,va=0,Yu=null,Yi=-1,Qi=0;function sn(){return st&6?At():Yi!==-1?Yi:Yi=At()}function ds(e){return e.mode&1?st&2&&Wt!==0?Wt&-Wt:Dw.transition!==null?(Qi===0&&(Qi=Vh()),Qi):(e=dt,e!==0||(e=window.event,e=e===void 0?16:qh(e.type)),e):1}function Zn(e,t,n,r){if(50<va)throw va=0,Yu=null,Error(oe(185));Wa(e,n,r),(!(st&2)||e!==Ot)&&(e===Ot&&(!(st&2)&&(qo|=n),It===4&&Jr(e,Wt)),gn(e,r),n===1&&st===0&&!(t.mode&1)&&(Pl=At()+500,Ko&&xs()))}function gn(e,t){var n=e.callbackNode;Dx(e,t);var r=ro(e,e===Ot?Wt:0);if(r===0)n!==null&&yp(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&yp(n),t===1)e.tag===0?Fw(cm.bind(null,e)):hg(cm.bind(null,e)),Iw(function(){!(st&6)&&xs()}),n=null;else{switch(Wh(r)){case 1:n=Cd;break;case 4:n=Bh;break;case 16:n=no;break;case 536870912:n=Uh;break;default:n=no}n=py(n,ay.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ay(e,t){if(Yi=-1,Qi=0,st&6)throw Error(oe(327));var n=e.callbackNode;if(kl()&&e.callbackNode!==n)return null;var r=ro(e,e===Ot?Wt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=ko(e,r);else{t=r;var s=st;st|=2;var a=oy();(Ot!==e||Wt!==t)&&(kr=null,Pl=At()+500,$s(e,t));do try{a0();break}catch(c){iy(e,c)}while(!0);Od(),xo.current=a,st=s,Rt!==null?t=0:(Ot=null,Wt=0,t=It)}if(t!==0){if(t===2&&(s=Su(e),s!==0&&(r=s,t=Qu(e,s))),t===1)throw n=Ma,$s(e,0),Jr(e,r),gn(e,At()),n;if(t===6)Jr(e,r);else{if(s=e.current.alternate,!(r&30)&&!s0(s)&&(t=ko(e,r),t===2&&(a=Su(e),a!==0&&(r=a,t=Qu(e,a))),t===1))throw n=Ma,$s(e,0),Jr(e,r),gn(e,At()),n;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(oe(345));case 2:Rs(e,fn,kr);break;case 3:if(Jr(e,r),(r&130023424)===r&&(t=Zd+500-At(),10<t)){if(ro(e,0)!==0)break;if(s=e.suspendedLanes,(s&r)!==r){sn(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=Lu(Rs.bind(null,e,fn,kr),t);break}Rs(e,fn,kr);break;case 4:if(Jr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,s=-1;0<r;){var i=31-Jn(r);a=1<<i,i=t[i],i>s&&(s=i),r&=~a}if(r=s,r=At()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*r0(r/1960))-r,10<r){e.timeoutHandle=Lu(Rs.bind(null,e,fn,kr),r);break}Rs(e,fn,kr);break;case 5:Rs(e,fn,kr);break;default:throw Error(oe(329))}}}return gn(e,At()),e.callbackNode===n?ay.bind(null,e):null}function Qu(e,t){var n=ya;return e.current.memoizedState.isDehydrated&&($s(e,t).flags|=256),e=ko(e,t),e!==2&&(t=fn,fn=n,t!==null&&qu(t)),e}function qu(e){fn===null?fn=e:fn.push.apply(fn,e)}function s0(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],a=s.getSnapshot;s=s.value;try{if(!er(a(),s))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Jr(e,t){for(t&=~Jd,t&=~qo,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Jn(t),r=1<<n;e[n]=-1,t&=~r}}function cm(e){if(st&6)throw Error(oe(327));kl();var t=ro(e,0);if(!(t&1))return gn(e,At()),null;var n=ko(e,t);if(e.tag!==0&&n===2){var r=Su(e);r!==0&&(t=r,n=Qu(e,r))}if(n===1)throw n=Ma,$s(e,0),Jr(e,t),gn(e,At()),n;if(n===6)throw Error(oe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Rs(e,fn,kr),gn(e,At()),null}function ef(e,t){var n=st;st|=1;try{return e(t)}finally{st=n,st===0&&(Pl=At()+500,Ko&&xs())}}function Us(e){ns!==null&&ns.tag===0&&!(st&6)&&kl();var t=st;st|=1;var n=Fn.transition,r=dt;try{if(Fn.transition=null,dt=1,e)return e()}finally{dt=r,Fn.transition=n,st=t,!(st&6)&&xs()}}function tf(){jn=ml.current,vt(ml)}function $s(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,_w(n)),Rt!==null)for(n=Rt.return;n!==null;){var r=n;switch(Id(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&oo();break;case 3:Al(),vt(mn),vt(qt),Wd();break;case 5:Vd(r);break;case 4:Al();break;case 13:vt(kt);break;case 19:vt(kt);break;case 10:Fd(r.type._context);break;case 22:case 23:tf()}n=n.return}if(Ot=e,Rt=e=fs(e.current,null),Wt=jn=t,It=0,Ma=null,Jd=qo=Bs=0,fn=ya=null,_s!==null){for(t=0;t<_s.length;t++)if(n=_s[t],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,a=n.pending;if(a!==null){var i=a.next;a.next=s,r.next=i}n.pending=r}_s=null}return e}function iy(e,t){do{var n=Rt;try{if(Od(),Hi.current=vo,yo){for(var r=jt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}yo=!1}if(Ds=0,Mt=_t=jt=null,ha=!1,_a=0,Xd.current=null,n===null||n.return===null){It=1,Ma=t,Rt=null;break}e:{var a=e,i=n.return,c=n,u=t;if(t=Wt,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,g=c,v=g.tag;if(!(g.mode&1)&&(v===0||v===11||v===15)){var y=g.alternate;y?(g.updateQueue=y.updateQueue,g.memoizedState=y.memoizedState,g.lanes=y.lanes):(g.updateQueue=null,g.memoizedState=null)}var x=qp(i);if(x!==null){x.flags&=-257,Xp(x,i,c,a,t),x.mode&1&&Qp(a,d,t),t=x,u=d;var S=t.updateQueue;if(S===null){var j=new Set;j.add(u),t.updateQueue=j}else S.add(u);break e}else{if(!(t&1)){Qp(a,d,t),nf();break e}u=Error(oe(426))}}else if(St&&c.mode&1){var N=qp(i);if(N!==null){!(N.flags&65536)&&(N.flags|=256),Xp(N,i,c,a,t),$d(Ll(u,c));break e}}a=u=Ll(u,c),It!==4&&(It=2),ya===null?ya=[a]:ya.push(a),a=i;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var m=Wg(a,u,t);Vp(a,m);break e;case 1:c=u;var p=a.type,h=a.stateNode;if(!(a.flags&128)&&(typeof p.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(us===null||!us.has(h)))){a.flags|=65536,t&=-t,a.lanes|=t;var w=Hg(a,c,t);Vp(a,w);break e}}a=a.return}while(a!==null)}uy(n)}catch(E){t=E,Rt===n&&n!==null&&(Rt=n=n.return);continue}break}while(!0)}function oy(){var e=xo.current;return xo.current=vo,e===null?vo:e}function nf(){(It===0||It===3||It===2)&&(It=4),Ot===null||!(Bs&268435455)&&!(qo&268435455)||Jr(Ot,Wt)}function ko(e,t){var n=st;st|=2;var r=oy();(Ot!==e||Wt!==t)&&(kr=null,$s(e,t));do try{l0();break}catch(s){iy(e,s)}while(!0);if(Od(),st=n,xo.current=r,Rt!==null)throw Error(oe(261));return Ot=null,Wt=0,It}function l0(){for(;Rt!==null;)cy(Rt)}function a0(){for(;Rt!==null&&!Tx();)cy(Rt)}function cy(e){var t=fy(e.alternate,e,jn);e.memoizedProps=e.pendingProps,t===null?uy(e):Rt=t,Xd.current=null}function uy(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Zw(n,t),n!==null){n.flags&=32767,Rt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{It=6,Rt=null;return}}else if(n=Jw(n,t,jn),n!==null){Rt=n;return}if(t=t.sibling,t!==null){Rt=t;return}Rt=t=e}while(t!==null);It===0&&(It=5)}function Rs(e,t,n){var r=dt,s=Fn.transition;try{Fn.transition=null,dt=1,i0(e,t,n,r)}finally{Fn.transition=s,dt=r}return null}function i0(e,t,n,r){do kl();while(ns!==null);if(st&6)throw Error(oe(327));n=e.finishedWork;var s=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(oe(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(Bx(e,a),e===Ot&&(Rt=Ot=null,Wt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ri||(Ri=!0,py(no,function(){return kl(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=Fn.transition,Fn.transition=null;var i=dt;dt=1;var c=st;st|=4,Xd.current=null,t0(e,n),sy(n,e),Ew(Eu),so=!!bu,Eu=bu=null,e.current=n,n0(n),Rx(),st=c,dt=i,Fn.transition=a}else e.current=n;if(Ri&&(Ri=!1,ns=e,So=s),a=e.pendingLanes,a===0&&(us=null),Ix(n.stateNode),gn(e,At()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(wo)throw wo=!1,e=Gu,Gu=null,e;return So&1&&e.tag!==0&&kl(),a=e.pendingLanes,a&1?e===Yu?va++:(va=0,Yu=e):va=0,xs(),null}function kl(){if(ns!==null){var e=Wh(So),t=Fn.transition,n=dt;try{if(Fn.transition=null,dt=16>e?16:e,ns===null)var r=!1;else{if(e=ns,ns=null,So=0,st&6)throw Error(oe(331));var s=st;for(st|=4,Ne=e.current;Ne!==null;){var a=Ne,i=a.child;if(Ne.flags&16){var c=a.deletions;if(c!==null){for(var u=0;u<c.length;u++){var d=c[u];for(Ne=d;Ne!==null;){var g=Ne;switch(g.tag){case 0:case 11:case 15:ga(8,g,a)}var v=g.child;if(v!==null)v.return=g,Ne=v;else for(;Ne!==null;){g=Ne;var y=g.sibling,x=g.return;if(ty(g),g===d){Ne=null;break}if(y!==null){y.return=x,Ne=y;break}Ne=x}}}var S=a.alternate;if(S!==null){var j=S.child;if(j!==null){S.child=null;do{var N=j.sibling;j.sibling=null,j=N}while(j!==null)}}Ne=a}}if(a.subtreeFlags&2064&&i!==null)i.return=a,Ne=i;else e:for(;Ne!==null;){if(a=Ne,a.flags&2048)switch(a.tag){case 0:case 11:case 15:ga(9,a,a.return)}var m=a.sibling;if(m!==null){m.return=a.return,Ne=m;break e}Ne=a.return}}var p=e.current;for(Ne=p;Ne!==null;){i=Ne;var h=i.child;if(i.subtreeFlags&2064&&h!==null)h.return=i,Ne=h;else e:for(i=p;Ne!==null;){if(c=Ne,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Qo(9,c)}}catch(E){Et(c,c.return,E)}if(c===i){Ne=null;break e}var w=c.sibling;if(w!==null){w.return=c.return,Ne=w;break e}Ne=c.return}}if(st=s,xs(),gr&&typeof gr.onPostCommitFiberRoot=="function")try{gr.onPostCommitFiberRoot(Bo,e)}catch{}r=!0}return r}finally{dt=n,Fn.transition=t}}return!1}function um(e,t,n){t=Ll(n,t),t=Wg(e,t,1),e=cs(e,t,1),t=sn(),e!==null&&(Wa(e,1,t),gn(e,t))}function Et(e,t,n){if(e.tag===3)um(e,e,n);else for(;t!==null;){if(t.tag===3){um(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(us===null||!us.has(r))){e=Ll(n,e),e=Hg(t,e,1),t=cs(t,e,1),e=sn(),t!==null&&(Wa(t,1,e),gn(t,e));break}}t=t.return}}function o0(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=sn(),e.pingedLanes|=e.suspendedLanes&n,Ot===e&&(Wt&n)===n&&(It===4||It===3&&(Wt&130023424)===Wt&&500>At()-Zd?$s(e,0):Jd|=n),gn(e,t)}function dy(e,t){t===0&&(e.mode&1?(t=ki,ki<<=1,!(ki&130023424)&&(ki=4194304)):t=1);var n=sn();e=Tr(e,t),e!==null&&(Wa(e,t,n),gn(e,n))}function c0(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),dy(e,n)}function u0(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(oe(314))}r!==null&&r.delete(t),dy(e,n)}var fy;fy=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||mn.current)pn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return pn=!1,Xw(e,t,n);pn=!!(e.flags&131072)}else pn=!1,St&&t.flags&1048576&&gg(t,fo,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Gi(e,t),e=t.pendingProps;var s=Cl(t,qt.current);Sl(t,n),s=Kd(null,t,r,e,s,n);var a=Gd();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,hn(r)?(a=!0,co(t)):a=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Bd(t),s.updater=Yo,t.stateNode=s,s._reactInternals=t,$u(t,r,e,n),t=Fu(null,t,r,!0,a,n)):(t.tag=0,St&&a&&_d(t),tn(null,t,s,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Gi(e,t),e=t.pendingProps,s=r._init,r=s(r._payload),t.type=r,s=t.tag=f0(r),e=Qn(r,e),s){case 0:t=Ou(null,t,r,e,n);break e;case 1:t=em(null,t,r,e,n);break e;case 11:t=Jp(null,t,r,e,n);break e;case 14:t=Zp(null,t,r,Qn(r.type,e),n);break e}throw Error(oe(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Qn(r,s),Ou(e,t,r,s,n);case 1:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Qn(r,s),em(e,t,r,s,n);case 3:e:{if(Qg(t),e===null)throw Error(oe(387));r=t.pendingProps,a=t.memoizedState,s=a.element,kg(e,t),ho(t,r,null,n);var i=t.memoizedState;if(r=i.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){s=Ll(Error(oe(423)),t),t=tm(e,t,r,n,s);break e}else if(r!==s){s=Ll(Error(oe(424)),t),t=tm(e,t,r,n,s);break e}else for(Nn=os(t.stateNode.containerInfo.firstChild),Cn=t,St=!0,Xn=null,n=wg(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(bl(),r===s){t=Rr(e,t,n);break e}tn(e,t,r,n)}t=t.child}return t;case 5:return jg(t),e===null&&zu(t),r=t.type,s=t.pendingProps,a=e!==null?e.memoizedProps:null,i=s.children,Au(r,s)?i=null:a!==null&&Au(r,a)&&(t.flags|=32),Yg(e,t),tn(e,t,i,n),t.child;case 6:return e===null&&zu(t),null;case 13:return qg(e,t,n);case 4:return Ud(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=El(t,null,r,n):tn(e,t,r,n),t.child;case 11:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Qn(r,s),Jp(e,t,r,s,n);case 7:return tn(e,t,t.pendingProps,n),t.child;case 8:return tn(e,t,t.pendingProps.children,n),t.child;case 12:return tn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,a=t.memoizedProps,i=s.value,ht(po,r._currentValue),r._currentValue=i,a!==null)if(er(a.value,i)){if(a.children===s.children&&!mn.current){t=Rr(e,t,n);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var c=a.dependencies;if(c!==null){i=a.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(a.tag===1){u=Er(-1,n&-n),u.tag=2;var d=a.updateQueue;if(d!==null){d=d.shared;var g=d.pending;g===null?u.next=u:(u.next=g.next,g.next=u),d.pending=u}}a.lanes|=n,u=a.alternate,u!==null&&(u.lanes|=n),_u(a.return,n,t),c.lanes|=n;break}u=u.next}}else if(a.tag===10)i=a.type===t.type?null:a.child;else if(a.tag===18){if(i=a.return,i===null)throw Error(oe(341));i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),_u(i,n,t),i=a.sibling}else i=a.child;if(i!==null)i.return=a;else for(i=a;i!==null;){if(i===t){i=null;break}if(a=i.sibling,a!==null){a.return=i.return,i=a;break}i=i.return}a=i}tn(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,Sl(t,n),s=Dn(s),r=r(s),t.flags|=1,tn(e,t,r,n),t.child;case 14:return r=t.type,s=Qn(r,t.pendingProps),s=Qn(r.type,s),Zp(e,t,r,s,n);case 15:return Kg(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Qn(r,s),Gi(e,t),t.tag=1,hn(r)?(e=!0,co(t)):e=!1,Sl(t,n),Vg(t,r,s),$u(t,r,s,n),Fu(null,t,r,!0,e,n);case 19:return Xg(e,t,n);case 22:return Gg(e,t,n)}throw Error(oe(156,t.tag))};function py(e,t){return Dh(e,t)}function d0(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function On(e,t,n,r){return new d0(e,t,n,r)}function rf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function f0(e){if(typeof e=="function")return rf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===kd)return 11;if(e===jd)return 14}return 2}function fs(e,t){var n=e.alternate;return n===null?(n=On(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function qi(e,t,n,r,s,a){var i=2;if(r=e,typeof e=="function")rf(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case sl:return Ms(n.children,s,a,t);case Sd:i=8,s|=8;break;case au:return e=On(12,n,t,s|2),e.elementType=au,e.lanes=a,e;case iu:return e=On(13,n,t,s),e.elementType=iu,e.lanes=a,e;case ou:return e=On(19,n,t,s),e.elementType=ou,e.lanes=a,e;case jh:return Xo(n,s,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Sh:i=10;break e;case kh:i=9;break e;case kd:i=11;break e;case jd:i=14;break e;case Qr:i=16,r=null;break e}throw Error(oe(130,e==null?e:typeof e,""))}return t=On(i,n,t,s),t.elementType=e,t.type=r,t.lanes=a,t}function Ms(e,t,n,r){return e=On(7,e,r,t),e.lanes=n,e}function Xo(e,t,n,r){return e=On(22,e,r,t),e.elementType=jh,e.lanes=n,e.stateNode={isHidden:!1},e}function Yc(e,t,n){return e=On(6,e,null,t),e.lanes=n,e}function Qc(e,t,n){return t=On(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function p0(e,t,n,r,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Lc(0),this.expirationTimes=Lc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Lc(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function sf(e,t,n,r,s,a,i,c,u){return e=new p0(e,t,n,c,u),t===1?(t=1,a===!0&&(t|=8)):t=0,a=On(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bd(a),e}function m0(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rl,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function my(e){if(!e)return hs;e=e._reactInternals;e:{if(Ws(e)!==e||e.tag!==1)throw Error(oe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(hn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(oe(171))}if(e.tag===1){var n=e.type;if(hn(n))return mg(e,n,t)}return t}function hy(e,t,n,r,s,a,i,c,u){return e=sf(n,r,!0,e,s,a,i,c,u),e.context=my(null),n=e.current,r=sn(),s=ds(n),a=Er(r,s),a.callback=t??null,cs(n,a,s),e.current.lanes=s,Wa(e,s,r),gn(e,r),e}function Jo(e,t,n,r){var s=t.current,a=sn(),i=ds(s);return n=my(n),t.context===null?t.context=n:t.pendingContext=n,t=Er(a,i),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=cs(s,t,i),e!==null&&(Zn(e,s,i,a),Wi(e,s,i)),i}function jo(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function dm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function lf(e,t){dm(e,t),(e=e.alternate)&&dm(e,t)}function h0(){return null}var gy=typeof reportError=="function"?reportError:function(e){console.error(e)};function af(e){this._internalRoot=e}Zo.prototype.render=af.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(oe(409));Jo(e,t,null,null)};Zo.prototype.unmount=af.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Us(function(){Jo(null,e,null,null)}),t[Pr]=null}};function Zo(e){this._internalRoot=e}Zo.prototype.unstable_scheduleHydration=function(e){if(e){var t=Gh();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Xr.length&&t!==0&&t<Xr[n].priority;n++);Xr.splice(n,0,e),n===0&&Qh(e)}};function of(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ec(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function fm(){}function g0(e,t,n,r,s){if(s){if(typeof r=="function"){var a=r;r=function(){var d=jo(i);a.call(d)}}var i=hy(t,r,e,0,null,!1,!1,"",fm);return e._reactRootContainer=i,e[Pr]=i.current,La(e.nodeType===8?e.parentNode:e),Us(),i}for(;s=e.lastChild;)e.removeChild(s);if(typeof r=="function"){var c=r;r=function(){var d=jo(u);c.call(d)}}var u=sf(e,0,!1,null,null,!1,!1,"",fm);return e._reactRootContainer=u,e[Pr]=u.current,La(e.nodeType===8?e.parentNode:e),Us(function(){Jo(t,u,n,r)}),u}function tc(e,t,n,r,s){var a=n._reactRootContainer;if(a){var i=a;if(typeof s=="function"){var c=s;s=function(){var u=jo(i);c.call(u)}}Jo(t,i,e,s)}else i=g0(n,t,e,s,r);return jo(i)}Hh=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=aa(t.pendingLanes);n!==0&&(bd(t,n|1),gn(t,At()),!(st&6)&&(Pl=At()+500,xs()))}break;case 13:Us(function(){var r=Tr(e,1);if(r!==null){var s=sn();Zn(r,e,1,s)}}),lf(e,1)}};Ed=function(e){if(e.tag===13){var t=Tr(e,134217728);if(t!==null){var n=sn();Zn(t,e,134217728,n)}lf(e,134217728)}};Kh=function(e){if(e.tag===13){var t=ds(e),n=Tr(e,t);if(n!==null){var r=sn();Zn(n,e,t,r)}lf(e,t)}};Gh=function(){return dt};Yh=function(e,t){var n=dt;try{return dt=e,t()}finally{dt=n}};vu=function(e,t,n){switch(t){case"input":if(du(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=Ho(r);if(!s)throw Error(oe(90));Ch(r),du(r,s)}}}break;case"textarea":Eh(e,n);break;case"select":t=n.value,t!=null&&yl(e,!!n.multiple,t,!1)}};_h=ef;Ih=Us;var y0={usingClientEntryPoint:!1,Events:[Ka,ol,Ho,Rh,zh,ef]},ra={findFiberByHostInstance:zs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},v0={bundleType:ra.bundleType,version:ra.version,rendererPackageName:ra.rendererPackageName,rendererConfig:ra.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Oh(e),e===null?null:e.stateNode},findFiberByHostInstance:ra.findFiberByHostInstance||h0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zi.isDisabled&&zi.supportsFiber)try{Bo=zi.inject(v0),gr=zi}catch{}}An.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y0;An.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!of(t))throw Error(oe(200));return m0(e,t,null,n)};An.createRoot=function(e,t){if(!of(e))throw Error(oe(299));var n=!1,r="",s=gy;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=sf(e,1,!1,null,null,n,!1,r,s),e[Pr]=t.current,La(e.nodeType===8?e.parentNode:e),new af(t)};An.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(oe(188)):(e=Object.keys(e).join(","),Error(oe(268,e)));return e=Oh(t),e=e===null?null:e.stateNode,e};An.flushSync=function(e){return Us(e)};An.hydrate=function(e,t,n){if(!ec(t))throw Error(oe(200));return tc(null,e,t,!0,n)};An.hydrateRoot=function(e,t,n){if(!of(e))throw Error(oe(405));var r=n!=null&&n.hydratedSources||null,s=!1,a="",i=gy;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),t=hy(t,null,e,1,n??null,s,!1,a,i),e[Pr]=t.current,La(e),r)for(e=0;e<r.length;e++)n=r[e],s=n._getVersion,s=s(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Zo(t)};An.render=function(e,t,n){if(!ec(t))throw Error(oe(200));return tc(null,e,t,!1,n)};An.unmountComponentAtNode=function(e){if(!ec(e))throw Error(oe(40));return e._reactRootContainer?(Us(function(){tc(null,null,e,!1,function(){e._reactRootContainer=null,e[Pr]=null})}),!0):!1};An.unstable_batchedUpdates=ef;An.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!ec(n))throw Error(oe(200));if(e==null||e._reactInternals===void 0)throw Error(oe(38));return tc(e,t,n,!1,r)};An.version="18.3.1-next-f1338f8080-20240426";function yy(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yy)}catch(e){console.error(e)}}yy(),yh.exports=An;var cf=yh.exports,pm=cf;su.createRoot=pm.createRoot,su.hydrateRoot=pm.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Oa(){return Oa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Oa.apply(this,arguments)}var rs;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(rs||(rs={}));const mm="popstate";function x0(e){e===void 0&&(e={});function t(s,a){let{pathname:i="/",search:c="",hash:u=""}=Hs(s.location.hash.substr(1));return!i.startsWith("/")&&!i.startsWith(".")&&(i="/"+i),Xu("",{pathname:i,search:c,hash:u},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(s,a){let i=s.document.querySelector("base"),c="";if(i&&i.getAttribute("href")){let u=s.location.href,d=u.indexOf("#");c=d===-1?u:u.slice(0,d)}return c+"#"+(typeof a=="string"?a:No(a))}function r(s,a){uf(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")}return S0(t,n,r,e)}function Nt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function uf(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function w0(){return Math.random().toString(36).substr(2,8)}function hm(e,t){return{usr:e.state,key:e.key,idx:t}}function Xu(e,t,n,r){return n===void 0&&(n=null),Oa({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Hs(t):t,{state:n,key:t&&t.key||r||w0()})}function No(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Hs(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function S0(e,t,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:a=!1}=r,i=s.history,c=rs.Pop,u=null,d=g();d==null&&(d=0,i.replaceState(Oa({},i.state,{idx:d}),""));function g(){return(i.state||{idx:null}).idx}function v(){c=rs.Pop;let N=g(),m=N==null?null:N-d;d=N,u&&u({action:c,location:j.location,delta:m})}function y(N,m){c=rs.Push;let p=Xu(j.location,N,m);n&&n(p,N),d=g()+1;let h=hm(p,d),w=j.createHref(p);try{i.pushState(h,"",w)}catch(E){if(E instanceof DOMException&&E.name==="DataCloneError")throw E;s.location.assign(w)}a&&u&&u({action:c,location:j.location,delta:1})}function x(N,m){c=rs.Replace;let p=Xu(j.location,N,m);n&&n(p,N),d=g();let h=hm(p,d),w=j.createHref(p);i.replaceState(h,"",w),a&&u&&u({action:c,location:j.location,delta:0})}function S(N){let m=s.location.origin!=="null"?s.location.origin:s.location.href,p=typeof N=="string"?N:No(N);return p=p.replace(/ $/,"%20"),Nt(m,"No window.location.(origin|href) available to create URL for href: "+p),new URL(p,m)}let j={get action(){return c},get location(){return e(s,i)},listen(N){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(mm,v),u=N,()=>{s.removeEventListener(mm,v),u=null}},createHref(N){return t(s,N)},createURL:S,encodeLocation(N){let m=S(N);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:y,replace:x,go(N){return i.go(N)}};return j}var gm;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(gm||(gm={}));function k0(e,t,n){return n===void 0&&(n="/"),j0(e,t,n)}function j0(e,t,n,r){let s=typeof t=="string"?Hs(t):t,a=Tl(s.pathname||"/",n);if(a==null)return null;let i=vy(e);N0(i);let c=null;for(let u=0;c==null&&u<i.length;++u){let d=I0(a);c=z0(i[u],d)}return c}function vy(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(a,i,c)=>{let u={relativePath:c===void 0?a.path||"":c,caseSensitive:a.caseSensitive===!0,childrenIndex:i,route:a};u.relativePath.startsWith("/")&&(Nt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=ps([r,u.relativePath]),g=n.concat(u);a.children&&a.children.length>0&&(Nt(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),vy(a.children,t,g,d)),!(a.path==null&&!a.index)&&t.push({path:d,score:T0(d,a.index),routesMeta:g})};return e.forEach((a,i)=>{var c;if(a.path===""||!((c=a.path)!=null&&c.includes("?")))s(a,i);else for(let u of xy(a.path))s(a,i,u)}),t}function xy(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,s=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return s?[a,""]:[a];let i=xy(r.join("/")),c=[];return c.push(...i.map(u=>u===""?a:[a,u].join("/"))),s&&c.push(...i),c.map(u=>e.startsWith("/")&&u===""?"/":u)}function N0(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:R0(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const C0=/^:[\w-]+$/,b0=3,E0=2,A0=1,L0=10,P0=-2,ym=e=>e==="*";function T0(e,t){let n=e.split("/"),r=n.length;return n.some(ym)&&(r+=P0),t&&(r+=E0),n.filter(s=>!ym(s)).reduce((s,a)=>s+(C0.test(a)?b0:a===""?A0:L0),r)}function R0(e,t){return e.length===t.length&&e.slice(0,-1).every((r,s)=>r===t[s])?e[e.length-1]-t[t.length-1]:0}function z0(e,t,n){let{routesMeta:r}=e,s={},a="/",i=[];for(let c=0;c<r.length;++c){let u=r[c],d=c===r.length-1,g=a==="/"?t:t.slice(a.length)||"/",v=Ju({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},g),y=u.route;if(!v)return null;Object.assign(s,v.params),i.push({params:s,pathname:ps([a,v.pathname]),pathnameBase:F0(ps([a,v.pathnameBase])),route:y}),v.pathnameBase!=="/"&&(a=ps([a,v.pathnameBase]))}return i}function Ju(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=_0(e.path,e.caseSensitive,e.end),s=t.match(n);if(!s)return null;let a=s[0],i=a.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:r.reduce((d,g,v)=>{let{paramName:y,isOptional:x}=g;if(y==="*"){let j=c[v]||"";i=a.slice(0,a.length-j.length).replace(/(.)\/+$/,"$1")}const S=c[v];return x&&!S?d[y]=void 0:d[y]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:i,pattern:e}}function _0(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),uf(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,c,u)=>(r.push({paramName:c,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),r]}function I0(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return uf(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Tl(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function $0(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:s=""}=typeof e=="string"?Hs(e):e;return{pathname:n?n.startsWith("/")?n:M0(n,t):t,search:D0(r),hash:B0(s)}}function M0(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function qc(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function O0(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function df(e,t){let n=O0(e);return t?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function ff(e,t,n,r){r===void 0&&(r=!1);let s;typeof e=="string"?s=Hs(e):(s=Oa({},e),Nt(!s.pathname||!s.pathname.includes("?"),qc("?","pathname","search",s)),Nt(!s.pathname||!s.pathname.includes("#"),qc("#","pathname","hash",s)),Nt(!s.search||!s.search.includes("#"),qc("#","search","hash",s)));let a=e===""||s.pathname==="",i=a?"/":s.pathname,c;if(i==null)c=n;else{let v=t.length-1;if(!r&&i.startsWith("..")){let y=i.split("/");for(;y[0]==="..";)y.shift(),v-=1;s.pathname=y.join("/")}c=v>=0?t[v]:"/"}let u=$0(s,c),d=i&&i!=="/"&&i.endsWith("/"),g=(a||i===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||g)&&(u.pathname+="/"),u}const ps=e=>e.join("/").replace(/\/\/+/g,"/"),F0=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),D0=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,B0=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function U0(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const wy=["post","put","patch","delete"];new Set(wy);const V0=["get",...wy];new Set(V0);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fa(){return Fa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Fa.apply(this,arguments)}const nc=o.createContext(null),Sy=o.createContext(null),_r=o.createContext(null),rc=o.createContext(null),Ir=o.createContext({outlet:null,matches:[],isDataRoute:!1}),ky=o.createContext(null);function W0(e,t){let{relative:n}=t===void 0?{}:t;$l()||Nt(!1);let{basename:r,navigator:s}=o.useContext(_r),{hash:a,pathname:i,search:c}=sc(e,{relative:n}),u=i;return r!=="/"&&(u=i==="/"?r:ps([r,i])),s.createHref({pathname:u,search:c,hash:a})}function $l(){return o.useContext(rc)!=null}function yn(){return $l()||Nt(!1),o.useContext(rc).location}function jy(e){o.useContext(_r).static||o.useLayoutEffect(e)}function $r(){let{isDataRoute:e}=o.useContext(Ir);return e?lS():H0()}function H0(){$l()||Nt(!1);let e=o.useContext(nc),{basename:t,future:n,navigator:r}=o.useContext(_r),{matches:s}=o.useContext(Ir),{pathname:a}=yn(),i=JSON.stringify(df(s,n.v7_relativeSplatPath)),c=o.useRef(!1);return jy(()=>{c.current=!0}),o.useCallback(function(d,g){if(g===void 0&&(g={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let v=ff(d,JSON.parse(i),a,g.relative==="path");e==null&&t!=="/"&&(v.pathname=v.pathname==="/"?t:ps([t,v.pathname])),(g.replace?r.replace:r.push)(v,g.state,g)},[t,r,i,a,e])}const K0=o.createContext(null);function G0(e){let t=o.useContext(Ir).outlet;return t&&o.createElement(K0.Provider,{value:e},t)}function sc(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=o.useContext(_r),{matches:s}=o.useContext(Ir),{pathname:a}=yn(),i=JSON.stringify(df(s,r.v7_relativeSplatPath));return o.useMemo(()=>ff(e,JSON.parse(i),a,n==="path"),[e,i,a,n])}function Y0(e,t){return Q0(e,t)}function Q0(e,t,n,r){$l()||Nt(!1);let{navigator:s}=o.useContext(_r),{matches:a}=o.useContext(Ir),i=a[a.length-1],c=i?i.params:{};i&&i.pathname;let u=i?i.pathnameBase:"/";i&&i.route;let d=yn(),g;if(t){var v;let N=typeof t=="string"?Hs(t):t;u==="/"||(v=N.pathname)!=null&&v.startsWith(u)||Nt(!1),g=N}else g=d;let y=g.pathname||"/",x=y;if(u!=="/"){let N=u.replace(/^\//,"").split("/");x="/"+y.replace(/^\//,"").split("/").slice(N.length).join("/")}let S=k0(e,{pathname:x}),j=eS(S&&S.map(N=>Object.assign({},N,{params:Object.assign({},c,N.params),pathname:ps([u,s.encodeLocation?s.encodeLocation(N.pathname).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?u:ps([u,s.encodeLocation?s.encodeLocation(N.pathnameBase).pathname:N.pathnameBase])})),a,n,r);return t&&j?o.createElement(rc.Provider,{value:{location:Fa({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:rs.Pop}},j):j}function q0(){let e=sS(),t=U0(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return o.createElement(o.Fragment,null,o.createElement("h2",null,"Unexpected Application Error!"),o.createElement("h3",{style:{fontStyle:"italic"}},t),n?o.createElement("pre",{style:s},n):null,null)}const X0=o.createElement(q0,null);class J0 extends o.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?o.createElement(Ir.Provider,{value:this.props.routeContext},o.createElement(ky.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Z0(e){let{routeContext:t,match:n,children:r}=e,s=o.useContext(nc);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),o.createElement(Ir.Provider,{value:t},r)}function eS(e,t,n,r){var s;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var a;if(!n)return null;if(n.errors)e=n.matches;else if((a=r)!=null&&a.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let i=e,c=(s=n)==null?void 0:s.errors;if(c!=null){let g=i.findIndex(v=>v.route.id&&(c==null?void 0:c[v.route.id])!==void 0);g>=0||Nt(!1),i=i.slice(0,Math.min(i.length,g+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let g=0;g<i.length;g++){let v=i[g];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(d=g),v.route.id){let{loaderData:y,errors:x}=n,S=v.route.loader&&y[v.route.id]===void 0&&(!x||x[v.route.id]===void 0);if(v.route.lazy||S){u=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}return i.reduceRight((g,v,y)=>{let x,S=!1,j=null,N=null;n&&(x=c&&v.route.id?c[v.route.id]:void 0,j=v.route.errorElement||X0,u&&(d<0&&y===0?(aS("route-fallback"),S=!0,N=null):d===y&&(S=!0,N=v.route.hydrateFallbackElement||null)));let m=t.concat(i.slice(0,y+1)),p=()=>{let h;return x?h=j:S?h=N:v.route.Component?h=o.createElement(v.route.Component,null):v.route.element?h=v.route.element:h=g,o.createElement(Z0,{match:v,routeContext:{outlet:g,matches:m,isDataRoute:n!=null},children:h})};return n&&(v.route.ErrorBoundary||v.route.errorElement||y===0)?o.createElement(J0,{location:n.location,revalidation:n.revalidation,component:j,error:x,children:p(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):p()},null)}var Ny=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Ny||{}),Cy=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Cy||{});function tS(e){let t=o.useContext(nc);return t||Nt(!1),t}function nS(e){let t=o.useContext(Sy);return t||Nt(!1),t}function rS(e){let t=o.useContext(Ir);return t||Nt(!1),t}function by(e){let t=rS(),n=t.matches[t.matches.length-1];return n.route.id||Nt(!1),n.route.id}function sS(){var e;let t=o.useContext(ky),n=nS(),r=by();return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function lS(){let{router:e}=tS(Ny.UseNavigateStable),t=by(Cy.UseNavigateStable),n=o.useRef(!1);return jy(()=>{n.current=!0}),o.useCallback(function(s,a){a===void 0&&(a={}),n.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,Fa({fromRouteId:t},a)))},[e,t])}const vm={};function aS(e,t,n){vm[e]||(vm[e]=!0)}function iS(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Co(e){let{to:t,replace:n,state:r,relative:s}=e;$l()||Nt(!1);let{future:a,static:i}=o.useContext(_r),{matches:c}=o.useContext(Ir),{pathname:u}=yn(),d=$r(),g=ff(t,df(c,a.v7_relativeSplatPath),u,s==="path"),v=JSON.stringify(g);return o.useEffect(()=>d(JSON.parse(v),{replace:n,state:r,relative:s}),[d,v,s,n,r]),null}function oS(e){return G0(e.context)}function In(e){Nt(!1)}function cS(e){let{basename:t="/",children:n=null,location:r,navigationType:s=rs.Pop,navigator:a,static:i=!1,future:c}=e;$l()&&Nt(!1);let u=t.replace(/^\/*/,"/"),d=o.useMemo(()=>({basename:u,navigator:a,static:i,future:Fa({v7_relativeSplatPath:!1},c)}),[u,c,a,i]);typeof r=="string"&&(r=Hs(r));let{pathname:g="/",search:v="",hash:y="",state:x=null,key:S="default"}=r,j=o.useMemo(()=>{let N=Tl(g,u);return N==null?null:{location:{pathname:N,search:v,hash:y,state:x,key:S},navigationType:s}},[u,g,v,y,x,S,s]);return j==null?null:o.createElement(_r.Provider,{value:d},o.createElement(rc.Provider,{children:n,value:j}))}function uS(e){let{children:t,location:n}=e;return Y0(Zu(t),n)}new Promise(()=>{});function Zu(e,t){t===void 0&&(t=[]);let n=[];return o.Children.forEach(e,(r,s)=>{if(!o.isValidElement(r))return;let a=[...t,s];if(r.type===o.Fragment){n.push.apply(n,Zu(r.props.children,a));return}r.type!==In&&Nt(!1),!r.props.index||!r.props.children||Nt(!1);let i={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=Zu(r.props.children,a)),n.push(i)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bo(){return bo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bo.apply(this,arguments)}function Ey(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,a;for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function dS(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function fS(e,t){return e.button===0&&(!t||t==="_self")&&!dS(e)}function ed(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(s=>[n,s]):[[n,r]])},[]))}function pS(e,t){let n=ed(e);return t&&t.forEach((r,s)=>{n.has(s)||t.getAll(s).forEach(a=>{n.append(s,a)})}),n}const mS=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],hS=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],gS="6";try{window.__reactRouterVersion=gS}catch{}const yS=o.createContext({isTransitioning:!1}),vS="startTransition",xm=ox[vS];function xS(e){let{basename:t,children:n,future:r,window:s}=e,a=o.useRef();a.current==null&&(a.current=x0({window:s,v5Compat:!0}));let i=a.current,[c,u]=o.useState({action:i.action,location:i.location}),{v7_startTransition:d}=r||{},g=o.useCallback(v=>{d&&xm?xm(()=>u(v)):u(v)},[u,d]);return o.useLayoutEffect(()=>i.listen(g),[i,g]),o.useEffect(()=>iS(r),[r]),o.createElement(cS,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:i,future:r})}const wS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",SS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ay=o.forwardRef(function(t,n){let{onClick:r,relative:s,reloadDocument:a,replace:i,state:c,target:u,to:d,preventScrollReset:g,viewTransition:v}=t,y=Ey(t,mS),{basename:x}=o.useContext(_r),S,j=!1;if(typeof d=="string"&&SS.test(d)&&(S=d,wS))try{let h=new URL(window.location.href),w=d.startsWith("//")?new URL(h.protocol+d):new URL(d),E=Tl(w.pathname,x);w.origin===h.origin&&E!=null?d=E+w.search+w.hash:j=!0}catch{}let N=W0(d,{relative:s}),m=NS(d,{replace:i,state:c,target:u,preventScrollReset:g,relative:s,viewTransition:v});function p(h){r&&r(h),h.defaultPrevented||m(h)}return o.createElement("a",bo({},y,{href:S||N,onClick:j||a?r:p,ref:n,target:u}))}),kS=o.forwardRef(function(t,n){let{"aria-current":r="page",caseSensitive:s=!1,className:a="",end:i=!1,style:c,to:u,viewTransition:d,children:g}=t,v=Ey(t,hS),y=sc(u,{relative:v.relative}),x=yn(),S=o.useContext(Sy),{navigator:j,basename:N}=o.useContext(_r),m=S!=null&&CS(y)&&d===!0,p=j.encodeLocation?j.encodeLocation(y).pathname:y.pathname,h=x.pathname,w=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;s||(h=h.toLowerCase(),w=w?w.toLowerCase():null,p=p.toLowerCase()),w&&N&&(w=Tl(w,N)||w);const E=p!=="/"&&p.endsWith("/")?p.length-1:p.length;let b=h===p||!i&&h.startsWith(p)&&h.charAt(E)==="/",L=w!=null&&(w===p||!i&&w.startsWith(p)&&w.charAt(p.length)==="/"),z={isActive:b,isPending:L,isTransitioning:m},$=b?r:void 0,T;typeof a=="function"?T=a(z):T=[a,b?"active":null,L?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let F=typeof c=="function"?c(z):c;return o.createElement(Ay,bo({},v,{"aria-current":$,className:T,ref:n,style:F,to:u,viewTransition:d}),typeof g=="function"?g(z):g)});var td;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(td||(td={}));var wm;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(wm||(wm={}));function jS(e){let t=o.useContext(nc);return t||Nt(!1),t}function NS(e,t){let{target:n,replace:r,state:s,preventScrollReset:a,relative:i,viewTransition:c}=t===void 0?{}:t,u=$r(),d=yn(),g=sc(e,{relative:i});return o.useCallback(v=>{if(fS(v,n)){v.preventDefault();let y=r!==void 0?r:No(d)===No(g);u(e,{replace:y,state:s,preventScrollReset:a,relative:i,viewTransition:c})}},[d,u,g,r,s,n,e,a,i,c])}function pf(e){let t=o.useRef(ed(e)),n=o.useRef(!1),r=yn(),s=o.useMemo(()=>pS(r.search,n.current?null:t.current),[r.search]),a=$r(),i=o.useCallback((c,u)=>{const d=ed(typeof c=="function"?c(s):c);n.current=!0,a("?"+d,u)},[a,s]);return[s,i]}function CS(e,t){t===void 0&&(t={});let n=o.useContext(yS);n==null&&Nt(!1);let{basename:r}=jS(td.useViewTransitionState),s=sc(e,{relative:t.relative});if(!n.isTransitioning)return!1;let a=Tl(n.currentLocation.pathname,r)||n.currentLocation.pathname,i=Tl(n.nextLocation.pathname,r)||n.nextLocation.pathname;return Ju(s.pathname,i)!=null||Ju(s.pathname,a)!=null}const nd="cozygen_token",Eo="cozygen:auth-expired";function mf(){try{return typeof window>"u"?null:localStorage.getItem(nd)}catch{return null}}function Ly(e){try{if(typeof window>"u")return;e?localStorage.setItem(nd,e):localStorage.removeItem(nd)}catch{}}function Xi(){Ly(null)}function Ml(){const e=mf();return e?{Authorization:`Bearer ${e}`}:{}}function bS(e={}){if(Xi(),!(typeof window>"u"||typeof window.dispatchEvent!="function"))try{window.dispatchEvent(new CustomEvent(Eo,{detail:e}))}catch{window.dispatchEvent(new Event(Eo))}}const Ya=async(e,t)=>{if(t.status===401){bS({url:e,status:t.status});const r=new Error("unauthorized");throw r.unauthorized=!0,r.status=401,r}if(!t.ok)throw new Error(`${e} failed`);return(t.headers.get("content-type")||"").includes("application/json")?t.json():t.text()},ws=async(e,t={})=>{const{signal:n}=t,r=await fetch(e,{headers:{...Ml()},credentials:"include",signal:n});return Ya(e,r)},Mr=async(e,t,n={})=>{const{signal:r}=n,s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",...Ml()},body:JSON.stringify(t),credentials:"include",signal:r});return Ya(e,s)};async function ES(e={}){return ws("/cozygen/workflows",e)}async function AS(e,t={}){return ws(`/cozygen/workflows/${encodeURIComponent(e)}`,t)}async function rd(e,t={}){const{refresh:n=!1,cacheBust:r="",...s}=t||{},a=new URLSearchParams({type:String(e||"")});return n&&a.set("refresh","1"),r&&a.set("cache_bust",String(r)),ws(`/cozygen/get_choices?${a.toString()}`,s)}async function Ao(e){const t=await fetch("/prompt",{method:"POST",headers:{"Content-Type":"application/json",...Ml()},body:JSON.stringify(e),credentials:"include"});return Ya("/prompt",t)}async function LS(e){const t=new FormData;t.append("image",e);const n=await fetch("/cozygen/upload_image",{method:"POST",headers:{...Ml()},body:t,credentials:"include"});return Ya("/cozygen/upload_image",n)}async function Py(e="",t=1,n=50,r=!1,s=!1,a="all",i="",c={}){const{includeMeta:u=!1,...d}=c||{},g=new URLSearchParams({subfolder:e,page:String(t),per_page:String(n),show_hidden:r?"1":"0",recursive:s?"1":"0",kind:a});return u&&g.set("include_meta","1"),i&&g.set("cache_bust",String(i)),ws(`/cozygen/api/gallery?${g.toString()}`,d)}async function PS({filename:e="",subfolder:t=""}={},n={}){const r=new URLSearchParams({filename:String(e||""),subfolder:String(t||"")}),s=await fetch(`/cozygen/api/gallery/prompt?${r.toString()}`,{headers:{...Ml()},credentials:"include",signal:n==null?void 0:n.signal}),i=(s.headers.get("content-type")||"").includes("application/json")?await s.json():await s.text();if(!s.ok){const c=new Error((i==null?void 0:i.error)||"Prompt metadata not found");throw c.status=s.status,c.payload=i,c}return i}async function Lo({promptId:e="",promptRaw:t=null}={},n={}){return!e||!t?{ok:!1}:typeof t!="object"?{ok:!1}:Mr("/cozygen/api/prompt_raw",{prompt_id:String(e),prompt_raw:t},n)}async function Ty({filename:e="",subfolder:t=""}={},n={}){return Mr("/cozygen/api/gallery/delete",{filename:e,subfolder:t},n)}async function TS({subfolder:e="",recursive:t=!0,confirm:n="delete-all"}={},r={}){return Mr("/cozygen/api/gallery/delete_all",{subfolder:e,recursive:t,confirm:n},r)}async function RS(){return ws("/cozygen/api/aliases")}async function zS(e){return Mr("/cozygen/api/aliases",e||{})}async function hf(e={}){return ws("/cozygen/api/tags/categories",e)}async function hr({q:e="",category:t="",sort:n="count",minCount:r=0,limit:s=80,offset:a=0}={},i={}){const c=Number.isFinite(Number(r))?Math.max(0,Number(r)):0,u=new URLSearchParams({q:String(e||""),category:String(t||""),sort:String(n||"count"),limit:String(s||80),offset:String(a||0)});return c>0&&u.set("min_count",String(c)),ws(`/cozygen/api/tags/search?${u.toString()}`,i)}async function Xc(e=[],t={}){return Mr("/cozygen/api/tags/validate",{tags:Array.isArray(e)?e:[]},t)}async function _S(e,t={}){const n=new URLSearchParams;return e&&n.set("workflow",e),ws(`/cozygen/api/workflow_presets?${n.toString()}`,t)}async function IS(e,t,n={}){return Mr("/cozygen/api/workflow_presets",{workflow:e,preset:t},n)}async function $S(e,t,n={}){return Mr("/cozygen/api/workflow_presets",{workflow:e,delete:t},n)}async function MS(e,t){return Mr("/cozygen/api/login",{username:e,password:t})}async function OS(){return fetch("/cozygen/api/auth_status",{headers:{...Ml()},credentials:"include"}).then(e=>Ya("/cozygen/api/auth_status",e))}async function FS(){return Mr("/cozygen/api/clear_cache",{})}const DS=30*60*1e3,Sm="cozygen_idle_logout",Ry=o.createContext(null);function BS({children:e}){const[t,n]=o.useState(!1),[r,s]=o.useState(null),[a,i]=o.useState(!1),c=o.useRef(null),u=o.useCallback(async()=>{if(!mf()){s(null),i(!1),n(!0);return}try{const x=await OS();s((x==null?void 0:x.user)||null),i(!!(x!=null&&x.default_credentials))}catch{Xi(),s(null),i(!1)}finally{n(!0)}},[]);o.useEffect(()=>{u()},[u]);const d=o.useCallback(async(y,x)=>{const S=await MS(y,x);Ly((S==null?void 0:S.token)||""),s((S==null?void 0:S.user)||y),i(!!(S!=null&&S.default_credentials));try{localStorage.removeItem(Sm)}catch{}return S},[]),g=o.useCallback(()=>{Xi(),s(null),i(!1)},[]);o.useEffect(()=>{if(typeof window>"u")return;const y=()=>{g(),n(!0)};return window.addEventListener(Eo,y),()=>window.removeEventListener(Eo,y)},[g]),o.useEffect(()=>{if(!t)return;const y=()=>{c.current&&clearTimeout(c.current);const S=setTimeout(()=>{Xi(),s(null),i(!1);try{localStorage.setItem(Sm,"1")}catch{}window.location.hash="#/login"},DS);c.current=S};y();const x=["pointerdown","keydown","visibilitychange"];return x.forEach(S=>window.addEventListener(S,y,{passive:!0})),()=>{c.current&&(clearTimeout(c.current),c.current=null),x.forEach(S=>window.removeEventListener(S,y))}},[t]);const v=o.useMemo(()=>({ready:t,user:r,authed:!!r,defaultCreds:a,login:d,logout:g,refresh:u}),[t,r,a,d,g,u]);return l.jsx(Ry.Provider,{value:v,children:e})}function lc(){const e=o.useContext(Ry);if(!e)throw new Error("useAuth must be used within AuthProvider");return e}function US({children:e}){return l.jsx(BS,{children:e})}const X=o.forwardRef(function({as:t,href:n,variant:r,size:s="md",iconOnly:a=!1,active:i=!1,pressed:c,className:u="",type:d,...g},v){const y=t||(n?"a":"button"),x=s==="lg"?"is-lg":s==="sm"?"is-compact":s==="xs"?"is-tiny":s==="mini"?"is-mini":s==="icon"?"is-icon":"",S=r?`is-${r}`:"",m=["ui-button",x,S,a?"is-icon":"",i?"is-active":"",u].filter(Boolean).join(" "),p={ref:v,className:m,"aria-pressed":c,...g};return y==="button"?l.jsx("button",{...p,type:d||"button"}):l.jsx(y,{...p,href:n})}),zy=({size:e=32,className:t=""})=>l.jsxs("svg",{width:e,height:e,viewBox:"0 0 32 32",fill:"none",className:t,"aria-hidden":"true",children:[l.jsx("path",{d:"M8 24L20 4",stroke:"url(#logo-gradient)",strokeWidth:"3",strokeLinecap:"round"}),l.jsx("path",{d:"M6 26C6 26 7 24 8 24C9 24 10 25 8 27C6 29 4 28 6 26Z",fill:"url(#logo-warm)"}),l.jsx("circle",{cx:"22",cy:"8",r:"2",fill:"url(#logo-spark)"}),l.jsx("circle",{cx:"26",cy:"12",r:"1.5",fill:"url(#logo-spark)",opacity:"0.8"}),l.jsx("circle",{cx:"24",cy:"16",r:"1",fill:"url(#logo-spark)",opacity:"0.6"}),l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"logo-gradient",x1:"8",y1:"24",x2:"20",y2:"4",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{stopColor:"#FF9F7A"}),l.jsx("stop",{offset:"0.5",stopColor:"#9F8CFF"}),l.jsx("stop",{offset:"1",stopColor:"#44E1C5"})]}),l.jsxs("linearGradient",{id:"logo-warm",x1:"4",y1:"24",x2:"10",y2:"28",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{stopColor:"#FF9F7A"}),l.jsx("stop",{offset:"1",stopColor:"#FFD666"})]}),l.jsxs("radialGradient",{id:"logo-spark",cx:"0.3",cy:"0.3",r:"0.7",children:[l.jsx("stop",{stopColor:"#FFFFFF"}),l.jsx("stop",{offset:"0.5",stopColor:"#44E1C5"}),l.jsx("stop",{offset:"1",stopColor:"#9F8CFF"})]})]})]}),gt=({children:e,size:t=16,className:n="",...r})=>l.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,"aria-hidden":"true",...r,children:e}),VS=e=>l.jsxs(gt,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),l.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("path",{d:"M21 15l-5-5L5 21"})]}),ac=e=>l.jsxs(gt,{...e,children:[l.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"}),l.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7",strokeWidth:"3"})]}),_y=e=>l.jsxs(gt,{...e,children:[l.jsx("path",{d:"M14 3H4a2 2 0 00-2 2v10l6 6h10a2 2 0 002-2V9l-6-6z"}),l.jsx("path",{d:"M14 3v6h6"}),l.jsx("path",{d:"M7 7h5"}),l.jsx("path",{d:"M7 11h7"})]}),ic=e=>l.jsx(gt,{...e,children:l.jsx("path",{d:"M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"})}),WS=e=>l.jsx(gt,{...e,children:l.jsx("polygon",{points:"5 3 19 12 5 21 5 3",fill:"currentColor",stroke:"none"})}),km=e=>l.jsxs(gt,{...e,children:[l.jsx("path",{d:"M15 4l2 2-10 10-3 1 1-3L15 4z",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"19",cy:"5",r:"1.5",fill:"currentColor",stroke:"none",opacity:"0.8"}),l.jsx("circle",{cx:"20",cy:"9",r:"1",fill:"currentColor",stroke:"none",opacity:"0.5"})]}),HS=e=>l.jsxs(gt,{...e,children:[l.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"}),l.jsx("polyline",{points:"16 17 21 12 16 7"}),l.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),Iy=e=>l.jsxs(gt,{...e,children:[l.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),l.jsx("line",{x1:"9",y1:"9",x2:"9",y2:"15"}),l.jsx("line",{x1:"15",y1:"9",x2:"15",y2:"15"}),l.jsx("circle",{cx:"9",cy:"12",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"10",r:"1.5",fill:"currentColor",stroke:"none"})]}),KS=e=>l.jsxs(gt,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),l.jsx("circle",{cx:"12",cy:"12",r:"4"}),l.jsx("line",{x1:"3",y1:"9",x2:"6",y2:"9"})]}),Po=e=>l.jsxs(gt,{...e,children:[l.jsx("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"}),l.jsx("path",{d:"M2 10h20"})]}),jm=e=>l.jsx(gt,{...e,children:l.jsx("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"})}),Nm=e=>l.jsxs(gt,{...e,children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),Cm=e=>l.jsxs(gt,{...e,children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"}),l.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),bm=e=>l.jsx(gt,{...e,children:l.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),sd=e=>l.jsxs(gt,{...e,children:[l.jsx("path",{d:"M4 6h16"}),l.jsx("path",{d:"M6 6v12a2 2 0 002 2h8a2 2 0 002-2V6"}),l.jsx("path",{d:"M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2"})]}),Em=e=>l.jsxs(gt,{...e,children:[l.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),l.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]}),Ji=e=>l.jsxs(gt,{...e,children:[l.jsx("polyline",{points:"23 4 23 10 17 10"}),l.jsx("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10"})]}),$y=e=>l.jsx(gt,{...e,children:l.jsx("polyline",{points:"15 18 9 12 15 6"})}),oc=e=>l.jsx(gt,{...e,children:l.jsx("polyline",{points:"9 18 15 12 9 6"})}),Da=e=>l.jsxs(gt,{...e,children:[l.jsx("circle",{cx:"9",cy:"6",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"6",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"9",cy:"12",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"12",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"9",cy:"18",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"18",r:"1",fill:"currentColor",stroke:"none"})]}),gs=e=>l.jsxs(gt,{...e,children:[l.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Am=e=>l.jsxs(gt,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",strokeDasharray:"4 2"}),l.jsx("line",{x1:"9",y1:"12",x2:"15",y2:"12"})]}),GS=e=>l.jsxs(gt,{...e,children:[l.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),l.jsx("polyline",{points:"5 12 12 5 19 12"})]}),YS=e=>l.jsxs(gt,{...e,children:[l.jsx("circle",{cx:"6",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"12",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"18",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"})]}),QS=e=>l.jsxs(gt,{...e,children:[l.jsx("rect",{x:"9",y:"9",width:"10",height:"10",rx:"2"}),l.jsx("path",{d:"M7 15H6a2 2 0 01-2-2V6a2 2 0 012-2h7"})]}),ld=e=>l.jsxs(gt,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"3"}),l.jsx("circle",{cx:"8",cy:"8",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"16",cy:"16",r:"1.5",fill:"currentColor",stroke:"none"})]});function qS(){const{pathname:e}=yn(),{logout:t,user:n}=lc(),r=e==="/login",s=()=>{try{t()}catch{}window.location.hash="#/login"};return l.jsx("header",{className:"top-bar",children:l.jsx("div",{className:"top-bar-shell",children:l.jsxs("div",{className:"brand-row",children:[l.jsxs(Ay,{to:"/studio",className:"brand-mark",children:[l.jsx(zy,{size:28,className:"brand-logo"}),l.jsx("span",{className:"brand-text",children:"CozyGen"})]}),l.jsx("div",{className:"flex-1"}),r?null:l.jsxs(X,{variant:"muted",size:"sm",onClick:s,title:"Sign out",children:[l.jsx("span",{className:"inline-flex items-center justify-center",children:l.jsx(HS,{size:16})}),l.jsx("span",{children:"Logout"}),n?l.jsxs("span",{className:"text-xs text-[#9DA3FFB3] hidden sm:inline",children:["@",n]}):null]})]})})})}function XS(){const[e,t]=o.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("cozygen_gallery_pending")==="1"}catch{return!1}});return o.useEffect(()=>{const n=()=>t(!0),r=()=>t(!1),s=a=>{a.key==="cozygen_gallery_pending"&&t(a.newValue==="1")};return window.addEventListener("cozygen:gallery-pending",n),window.addEventListener("cozygen:gallery-viewed",r),window.addEventListener("storage",s),()=>{window.removeEventListener("cozygen:gallery-pending",n),window.removeEventListener("cozygen:gallery-viewed",r),window.removeEventListener("storage",s)}},[]),e}function To(){if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const e=Math.random().toString(16).slice(2);return`cozy-${Date.now().toString(16)}-${e}`}const My="cozygen_last_render_payload";function ad(e){if(e)try{if(typeof window>"u")return;window.localStorage.setItem(My,JSON.stringify(e))}catch{}}function Oy(){try{if(typeof window>"u")return null;const e=window.localStorage.getItem(My);return e?JSON.parse(e):null}catch{return null}}async function JS(){var t,n;const e=Oy();if(!e||!e.workflow)return{success:!1,error:"No previous render to repeat"};try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!0}}));const r=To(),s=e.promptRaw||((n=(t=e==null?void 0:e.extraData)==null?void 0:t.extra_pnginfo)==null?void 0:n.cozygen_prompt_raw);if(s&&typeof s=="object")try{await Lo({promptId:r,promptRaw:s})}catch{}return await Ao({prompt:e.workflow,prompt_id:r}),window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!1}})),{success:!0}}catch(r){return console.error("Failed to requeue prompt",r),window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!1}})),r!=null&&r.unauthorized?(window.location.hash="#/login",{success:!1,error:"Session expired"}):{success:!1,error:"Failed to queue prompt"}}}function ZS(){const e=Oy();return!!(e&&e.workflow)}const ek=[{to:"/controls",label:"Controls",Icon:Iy},{to:"/compose",label:"Compose",Icon:ic},{to:"/gallery",label:"Gallery",Icon:VS},{to:"/library",label:"Library",Icon:Po}],tk=({isActive:e})=>["bottom-nav-link",e?"is-active":""].filter(Boolean).join(" ");function nk(){const e=yn(),t=XS(),[n,r]=ca.useState(!1),[s,a]=ca.useState(!1),i=e.pathname==="/controls",c=e.pathname==="/compose",u=async()=>{if(!(typeof window>"u")&&!s)if(r(!0),setTimeout(()=>r(!1),400),i||c)try{window.dispatchEvent(new CustomEvent("cozygen:request-render"))}catch{}else{if(!ZS())return;const d=await JS();d.success||console.warn("Requeue failed:",d.error)}};return ca.useEffect(()=>{const d=g=>{var y;const v=!!((y=g==null?void 0:g.detail)!=null&&y.active);a(v),v&&(r(!0),setTimeout(()=>r(!1),400))};return window.addEventListener("cozygen:render-state",d),()=>window.removeEventListener("cozygen:render-state",d)},[]),l.jsxs("nav",{className:"bottom-nav","aria-label":"Bottom navigation",children:[ek.map(d=>l.jsxs(kS,{to:d.to,end:d.end,className:tk,children:[l.jsx("span",{className:"bottom-nav-icon","aria-hidden":"true",children:l.jsx(d.Icon,{size:20})}),l.jsxs("span",{className:"bottom-nav-label",children:[d.label,d.to==="/gallery"&&t?l.jsx("span",{className:"badge-dot pulse","aria-hidden":"true"}):null]})]},d.to)),l.jsxs("button",{type:"button",className:`bottom-nav-link is-action ${n?"is-flash":""} ${s?"is-rendering":""}`,onClick:u,"aria-label":"Render","aria-busy":s,"aria-disabled":s,disabled:s,children:[l.jsx("span",{className:"bottom-nav-icon","aria-hidden":"true",children:l.jsx(WS,{size:20})}),l.jsx("span",{className:"bottom-nav-label",children:"Render"})]},"render")]})}function rk(e,t){if(!t||t<=0)return null;const n=Number(e)||0,r=Number(t)||0,s=Math.round(n/r*100);return Number.isFinite(s)?Math.max(0,Math.min(100,s)):null}function sk({busy:e=!1,progressValue:t=0,progressMax:n=0,statusText:r="Idle",statusPhase:s="idle",primaryLabel:a="Render",onPrimary:i,primaryDisabled:c=!1,onLogs:u,logsLabel:d="Logs"}){const g=rk(t,n),v=s==="queued"?"rgba(255, 143, 112, 0.95)":s==="running"?"rgba(68, 225, 197, 0.95)":s==="finished"?"rgba(92, 255, 154, 0.95)":s==="error"?"rgba(255, 143, 112, 0.95)":"rgba(159, 178, 215, 0.55)",x={idle:"Idle",queued:"Queued",running:"Running",finished:"Finished",error:"Error"}[s]||"Status",S=e||c;return l.jsxs("div",{className:"dock-bar-inner",children:[l.jsx(X,{variant:"primary",size:"lg",className:"w-full",onClick:i,disabled:S,children:e?"Rendering":a}),l.jsxs("div",{className:"dock-status-row",children:[l.jsxs("span",{className:"dock-status-left",children:[l.jsx("span",{className:"dock-status-dot",style:{background:v}}),l.jsx("span",{className:"dock-status-label",children:x})]}),l.jsxs("span",{className:"dock-status-right",children:[g!=null&&e?l.jsxs("span",{className:"dock-progress",children:[l.jsx("span",{className:"dock-progress-bar","aria-hidden":"true",children:l.jsx("span",{className:"dock-progress-fill",style:{width:`${g}%`}})}),l.jsxs("span",{children:[g,"%"]})]}):null,l.jsx("span",{className:"dock-status-text",children:r||(e?"Working":"Idle")}),u?l.jsx(X,{size:"xs",variant:"ghost",onClick:u,children:d}):null]})]})]})}const Fy="jpg,jpeg,png,webp,gif,bmp,tif,tiff",gf=(e="")=>/\.(png|jpe?g|gif|webp|bmp|tif?f)$/i.test(e),Dy=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e);async function Jc({subfolder:e="",page:t=1,perPage:n=50,exts:r=Fy,signal:s}={}){const a=new URLSearchParams({subfolder:e,page:String(t),per_page:String(n),exts:r}),i=await fetch(`/cozygen/input?${a.toString()}`,{signal:s});if(!i.ok)throw new Error(`Input list failed: ${i.status}`);return i.json()}const Ro=e=>`/cozygen/input/file?path=${encodeURIComponent(e)}`,id="output::",cc=(e="")=>e.replace(/\\/g,"/").replace(/^\/+/,"").replace(/\/+$/,""),By=(e="")=>{const t=e.replace(/\\/g,"/").split("/").filter(Boolean);return t[t.length-1]||""},lk=({subfolder:e="",filename:t=""}={})=>{const n=By(t);if(!n)return"";const r=cc(e);return`${id}${r}::${n}`},od=(e="")=>{if(typeof e!="string"||!e.startsWith(id))return null;const t=e.slice(id.length);if(!t)return null;const n=t.lastIndexOf("::"),r=n===-1?t:t.slice(n+2);return r?{subfolder:n===-1?"":t.slice(0,n),filename:r}:null},zo=({filename:e="",subfolder:t="",type:n="output"}={})=>{const r=By(e);return r?`/view?${new URLSearchParams({filename:r,subfolder:cc(t),type:n||"output"}).toString()}`:""},cd=(e="")=>e.split("/").slice(0,-1).join("/"),ak=e=>{if(typeof e!="string"||!e)return e!=null&&e.path?cd(e.path):"";const t=od(e);return t?cc(t.subfolder):cd(e)},Lm=(e=[])=>e.map(t=>{const n=t.rel_path||t.name||"",r=t.name||n||"Untitled",s=!!t.is_dir,a=s?"":Ro(n);return{...t,name:r,rel_path:n,is_dir:s,is_image:!s&&gf(r),is_video:!s&&Dy(r),source:"input",preview_url:a}}),ik=(e=[])=>e.map(t=>{const n=t.filename||"",r=t.subfolder||"",s=t.type==="directory",a=s?r||n:[r,n].filter(Boolean).join("/"),i=n||r||a||"Untitled",c=s?"":zo({filename:n,subfolder:r,type:t.type});return{...t,name:i,rel_path:a,is_dir:s,is_image:!s&&gf(n),is_video:!s&&Dy(n),source:"output",preview_url:c}}),Ps={get(e,t){try{return(typeof window<"u"?JSON.parse(localStorage.getItem(e)):null)??t}catch{return t}},set(e,t){try{typeof window<"u"&&localStorage.setItem(e,JSON.stringify(t))}catch{}}};function ok({input:e,value:t,onFormChange:n}){var J;const r=((J=e==null?void 0:e.inputs)==null?void 0:J.param_name)||"Image Input",s=(e==null?void 0:e.class_type)||"CozyGenImageInput",a=`cg_last_input_cwd::${r}`,i=`cg_last_picker_source::${r}`,[c,u]=o.useState(""),[d,g]=o.useState(!1),[v,y]=o.useState(!1),[x,S]=o.useState(Ps.get(a,"")),[j,N]=o.useState(1),[m,p]=o.useState(50),[h,w]=o.useState([]),[E,b]=o.useState(1),[L,z]=o.useState(!1),[$,T]=o.useState(""),[F,Z]=o.useState([]),[ae,Ce]=o.useState(!0),ye=o.useRef(null),[Y,Se]=o.useState(()=>Ps.get(i,"inputs")==="outputs"?"outputs":"inputs"),R=Y,A=o.useCallback(U=>{const H=U==="outputs"?"outputs":"inputs";Se(H),Ps.set(i,H),S(""),N(1)},[]),O=o.useMemo(()=>{if(c)try{const U=new URL(c,window.location.origin);return(U.searchParams.get("path")||U.searchParams.get("filename")||U.pathname.split("/").pop()||"").split("/").pop()||"No file selected."}catch{}if(!t)return"No file selected.";if(typeof t=="string"){const U=od(t);return U!=null&&U.filename?U.filename.split("/").pop():t.split("/").pop()}return t!=null&&t.path?t.path.split("/").pop():"No file selected."},[c,t]);o.useEffect(()=>{if(typeof t=="string"&&t){const U=od(t);U!=null&&U.filename?u(zo({filename:U.filename,subfolder:U.subfolder,type:"output"})):u(Ro(t)),g(!1)}else t!=null&&t.url?(u(t.url),g(!1)):(u(""),g(!1))},[t]);const _=o.useCallback(async U=>{const H=await LS(U),ve=`/view?filename=${H.filename}&type=input`;u(ve),g(!1),Ps.set(a,""),s==="CozyGenImageInput"?n(r,H.filename):n(r,{source:"Upload",path:H.filename,url:ve})},[s,n,r]),B=o.useCallback(()=>{u(""),g(!1),s==="CozyGenImageInput"?n(r,""):n(r,{source:"Upload",path:"",url:""})},[s,n,r]),W=o.useCallback(()=>{const H=ak(t)||Ps.get(a,"");S(H),N(1),y(!0)},[t]),ue=o.useCallback(()=>{y(!1)},[]);o.useEffect(()=>{if(v){if(R!=="inputs"){Z([]);return}(async()=>{try{const U=await Jc({subfolder:"",page:1,perPage:0,exts:""});Z((U.items||[]).filter(H=>H.is_dir))}catch{}})()}},[v,R]),o.useEffect(()=>{if(!v)return;let U=!1;ye.current&&ye.current.abort();const H=new AbortController;ye.current=H;async function ve(){z(!0);try{if(R==="outputs"){const ge=await Py(x,j,m,!1,!1,"all","",{signal:H.signal});if(U)return;const $e=ik(ge&&ge.items||[]);U||(w($e),b(ge&&ge.total_pages||1))}else{const $e=await Jc({subfolder:x,page:j,perPage:m,exts:ae?Fy:"",signal:H.signal}),ke=($e.items||[]).some(ze=>!ze.is_dir);if(ae&&!ke){const ze=await Jc({subfolder:x,page:j,perPage:m,exts:"",signal:H.signal});U||(w(Lm(ze.items||[])),b(ze.total_pages||1),Ce(!1));return}U||(w(Lm($e.items||[])),b($e.total_pages||1))}}catch(ge){if((ge==null?void 0:ge.name)==="AbortError")return;console.error(R==="outputs"?"Failed to load output directory":"Failed to load input directory",ge),U||(w([]),b(1))}finally{U||z(!1)}}return ve(),()=>{U=!0,ye.current===H&&(ye.current=null),H.abort()}},[v,x,j,m,ae,R]);const pe=o.useDeferredValue($),Q=o.useMemo(()=>{const U=pe.trim().toLowerCase();let H=h;return ae&&(H=H.filter(ve=>{if(ve.is_dir)return!0;const ge=ve.name||ve.filename||ve.rel_path||"";return gf(String(ge))})),U?H.filter(ve=>(ve.name||ve.filename||ve.rel_path||"").toLowerCase().includes(U)):H},[h,pe,ae]),he=o.useCallback(U=>{if(!U)return;const H=typeof U=="object"?U:null;if(((H==null?void 0:H.source)||"inputs")==="output"){const ke=lk({subfolder:(H==null?void 0:H.subfolder)||"",filename:(H==null?void 0:H.filename)||(H==null?void 0:H.name)||""});if(!ke)return;const ze=(H==null?void 0:H.preview_url)||zo({filename:H==null?void 0:H.filename,subfolder:H==null?void 0:H.subfolder,type:H==null?void 0:H.type});u(ze),g(!1),Ps.set(a,cc((H==null?void 0:H.subfolder)||"")),s==="CozyGenImageInput"?n(r,ke):n(r,{source:"OutputGallery",path:ke,url:ze}),y(!1);return}const ge=typeof U=="string"?U:(H==null?void 0:H.rel_path)||(H==null?void 0:H.path)||"";if(!ge)return;const $e=(H==null?void 0:H.preview_url)||Ro(ge);u($e),g(!1),Ps.set(a,cd(ge)),s==="CozyGenImageInput"?n(r,ge):n(r,{source:"Server",path:ge,url:$e}),y(!1)},[s,n,r]);return{param:r,previewUrl:c,imgReady:d,setImgReady:g,displayName:O,serverOpen:v,openServer:W,closeServer:ue,cwd:x,setCwd:S,page:j,setPage:N,perPage:m,setPerPage:p,totalPages:E,loading:L,search:$,setSearch:T,topDirs:F,imagesOnly:ae,setImagesOnly:Ce,shownEntries:Q,pickerSource:R,setPickerSource:A,handleUpload:_,clearImage:B,selectServer:he}}function Ht({open:e,onClose:t,title:n,children:r,footer:s,variant:a="sheet",className:i="",contentClassName:c="",shouldCloseOnOverlayClick:u=!0,shouldCloseOnEsc:d=!0}){const g=o.useRef(!1),v=o.useRef(null),y=o.useRef(null),x=N=>N?Array.from(N.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(m=>!m.hasAttribute("disabled")&&m.getAttribute("aria-hidden")!=="true"):[],S=o.useMemo(()=>["bottom-sheet-content",a==="fullscreen"?"is-fullscreen":"is-sheet",c].filter(Boolean).join(" "),[c,a]),j=o.useMemo(()=>["bottom-sheet-overlay",i].filter(Boolean).join(" "),[i]);return o.useEffect(()=>{if(!e||!d)return;const N=m=>{m.key==="Escape"&&(t==null||t())};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[e,t,d]),o.useEffect(()=>{if(!e||typeof document>"u")return;const N=v.current;y.current=document.activeElement;const m=()=>{var E;const w=x(N)[0]||N;(E=w==null?void 0:w.focus)==null||E.call(w)},p=h=>{if(h.key!=="Tab"||!N)return;const w=x(N);if(!w.length){h.preventDefault(),N.focus();return}const E=w[0],b=w[w.length-1],L=document.activeElement;h.shiftKey&&L===E?(h.preventDefault(),b.focus()):!h.shiftKey&&L===b&&(h.preventDefault(),E.focus())};return requestAnimationFrame(m),N==null||N.addEventListener("keydown",p),()=>{var w;N==null||N.removeEventListener("keydown",p);const h=y.current;h&&document.contains(h)&&((w=h.focus)==null||w.call(h))}},[e]),!e||typeof document>"u"?null:cf.createPortal(l.jsx("div",{className:j,role:"presentation",onPointerDown:N=>{g.current=N.target===N.currentTarget},onClick:N=>{u&&g.current&&N.target===N.currentTarget&&(t==null||t())},children:l.jsx("div",{ref:v,className:S,role:"dialog","aria-modal":"true","aria-label":n||"Sheet",onClick:N=>N.stopPropagation(),tabIndex:-1,children:l.jsxs("div",{className:"bottom-sheet-panel",children:[l.jsxs("header",{className:"bottom-sheet-head",children:[l.jsx("div",{className:"bottom-sheet-title",children:n||""}),l.jsx("button",{type:"button",className:"bottom-sheet-close",onClick:t,"aria-label":"Close",children:l.jsx(gs,{size:16})})]}),l.jsx("div",{className:"bottom-sheet-body",children:r}),s?l.jsx("footer",{className:"bottom-sheet-foot",children:s}):null]})})}),document.body)}function ck({items:e=[],value:t,onChange:n,ariaLabel:r,role:s="tablist",className:a="",tabClassName:i="",size:c="md",layout:u="equal",wrap:d=!1}){const g=["segmented-tabs",c==="sm"?"is-compact":"",u==="auto"?"is-auto":"",u==="icon"?"is-icon":"",d?"is-wrap":"",a].filter(Boolean).join(" "),v=s==="tablist"?"tab":"button",y=o.useRef([]);o.useEffect(()=>{y.current=y.current.slice(0,e.length)},[e.length]);const x=o.useMemo(()=>e.map((h,w)=>h.disabled?null:w).filter(h=>h!==null),[e]),S=o.useMemo(()=>e.findIndex(h=>h.key===t&&!h.disabled),[e,t]),j=x.length?x[0]:-1,N=S>=0?S:j,m=h=>{var E;const w=y.current[h];(E=w==null?void 0:w.focus)==null||E.call(w)},p=(h,w)=>{var b;if(!e.length)return h;let E=h;for(let L=0;L<e.length;L+=1)if(E=(E+w+e.length)%e.length,!((b=e[E])!=null&&b.disabled))return E;return h};return l.jsx("div",{className:g,role:s,"aria-label":r,children:e.map((h,w)=>{const E=h.key===t,b=h.label?String(h.label):"";return l.jsxs("button",{type:"button",ref:L=>{y.current[w]=L},role:v,"aria-selected":s==="tablist"?E:void 0,"aria-pressed":s!=="tablist"?E:void 0,"aria-controls":s==="tablist"?h.controls:void 0,className:["segmented-tab",E?"is-active":"",h.icon&&!b?"is-icon":"",h.className||"",i].filter(Boolean).join(" "),onClick:()=>{h.disabled||n==null||n(h.key)},onKeyDown:L=>{if(s!=="tablist"||!["ArrowRight","ArrowLeft","Home","End"].includes(L.key)||(L.preventDefault(),!e.length))return;let z=w;L.key==="Home"?z=x.length?x[0]:z:L.key==="End"?z=x.length?x[x.length-1]:z:L.key==="ArrowRight"?z=p(z,1):L.key==="ArrowLeft"&&(z=p(z,-1));const $=e[z];!$||$.disabled||(n==null||n($.key),m(z))},disabled:h.disabled,title:h.title||b||h.ariaLabel,"aria-label":h.ariaLabel,tabIndex:s==="tablist"?w===N?0:-1:void 0,children:[h.icon?l.jsx("span",{className:"segmented-tab-icon",children:h.icon}):null,b?l.jsx("span",{className:"segmented-tab-label",children:b}):null,h.badge?l.jsx("span",{className:"segmented-tab-badge",children:h.badge}):null]},h.key)})})}const vr=o.memo(ck),uk=(e=[])=>(e||[]).map(t=>typeof t=="string"||typeof t=="number"?{value:t,label:String(t)}:{value:(t==null?void 0:t.value)??(t==null?void 0:t.id)??"",label:(t==null?void 0:t.label)??(t==null?void 0:t.name)??String((t==null?void 0:t.value)??""),disabled:!!(t!=null&&t.disabled)}),dk=(e,t)=>{if(!t)return e;const n=t.trim().toLowerCase();return n?e.filter(r=>{const s=String(r.label||"").toLowerCase(),a=String(r.value||"").toLowerCase();return s.includes(n)||a.includes(n)}):e};function fk({value:e,onChange:t,options:n,children:r,placeholder:s,emptyLabel:a="No matches",disabled:i=!1,size:c="md",className:u="",wrapperClassName:d="",searchable:g=!1,searchThreshold:v=0,searchPlaceholder:y="Search options...",searchValue:x,onSearchChange:S,searchAriaLabel:j="Search options",...N}){const[m,p]=o.useState(""),h=typeof x=="string"?x:m,w=S||p,E=o.useMemo(()=>uk(n),[n]),b=g||typeof v=="number"&&v>0&&E.length>v,L=o.useMemo(()=>b?dk(E,h):E,[E,h,b]),z=["ui-control","ui-select",c==="sm"?"is-compact":"",u,b?"":d].filter(Boolean).join(" "),$=()=>r||(L.length?L.map(F=>l.jsx("option",{value:F.value,disabled:F.disabled,children:F.label},String(F.value))):l.jsx("option",{value:"",disabled:!0,children:a})),T=l.jsxs("select",{...N,className:z,value:e??"",onChange:F=>t==null?void 0:t(F.target.value),disabled:i,children:[s?l.jsx("option",{value:"",children:s}):null,$()]});return b?l.jsxs("div",{className:["ui-select-stack",d].filter(Boolean).join(" "),children:[l.jsx("input",{type:"search",value:h,onChange:F=>w(F.target.value),placeholder:y,className:"ui-control ui-input is-compact","aria-label":j,disabled:i}),T]}):T}const mt=o.memo(fk);function pk({open:e,cwd:t,setCwd:n,page:r,setPage:s,perPage:a,setPerPage:i,totalPages:c,topDirs:u,loading:d,imagesOnly:g,setImagesOnly:v,search:y,setSearch:x,shownEntries:S,onSelect:j,onClose:N,pickerSource:m,setPickerSource:p}){if(!e)return null;const h=m||"inputs",w=typeof p=="function",E=()=>{n(""),s(1)},b=F=>{w&&F!==h&&(p(F),n(""),s(1))},L=t.split("/").filter(Boolean),z=h==="outputs"?"Choose output":"Choose input",$=[{key:"",label:"Root"},...u.map(F=>({key:F.rel_path,label:F.name}))],T=F=>{n(F),s(1)};return l.jsx(Ht,{open:e,onClose:N,title:z,variant:"fullscreen",footer:l.jsxs("div",{className:"flex items-center gap-2 w-full",children:[l.jsx(X,{variant:"muted",className:"w-full",disabled:r<=1||d,onClick:()=>s(F=>Math.max(1,F-1)),children:"Prev"}),l.jsxs("div",{className:"text-xs text-center text-[rgba(159,178,215,0.75)] min-w-[92px]",children:[r," / ",c]}),l.jsx(X,{variant:"muted",className:"w-full",disabled:r>=c||d,onClick:()=>s(F=>F<c?F+1:F),children:"Next"})]}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Location"}),l.jsxs("div",{className:"imagepicker-breadcrumb",children:[l.jsx("button",{type:"button",className:"imagepicker-crumb",onClick:E,children:"Root"}),L.map((F,Z)=>{const ae=L.slice(0,Z+1).join("/");return l.jsx("button",{type:"button",className:"imagepicker-crumb",onClick:()=>{n(ae),s(1)},children:F},ae)})]})]}),w?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Source"}),l.jsx(vr,{ariaLabel:"Source",value:h,onChange:b,size:"sm",items:[{key:"inputs",label:"Inputs"},{key:"outputs",label:"Outputs"}]})]}):null,l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Filters"}),l.jsxs("div",{className:"composer-filters",children:[l.jsxs("label",{className:"inline-flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:g,onChange:F=>{v(F.target.checked),s(1)}}),l.jsx("span",{className:"text-sm text-[rgba(159,178,215,0.85)]",children:"Images only"})]}),l.jsx("input",{type:"search",value:y,onChange:F=>x(F.target.value),placeholder:"Search files",className:"sheet-input ui-control ui-input","aria-label":"Search files"}),l.jsx(mt,{value:a,onChange:F=>{const Z=parseInt(F,10)||50;i(Z),s(1)},"aria-label":"Items per page",size:"sm",options:[25,50,100]})]})]}),u.length>0?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Quick folders"}),l.jsx(vr,{ariaLabel:"Quick folders",value:t,onChange:T,size:"sm",layout:"auto",wrap:!0,className:"imagepicker-chips",items:$})]}):null,l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Results"}),d?l.jsxs("div",{className:"sheet-hint",children:["Scanning ",h==="outputs"?"output":"input"," folders"]}):S.length===0?l.jsx("div",{className:"sheet-hint",children:"Nothing here yet. Try a different folder or turn off Images only."}):null,l.jsx("div",{className:"imagepicker-grid",children:!d&&S.map(F=>{const Z=`${F.source||"input"}::${F.rel_path||F.name}`,ae=F.is_dir?"":F.preview_url||(F.source==="output"?zo({filename:F.filename,subfolder:F.subfolder,type:F.type}):Ro(F.rel_path||""));return l.jsx("button",{type:"button",className:`imagepicker-item ${F.is_dir?"is-dir":""}`,onClick:()=>{F.is_dir?(n(F.rel_path||""),s(1)):j(F)},children:F.is_dir?l.jsxs("div",{className:"imagepicker-dir-row",children:[l.jsx("div",{className:"imagepicker-dir-dot","aria-hidden":"true"}),l.jsx("div",{className:"imagepicker-name",children:F.name})]}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"imagepicker-thumb",children:ae?l.jsx("img",{className:"imagepicker-img",alt:F.name,src:ae}):l.jsx("div",{className:"imagepicker-img is-placeholder"})}),l.jsx("div",{className:"imagepicker-name",children:F.name})]})},Z)})})]})]})})}function mk({open:e,onClose:t,title:n,url:r,kind:s="image"}){return r?l.jsx(Ht,{open:e,onClose:t,title:n||"Preview",variant:"fullscreen",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(X,{href:r,target:"_blank",rel:"noreferrer",variant:"muted",className:"w-full text-center",children:"Open"}),l.jsx(X,{variant:"primary",className:"w-full",onClick:t,children:"Close"})]}),children:l.jsx("div",{className:"url-viewer-stage",children:s==="video"?l.jsx("video",{src:r,controls:!0,className:"url-viewer-media",autoPlay:!0}):l.jsx("img",{src:r,alt:n||"Preview",className:"url-viewer-media"})})}):null}function hk({input:e,value:t,onFormChange:n}){const{previewUrl:r,imgReady:s,setImgReady:a,displayName:i,serverOpen:c,openServer:u,closeServer:d,cwd:g,setCwd:v,page:y,setPage:x,perPage:S,setPerPage:j,totalPages:N,topDirs:m,loading:p,search:h,setSearch:w,imagesOnly:E,setImagesOnly:b,shownEntries:L,pickerSource:z,setPickerSource:$,handleUpload:T,clearImage:F,selectServer:Z}=ok({input:e,value:t,onFormChange:n}),ae=o.useRef(null),Ce=o.useRef(null),[ye,Y]=o.useState(0),[Se,R]=o.useState(!1);o.useEffect(()=>{const _=Ce.current;if(!_)return;const B=ue=>{ue.preventDefault(),ue.stopPropagation()},W=async ue=>{var Q,he;B(ue);const pe=(he=(Q=ue.dataTransfer)==null?void 0:Q.files)==null?void 0:he[0];pe&&(await T(pe),ae.current&&(ae.current.value=""),Y(J=>J+1))};return["dragenter","dragover","dragleave","drop"].forEach(ue=>_.addEventListener(ue,ue==="drop"?W:B)),()=>{["dragenter","dragover","dragleave","drop"].forEach(ue=>_.removeEventListener(ue,ue==="drop"?W:B))}},[T]);const A=async _=>{var W;const B=(W=_.target.files)==null?void 0:W[0];B&&(await T(B),ae.current&&(ae.current.value=""),Y(ue=>ue+1))},O=()=>{ae.current&&ae.current.click()};return l.jsxs("div",{className:"ui-card",children:[l.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[l.jsx("h3",{className:"text-sm font-semibold text-[#F8F4FF] truncate",children:i}),l.jsx("span",{className:"text-[11px] text-[#C3C7FFB3] truncate",children:"Image"})]}),l.jsx("div",{ref:Ce,className:"mb-3 rounded-xl border border-dashed border-[rgba(255,255,255,0.14)] bg-[rgba(255,255,255,0.02)] flex items-center justify-center min-h-[140px] sm:min-h-[180px] overflow-hidden",children:r?l.jsx(X,{variant:"bare",className:"w-full h-full",onClick:()=>R(!0),"aria-label":`Preview ${i}`,title:"Open preview",children:l.jsx("img",{src:r,alt:i,className:`max-h-64 max-w-full object-contain transition-opacity ${s?"opacity-100":"opacity-0"}`,onLoad:()=>a(!0)})}):l.jsx("div",{className:"text-[11px] text-[#9DA3FFCC] text-center px-6",children:"Drop an image here, upload from your device, or choose one from your server."})}),l.jsx("input",{ref:ae,type:"file",accept:"image/*",className:"hidden",onChange:A},ye),l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[l.jsx(X,{size:"sm",variant:"primary",onClick:u,children:"Choose"}),l.jsx(X,{size:"sm",variant:"muted",onClick:O,children:"Upload"}),l.jsx(X,{size:"sm",variant:"ghost",onClick:F,children:"Clear"})]}),l.jsx(pk,{open:c,cwd:g,setCwd:v,page:y,setPage:x,perPage:S,setPerPage:j,totalPages:N,topDirs:m,loading:p,imagesOnly:E,setImagesOnly:b,search:h,setSearch:w,shownEntries:L,pickerSource:z,setPickerSource:$,onSelect:Z,onClose:d}),l.jsx(mk,{open:Se,onClose:()=>R(!1),title:i||"Preview",url:r,kind:"image"})]})}function gk({open:e,onClose:t,title:n,description:r,render:s,index:a=0,total:i=0,children:c}){const[u,d]=o.useState("idle"),g=o.useRef(null),v=o.useRef(null),y=S=>S?Array.from(S.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(j=>!j.hasAttribute("disabled")&&j.getAttribute("aria-hidden")!=="true"):[];if(o.useEffect(()=>{if(u==="queued"){const S=setTimeout(()=>d("idle"),1600);return()=>clearTimeout(S)}},[u]),o.useEffect(()=>{if(!e||typeof document>"u")return;const S=g.current;v.current=document.activeElement;const j=()=>{var h;const p=y(S)[0]||S;(h=p==null?void 0:p.focus)==null||h.call(p)},N=m=>{if(m.key==="Escape"){t==null||t();return}if(m.key!=="Tab"||!S)return;const p=y(S);if(!p.length){m.preventDefault(),S.focus();return}const h=p[0],w=p[p.length-1],E=document.activeElement;m.shiftKey&&E===h?(m.preventDefault(),w.focus()):!m.shiftKey&&E===w&&(m.preventDefault(),h.focus())};return requestAnimationFrame(j),S==null||S.addEventListener("keydown",N),()=>{var p;S==null||S.removeEventListener("keydown",N);const m=v.current;m&&document.contains(m)&&((p=m.focus)==null||p.call(m))}},[e,t]),!e)return null;const x=typeof s=="function"?s():c;return l.jsxs("div",{className:"spotlight-overlay",role:"dialog","aria-modal":"true",children:[l.jsx("div",{className:"spotlight-backdrop",onClick:t}),l.jsxs("div",{className:"spotlight-sheet",ref:g,tabIndex:-1,children:[l.jsxs("div",{className:"spotlight-header",children:[l.jsxs("div",{className:"spotlight-meta",children:[l.jsx("div",{className:"spotlight-kicker",children:"Focused control"}),l.jsx("div",{className:"spotlight-title",children:n||"Control"}),r?l.jsx("div",{className:"spotlight-hint",children:r}):null]}),l.jsx("button",{type:"button",className:"spotlight-close",onClick:t,"aria-label":"Close",children:l.jsx(gs,{size:16})})]}),l.jsx("div",{className:"spotlight-body",children:x}),l.jsx("div",{className:"spotlight-footer",children:l.jsx("div",{className:"spotlight-footer-right",children:l.jsx(X,{size:"sm",variant:"muted",onClick:t,"aria-label":"Close",children:"Close"})})})]})]})}const _o=o.forwardRef(function({title:t,kicker:n,meta:r,defaultOpen:s=!0,variant:a="card",className:i="",bodyClassName:c,children:u},d){const g=a==="bare",v=(g?["collapsible-section","collapsible-section--bare",i]:["ui-panel","collapsible-card",i]).filter(Boolean).join(" "),y=(g?["collapsible-section-body",c||"space-y-4"]:["collapsible-card-body",c||"space-y-4"]).filter(Boolean).join(" "),x=r!=null?l.jsx("div",{className:"collapsible-card-summary-meta",children:r}):null;return l.jsxs("details",{ref:d,className:v,open:s,children:[l.jsxs("summary",{className:g?"collapsible-section-summary":"collapsible-card-summary",children:[l.jsxs("div",{className:"flex flex-col gap-1",children:[n?l.jsx("span",{className:"ui-kicker",children:n}):null,l.jsx("span",{className:"text-sm font-semibold tracking-wide",children:t})]}),x,g?l.jsx("span",{className:"collapsible-section-chevron","aria-hidden":"true",children:l.jsx(oc,{size:16})}):null]}),l.jsx("div",{className:y,children:u})]})}),yk=/\.(safetensors|ckpt|pt|pth)$/i,vk=/\.([a-z0-9]{2,16})$/i,xk=e=>/[a-z]/i.test(e),uc=e=>e.replace(/\\/g,"/"),Uy=e=>{const{folder:t,base:n}=wk(e);if(!n)return e;if(!t)return n;const r=t.split(/\s+/).filter(Boolean),s=r[r.length-1]||"";if(s&&n.toLowerCase().startsWith(s.toLowerCase())){const a=n.slice(s.length);return a?`${t}${a}`:t}return`${t} ${n}`.trim()};function Vy(e){if(typeof e!="string")return!1;const t=e.trim();if(!t)return!1;const r=uc(t).split("/").filter(Boolean).pop()||"";return yk.test(r)}function Rl(e){if(typeof e!="string")return!1;const t=e.trim();if(!t)return!1;const s=(uc(t).split("/").filter(Boolean).pop()||"").match(vk);return s?xk(s[1]):!1}function dc(e){if(typeof e!="string")return{folderPath:"",base:"",filename:""};const t=uc(e.trim());if(!t)return{folderPath:"",base:"",filename:""};const n=t.split("/").filter(Boolean),r=n.pop()||"",s=r.replace(/\.[^.]+$/,"");return{folderPath:n.join("/"),base:s,filename:r}}function wk(e){if(typeof e!="string")return{folder:"",base:""};const n=uc(e.trim()).split("/").filter(Boolean),s=(n.pop()||"").replace(/\.[^.]+$/,"");return{folder:n.join(" ").trim(),base:s}}function Sk(e){return Vy(e)?Uy(e):e}function kk(e){return Rl(e)?Uy(e):e}function cr(e){if(!Rl(e))return e;const{base:t}=dc(e);return t||kk(e)}const jk=(e="")=>{if(!e||e==="root")return"root";const t=e.split("/").filter(Boolean);return t[t.length-1]||e},Nk=o.memo(function({workflows:t=[],selectedWorkflow:n,onWorkflowChange:r,workflowData:s,presets:a=[],presetName:i="",onPresetNameChange:c,selectedPresetId:u="",onPresetSelect:d,onPresetSave:g,onPresetDelete:v,presetStatus:y}){const x=Array.isArray(t)?t:[],S=Array.isArray(a)?a:[],[j,N]=o.useState("All"),m=o.useMemo(()=>x.map(T=>{const F=String(T||"");if(!Rl(F))return{value:F,isFile:!1,base:"",folderPath:""};const{folderPath:Z,base:ae}=dc(F);return{value:F,isFile:!0,base:ae,folderPath:Z||"root"}}),[x]),p=o.useMemo(()=>{const T=new Set(["All"]);return m.forEach(F=>{F.isFile&&F.folderPath&&T.add(F.folderPath)}),Array.from(T).sort((F,Z)=>F.localeCompare(Z))},[m]),h=p.length>2;o.useEffect(()=>{if(!h){j!=="All"&&N("All");return}p.includes(j)||N("All")},[h,j,p]);const w=o.useMemo(()=>{const T=new Map;return m.forEach(F=>{if(!F.isFile||!F.base)return;const Z=F.base.toLowerCase();T.set(Z,(T.get(Z)||0)+1)}),T},[m]),E=o.useMemo(()=>{const T=[],F=h&&j==="All";return m.forEach(Z=>{if(!Z.isFile){T.push({value:Z.value,label:Z.value});return}if(h&&j!=="All"&&Z.folderPath!==j)return;let ae=Z.base||cr(Z.value)||Z.value;if(F&&Z.base){const Ce=Z.base.toLowerCase();w.get(Ce)>1&&(ae=`${ae} (${jk(Z.folderPath)})`)}T.push({value:Z.value,label:ae})}),T},[m,j,w,h]),b=o.useMemo(()=>n?E.some(T=>String(T.value)===String(n)):!0,[E,n]),L=o.useMemo(()=>!n||b?E:[{value:n,label:cr(String(n))},...E],[b,n,E]),z=()=>{g()},$=()=>{v()};return l.jsxs(_o,{title:l.jsxs(l.Fragment,{children:[l.jsx(Po,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Workflow"]}),bodyClassName:"control-shell controls-body",defaultOpen:!1,className:"controls-panel",children:[l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"workflow-select",children:"Workflow"}),h?l.jsx(mt,{value:j,onChange:N,wrapperClassName:"mb-2","aria-label":"Workflow folder filter",size:"sm",options:p.map(T=>({value:T,label:T}))}):null,l.jsx(mt,{id:"workflow-select",value:n||"",onChange:r,"aria-label":"Workflow",size:"sm",placeholder:"Select workflow...",options:L})]}),l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"preset-select",children:"Preset"}),l.jsx(mt,{id:"preset-select",value:u||"",onChange:d,"aria-label":"Workflow preset",disabled:!s,size:"sm",placeholder:"Select preset...",options:S.map(T=>({value:T.id,label:T.name}))})]}),l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"preset-name-input",children:"Preset name"}),l.jsx("input",{id:"preset-name-input",type:"text",value:i,onChange:T=>c(T.target.value),className:"ui-control ui-input",placeholder:"Name for new preset...","aria-label":"Preset name",disabled:!s})]}),l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsx(X,{size:"sm",variant:"primary",onClick:z,disabled:!s||!i.trim(),children:"Save preset"}),l.jsx(X,{size:"sm",variant:"muted",onClick:$,disabled:!s||!u,children:"Delete preset"})]}),y?l.jsx("div",{className:"text-xs text-[#6D8BFF]",children:y}):null]})]})});function Ck({open:e,onClose:t,title:n,value:r,onChange:s,placeholder:a="",description:i}){const c=n||"Edit",u=o.useMemo(()=>`sheet-textarea-${Math.random().toString(36).slice(2,9)}`,[]);return l.jsxs(Ht,{open:e,onClose:t,title:c,variant:"fullscreen",footer:l.jsx(X,{variant:"primary",className:"w-full",onClick:t,children:"Done"}),children:[i?l.jsx("div",{className:"text-[12px] text-[rgba(159,178,215,0.75)] mb-3",children:i}):null,l.jsx("textarea",{id:u,value:r??"",onChange:d=>s==null?void 0:s(d.target.value),placeholder:a,className:"sheet-textarea ui-control ui-textarea",rows:12})]})}function rn(e){const t=Number(e);return Number.isFinite(t)?t.toFixed(2).replace(/\.?0+$/u,""):"1"}function Wy(e=""){const t=String(e||"");if(!t.trim())return[];const n=[];let r=0;const s=(a,i)=>{if(a[i]!=="(")return!1;let c=-1,u=i+1;for(;u<a.length;){const g=a[u];if(g===`
`)return!1;if(g===":"&&(c=u),g===")")break;u++}if(u>=a.length||a[u]!==")"||c===-1)return!1;const d=a.slice(c+1,u).trim();return/^\d+(\.\d+)?$/u.test(d)};for(;r<t.length;){for(;r<t.length&&/[\s,]/.test(t[r]);)r++;if(r>=t.length)break;let a=r,i=r,c="tag",u="";const d=s(t,r);if(d&&(a=r,r++),t[r]==="$"){c="alias";const y=r;for(r++;r<t.length&&t[r]!=="$"&&t[r]!==","&&t[r]!==`
`;)u+=t[r],r++;t[r]==="$"&&r++,d||(a=y)}else if(d){for(c="tag";r<t.length&&!(t[r]===":"||t[r]===`
`||t[r]===")");)u+=t[r],r++;u=u.trim()}else{c="tag";const y=r;for(;r<t.length&&!(t[r]===","||t[r]==="$"||t[r]===`
`);)u+=t[r],r++;u=u.trim(),a=y}if(d&&t[r]===":"){for(r++;r<t.length&&t[r]!==")"&&t[r]!==","&&t[r]!==`
`;)r++;t[r]===")"&&r++}d&&t[r]===")"&&r++,i=r;const g=u.trim(),v=c==="alias"&&/^:?[\d.]+$/u.test(g);g&&!v&&n.push({type:c,text:g,start:a,end:i})}return n}function Zr(e="",t){if(!t||typeof t.start!="number"||typeof t.end!="number")return null;const r=String(e||"").slice(t.start,t.end);if(!r.startsWith("(")||!r.includes(":"))return null;const s=r.lastIndexOf(":");if(s===-1)return null;const a=r.slice(s+1);if(!a.endsWith(")"))return null;const i=a.slice(0,-1).trim();if(!/^\d+(\.\d+)?$/u.test(i))return null;const c=Number.parseFloat(i);return Number.isFinite(c)?{weight:c,wrapperStart:t.start,wrapperEnd:t.end}:null}function Hy(e="",t,n){const r=String(e||"");if(!t||typeof t.start!="number"||typeof t.end!="number")return r;const s=n==null?null:Number(n),a=s===null||!Number.isFinite(s)||Math.abs(s-1)<1e-6,i=t.type==="alias"?`$${t.text}$`:t.text;if(a)return r.slice(0,t.start)+i+r.slice(t.end);const c=rn(s),u=`(${i}:${c})`;return r.slice(0,t.start)+u+r.slice(t.end)}function Ky(e="",t,n,r){var y;if(n===r||n===null||r===null||!(t!=null&&t.length))return e;const s=String(e||""),a=t.map(x=>({start:x.start,end:x.end,text:s.slice(x.start,x.end)})),i=a.slice(0,-1).map((x,S)=>{const j=a[S+1];return s.slice(x.end,j.start)}),c=a.length?s.slice(0,a[0].start):"",u=a.length?s.slice(a[a.length-1].end):"",d=[...a],[g]=d.splice(n,1);d.splice(r,0,g);let v=c+(((y=d[0])==null?void 0:y.text)||"");for(let x=1;x<d.length;x++)v+=(i[x-1]??", ")+d[x].text;return v+=u,v}function Gy(e="",t){const n=String(e||"");if(!t||typeof t.start!="number"||typeof t.end!="number")return n;const r=n.slice(0,t.start).replace(/[\s,]*$/,""),s=n.slice(t.end).replace(/^[\s,]*/,"");return r?`${r}, ${s}`.trim():s.trim()}function Yy(e="",t,n){const r=String(e||"");if(!t||typeof t.start!="number"||typeof t.end!="number"||!n)return r;const s=r.slice(0,t.start),a=r.slice(t.end),i=s.replace(/[\s,]*$/,""),c=a.replace(/^[\s,]*/,"");return i&&c?`${i}, ${n}, ${c}`:i?`${i}, ${n}`:c?`${n}, ${c}`:n}function tl(e="",t){if(!t||typeof t.index!="number"||typeof t.length!="number")return null;const n=String(e||""),r=t.index,s=t.index+t.length;if(r<=0||n[r-1]!=="("||n[s]!==":")return null;let a=s+1,i="";for(;a<n.length&&n[a]!==")";)if(i+=n[a],a+=1,i.length>12)return null;if(a>=n.length||n[a]!==")")return null;const c=i.trim();if(!/^\d+(\.\d+)?$/u.test(c))return null;const u=Number.parseFloat(c);return Number.isFinite(u)?{weight:u,wrapperStart:r-1,wrapperEnd:a+1}:null}function _i(e="",t,n){const r=String(e||"");if(!t||typeof t.index!="number"||typeof t.length!="number")return r;const s=t.index,a=t.index+t.length,i=tl(r,t),c=n==null?null:Number(n),u=c===null||!Number.isFinite(c)||Math.abs(c-1)<1e-6;if(i){if(u)return r.slice(0,i.wrapperStart)+r.slice(s,a)+r.slice(i.wrapperEnd);const g=rn(c);return r.slice(0,a+1)+g+r.slice(i.wrapperEnd-1)}if(u)return r;const d=rn(c);return r.slice(0,s)+"("+r.slice(s,a)+":"+d+")"+r.slice(a)}function Ii(e,t,n){const r=Number(e);return Number.isFinite(r)?Math.max(t,Math.min(n,r)):t}function Pm({open:e,onClose:t,title:n="Alias strength",tokenLabel:r="",weight:s=1,onApply:a,onRemoveWeight:i,onDeleteToken:c,onReplace:u,replaceLabel:d="Replace"}){const g=o.useMemo(()=>Ii(s||1,.2,2),[s]),[v,y]=o.useState(g);o.useEffect(()=>{e&&y(g)},[e,g]);const x=rn(v);return l.jsx(Ht,{open:e,onClose:t,title:n,footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(X,{variant:"muted",className:"w-full",onClick:t,children:"Cancel"}),l.jsx(X,{variant:"primary",className:"w-full",onClick:()=>{a==null||a(v),t==null||t()},children:"Done"})]}),children:l.jsxs("div",{className:"sheet-stack token-strength-sheet",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Alias"}),l.jsx("div",{className:"sheet-hint",children:r||""})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Strength"}),l.jsxs("div",{className:"token-strength-row",children:[l.jsx(X,{size:"sm",variant:"muted",onClick:()=>y(S=>Ii(S-.05,.2,2)),children:""}),l.jsxs("div",{className:"token-strength-value tabular-nums",children:[x,""]}),l.jsx(X,{size:"sm",variant:"muted",onClick:()=>y(S=>Ii(S+.05,.2,2)),children:"+"})]}),l.jsx("input",{type:"range",min:.2,max:2,step:.05,value:v,onChange:S=>y(Ii(S.target.value,.2,2)),className:"ui-range","aria-label":"Alias strength"}),l.jsx("div",{className:"sheet-hint token-strength-hint",children:"1.0 is normal. Increase to emphasize or reduce to soften."})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Actions"}),l.jsxs("div",{className:"token-strength-actions",children:[l.jsx(X,{size:"sm",variant:"ghost",onClick:()=>y(1),children:"Reset"}),u?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"token-strength-divider","aria-hidden":"true",children:"|"}),l.jsx(X,{size:"sm",variant:"ghost",onClick:()=>{u==null||u(),t==null||t()},children:d})]}):null,l.jsx("span",{className:"token-strength-divider","aria-hidden":"true",children:"|"}),l.jsx(X,{size:"sm",variant:"danger",onClick:()=>{c==null||c(),t==null||t()},children:"Delete"})]})]})]})})}function es(e){const t=String(e||"").trim();if(!t)return"";const n=t.toLowerCase(),r={scifi:"Sci-Fi",sci:"Sci",ui:"UI",vfx:"VFX",hdr:"HDR",dof:"DoF",bokeh:"Bokeh",vhs:"VHS",jpeg:"JPEG",jpg:"JPG",png:"PNG",gif:"GIF",webp:"WebP",api:"API",nsfw:"NSFW",sfw:"SFW",sfx:"SFX",fx:"FX",lora:"LoRA",loras:"LoRAs",ip:"IP",egirl:"E-girl",i2v:"I2V",t2i:"T2I",img2img:"Img2Img",txt2img:"Txt2Img",tts:"TTS",asmr:"ASMR",ai:"AI",highleg:"High-Leg","one-piece":"One-Piece","three-quarter":"Three-Quarter"};return r[n]?r[n]:/^\d+$/.test(n)?n:n==="3d"?"3D":n==="2d"?"2D":n.length===1?n.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1)}function bk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return n==="media"?"media":n==="posture"?"posture":n==="dynamic"?"dynamic":n==="interaction"?"interaction":n||"other"}function Ek(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return n==="lingerie"?"lingerie":n==="swimwear"||n==="swim"?"swimwear":n==="costumes"||n==="tech"?"costumes":n==="uniform"?"uniform":n==="formal"?"formal":n==="alt"?"alt":n==="sensual"?"sensual":n==="trad"?"trad":n==="pro"?"pro":n==="sporty"?"sporty":n==="fantasy"?"fantasy":n==="casual"||n==="street"||n==="lounge"||n==="sporty"||n==="dress"?"everyday":n||"everyday"}function Ak(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_").filter(Boolean),r=n[0]||"",s=n[1]||"";if(["fire","candlelight","embers"].includes(r))return"fire";if(["moonlight"].includes(r))return"night";if(["neon"].includes(r))return"neon";if(["studio","stage","sidelighting","dim"].includes(r))return"studio";if(["golden","sunbeam","dappled"].includes(r))return"natural";if(["lens","light"].includes(r))return"effects";if(r==="special"){if(["candlelight","embers","fire"].includes(s))return"fire";if(s==="moonlight")return"night";if(s==="neon")return"neon";if(["stage","spotlight","studio"].includes(s))return"studio";if(["sunbeam","golden","dappled"].includes(s))return"natural";if(s)return"effects"}return r==="particle"?["sunbeam","dust"].includes(s)?"natural":"effects":r||"other"}function Lk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return["aftercare","bdsm","clothed","cumshot","flexible","footjob","foreplay","furniture","group","handjob","lesbian","locations","masturbation","oral","paizuri","penetration","pregnant","special","toys"].includes(n)?n:"other"}function Pk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return["fantasy","scifi","horror","cyberpunk","historical","wasteland","occult","mythology"].includes(n)?n:"other"}function Tk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_").filter(Boolean);return n[0]==="hair"&&n[1]?n[1]:n[0]||"other"}function hl(e="",t=""){const n=String(e||"").trim(),r=String(t||"").trim().toLowerCase();if(!n)return"";if(r==="outfit")return Ek(n)||"everyday";if(r==="pose")return bk(n)||"everyday";if(r==="lighting")return Ak(n)||"effects";if(r==="nsfw")return Lk(n)||"other";if(r==="character")return Pk(n)||"other";if(r==="hair")return Tk(n)||"other";const s=n.indexOf("_");return s<=0?"":n.slice(0,s).trim()}function Qy(e=""){const t=String(e||"").trim();return t?t.includes(":")?t.split(":").slice(1).join(":"):t:""}function gl({token:e="",name:t=""}={}){const n=String(t||"").trim()||Qy(e);if(!n)return"";let s=n.replace(/_(\d+)$/u,"").split("_").filter(Boolean);if(s.length===0)return n;const a=[];for(let v=0;v<s.length;v++){const y=s[v],x=s[v+1];if(y&&x&&y.toLowerCase()==="one"&&x.toLowerCase()==="piece"){a.push("one-piece"),v+=1;continue}if(y&&x&&y.toLowerCase()==="three"&&x.toLowerCase()==="quarter"){a.push("three-quarter"),v+=1;continue}a.push(y)}if(s=a,Array.from(new Set(s.map(v=>String(v).toLowerCase()))).length===1)return es(s[0]);const c=s[0],u=s.slice(1),d=es(c),g=u.map(es).join(" ").trim();return g?g.toLowerCase()===d.toLowerCase()?u.length===1&&String(u[0]).toLowerCase()===String(c).toLowerCase()?d||n:s.map(es).join(" ").trim()||n:`${d} - ${g}`:s.map(es).join(" ").trim()||n}function yf(e){if(!e)return{subcategory:"",displayName:""};const t=e.name||"",n=e.token||"",r=Qy(n)||t,s=hl(r,e.category)||"other",a=gl({token:n,name:t})||n||t||"Alias";return{subcategory:s,displayName:a}}function nn(e=""){const t=String(e||"").trim();if(!t)return"";if(t==="All")return"All";if(t.startsWith("prompts_")){const r=t.replace("prompts_","");return`PROMPTS - ${es(r)}`}return{character:"SUBJECT - Character",media_char:"SUBJECT - Media Character",body:"SUBJECT - Body",expression:"SUBJECT - Expression",outfit:"SUBJECT - Outfit",accessory:"SUBJECT - Accessory",dynamic:"POSE - Dynamic",interaction:"POSE - Interaction",media_pose:"POSE - Media",posture:"POSE - Posture",nsfw:"POSE - NSFW",indoor:"SCENE - Indoor",outdoor:"SCENE - Outdoor",urban:"SCENE - Urban",everyday:"SCENE - Everyday",media:"SCENE - Media",art:"SCENE - Art",history:"SCENE - History",speculative:"SCENE - Speculative",weather:"SCENE - Weather",artistic:"STYLES - Artistic",film:"STYLES - Film",game:"STYLES - Game",photo:"STYLES - Photo",vintage:"STYLES - Vintage",angles:"CAMERA - Angles",distance:"CAMERA - Distance",lens:"CAMERA - Lens",technique:"CAMERA - Technique",device:"CAMERA - Device",lighting:"CAMERA - Lighting",render:"CAMERA - Render",filter:"CAMERA - Filter",prompts:"PROMPTS - Full Scenes"}[t]||es(t)}function bn(e=""){const t=String(e||"").trim();return t?t==="All"?"All":t.split(/[_-]+/u).filter(Boolean).map(n=>es(n)).join(" ").trim():""}function Tm({open:e,onClose:t,isPromptLike:n,pickerSearch:r,onSearchChange:s,pickerSearchRef:a,categories:i,pickerCategory:c,onCategoryChange:u,subcategories:d,pickerSubcategory:g,onSubcategoryChange:v,filteredAliases:y,visibleAliases:x,visibleCount:S,onShowMore:j,listItemVisibilityStyles:N,onInsertAlias:m}){return l.jsx(Ht,{open:e,onClose:t,title:n?"Insert alias":"Aliases",footer:l.jsx(X,{variant:"primary",className:"w-full",onClick:t,children:"Done"}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Search"}),l.jsxs("div",{className:"composer-filters",children:[l.jsx("input",{ref:a,type:"text",value:r,onChange:p=>s(p.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(mt,{value:c,onChange:u,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:["All",...i.filter(p=>p!=="All")].map(p=>({value:p,label:p==="All"?"Category: All":nn(p)}))}),d.length>2?l.jsx(mt,{value:g,onChange:v,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:d.map(p=>({value:p,label:p==="All"?"All subcategories":bn(p)}))}):null]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Results"}),l.jsx("div",{className:"composer-alias-list",children:y.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[x.map(p=>l.jsxs("button",{type:"button",onClick:()=>m(p.token,{closeAfter:!n}),className:"composer-alias-item",style:N,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:p.displayName||p.token}),p.category?l.jsx("span",{className:"composer-alias-category",children:nn(p.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",p.token,"$"]}),l.jsx("div",{className:"composer-alias-text",children:p.text})]},p.key)),S<y.length?l.jsxs(X,{variant:"muted",className:"w-full",onClick:j,children:["Show more (",y.length-S," left)"]}):null]})})]})]})})}const Rm={contentVisibility:"auto",containIntrinsicSize:"240px 120px"};function Rk({name:e,label:t,description:n,value:r,onChange:s,onEnter:a,disabled:i=!1,multiline:c=!1,aliasOptions:u=[],aliasCatalog:d=[],onOpenComposer:g}){var Oe,xt;const v=o.useRef(null),y=o.useRef(null),x=o.useRef({start:null,end:null}),S=o.useRef(null),j=o.useRef(null),[N,m]=o.useState(null),[p,h]=o.useState(null),[w,E]=o.useState(!1),[b,L]=o.useState(""),z=o.useDeferredValue(b),[$,T]=o.useState("All"),[F,Z]=o.useState("All"),[ae]=o.useState([]),Ce=o.useRef(null),[ye,Y]=o.useState(!1),[Se,R]=o.useState(!1),[A,O]=o.useState(null),_=typeof r=="string"?r:String(r??"");o.useMemo(()=>Array.isArray(u)?u.filter(Boolean):[],[u]);const B=o.useMemo(()=>(Array.isArray(d)?d.filter(D=>D&&D.name):[]).map(D=>({...D,...yf(D)})),[d]),W=o.useMemo(()=>B,[B]),ue=D=>{const re=D.target.value;s==null||s(re)},pe=D=>{if(!c&&D.key==="Enter"){D.preventDefault(),a==null||a(D.target.value,D);return}},Q=o.useMemo(()=>{const D=new Map;return W.forEach(re=>{re!=null&&re.token&&D.set(String(re.token).toLowerCase(),re)}),D},[W]),he=o.useMemo(()=>{const D=new Set(["All"]);return B.forEach(re=>{re.category&&D.add(re.category)}),Array.from(D).sort((re,be)=>re.localeCompare(be))},[B]),J=o.useMemo(()=>{const D=new Set(["All"]);return W.forEach(re=>{(!$||$==="All"||re.category===$)&&re.subcategory&&D.add(re.subcategory)}),Array.from(D).sort((re,be)=>re.localeCompare(be))},[W,$]);o.useEffect(()=>{Z("All")},[$]);const U=o.useMemo(()=>{const D=_||"";if(!D||!D.includes("$"))return[];const re=[],be=/\$([a-z0-9_:-]+)\$/gi;let Ee;for(;Ee=be.exec(D);)re.push({token:Ee[1],index:Ee.index,length:Ee[0].length});return re},[_]),H=()=>{try{const D=v.current;D?x.current={start:D.selectionStart??null,end:D.selectionEnd??null}:x.current={start:null,end:null}}catch{x.current={start:null,end:null}}y.current&&y.current.scrollIntoView({block:"center",behavior:"smooth"}),E(!0)},ve=o.useMemo(()=>{const D=z.trim().toLowerCase();return W.filter(re=>{var be,Ee,Fe,tt;return $!=="All"&&(re.category||"")!==$||F!=="All"&&(re.subcategory||"other")!==F?!1:D?((be=re.token)==null?void 0:be.toLowerCase().includes(D))||((Ee=re.text)==null?void 0:Ee.toLowerCase().includes(D))||((Fe=re.name)==null?void 0:Fe.toLowerCase().includes(D))||((tt=re.displayName)==null?void 0:tt.toLowerCase().includes(D)):!0}).sort((re,be)=>{const Ee=(re.subcategory||"").toLowerCase(),Fe=(be.subcategory||"").toLowerCase();return Ee!==Fe?Ee.localeCompare(Fe):re.token.localeCompare(be.token)})},[W,$,F,z]),[ge,$e]=o.useState(30),ke=o.useMemo(()=>ve.slice(0,ge),[ve,ge]);o.useEffect(()=>{$e(30)},[$,F,b,B]),o.useEffect(()=>{Z("All")},[$]);const ze=(D,{closeAfter:re=!0}={})=>{var me,_e;const be=v.current,Ee=`$${D}$`,Fe=_||"",tt=(me=x.current)==null?void 0:me.start,Ge=(_e=x.current)==null?void 0:_e.end,Xe=(be==null?void 0:be.selectionStart)??(typeof tt=="number"?tt:Fe.length),V=(be==null?void 0:be.selectionEnd)??(typeof Ge=="number"?Ge:Fe.length),ie=Fe.slice(0,Xe),je=Fe.slice(V),Le=ie.match(/[^\s]$/),Be=je.match(/^[^\s]/),Ze=Le&&Le[0]!==","?", ":"",I=Be&&Be[0]!==","?", ":"",K=ie+Ze+Ee+I+je;s==null||s(K);const se=(ie+Ze+Ee+I).length;x.current={start:se,end:se},re&&(E(!1),requestAnimationFrame(()=>{var Te;(Te=be==null?void 0:be.blur)==null||Te.call(be)}))},Me=D=>{const re=_||"",be=tl(re,D),Ee=be?be.wrapperStart:D.index,Fe=be?be.wrapperEnd:D.index+D.length,tt=re.slice(0,Ee).replace(/[\s,]*$/,""),Ge=re.slice(Fe).replace(/^[\s,]*/,""),Xe=tt?`${tt} ${Ge}`.trim():Ge.trim();s==null||s(Xe)},at=D=>{if(!D)return;const re=Q.get(D.token.toLowerCase()),be=(re==null?void 0:re.displayName)||D.token,Ee=tl(_||"",D);O({tokenObj:D,displayName:be,weight:(Ee==null?void 0:Ee.weight)??1}),R(!0),requestAnimationFrame(()=>{var Fe,tt;return(tt=(Fe=v.current)==null?void 0:Fe.blur)==null?void 0:tt.call(Fe)})},qe=o.useMemo(()=>(D,re)=>{var je;if(D===re||D===null||re===null||!(U!=null&&U.length))return;const be=_||"",Ee=U.map(Le=>{const Be=tl(be,Le),Ze=Be?Be.wrapperStart:Le.index,I=Be?Be.wrapperEnd:Le.index+Le.length;return{start:Ze,end:I,text:be.slice(Ze,I)||`$${Le.token}$`}}),Fe=Ee.slice(0,-1).map((Le,Be)=>{const Ze=Ee[Be+1];return be.slice(Le.end,Ze.start)}),tt=Ee.length?be.slice(0,Ee[0].start):"",Ge=Ee.length?be.slice(Ee[Ee.length-1].end):"",Xe=[...Ee],[V]=Xe.splice(D,1);Xe.splice(re,0,V);let ie=tt+(((je=Xe[0])==null?void 0:je.text)||"");for(let Le=1;Le<Xe.length;Le+=1)ie+=(Fe[Le-1]??", ")+Xe[Le].text;ie+=Ge,s==null||s(ie)},[s,U,_]),lt=(D,re)=>{m(re),S.current=D.currentTarget,D.dataTransfer.effectAllowed="move",D.dataTransfer.setData("text/plain",String(re)),requestAnimationFrame(()=>{S.current&&S.current.classList.add("is-dragging")})},Re=(D,re)=>{D.preventDefault(),D.dataTransfer.dropEffect="move",re!==p&&h(re)},Qe=D=>{D!==p&&h(D)},G=D=>{N!==null&&D!==null&&N!==D&&qe(N,D),m(null),h(null),S.current=null},q=()=>{S.current&&S.current.classList.remove("is-dragging"),G(p)},le=(D,re)=>{D.preventDefault(),G(re)},te=(D,re)=>{var Fe,tt;if(!((tt=(Fe=D.target)==null?void 0:Fe.closest)==null?void 0:tt.call(Fe,".token-chip-drag-handle")))return;const Ee=D.touches[0];j.current={idx:re,startX:Ee.clientX,startY:Ee.clientY,moved:!1}},de=D=>{if(!j.current)return;const re=D.touches[0],be=Math.abs(re.clientX-j.current.startX),Ee=Math.abs(re.clientY-j.current.startY);if(be<=10&&Ee<=10)return;j.current.moved=!0,m(j.current.idx),D.preventDefault();const Fe=y.current,tt=Fe?Fe.querySelectorAll(".token-chip-draggable"):document.querySelectorAll(".token-chip-draggable"),Ge=re.clientX,Xe=re.clientY;for(let V=0;V<tt.length;V++){const ie=tt[V].getBoundingClientRect();if(Ge>=ie.left&&Ge<=ie.right&&Xe>=ie.top&&Xe<=ie.bottom){h(V);break}}},we=()=>{var D;(D=j.current)!=null&&D.moved&&N!==null&&p!==null&&N!==p&&qe(N,p),j.current=null,m(null),h(null)},ee={id:e,name:e,value:_,onChange:ue,disabled:i,className:"ui-control ui-input pr-10 text-[13px] sm:text-sm",placeholder:"","aria-label":t||e,"aria-describedby":n?`${e}-description`:void 0},We=()=>{E(!1),requestAnimationFrame(()=>{var D,re;(re=(D=v.current)==null?void 0:D.blur)==null||re.call(D)})},et=(()=>{const D=String(e||"").toLowerCase(),re=String(t||"").toLowerCase();return!!`${D} ${re}`.trim().includes("prompt")})();return c?l.jsxs("div",{className:"relative space-y-2",ref:y,children:[g&&!et?l.jsxs("div",{className:"stringinput-toolbar",children:[l.jsx(X,{size:"sm",variant:"muted",onClick:()=>g(e),children:"Open composer"}),B.length?l.jsx(X,{size:"sm",variant:"ghost",onClick:H,children:"Aliases"}):null,l.jsx(X,{size:"sm",variant:"ghost",onClick:()=>Y(!0),children:"Expand"})]}):null,l.jsx("textarea",{ref:v,...ee,rows:3,wrap:"soft",onKeyDown:pe,className:ee.className+" resize-none min-h-[88px] max-h-[160px] leading-relaxed overflow-y-auto overflow-x-hidden break-words whitespace-pre-wrap",style:{whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere"}}),g&&et?l.jsx("div",{className:"stringinput-underbar",children:l.jsxs("div",{className:"stringinput-underbar-actions",children:[l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>g(e),children:"Open composer"}),B.length?l.jsx(X,{size:"xs",variant:"ghost",onClick:H,children:"Insert alias"}):null]})}):null,l.jsx(Ck,{open:ye,onClose:()=>Y(!1),title:t||e,value:_,onChange:s,description:n}),U.length?l.jsxs("div",{className:"stringinput-tokens",children:[l.jsxs("div",{className:"stringinput-tokens-label",children:["Active aliases ",l.jsx("span",{className:"stringinput-tokens-hint",children:"(drag to reorder)"})]}),l.jsx("div",{className:"stringinput-tokens-list",children:U.map((D,re)=>{var Xe;const be=Q.get(D.token.toLowerCase()),Ee=(be==null?void 0:be.displayName)||D.token,Fe=N===re,tt=p===re&&N!==null&&N!==re,Ge=((Xe=tl(_||"",D))==null?void 0:Xe.weight)??1;return l.jsxs("div",{className:`ui-chip is-clickable token-chip token-chip-draggable ${Fe?"is-dragging":""} ${tt?"is-drop-target":""}`,title:`$${D.token}$`,role:"button",tabIndex:0,draggable:!0,onDragStart:V=>lt(V,re),onDragEnd:q,onDragEnter:()=>Qe(re),onDragOver:V=>Re(V,re),onDrop:V=>le(V,re),onTouchStart:V=>te(V,re),onTouchMove:de,onTouchEnd:we,onClick:()=>{N===null&&at(D)},onKeyDown:V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),at(D))},children:[l.jsx("span",{className:"token-chip-drag-handle","aria-hidden":"true",children:l.jsx(Da,{size:14})}),l.jsx("span",{className:"token-chip-label",children:Ee}),Math.abs(Ge-1)>1e-6?l.jsxs("span",{className:"token-chip-weight","aria-label":`Strength ${rn(Ge)}x`,children:["",rn(Ge)]}):null,l.jsx(X,{size:"mini",variant:"danger",onClick:V=>{V.stopPropagation(),Me(D)},"aria-label":`Remove ${D.token}`,children:l.jsx(gs,{size:12})})]},`${D.token}-${D.index}`)})})]}):null,l.jsx(Pm,{open:Se,onClose:()=>R(!1),title:"Alias strength",tokenLabel:A?`${A.displayName}  $${(Oe=A.tokenObj)==null?void 0:Oe.token}$`:"",weight:(A==null?void 0:A.weight)??1,onApply:D=>{A!=null&&A.tokenObj&&(s==null||s(_i(_||"",A.tokenObj,D)))},onRemoveWeight:()=>{A!=null&&A.tokenObj&&(s==null||s(_i(_||"",A.tokenObj,null)))},onDeleteToken:()=>{A!=null&&A.tokenObj&&Me(A.tokenObj)}}),w?l.jsx(Tm,{open:w,onClose:We,isPromptLike:et,pickerSearch:b,onSearchChange:L,pickerSearchRef:Ce,categories:he,pickerCategory:$,onCategoryChange:T,subcategories:J,pickerSubcategory:F,onSubcategoryChange:Z,filteredAliases:ve,visibleAliases:ke,visibleCount:ge,onShowMore:()=>$e(D=>Math.min(D+30,ve.length)),listItemVisibilityStyles:Rm,onInsertAlias:ze}):null]}):l.jsxs("div",{className:"relative space-y-2",ref:y,children:[l.jsx("input",{...ee,type:"text",inputMode:"text",autoComplete:"off",onKeyDown:pe,className:ee.className+" min-h-[44px]",ref:v}),U.length?l.jsxs("div",{className:"stringinput-tokens",children:[l.jsxs("div",{className:"stringinput-tokens-label",children:["Active aliases ",l.jsx("span",{className:"stringinput-tokens-hint",children:"(drag to reorder)"})]}),l.jsx("div",{className:"stringinput-tokens-list",children:U.map((D,re)=>{var Xe;const be=Q.get(D.token.toLowerCase()),Ee=(be==null?void 0:be.displayName)||D.token,Fe=N===re,tt=p===re&&N!==null&&N!==re,Ge=((Xe=tl(_||"",D))==null?void 0:Xe.weight)??1;return l.jsxs("div",{className:`ui-chip is-clickable token-chip token-chip-draggable ${Fe?"is-dragging":""} ${tt?"is-drop-target":""}`,title:`$${D.token}$`,onClick:()=>{N===null&&at(D)},role:"button",tabIndex:0,draggable:!0,onDragStart:V=>lt(V,re),onDragEnd:q,onDragEnter:()=>Qe(re),onDragOver:V=>Re(V,re),onDrop:V=>le(V,re),onTouchStart:V=>te(V,re),onTouchMove:de,onTouchEnd:we,onKeyDown:V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),at(D))},children:[l.jsx("span",{className:"token-chip-drag-handle","aria-hidden":"true",children:l.jsx(Da,{size:14})}),l.jsx("span",{className:"token-chip-label",children:Ee}),Math.abs(Ge-1)>1e-6?l.jsxs("span",{className:"token-chip-weight","aria-label":`Strength ${rn(Ge)}x`,children:["",rn(Ge)]}):null,l.jsx(X,{size:"mini",variant:"danger",onClick:V=>{V.stopPropagation(),Me(D)},"aria-label":`Remove ${D.token}`,children:l.jsx(gs,{size:12})})]},`${D.token}-${D.index}`)})})]}):null,l.jsx(Pm,{open:Se,onClose:()=>R(!1),title:"Alias strength",tokenLabel:A?`${A.displayName}  $${(xt=A.tokenObj)==null?void 0:xt.token}$`:"",weight:(A==null?void 0:A.weight)??1,onApply:D=>{A!=null&&A.tokenObj&&(s==null||s(_i(_||"",A.tokenObj,D)))},onRemoveWeight:()=>{A!=null&&A.tokenObj&&(s==null||s(_i(_||"",A.tokenObj,null)))},onDeleteToken:()=>{A!=null&&A.tokenObj&&Me(A.tokenObj)}}),B.length?l.jsx(X,{size:"sm",variant:"ghost",className:"stringinput-trailing",onClick:()=>g?g(e):H(),title:g?"Open prompt composer":"Insert alias","aria-label":g?"Open prompt composer":"Insert alias",children:g?l.jsx(ic,{size:16}):l.jsx(ac,{size:16})}):null,l.jsx(Tm,{open:w,onClose:We,isPromptLike:et,pickerSearch:b,onSearchChange:L,pickerSearchRef:Ce,categories:he,pickerCategory:$,onCategoryChange:T,subcategories:J,pickerSubcategory:F,onSubcategoryChange:Z,filteredAliases:ve,visibleAliases:ke,visibleCount:ge,onShowMore:()=>$e(D=>Math.min(D+30,ve.length)),listItemVisibilityStyles:Rm,onInsertAlias:ze})]})}const qy=o.memo(Rk),zm=e=>e==null?void 0:String(e).trim().replace(/[^A-Za-z0-9_-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||void 0;function zk({name:e,label:t,description:n,value:r,onChange:s,disabled:a=!1,min:i,max:c,step:u,isFloat:d=!1,inputId:g}){const v=u??(d?.01:1),y=g??zm(e),x=N=>{if(N===""||N===null||N===void 0)return"";const m=d?parseFloat(N):parseInt(N,10);return Number.isNaN(m)?"":m},S=N=>{const m=N.target.value,p=x(m);s==null||s(p)},j=N=>{if(N.key!=="ArrowUp"&&N.key!=="ArrowDown")return;N.preventDefault();const m=typeof r=="number"?r:x(String(r??""))||0,p=N.key==="ArrowUp"?v:-v;let h=m+p;if(typeof i=="number"&&(h=Math.max(i,h)),typeof c=="number"&&(h=Math.min(c,h)),d){const w=typeof v=="number"?(String(v).split(".")[1]||"").length:2;h=parseFloat(h.toFixed(Math.max(w,2)))}s==null||s(h)};return l.jsxs("div",{className:"w-full flex items-center gap-2",children:[l.jsx("input",{id:y,name:e,type:"number",inputMode:d?"decimal":"numeric",value:r??"",onChange:S,onKeyDown:j,disabled:a,min:i,max:c,step:v,"aria-label":t||e,"aria-describedby":n?`${y||zm(e)||e}-description`:void 0,className:"ui-control ui-input"}),typeof i=="number"||typeof c=="number"?l.jsxs("div",{className:"hidden sm:flex flex-col text-[10px] text-[#6A6FA8] text-right leading-tight",children:[typeof i=="number"&&l.jsxs("span",{children:["min ",i]}),typeof c=="number"&&l.jsxs("span",{children:["max ",c]})]}):null]})}const xa=o.memo(zk);function _k({name:e,label:t,description:n,value:r,onChange:s,disabled:a=!1}){const i=!!r,c=()=>{a||s==null||s(!i)},u=d=>{(d.key===" "||d.key==="Enter")&&(d.preventDefault(),c())};return l.jsxs("button",{id:e,type:"button",role:"switch","aria-checked":i,"aria-label":t||e,"aria-describedby":n?`${e}-description`:void 0,onClick:c,onKeyDown:u,disabled:a,className:`ui-switch ${i?"is-on":""}`,children:[l.jsx("span",{className:"ui-switch-track",children:l.jsx("span",{className:"ui-switch-knob"})}),l.jsx("span",{className:"ui-switch-state",children:i?"On":"Off"})]})}const Xy=o.memo(_k);function Ik(e,t){try{if(typeof window>"u"||!e)return null;const n=e.getItem(t);return n?JSON.parse(n):null}catch{return null}}function fc(e,t,n){try{if(typeof window>"u"||!e)return;e.setItem(t,JSON.stringify(n))}catch{}}function tr(){try{return typeof window>"u"?null:window.sessionStorage||null}catch{return null}}function Ol(){try{return typeof window>"u"?null:window.localStorage||null}catch{return null}}const Jy=750,Ar=new Map,dr=new Map,fr=new Map,jl=new Map,pr=new Map,mr=new Map;function Zy(e){var t;if(dr.has(e)&&(clearTimeout(dr.get(e)),dr.delete(e)),fr.has(e)){try{(t=window.cancelIdleCallback)==null||t.call(window,fr.get(e))}catch{}fr.delete(e)}Ar.has(e)&&(fc(tr(),e,Ar.get(e)),Ar.delete(e))}function $k(e){var r;if(dr.has(e)&&(clearTimeout(dr.get(e)),dr.delete(e)),fr.has(e)){try{(r=window.cancelIdleCallback)==null||r.call(window,fr.get(e))}catch{}fr.delete(e)}const t=()=>{Ar.has(e)&&(fc(tr(),e,Ar.get(e)),Ar.delete(e))},n=setTimeout(()=>{dr.delete(e);try{if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const s=window.requestIdleCallback(()=>{fr.delete(e),t()},{timeout:2500});fr.set(e,s);return}}catch{}t()},Jy);dr.set(e,n)}function Mk(){Array.from(dr.values()).forEach(e=>clearTimeout(e)),dr.clear(),Array.from(fr.values()).forEach(e=>{var t;try{(t=window.cancelIdleCallback)==null||t.call(window,e)}catch{}}),fr.clear(),Array.from(Ar.entries()).forEach(([e,t])=>{fc(tr(),e,t)}),Ar.clear(),Array.from(pr.values()).forEach(e=>clearTimeout(e)),pr.clear(),Array.from(mr.values()).forEach(e=>{var t;try{(t=window.cancelIdleCallback)==null||t.call(window,e)}catch{}}),mr.clear(),Array.from(jl.entries()).forEach(([e,t])=>{try{const n=tr();n&&n.setItem(e,t)}catch{}}),jl.clear()}if(typeof window<"u"&&!window.__cozygenFormStateFlush){const e=()=>Mk();window.addEventListener("beforeunload",e),window.addEventListener("pagehide",e),window.__cozygenFormStateFlush=!0}function Ok(e){var r;if(!e)return{};const t=`${e}_formData`,n=Ik(tr(),t);if(n&&typeof n=="object")return n;try{const s=Ol();(r=s==null?void 0:s.removeItem)==null||r.call(s,t)}catch{}return{}}function Io(e,t,n={}){var a;if(!e)return;const{immediate:r=!1}=n||{},s=`${e}_formData`;if(r){Zy(s),fc(tr(),s,t||{});try{const i=Ol();(a=i==null?void 0:i.removeItem)==null||a.call(i,s)}catch{}return}Ar.set(s,t||{}),$k(s)}function Fk(e){e&&Zy(`${e}_formData`)}function Dk(e,t,n=Jy){var a;if(jl.set(e,t),pr.has(e)&&(clearTimeout(pr.get(e)),pr.delete(e)),mr.has(e)){try{(a=window.cancelIdleCallback)==null||a.call(window,mr.get(e))}catch{}mr.delete(e)}const r=()=>{const i=jl.get(e);jl.delete(e);try{const c=tr();c&&c.setItem(e,i)}catch{}},s=setTimeout(()=>{pr.delete(e);try{if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const i=window.requestIdleCallback(()=>{mr.delete(e),r()},{timeout:2e3});mr.set(e,i);return}}catch{}r()},n);pr.set(e,s)}function Bk(e,t={}){var s,a;const{immediate:n=!1}=t||{},r="cozygen_last_param";if(n){if(pr.has(r)&&(clearTimeout(pr.get(r)),pr.delete(r)),mr.has(r)){try{(s=window.cancelIdleCallback)==null||s.call(window,mr.get(r))}catch{}mr.delete(r)}jl.delete(r);try{const i=tr();i&&i.setItem(r,e||"");const c=Ol();(a=c==null?void 0:c.removeItem)==null||a.call(c,r)}catch{}return}Dk(r,e||"")}function Uk(){var t,n;const e="cozygen_last_param";try{const r=tr(),s=((t=r==null?void 0:r.getItem)==null?void 0:t.call(r,e))||"";if(s)return s;const a=Ol();(n=a==null?void 0:a.removeItem)==null||n.call(a,e)}catch{}return""}function ev(e,t){const n=e?String(e):"global",r=t?String(t):"";return`cozygen_dropdown_folder:${n}:${r}`}function _m(e,t){var r,s;const n=ev(e,t);try{const a=tr(),i=((r=a==null?void 0:a.getItem)==null?void 0:r.call(a,n))||"";if(i)return i;const c=Ol();(s=c==null?void 0:c.removeItem)==null||s.call(c,n)}catch{}return""}function Vk(e,t,n){var s;const r=ev(e,t);try{const a=tr();a&&a.setItem(r,String(n||""));const i=Ol();(s=i==null?void 0:i.removeItem)==null||s.call(i,r)}catch{}}function Wk({workflowName:e,name:t,label:n,description:r,value:s,onChange:a,disabled:i=!1,options:c=[]}){const u=s??"",[d,g]=o.useState(()=>_m(e,t)||"All");o.useEffect(()=>{const w=_m(e,t);g(w||"All")},[e,t]);const v=o.useMemo(()=>(c||[]).map(w=>typeof w=="string"?{value:w,label:w}:{value:w.value??w.name??"",label:w.label??w.name??String(w.value??"")}),[c]),y=w=>{const E=typeof(w==null?void 0:w.value)=="string"||typeof(w==null?void 0:w.value)=="number"?String(w.value):"",b=typeof(w==null?void 0:w.label)=="string"||typeof(w==null?void 0:w.label)=="number"?String(w.label):"";return Rl(E)?E:Rl(b)?b:""},x=o.useMemo(()=>v.map(w=>{const E=y(w);if(!E)return{opt:w,path:"",base:"",folderPath:""};const{folderPath:b,base:L}=dc(E);return{opt:w,path:E,base:L,folderPath:b||"root"}}),[v]),S=o.useMemo(()=>{const w=new Set(["All"]);return x.forEach(({path:E,folderPath:b})=>{E&&w.add(b||"root")}),Array.from(w).sort((E,b)=>E.localeCompare(b))},[x]),j=S.length>2;o.useEffect(()=>{if(!j){d!=="All"&&g("All");return}S.includes(d)||g("All")},[S,d,j]),o.useEffect(()=>{Vk(e,t,d)},[e,t,d]);const N=o.useMemo(()=>{const w=new Map;return x.forEach(({base:E})=>{if(!E)return;const b=E.toLowerCase();w.set(b,(w.get(b)||0)+1)}),w},[x]),m=o.useMemo(()=>{const w=[],E=j&&d==="All";return x.forEach(({opt:b,path:L,base:z,folderPath:$})=>{if(!L){w.push(b);return}const T=$||"root";if(j&&d!=="All"&&T!==d)return;let F=z||cr(L)||b.label;if(E&&z){const Z=z.toLowerCase();if(N.get(Z)>1){const ae=T==="root"?"root":T.split("/").pop()||T;F=`${F} (${ae})`}}w.push({...b,label:F})}),w.sort((b,L)=>String(b.label||"").localeCompare(String(L.label||"")))},[x,N,d,j]),p=o.useMemo(()=>u===""||u===null||u===void 0?!0:m.some(w=>String(w.value)===String(u)),[m,u]),h=w=>{const E=w&&w.target?w.target.value:w;a==null||a(E)};return l.jsxs("div",{className:"w-full space-y-2",children:[j?l.jsx("div",{className:"relative w-full",children:l.jsx(mt,{value:d,onChange:g,disabled:i,"aria-label":`Choose folder for ${n||t}`,size:"sm",options:S.map(w=>({value:w,label:w}))})}):null,l.jsx("div",{className:"relative w-full",children:l.jsx(mt,{id:t,name:t,value:u,onChange:h,disabled:i,"aria-label":n||t,"aria-describedby":r?`${t}-description`:void 0,placeholder:m.length>0&&(u===void 0||u==="")?"Select...":void 0,emptyLabel:"No matches",options:[...!p&&u!==""?[{value:u,label:cr(String(u))}]:[],...m]},`${t||"field"}:${d}`)})]})}const vf=o.memo(Wk);function Im(e=[]){return e.map(t=>typeof t=="string"?{value:t,label:t}:{value:t.value??t.name??"",label:t.label??t.name??String(t.value??"")})}function $m(e,t){if(!e)return null;const n=String(e);if(t==="high"){const r=n.match(/(.+)-high(\.[^.]*)?$/i);return r?r[1]:null}if(t==="low"){const r=n.match(/(.+)-low(\.[^.]*)?$/i);return r?r[1]:null}return null}function Hk(e){return e?e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/^./,t=>t.toUpperCase()):""}const Kk=(...e)=>e.flat().map(n=>String(n??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")).filter(Boolean).join("-")||"field";function Gk({name:e,label:t,description:n,highParam:r,lowParam:s,highChoices:a=[],lowChoices:i=[],formData:c={},onChangeParam:u,highStrengthParam:d,lowStrengthParam:g,strengthValue:v,onChangeStrength:y,highStrengthValue:x,lowStrengthValue:S,onChangeHighStrength:j,onChangeLowStrength:N,disabled:m=!1}){const p=o.useMemo(()=>Im(a),[a]),h=o.useMemo(()=>Im(i),[i]),w=o.useMemo(()=>{const Q=new Map;h.forEach(J=>{const U=$m(J.value,"low");U&&(Q.has(U)||Q.set(U,J))});const he=[];return p.forEach(J=>{const U=$m(J.value,"high");if(!U)return;const H=Q.get(U);H&&he.push({base:U,label:Hk(U),highValue:J.value,lowValue:H.value})}),he.sort((J,U)=>J.label.localeCompare(U.label)),he},[p,h]),E=o.useMemo(()=>{const Q=c[r],he=c[s];if(!Q||!he)return"";const J=w.find(U=>U.highValue===Q&&U.lowValue===he);return J?J.base:""},[c,r,s,w]),b=d||g||`${e}_strength`,L=o.useMemo(()=>Kk(e||"lora",b||"strength"),[e,b]),z=!!(d||g),$=!!(d&&g),T=(Q,he=1)=>typeof Q=="number"?Q:he,F=T(typeof v=="number"?v:typeof x=="number"?x:typeof S=="number"?S:void 0,1),Z=T(typeof x=="number"?x:void 0,F),ae=T(typeof S=="number"?S:void 0,$?F:Z),Ce=$&&Math.abs(Z-ae)>1e-4,[ye,Y]=o.useState(Ce);o.useEffect(()=>{Y(Ce)},[Ce,r,s]);const Se=Q=>{if(!u)return;const he=w.find(J=>J.base===Q);he&&(u(r,he.highValue),u(s,he.lowValue))};if(w.length===0)return l.jsxs("div",{className:"text-[11px] text-[#9DA3FFCC]",children:["No matching ",l.jsx("span",{className:"font-semibold",children:"-high"})," /"," ",l.jsx("span",{className:"font-semibold",children:"-low"})," LoRA pairs found."]});const R=`${L}-linked`,A=`${L}-high`,O=`${L}-low`,_=$?"Linked":"Strength",B=$?"Applies to high + low":d||g||"",W=(Q,he)=>{const J=Array.isArray(Q)?Q:[Q];let U=!1;J.forEach(H=>{if(H==="high"&&typeof j=="function"){j(he);return}if(H==="low"&&typeof N=="function"){N(he);return}typeof y=="function"&&!U&&(y(he),U=!0)})},ue=Q=>{(d||!d&&!g)&&W("high",Q),g&&W("low",Q)},pe=()=>{$&&Y(Q=>{const he=!Q;return he||ue(typeof Z=="number"?Z:typeof ae=="number"?ae:F),he})};return l.jsxs("div",{className:"space-y-2",children:[l.jsx(vf,{name:`${e}_pair`,label:t,description:n,value:E||"",onChange:Se,disabled:m,options:w.map(Q=>({value:Q.base,label:Q.label}))}),z&&l.jsxs("div",{className:"space-y-1.5",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-[10px] uppercase tracking-[0.16em] text-[#9DA3FFCC]",children:"Strength"}),$&&l.jsx("button",{type:"button",className:"text-[10px] font-semibold tracking-[0.12em] uppercase text-[#E5E7FF]",onClick:pe,disabled:m,children:ye?"Link values":"Split values"})]}),ye&&$?l.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-3",children:[l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:A,className:"lora-strength-label is-high",children:[l.jsx("span",{className:"lora-strength-label-pill",children:"High"}),l.jsxs("span",{className:"lora-strength-label-text",children:["High strength",d&&l.jsx("span",{className:"lora-strength-label-hint",children:d})]})]}),l.jsx(xa,{name:`${b}_high`,label:"High strength",description:"",value:Z,onChange:Q=>W("high",Q),disabled:m,isFloat:!0,min:0,max:2,step:.05,inputId:A})]}),l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:O,className:"lora-strength-label is-low",children:[l.jsx("span",{className:"lora-strength-label-pill",children:"Low"}),l.jsxs("span",{className:"lora-strength-label-text",children:["Low strength",g&&l.jsx("span",{className:"lora-strength-label-hint",children:g})]})]}),l.jsx(xa,{name:`${b}_low`,label:"Low strength",description:"",value:ae,onChange:Q=>W("low",Q),disabled:m,isFloat:!0,min:0,max:2,step:.05,inputId:O})]})]}):l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:R,className:"lora-strength-label is-linked",children:[l.jsx("span",{className:"lora-strength-label-pill",children:_}),l.jsxs("span",{className:"lora-strength-label-text",children:["LoRA strength",B&&l.jsx("span",{className:"lora-strength-label-hint",children:B})]})]}),l.jsx(xa,{name:b,label:"LoRA strength",description:"",value:F,onChange:ue,disabled:m,isFloat:!0,min:0,max:2,step:.05,inputId:R})]})]})]})}function Yk(e,t){if(e.disabled!==t.disabled||e.name!==t.name||e.label!==t.label||e.description!==t.description||e.highParam!==t.highParam||e.lowParam!==t.lowParam||e.highStrengthParam!==t.highStrengthParam||e.lowStrengthParam!==t.lowStrengthParam||e.strengthValue!==t.strengthValue||e.highStrengthValue!==t.highStrengthValue||e.lowStrengthValue!==t.lowStrengthValue||e.highChoices!==t.highChoices||e.lowChoices!==t.lowChoices||e.onChangeParam!==t.onChangeParam||e.onChangeStrength!==t.onChangeStrength||e.onChangeHighStrength!==t.onChangeHighStrength||e.onChangeLowStrength!==t.onChangeLowStrength)return!1;const n=e.formData||{},r=t.formData||{};return!(n[e.highParam]!==r[t.highParam]||n[e.lowParam]!==r[t.lowParam])}const tv=o.memo(Gk,Yk),Qk=16,qk=[" - "," ","-","_"],nv=e=>[...new Set(e.filter(Boolean))],$o=(e,t)=>{const n=String(e||"").trim(),r=qk.map(s=>`${n}${s}${t}`);return r.push(`${n}${t}`),nv(r)},Mm=(e,t)=>{const n=$o(`${e} Strength`,t),r=$o(e,t).map(s=>`${s} Strength`);return nv([...n,...r])},Om=e=>String(e||"").toLowerCase().replace(/[\s_-]+/g,""),$i=(e,t=[])=>{if(!e)return null;const n=Array.isArray(t)?t:[t];for(const s of n){if(!s)continue;const a=e.get(s);if(a)return{name:s,input:a}}const r=new Map;n.forEach(s=>{s&&r.set(Om(s),s)});for(const[s,a]of e.entries()){const i=Om(s);if(r.has(i))return{name:s,input:a}}return null},Xk=Array.from({length:Qk},(e,t)=>{const n=t+1,r=$o("Lora High",n),s=$o("Lora Low",n),a=Mm("Lora High",n),i=Mm("Lora Low",n);return{id:`video_lora_${n}`,label:`Video LoRA ${n}`,highParam:r[0],lowParam:s[0],highParamAliases:r,lowParamAliases:s,highStrengthParam:a[0],lowStrengthParam:i[0],highStrengthParamAliases:a,lowStrengthParamAliases:i}}),Jk=e=>{var r,s;const t=((r=e==null?void 0:e.inputs)==null?void 0:r.param_type)||((s=e==null?void 0:e.inputs)==null?void 0:s.Param_type),n=String(t||"STRING").toUpperCase();return["NUMBER","FLOAT","INT"].includes(n)?"NUMBER":["BOOLEAN","BOOL"].includes(n)?"BOOLEAN":["DROPDOWN","CHOICE","SELECT"].includes(n)?"DROPDOWN":"STRING"},Zk=e=>{const t=(e==null?void 0:e.inputs)||{};return t.label||t.display_name||t.title||t.param_name||(e==null?void 0:e.title)||(e==null?void 0:e.class_type)||"Parameter"},ej=e=>{const t=(e==null?void 0:e.inputs)||{};return t.description||t.help||t.tooltip||t.doc||""},nl=e=>{const t=(e==null?void 0:e.inputs)||{};return t.param_name||t.name||t.key||t.id||`param_${(e==null?void 0:e.id)||"unknown"}`},oa=e=>{const t=(e==null?void 0:e.inputs)||{},n=t.choices||t.options||[],r=t.default_value??t.value??t.default_choice??(n&&n.length?n[0]:"")??"";return{paramName:nl(e),label:Zk(e),description:ej(e),paramType:Jk(e),multiline:!!t.multiline,min:typeof t.min=="number"?t.min:void 0,max:typeof t.max=="number"?t.max:void 0,step:typeof t.step=="number"?t.step:void 0,choices:n,defaultValue:r}},tj=(e,t)=>{if((e==null?void 0:e.paramType)==="BOOLEAN")return t?"On":"Off";if(t==null||t==="")return"Empty";if(typeof t=="string"){const n=t.trim();if(!n)return"Empty";const r=240,s=140,a=n.length>r?n.slice(0,r):n,c=/[\r\n\t]/.test(a)||/\s{2,}/u.test(a)?a.replace(/\s+/gu," ").trim():a;if(c.length>s)return`${c.slice(0,s)}`;const u=Sk(c);return n.length>r?`${u}`:u}return String(t)};function nj({id:e,label:t,description:n,preview:r,expanded:s=!1,onToggle:a,children:i,trailing:c,className:u=""}){const d=typeof a=="function",g=e?`${e}-description`:void 0,v=e?`${e}-panel`:void 0,y=typeof t=="string"?t.trim().replace(/\s+/gu," ").replace(/:\s*$/u,""):t,x=typeof n=="string"?n.trim().replace(/\s+/gu," "):n,S=typeof r=="string"||typeof r=="number"?String(r):void 0,j=d?"button":"div",N=d?{type:"button",onClick:a,"aria-expanded":s,"aria-controls":v,"aria-describedby":x?g:void 0}:{};return l.jsxs("div",{className:["field-row",u].filter(Boolean).join(" "),children:[l.jsxs(j,{...N,className:["field-row-head",d?"is-collapsible":"is-static",s?"is-expanded":""].filter(Boolean).join(" "),children:[l.jsxs("div",{className:"field-row-main",children:[l.jsx("div",{className:"field-row-label",children:y}),x?l.jsx("div",{id:g,className:"field-row-description",children:x}):null]}),l.jsxs("div",{className:"field-row-trailing",children:[c?l.jsx("div",{className:"field-row-trailing-control",children:c}):null,r?l.jsx("div",{className:"field-row-preview",title:S,children:r}):null,d?l.jsx("div",{className:"field-row-chevron","aria-hidden":"true",children:l.jsx(oc,{size:16})}):null]})]}),d&&s?l.jsx("div",{id:v,className:"field-row-body",children:i}):null]})}const ud=o.memo(nj);function rj({paramName:e,cfg:t,formData:n,loraPair:r,collapsed:s,onToggle:a,formatPreview:i,onChangeParam:c,changeHandlers:u}){const{id:d,label:g,highParam:v,lowParam:y,highStrengthParam:x,lowStrengthParam:S,highCfg:j,lowCfg:N}=r,m=x?n[x]:void 0,p=S?n[S]:void 0,h=m??p??1,w=s?i(t,[n[v],n[y]].filter(Boolean).join("  ")):null,E=e?`param-${e}`:void 0;return l.jsx("div",{id:E,"data-param-name":e,"data-param-label":g||t.label,"data-param-type":"lora_pair",className:"settings-row",children:l.jsx(ud,{id:e,label:g||t.label,description:t.description,preview:w,expanded:!s,onToggle:a,children:s?null:l.jsx(tv,{name:d||v,label:g||t.label,highParam:v,lowParam:y,highChoices:j.choices,lowChoices:N.choices,formData:n,onChangeParam:c,highStrengthParam:x,lowStrengthParam:S,strengthValue:h,highStrengthValue:m,lowStrengthValue:p,onChangeHighStrength:x?u.get(x):void 0,onChangeLowStrength:S?u.get(S):void 0,disabled:!1},`lora-${e}`)})})}function sj({paramName:e,cfg:t,formData:n,workflowName:r,spotlightName:s,spotlightRenderKey:a,aliasOptions:i,aliasCatalog:c,onOpenComposer:u,changeHandlers:d,enterHandlers:g,collapsed:v,previewValue:y,onToggle:x}){const S=n[e],j={name:e,label:t.label,description:t.description,value:S,disabled:!1,defaultValue:t.defaultValue},N=(p=n,h=!1)=>{const w={...j,value:p==null?void 0:p[e]};return t.paramType==="NUMBER"?l.jsx(xa,{...w,inputId:e,onChange:d.get(e),min:t.min,max:t.max,step:t.step,isFloat:!0},`field-${e}-number-${a}`):t.paramType==="BOOLEAN"?l.jsx(Xy,{...w,onChange:d.get(e)},`field-${e}-bool-${a}`):t.paramType==="DROPDOWN"?l.jsx(vf,{...w,workflowName:r,onChange:d.get(e),options:t.choices||[]},`field-${e}-dropdown-${a}`):l.jsx(qy,{...w,aliasOptions:i,aliasCatalog:c,onOpenComposer:u,onChange:d.get(e),onEnter:g.get(e),multiline:t.multiline||s===e||h},`field-${e}-string-${a}`)},m=e?`param-${e}`:void 0;return t.paramType==="BOOLEAN"?l.jsx("div",{id:m,"data-param-name":e,"data-param-label":t.label,"data-param-type":"single",className:"settings-row",children:l.jsx(ud,{id:e,label:t.label,description:t.description,trailing:N(n,!0)})}):l.jsx("div",{id:m,"data-param-name":e,"data-param-label":t.label,"data-param-type":"single",className:"settings-row",children:l.jsx(ud,{id:e,label:t.label,description:t.description,preview:y,expanded:!v,onToggle:x,children:v?null:N(n,!0)})})}function lj({inputs:e=[],formData:t={},onFormChange:n,workflowName:r,onParamEdited:s,onSpotlight:a,compactControls:i=!0,collapseAllKey:c=0,collapseAllCollapsed:u=!0,lastEditedParam:d="",spotlightName:g="",onCloseSpotlight:v=()=>{},onVisibleParamsChange:y=()=>{},aliasOptions:x=[],aliasCatalog:S=[],onOpenComposer:j}){const[N,m]=o.useState({}),[p,h]=o.useState(0),w=o.useRef(t);o.useEffect(()=>{w.current=t},[t]);const E=o.useCallback((A,O)=>tj(A,O),[]),b=o.useCallback((A,O)=>{!n||!A||(n(A,O),s==null||s(A),m(_=>(_==null?void 0:_[A])===!1?_:{..._,[A]:!1}))},[n,s]),L=o.useCallback(A=>{A&&m(O=>({...O,[A]:!(O!=null&&O[A])}))},[]),z=o.useMemo(()=>e||[],[e]),$=o.useMemo(()=>{const A=new Map;return(z||[]).forEach(O=>{const _=nl(O);_&&A.set(_,B=>b(_,B))}),A},[b,z]),T=o.useMemo(()=>{const A=new Map;return(z||[]).forEach(O=>{const _=nl(O);_&&A.set(_,(B,W)=>{var ue,pe;b(_,B),(pe=(ue=W==null?void 0:W.target)==null?void 0:ue.blur)==null||pe.call(ue),g===_&&(v==null||v())})}),A},[b,v,g,z]),F=o.useMemo(()=>{const A=new Map;return(z||[]).forEach(O=>{const _=nl(O);_&&A.set(_,()=>L(_))}),A},[L,z]);o.useEffect(()=>{const A={};(e||[]).forEach(O=>{const _=nl(O);_&&(A[_]=u)}),d&&(A[d]=!1),m(A)},[c,u,e,d]);const Z=o.useMemo(()=>{const A=new Map;return(e||[]).forEach(O=>{const _=nl(O);_&&A.set(_,O)}),A},[e]),ae=o.useMemo(()=>{const A=[];return Xk.forEach(O=>{const _=$i(Z,O.highParamAliases||O.highParam),B=$i(Z,O.lowParamAliases||O.lowParam);if(!_||!B)return;const W=_.input,ue=B.input,pe=oa(W),Q=oa(ue);if(pe.paramType!=="DROPDOWN"||Q.paramType!=="DROPDOWN")return;const he=pe.choices||[],J=Q.choices||[];if(!he.length||!J.length)return;const U=$i(Z,O.highStrengthParamAliases||O.highStrengthParam),H=$i(Z,O.lowStrengthParamAliases||O.lowStrengthParam);A.push({...O,highParam:_.name,lowParam:B.name,highStrengthParam:U==null?void 0:U.name,lowStrengthParam:H==null?void 0:H.name,highInput:W,lowInput:ue,highCfg:pe,lowCfg:Q})}),A},[Z]),Ce=o.useMemo(()=>{const A=new Map;return ae.forEach(O=>{A.set(O.highParam,O)}),A},[ae]),ye=o.useMemo(()=>{const A=new Set;return ae.forEach(O=>{A.add(O.highParam),A.add(O.lowParam),O.highStrengthParam&&A.add(O.highStrengthParam),O.lowStrengthParam&&A.add(O.lowStrengthParam)}),A},[ae]),Y=o.useMemo(()=>{const A=[];return(z||[]).forEach(O=>{const _=oa(O),B=_.paramName,W=Ce.get(B);if(W){A.push({name:B,label:W.label||_.label,description:_.description,render:ue=>{const pe=ue||w.current||{},Q=W.highStrengthParam?pe[W.highStrengthParam]:void 0,he=W.lowStrengthParam?pe[W.lowStrengthParam]:void 0,J=Q??he??1;return l.jsx(tv,{name:W.id||W.highParam,label:W.label||_.label,highParam:W.highParam,lowParam:W.lowParam,highChoices:W.highCfg.choices,lowChoices:W.lowCfg.choices,formData:pe,onChangeParam:b,highStrengthParam:W.highStrengthParam,lowStrengthParam:W.lowStrengthParam,strengthValue:J,highStrengthValue:Q,lowStrengthValue:he,onChangeHighStrength:W.highStrengthParam?$.get(W.highStrengthParam):void 0,onChangeLowStrength:W.lowStrengthParam?$.get(W.lowStrengthParam):void 0,disabled:!1},`lora-${B}-${p}`)}});return}ye.has(B)||A.push({name:B,label:_.label,description:_.description,render:ue=>{const pe=ue||w.current||{},Q={name:B,label:_.label,description:_.description,value:pe[B],defaultValue:_.defaultValue,disabled:!1};return _.paramType==="NUMBER"?l.jsx(xa,{...Q,onChange:$.get(B),min:_.min,max:_.max,step:_.step,isFloat:!0},`field-${B}-number-${p}`):_.paramType==="BOOLEAN"?l.jsx(Xy,{...Q,onChange:$.get(B)},`field-${B}-bool-${p}`):_.paramType==="DROPDOWN"?l.jsx(vf,{...Q,workflowName:r,onChange:$.get(B),options:_.choices||[]},`field-${B}-dropdown-${p}`):l.jsx(qy,{...Q,aliasOptions:x,aliasCatalog:S,onOpenComposer:j,onChange:$.get(B),onEnter:T.get(B),multiline:_.multiline},`field-${B}-string-${p}`)}})}),A},[z,Ce,ye,p,r,x,S,j,b,$,T,g,v]),Se=o.useMemo(()=>{const A=new Map;return Y.forEach(O=>A.set(O.name,O)),A},[Y]);o.useEffect(()=>{y==null||y(Y.map(A=>A.name))},[Y,y]);const R=o.useCallback(A=>{const O=Y.map(pe=>pe.name),_=Se.get(A);if(!_)return;const B=O.indexOf(A),W=B>0?O[B-1]:null,ue=B>=0&&B<O.length-1?O[B+1]:null;h(pe=>pe+1),a==null||a({name:A,label:_.label,description:_.description,render:pe=>_.render(pe||w.current),order:O,index:B>=0?B:0,total:O.length,onPrev:W?()=>R(W):null,onNext:ue?()=>R(ue):null})},[Se,a,Y]);return l.jsx("div",{className:"settings-list",children:z.map(A=>{const O=oa(A),_=O.paramName,B=Ce.get(_);if(B){const pe=i?N[_]??!0:!!N[_];return l.jsx(rj,{paramName:_,cfg:O,formData:t,loraPair:B,collapsed:pe,onToggle:F.get(_),formatPreview:E,onChangeParam:b,changeHandlers:$},`lora_pair_${B.id||B.highParam}`)}if(ye.has(_))return null;const W=i?N[_]??!0:!!N[_],ue=W?E(O,t[_]):null;return l.jsx(sj,{paramName:_,cfg:O,formData:t,workflowName:r,spotlightName:g,spotlightRenderKey:p,aliasOptions:x,aliasCatalog:S,onOpenComposer:j,changeHandlers:$,enterHandlers:T,collapsed:W,previewValue:ue,onToggle:F.get(_)},_)})})}function aj(e){return(e||[]).map(t=>{var n;if(["CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput","CozyGenChoiceInput"].includes(t.class_type)){let r=t.class_type.replace("CozyGen","").replace("Input","").toUpperCase();return r==="CHOICE"&&(r="DROPDOWN"),{...t,inputs:{...t.inputs,param_type:r,Multiline:((n=t.inputs)==null?void 0:n.display_multiline)||!1}}}return t})}function ij({workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,sectionRef:s,compactControls:a=!1,collapseAllState:i=null,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:g,aliasOptions:v=[],aliasCatalog:y=[],onOpenComposer:x}){const S=o.useMemo(()=>aj((t||[]).filter(j=>j.class_type!=="CozyGenImageInput")),[t]);return l.jsx("section",{className:"settings-surface scroll-mt-24",ref:s,children:l.jsx(lj,{workflowName:e,inputs:S,formData:n,onFormChange:r,compactControls:a,collapseAllKey:(i==null?void 0:i.key)??0,collapseAllCollapsed:(i==null?void 0:i.collapsed)??!0,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:g,aliasOptions:v,aliasCatalog:y,onOpenComposer:x})})}function oj({workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,parameterSectionRef:s,compactControls:a=!0,collapseAllState:i=null,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:g,aliasOptions:v=[],aliasCatalog:y=[],onOpenComposer:x}){return l.jsx(ij,{workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,sectionRef:s,compactControls:a,collapseAllState:i,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:g,aliasOptions:v,aliasCatalog:y,onOpenComposer:x})}function Fm(e){try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return""}}function cj({open:e,onClose:t,logs:n=[],onClear:r}){const s=o.useMemo(()=>(n||[]).map(a=>`[${Fm(a.ts)}] ${String(a.level||"info").toUpperCase()} ${a.message}`).join(`
`),[n]);return l.jsx(Ht,{open:e,onClose:t,title:"Run logs",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(X,{variant:"muted",className:"w-full",onClick:()=>{var a,i;try{(i=(a=navigator.clipboard)==null?void 0:a.writeText)==null||i.call(a,s||"")}catch{}},children:"Copy"}),l.jsx(X,{variant:"ghost",className:"w-full",onClick:r,children:"Clear"}),l.jsx(X,{variant:"primary",className:"w-full",onClick:t,children:"Close"})]}),children:l.jsx("pre",{className:"runlog-pre",children:n!=null&&n.length?n.map((a,i)=>l.jsxs("div",{className:`runlog-line is-${a.level||"info"}`,children:[l.jsx("span",{className:"runlog-ts",children:Fm(a.ts)}),l.jsx("span",{className:"runlog-msg",children:a.message})]},`${a.ts}-${i}`)):"No logs yet."})})}const uj="cozygen_field_order_v1";function dj(e,t){if(!e)return t;try{const n=JSON.parse(e);return n&&typeof n=="object"?n:t}catch{return t}}function fj(){if(typeof window>"u")return{};try{return dj(window.localStorage.getItem(uj),{})}catch{return{}}}function pj(e){if(Array.isArray(e))return{order:e.filter(Boolean),hidden:{}};if(!e||typeof e!="object")return{order:[],hidden:{}};const t=Array.isArray(e.order)?e.order.filter(Boolean):[],n=e.hidden&&typeof e.hidden=="object"?e.hidden:{};return{order:t,hidden:n}}function mj(e){if(!e)return{order:[],hidden:{}};const n=fj()[e];return pj(n)}function hj(e,t){let n=Array.isArray(t)?t:[];if(!e||n.length===0)return n;const{order:r,hidden:s}=mj(e);if(r&&r.length){const a=new Map;n.forEach(c=>{var d;const u=(d=c==null?void 0:c.inputs)==null?void 0:d.param_name;u&&!a.has(u)&&a.set(u,c)});const i=[];r.forEach(c=>{const u=a.get(c);u&&(i.push(u),a.delete(c))}),n.forEach(c=>{var d;const u=(d=c==null?void 0:c.inputs)==null?void 0:d.param_name;if(!u){i.push(c);return}a.has(u)&&(i.push(c),a.delete(u))}),n=i}return n=n.filter(a=>{var c;const i=(c=a==null?void 0:a.inputs)==null?void 0:c.param_name;return i?!s[i]:!0}),n}function gj(){const[e,t]=o.useState([]),[n,r]=o.useState(null),[s,a]=o.useState(!0),[i,c]=o.useState(null);o.useEffect(()=>{let d=!1;async function g(){a(!0),c(null);try{const v=await ES();if(d)return;const y=(v==null?void 0:v.workflows)||[];t(y);let x=null;try{if(x=typeof window<"u"?sessionStorage.getItem("selectedWorkflow"):null,typeof window<"u")try{localStorage.removeItem("selectedWorkflow")}catch{}}catch{x=null}if(x&&y.includes(x))r(x);else if(y.length>0){r(y[0]);try{typeof window<"u"&&sessionStorage.setItem("selectedWorkflow",y[0])}catch{}}else r(null)}catch(v){if(d)return;console.error("Failed to load workflows",v),c(v)}finally{d||a(!1)}}return g(),()=>{d=!0}},[]);const u=o.useCallback(d=>{r(d);try{if(typeof window<"u"&&sessionStorage.setItem("selectedWorkflow",d),typeof window<"u")try{localStorage.removeItem("selectedWorkflow")}catch{}}catch{}},[]);return{workflows:e,selectedWorkflow:n,selectWorkflow:u,loading:s,error:i}}const yj={clip_name1:"clip",clip_name2:"clip",unet_name:"unet",vae_name:"vae",sampler_name:"sampler",scheduler:"scheduler"},vj=["CozyGenDynamicInput","CozyGenImageInput","CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput","CozyGenChoiceInput"];function xj(e){const[t,n]=o.useState(null),[r,s]=o.useState([]),[a,i]=o.useState({}),[c,u]=o.useState(!1),[d,g]=o.useState(null);o.useEffect(()=>{if(!e){n(null),s([]),i({});return}let S=!1;const j=new AbortController;async function N(){u(!0),g(null);try{typeof performance<"u"&&performance.mark&&performance.mark("cozygen:workflow:load")}catch{}try{const m=await AS(e,{signal:j.signal});if(S)return;for(const b in m){const L=m[b];L.class_type==="CozyGenImageInput"&&!L.inputs.param_name&&(L.inputs.param_name="Image Input"),m[b].id=b}n(m);const p=Object.values(m).filter(b=>vj.includes(b.class_type)),h=await Promise.all(p.map(async b=>{const L=b.class_type==="CozyGenDynamicInput"&&b.inputs.param_type==="DROPDOWN",z=b.class_type==="CozyGenChoiceInput";if(L||z){const $=b.inputs.param_name;let T=b.inputs.choice_type||b.properties&&b.properties.choice_type;if(!T&&L&&(T=yj[$]),T)try{const F=await rd(T,{signal:j.signal,refresh:T==="loras"});b.inputs.choices=F.choices||[]}catch(F){(F==null?void 0:F.name)!=="AbortError"&&console.error(`Choices for ${$} failed`,F),b.inputs.choices=[]}}return b}));if(S)return;s(h);const w=Ok(e),E={};h.forEach(b=>{const L=b.inputs.param_name;if(!L)return;if(w[L]!==void 0){E[L]=w[L];return}let z;if(["CozyGenDynamicInput","CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput"].includes(b.class_type)){if(z=b.inputs.default_value,b.class_type==="CozyGenIntInput"){const $=parseInt(z,10);z=Number.isNaN($)?0:$}else if(b.class_type==="CozyGenFloatInput"){const $=parseFloat(z);z=Number.isNaN($)?0:$}}else if(b.class_type==="CozyGenChoiceInput"){const $=b.inputs.choices||[];z=$.length?$[0]:""}else b.class_type,z="";E[L]=z}),i(E);try{typeof performance<"u"&&performance.measure&&(performance.mark("cozygen:workflow:ready"),performance.measure(`cozygen:workflow:ready:${e||"unknown"}`,"cozygen:workflow:load","cozygen:workflow:ready"))}catch{}}catch(m){if(S)return;console.error("Failed to load workflow",m),g(m),n(null),s([])}finally{S||u(!1)}}return N(),()=>{Fk(e),S=!0,j.abort()}},[e]);const v=o.useMemo(()=>r.filter(S=>S.class_type==="CozyGenImageInput"),[r]),y=v[0]||null,x=o.useCallback((S,j)=>{i(N=>{const m={...N,[S]:j};return e&&Io(e,m),m})},[e]);return{workflowData:t,dynamicInputs:r,imageInputs:v,primaryImageInput:y,formData:a,setFormData:i,handleFormChange:x,loading:c,error:d}}function xf(){const[e,t]=o.useState(()=>typeof document>"u"?!0:document.visibilityState!=="hidden");return o.useEffect(()=>{if(typeof document>"u")return;const n=()=>{t(document.visibilityState!=="hidden")};return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)},[]),e}const Dm="::";function wa(e){const t={};return Object.entries(e||{}).forEach(([n,r])=>{const s=String(n||"").trim();if(!s||typeof r!="string")return;const a=r.trim();a&&(t[s]=a)}),t}function wf(e){const t=new Map;return Object.entries(wa(e)).forEach(([n,r])=>{const s=n.toLowerCase();t.set(s,r),s.includes(Dm)&&t.set(s.replace(Dm,":"),r)}),t}function ss(e,t){if(typeof e!="string"||!e.includes("$")&&!e.includes("::"))return e;const n=t instanceof Map?t:wf(t);if(!n.size)return e;const r=ss._fallbackCache||(ss._fallbackCache=new WeakMap),s=x=>{const S=r.get(x);if(S)return S;const j=new Map,N=new Set;return x.forEach((m,p)=>{const h=String(p||"").toLowerCase();if(!h)return;const w=h.includes(":")?h.split(":").pop():h;if(w&&!N.has(w)){if(j.has(w)){if(j.get(w)===m)return;j.set(w,null),N.add(w);return}j.set(w,m)}}),r.set(x,j),j},a=x=>{const S=String(x||"").trim();if(!S.startsWith("(")||!S.endsWith(")"))return null;const j=S.slice(1,-1),N=j.lastIndexOf(":");if(N===-1)return null;const m=j.slice(N+1).trim();return/^\d+(\.\d+)?$/u.test(m)&&j.slice(0,N).trim()||null},i=(x,S)=>{const j=String(x||"").split(",").map(N=>N.trim()).filter(Boolean);return j.length?j.map(N=>{const m=a(N)||N;return m?`(${m}:${S})`:""}).filter(Boolean).join(", "):x},c=/\(\s*\$([a-z0-9_:-]+)\$\s*:\s*(\d+(?:\.\d+)?)\s*\)/gi,u=new RegExp("(?<!\\$)\\b([a-z0-9_]+)::([a-z0-9_:-]+)\\b(?!\\$)","gi"),d=x=>{let S=x.replace(c,(j,N,m)=>{const p=String(N||"").toLowerCase();let h=n.get(p);return typeof h!="string"&&!p.includes(":")&&(h=s(n).get(p)),typeof h!="string"?j:i(h,String(m||"").trim())});return S=S.replace(/\$([a-z0-9_:-]+)\$/gi,(j,N)=>{const m=String(N||"").toLowerCase();let p=n.get(m);return typeof p!="string"&&!m.includes(":")&&(p=s(n).get(m)),typeof p=="string"?p:j}),S=S.replace(u,(j,N,m,p)=>{if(S[p+j.length]===":")return j;const w=`${N}::${m}`.toLowerCase();let E=n.get(w);return typeof E!="string"&&(E=n.get(w.replace("::",":"))),typeof E=="string"?E:String(m||"").trim()||j}),S},g=10;let v=e;const y=new Set([v]);for(let x=0;x<g;x+=1){const S=d(v);if(S===v||y.has(S)||(y.add(S),v=S,!v.includes("$")))break}return v}function wj(e,t){const n=t instanceof Map?t:wf(t);if(!n.size||!e||typeof e!="object")return e;let r=!1;const s={};return Object.entries(e).forEach(([a,i])=>{if(typeof i=="string"){const c=ss(i,n);s[a]=c,c!==i&&(r=!0)}else s[a]=i}),r?s:e}function Sf(e){return e?JSON.parse(JSON.stringify(e)):{}}function Sj(e,t,n){const r=Sf(e),s={...n||{}};if(!t||!Array.isArray(t))return{workflow:r,formData:s};for(const a of t){if(!a||!a.id||!a.inputs||!r[a.id])continue;const i=a.inputs.param_name;if(!i||a.class_type==="CozyGenImageInput")continue;let c=s[i];const u=r[a.id];if(!u||!u.inputs)continue;const d=a.class_type;c===void 0&&(d==="CozyGenChoiceInput"?c=a.inputs.value??a.inputs.default_choice??(a.inputs.choices&&a.inputs.choices[0])??"":c=a.inputs.default_value),c===void 0&&(c=""),s[i]=c,d==="CozyGenFloatInput"||d==="CozyGenIntInput"||d==="CozyGenStringInput"||d==="CozyGenDynamicInput"?u.inputs.default_value=c:d==="CozyGenChoiceInput"&&(u.inputs.value=c)}return{workflow:r,formData:s}}const kf=["seed","noise_seed"],rv=["ckpt_name","checkpoint","ckpt","model_name"],dd=["lora_name"],sv=["width","image_width"],lv=["height","image_height"],kj=/(prompt|positive|text)/i,jj=/(negative|neg)/i,Fl=e=>String(e||"").toLowerCase(),Ba=e=>(e==null?void 0:e.class_type)==="CozyGenDynamicInput"||(e==null?void 0:e.class_type)==="CozyGenChoiceInput",Ua=e=>{var t;return Fl((t=e==null?void 0:e.inputs)==null?void 0:t.choice_type)},Mo=(e,t)=>{e!=null&&e.inputs&&("default_value"in e.inputs&&(e.inputs.default_value=t),"value"in e.inputs&&(e.inputs.value=t))},av=e=>Fl(e==null?void 0:e.class_type).includes("checkpoint"),iv=e=>Fl(e==null?void 0:e.class_type).includes("lora"),ov=e=>Fl(e==null?void 0:e.class_type).includes("seed"),jf=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;const t=parseInt(String(e),10);return Number.isFinite(t)?t:null},xr=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;const t=parseInt(String(e),10);return Number.isFinite(t)?t:null},Mi=e=>e!=null&&e.inputs?"default_value"in e.inputs?xr(e.inputs.default_value):"value"in e.inputs?xr(e.inputs.value):null:null,Oo=e=>{var t;return Fl((t=e==null?void 0:e.inputs)==null?void 0:t.param_name)},Nj=e=>{var t;return String(((t=e==null?void 0:e.inputs)==null?void 0:t.param_name)||"").trim()},Oi=(e,t)=>{if(!(e!=null&&e.inputs))return!1;let n=!1;return"default_value"in e.inputs&&xr(e.inputs.default_value)!==null&&(e.inputs.default_value=t,n=!0),"value"in e.inputs&&xr(e.inputs.value)!==null&&(e.inputs.value=t,n=!0),n},Cj=e=>{const t=String(e||"").trim();return!t||jj.test(t)?!1:kj.test(t)},bj=e=>{if(!e)return[];const t=[];return typeof e.default_value=="string"&&t.push("default_value"),typeof e.value=="string"&&e.value!==e.default_value&&t.push("value"),t},Ej=e=>Fl(e==null?void 0:e.class_type).includes("textencode"),Bm=(e,t)=>{if(!(e!=null&&e.inputs))return!1;let n=!1;return kf.forEach(r=>{if(!(r in e.inputs))return;const s=e.inputs[r];Array.isArray(s)||jf(s)!==null&&(e.inputs[r]=t,n=!0)}),n},Aj=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(kf.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}jf(a)!==null&&(r.inputs[s]=t)}),ov(r)&&Bm(r,t))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Bm(s,t)})},Lj=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(Ba(r)&&Ua(r)==="checkpoints"&&Mo(r,t),av(r)&&rv.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}(typeof a=="string"||typeof a=="number")&&(r.inputs[s]=t)}))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Ba(s)&&Ua(s)==="checkpoints"&&Mo(s,t)})},Pj=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(Ba(r)&&Ua(r)==="loras"&&Mo(r,t),(iv(r)||dd.some(s=>s in r.inputs))&&dd.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}(typeof a=="string"||typeof a=="number")&&(r.inputs[s]=t)}))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Ba(s)&&Ua(s)==="loras"&&Mo(s,t)})},Tj=(e,t,n)=>{if(t===null&&n===null)return;const r=new Set,s=new Set;Object.values(e||{}).forEach(a=>{if(!(a!=null&&a.inputs))return;const i=a.inputs,c=Oo(a);t!==null&&c==="width"&&Oi(a,t),n!==null&&c==="height"&&Oi(a,n),t!==null&&sv.forEach(u=>{if(!(u in i))return;const d=i[u];if(Array.isArray(d)&&d.length){r.add(d[0]);return}xr(d)!==null&&(i[u]=t)}),n!==null&&lv.forEach(u=>{if(!(u in i))return;const d=i[u];if(Array.isArray(d)&&d.length){s.add(d[0]);return}xr(d)!==null&&(i[u]=n)})}),r.forEach(a=>{const i=e==null?void 0:e[a];i&&Oi(i,t)}),s.forEach(a=>{const i=e==null?void 0:e[a];i&&Oi(i,n)})};function cv(e){if(!e)return[];const t=Object.entries(e||{}).sort((r,s)=>{const a=Number(r[0]),i=Number(s[0]);return Number.isFinite(a)&&Number.isFinite(i)?a-i:String(r[0]).localeCompare(String(s[0]))}),n=[];return t.forEach(([r,s])=>{if(!(s!=null&&s.inputs))return;const a=s.inputs,i=String((s==null?void 0:s.class_type)||""),c=Nj(s),u=Oo(s);if(u&&Cj(u)){const d=bj(a);if(d.length){const g=a[d[0]];typeof g=="string"&&n.push({id:String(r),key:`${r}:${d[0]}`,label:c||`Prompt ${r}`,text:g,fields:d,classType:i})}return}Ej(s)&&typeof a.text=="string"&&n.push({id:String(r),key:`${r}:text`,label:`${i||"Text Encode"} ${r}`,text:a.text,fields:["text"],classType:i})}),n}function Rj(e,t=[],n={},r={}){if(!e||!t.length)return e;const{mutate:s=!1}=r||{},a=s?e:Sf(e);return t.forEach(i=>{var d;if(!(i!=null&&i.id)||!((d=i==null?void 0:i.fields)!=null&&d.length))return;const c=typeof(n==null?void 0:n[i.key])=="string"?n[i.key]:i.text;if(typeof c!="string")return;const u=a==null?void 0:a[i.id];u!=null&&u.inputs&&i.fields.forEach(g=>{typeof u.inputs[g]=="string"&&(u.inputs[g]=c)})}),a}function zj(e){const t={hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null},n=new Set,r=new Set;return Object.values(e||{}).forEach(s=>{const a=(s==null?void 0:s.inputs)||{};if(a){if(kf.forEach(i=>{i in a&&(t.hasSeed=!0)}),av(s)&&(t.hasCheckpoint=!0,rv.forEach(i=>{const c=a[i];typeof c=="string"&&c&&n.add(c)})),iv(s)||dd.some(i=>i in a)){t.hasLora=!0;const i=a.lora_name;typeof i=="string"&&i&&r.add(i)}if(Ba(s)){const i=Ua(s),c=a.default_value??a.value;i==="checkpoints"&&(t.hasCheckpoint=!0,typeof c=="string"&&c&&n.add(c)),i==="loras"&&(t.hasLora=!0,typeof c=="string"&&c&&r.add(c))}if(ov(s)&&"seed"in a&&(t.hasSeed=!0),t.width===null&&Oo(s)==="width"){const i=Mi(s);i!==null&&(t.width=i)}if(t.height===null&&Oo(s)==="height"){const i=Mi(s);i!==null&&(t.height=i)}t.width===null&&sv.forEach(i=>{if(!(i in a)||t.width!==null)return;const c=a[i];if(Array.isArray(c)&&c.length){const d=e==null?void 0:e[c[0]],g=Mi(d);g!==null&&(t.width=g);return}const u=xr(c);u!==null&&(t.width=u)}),t.height===null&&lv.forEach(i=>{if(!(i in a)||t.height!==null)return;const c=a[i];if(Array.isArray(c)&&c.length){const d=e==null?void 0:e[c[0]],g=Mi(d);g!==null&&(t.height=g);return}const u=xr(c);u!==null&&(t.height=u)})}}),t.checkpoint=n.values().next().value||"",t.loras=Array.from(r),t.hasSize=t.width!==null||t.height!==null,t}function Um(e,t={}){if(!e)return e;const n=Sf(e),{seedMode:r="keep",seedValue:s=null,checkpoint:a=null,lora:i=null,width:c=null,height:u=null}=t;if(r&&r!=="keep"){const v=r==="random"?Math.floor(Math.random()*4294967295):jf(s);v!==null&&Aj(n,v)}a&&Lj(n,a),i&&Pj(n,i);const d=xr(c),g=xr(u);return(d!==null||g!==null)&&Tj(n,d,g),n}const _j=/\$[a-z0-9_:-]+\$/i;function Ij({selectedWorkflow:e,workflowData:t,dynamicInputs:n,imageInputs:r,formData:s,setFormData:a,promptAliases:i=null}){const c=xf(),[u,d]=o.useState(!1),[g,v]=o.useState(!1),[y,x]=o.useState(0),[S,j]=o.useState(0),[N,m]=o.useState("Idle"),[p,h]=o.useState("idle"),[w,E]=o.useState([]),b=o.useRef({ts:0,value:0,max:0}),L=o.useRef(null),z=o.useRef({value:0,max:0}),$=o.useRef(null),T=o.useRef(null),F=o.useRef(t),Z=o.useRef(s),ae=o.useRef(!1),Ce=o.useRef(0),ye=o.useRef(0),Y=o.useRef("idle"),Se=o.useRef(null),R=o.useRef(null);o.useEffect(()=>{F.current=t},[t]),o.useEffect(()=>{ae.current=g},[g]),o.useEffect(()=>{Ce.current=y},[y]),o.useEffect(()=>{ye.current=S},[S]),o.useEffect(()=>{Y.current=p},[p]),o.useEffect(()=>{Z.current=s},[s]);const A=()=>{Se.current&&(clearTimeout(Se.current),Se.current=null)},O=()=>{R.current&&(clearTimeout(R.current),R.current=null)},_=()=>{T.current&&(clearTimeout(T.current),T.current=null)},B=()=>{L.current&&(cancelAnimationFrame(L.current),L.current=null)},W=o.useCallback((H,ve,ge=null)=>{const $e={ts:Date.now(),level:H||"info",message:String(ve||""),extra:ge||null};E(ke=>{const ze=[...ke||[],$e];return ze.length>250?ze.slice(ze.length-250):ze})},[]),ue=o.useCallback(()=>E([]),[]),pe=()=>{if(!(typeof window>"u"||typeof window.dispatchEvent!="function"))try{window.dispatchEvent(new CustomEvent("cozygen:queue-finished"))}catch{}},Q=()=>{O(),R.current=setTimeout(()=>{ae.current||(h("idle"),m("Idle"),x(0),j(0))},8e3)},he=o.useCallback(()=>{A(),d(!1),v(!1),x(0),j(0),m("Finished"),h("finished"),W("success","Finished"),Q(),pe()},[W]),J=o.useCallback((H="Error")=>{A(),d(!1),v(!1),m(H),h("error"),W("error",H||"Error"),Q()},[W]);o.useEffect(()=>{A(),!(!g||!S||S<=0||y<S)&&(Se.current=setTimeout(()=>{const H=ae.current,ve=Ce.current,ge=ye.current,$e=Y.current;H&&ge>0&&ve>=ge&&$e!=="finished"&&$e!=="error"&&he()},800))},[g,y,S,he]),o.useEffect(()=>{if(typeof window>"u"||!c&&!g)return;let H=!1,ve=1e3;const ge=()=>{if(H||!c&&!ae.current)return;const $e=window.location.protocol==="https:"?"wss":"ws",ke=window.location.host,ze=mf(),Me=`${$e}://${ke}/ws${ze?`?token=${encodeURIComponent(ze)}`:""}`,at=new WebSocket(Me);$.current=at,at.onopen=()=>{ve=1e3},at.onmessage=qe=>{var Qe,G,q;if(typeof qe.data!="string")return;let lt;try{lt=JSON.parse(qe.data)}catch{return}const Re=lt.type;if(Re==="cozygen_batch_ready"){he();return}if(Re==="execution_success"||Re==="execution_finished"){ae.current&&he();return}if(Re==="execution_error"||Re==="execution_interrupted"){W("error","Execution error"),J("Execution error");return}if(Re==="status"){const le=lt.data||{},te=le.status||le,de=te.exec_info||le.exec_info||te;if(de&&ae.current){const we=de.queue_remaining??de.queue_pending??de.queue_remaining_items??0;(de.queue_running??de.running??0)===0&&we===0&&he()}return}if(Re==="executing"){O(),h("running");const le=(Qe=lt.data)==null?void 0:Qe.node,te=F.current;if(le&&te&&te[le]){const de=te[le],we=de.title||de.class_type||"Node";W("info",`Executing: ${we}`,{nodeId:le}),m(`Executing: ${we}`)}else W("info","Executing"),m("Executing");return}if(Re==="progress"){const le=((G=lt.data)==null?void 0:G.value)??0,te=((q=lt.data)==null?void 0:q.max)??0;z.current={value:le,max:te},L.current||(L.current=window.requestAnimationFrame(()=>{L.current=null;const We=z.current;x(We.value),j(We.max)}));const de=Date.now(),we=b.current;de-we.ts>2500&&(le!==we.value||te!==we.max)&&te>0&&(b.current={ts:de,value:le,max:te},W("info",`Progress: ${le}/${te}`));return}},at.onclose=()=>{H||!c&&!ae.current||(_(),T.current=setTimeout(ge,ve),ve=Math.min(Math.ceil(ve*1.6),15e3))}};return ge(),()=>{H=!0,A(),O(),_(),B(),$.current&&($.current.onclose=null,$.current.close())}},[W,J,he,c,g]);const U=o.useCallback(async(H={})=>{if(!t)return;const{overrides:ve=null,persistFormState:ge=!0}=H||{};A(),O(),d(!0),v(!0),m("Queuing prompt"),h("queued"),x(0),j(0),W("info","Queuing prompt",{workflow:e||""});const $e=Z.current||{},ke=ve?{...$e,...ve||{}}:$e,ze=wj(ke,i||{}),{workflow:Me,formData:at}=Sj(t,n||[],ze||{}),qe={...at,...ke};ge&&e&&Io(e,qe),ge&&a(qe);const lt=r||[];for(const Re of lt){if(!Re||!Re.id||!Re.inputs)continue;const Qe=Re.inputs.param_name;if(!Qe)continue;const G=qe[Qe];if(!G){alert(`Please upload or select an image for "${Qe}" before generating.`),J("Missing image input");return}Me[Re.id]&&Me[Re.id].inputs&&(Me[Re.id].inputs.image_filename=G)}try{const Re=cv(Me),Qe={};Re.length&&Re.forEach(le=>{const te=ke==null?void 0:ke[le.label],de=typeof te=="string"?te:le.text;typeof de=="string"&&_j.test(de)&&(Qe[le.key]=de)});const G=To();if(Object.keys(Qe).length)try{await Lo({promptId:G,promptRaw:Qe})}catch{}let q=Me;if(i){const le=te=>{if(typeof te=="string")return ss(te,i);if(Array.isArray(te))return te.map(de=>le(de));if(te&&typeof te=="object"){const de=Array.isArray(te)?[]:{};return Object.entries(te).forEach(([we,ee])=>{de[we]=le(ee)}),de}return te};try{q=le(Me)}catch{q=Me}}ad({workflowName:e,workflow:q,timestamp:Date.now(),promptRaw:Object.keys(Qe).length?Qe:null}),await Ao({prompt:q,prompt_id:G}),W("info","Prompt queued")}catch(Re){console.error("Failed to queue prompt",Re),Re!=null&&Re.unauthorized?(W("error","Session expired. Please sign in again."),J("Session expired. Please sign in again."),window.location.hash="#/login"):(W("error","Error queuing prompt"),J("Error queuing prompt"))}},[t,n,r,i,e,a,J,W]);return{isLoading:u,progressValue:y,progressMax:S,statusText:N,statusPhase:p,handleGenerate:U,logEntries:w,clearLogs:ue}}const uv="cozygen_prompt_aliases",dv="cozygen_alias_categories",fv="cozygen_alias_category_list";function Vm(){if(typeof window>"u")return{};try{const e=window.localStorage.getItem(uv);return e?JSON.parse(e)||{}:{}}catch{return{}}}function Zc(e){if(!(typeof window>"u"))try{window.localStorage.setItem(uv,JSON.stringify(e||{}))}catch{}}function Wm(){if(typeof window>"u")return{};try{const e=window.localStorage.getItem(dv);return e?JSON.parse(e)||{}:{}}catch{return{}}}function eu(e){if(!(typeof window>"u"))try{window.localStorage.setItem(dv,JSON.stringify(e||{}))}catch{}}function Hm(){if(typeof window>"u")return[];try{const e=window.localStorage.getItem(fv);return Array.isArray(JSON.parse(e))?JSON.parse(e):[]}catch{return[]}}function tu(e){if(!(typeof window>"u"))try{window.localStorage.setItem(fv,JSON.stringify(e||[]))}catch{}}function pv(){const[e,t]=o.useState(()=>Vm()),[n,r]=o.useState(()=>Wm()),[s,a]=o.useState(()=>Hm()),[i,c]=o.useState(!1),[u,d]=o.useState(!1),[g,v]=o.useState(null),y=o.useCallback(async()=>{c(!0),v(null);try{const N=await RS(),m=wa((N==null?void 0:N.items)||N||{}),p=(N==null?void 0:N.categories)||{},h=Array.isArray(N==null?void 0:N.categoryList)?N.categoryList:[];t(m),r(p),a(h),Zc(m),eu(p),tu(h)}catch(N){console.error("Failed to load prompt aliases",N),v(N);const m=wa(Vm()),p=Wm(),h=Hm();t(m),r(p),a(h)}finally{c(!1)}},[]),x=o.useCallback(async N=>{const m=(N==null?void 0:N.items)||N||{},p=(N==null?void 0:N.categories)||n||{},h=Array.isArray(N==null?void 0:N.categoryList)&&N.categoryList.length?N.categoryList:s.length?s:Array.from(new Set(Object.values(p).filter(Boolean))),w=wa(m||{});d(!0),v(null);try{await zS({items:w,categories:p,categoryList:h}),t(w),r(p),a(h),Zc(w),eu(p),tu(h)}catch(E){throw console.error("Failed to save prompt aliases",E),v(E),Zc(w),eu(p),tu(h),E}finally{d(!1)}},[n,s]);o.useEffect(()=>{y()},[y]);const S=o.useMemo(()=>{const N=wf(e),m=new Map(N),p="::";return Object.entries(n||{}).forEach(([h,w])=>{const E=String(w||"").trim(),b=String(h||"").trim();if(!E||!b||!(e!=null&&e[h]))return;const L=b.split(p),z=L.length>1?L.slice(1).join(p):b;z&&m.set(`${E}:${z}`,e[h])}),m},[e,n]),j=o.useMemo(()=>{const N=new Set,m=[];return S.forEach((p,h)=>{let w=h.includes("::")?h.replace("::",":"):h;const E=w.split(":");E.length>=3&&E[0]&&E[1]&&E[0].toLowerCase()===E[1].toLowerCase()&&(w=[E[0],...E.slice(2)].join(":"));const b=w.toLowerCase();N.has(b)||(N.add(b),m.push(w))}),m},[S]);return{aliases:e,aliasCategories:n,categoryList:s,aliasLookup:S,aliasOptions:j,loading:i,saving:u,error:g,refreshAliases:y,persistAliases:x}}const mv=o.createContext(null);function Nf(){const e=o.useContext(mv);if(!e)throw new Error("useStudioContext must be used within a StudioProvider");return e}function $j({children:e}){const{workflows:t,selectedWorkflow:n,selectWorkflow:r,loading:s,error:a}=gj(),{workflowData:i,dynamicInputs:c,imageInputs:u,primaryImageInput:d,formData:g,setFormData:v,handleFormChange:y,loading:x,error:S}=xj(n),j=pv(),N=o.useMemo(()=>{const Z=[];return Object.entries(j.aliases||{}).forEach(([ae,Ce])=>{const ye=String(ae).split("::"),Y=ye.length>1,Se=j.aliasCategories&&j.aliasCategories[ae]||(Y?ye[0]:""),R=Y?ye.slice(1).join("::"):ae,A={key:ae,name:R,category:Se,text:Ce,token:Se?`${Se}:${R}`:R};Z.push({...A,...yf(A)})}),Z},[j.aliases,j.aliasCategories]),m=o.useMemo(()=>hj(n,c),[n,c]),p=o.useMemo(()=>{const Z=(m||c||[]).filter(R=>(R==null?void 0:R.class_type)!=="CozyGenImageInput"),ae=/\b(checkpoint|ckpt|lora|model|vae|embedding|clip|sampler|scheduler|seed)\b/i,Ce=R=>{const A=String((R==null?void 0:R.paramName)||"").toLowerCase(),O=String((R==null?void 0:R.label)||"").toLowerCase(),_=`${A} ${O}`,B=g==null?void 0:g[R==null?void 0:R.paramName],W=typeof B=="string"?B:"";let ue=0;return _.includes("prompt")&&(ue+=100),_.includes("negative")&&_.includes("prompt")&&(ue-=15),R!=null&&R.multiline&&(ue+=10),W.includes("$")&&(ue+=20),ae.test(_)&&(ue-=200),Vy(W)&&(ue-=200),ue};if(typeof(g==null?void 0:g.prompt)=="string")return"prompt";const ye=Z.map(R=>oa(R)).filter(R=>(R==null?void 0:R.paramType)==="STRING"&&(R==null?void 0:R.paramName));if(!ye.length)return"prompt";let Y=ye[0],Se=Ce(Y);for(let R=1;R<ye.length;R+=1){const A=ye[R],O=Ce(A);O>Se&&(Y=A,Se=O)}return(Y==null?void 0:Y.paramName)||"prompt"},[c,g,m]),{isLoading:h,progressValue:w,progressMax:E,statusText:b,statusPhase:L,handleGenerate:z,logEntries:$,clearLogs:T}=Ij({selectedWorkflow:n,workflowData:i,dynamicInputs:c,imageInputs:u,formData:g,setFormData:v,promptAliases:j.aliasLookup});o.useEffect(()=>{if(L==="finished"&&!(typeof window>"u")){try{window.localStorage.setItem("cozygen_gallery_pending","1")}catch{}window.dispatchEvent(new Event("cozygen:gallery-pending"))}},[L]),o.useEffect(()=>{if(typeof window>"u")return;const Z=L==="queued"||L==="running"||h;try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:Z}}))}catch{}},[L,h]);const F=o.useMemo(()=>({workflows:t,selectedWorkflow:n,selectWorkflow:r,workflowsLoading:s,workflowsError:a,workflowData:i,dynamicInputs:c,orderedDynamicInputs:m,imageInputs:u,primaryImageInput:d,formData:g,setFormData:v,handleFormChange:y,workflowLoading:x,workflowError:S,promptFieldName:p,aliasOptions:j.aliasOptions,aliasCatalog:N,aliasLookup:j.aliasLookup,aliasCategories:j.aliasCategories,aliasLoading:j.loading,aliasSaving:j.saving,aliasError:j.error,refreshAliases:j.refreshAliases,persistAliases:j.persistAliases,isLoading:h,progressValue:w,progressMax:E,statusText:b,statusPhase:L,handleGenerate:z,logEntries:$,clearLogs:T}),[t,n,r,s,a,i,c,m,u,d,g,v,y,x,S,p,j.aliasOptions,j.aliasLookup,j.aliasCategories,N,j.loading,j.saving,j.error,j.refreshAliases,j.persistAliases,h,w,E,b,L,z,$,T]);return l.jsx(mv.Provider,{value:F,children:e})}function Mj(){const e=$r(),{workflows:t=[],selectedWorkflow:n,selectWorkflow:r,workflowData:s,dynamicInputs:a=[],imageInputs:i=[],formData:c,setFormData:u,handleFormChange:d,aliasOptions:g,aliasCatalog:v,isLoading:y,progressValue:x,progressMax:S,statusText:j,statusPhase:N,handleGenerate:m,logEntries:p,clearLogs:h,promptFieldName:w,orderedDynamicInputs:E}=Nf(),b=o.useRef(null),L=o.useRef(null),[z,$]=o.useState(()=>Uk()),[T,F]=o.useState(null),Z=(T==null?void 0:T.name)||"",ae=o.useCallback(()=>F(null),[]),[Ce,ye]=o.useState(!1),[Y,Se]=o.useState([]),[R,A]=o.useState([]),[O,_]=o.useState(""),[B,W]=o.useState(""),[ue,pe]=o.useState(""),Q=o.useRef(new Map),he=o.useCallback((G="")=>{const le=`?field=${encodeURIComponent(G||w||"prompt")}`;e(`/compose${le}`)},[e,w]),J=o.useCallback(G=>{!G||G===n||(n&&Io(n,c||{},{immediate:!0}),_(""),W(""),pe(""),r(G))},[c,n,r]),U=o.useMemo(()=>{const q=[...E||[],...i||[]].map(le=>{var te;return(te=le==null?void 0:le.inputs)==null?void 0:te.param_name}).filter(le=>le&&typeof le=="string");return new Set(q)},[E,i]),H=o.useCallback(G=>{W(G);const q=R.find(de=>de.id===G);if(_((q==null?void 0:q.name)||""),!G||!(q!=null&&q.values)||!n){G||pe("");return}const le=U,te={};Object.entries(q.values).forEach(([de,we])=>{(!le.size||le.has(de))&&(te[de]=we)}),u(de=>{const we={...de,...te};return Io(n,we,{immediate:!0}),we}),pe(`Applied "${q.name}".`)},[U,R,n,u]),ve=i||[],ge=!!(s&&n),$e=ve.length>0,ke=o.useCallback((G,q)=>{const le=Q.current;q&&G&&le.set(G,q);const te=Y.length?Y:(q==null?void 0:q.order)||[],de=te.length,we=de>0?te.indexOf(G):-1,ee=we>0?te[we-1]:null,We=we>=0&&we<de-1?te[we+1]:null,et=ee?le.get(ee):null,Oe=We?le.get(We):null;return{...q,index:we>=0?we:0,total:de,onPrev:et?()=>F(ke(ee,et)):null,onNext:Oe?()=>F(ke(We,Oe)):null,onRender:m}},[Y,m]),ze=o.useCallback(G=>{const q=G||[];Se(le=>le.length===q.length&&le.every((te,de)=>te===q[de])?le:q)},[]),Me=o.useCallback(G=>{const q=G||"";$(q),Bk(q)},[]),at=o.useCallback(G=>{G!=null&&G.name&&F(ke(G.name,G))},[ke]),qe=o.useCallback(async G=>{if(!G){A([]),W("");return}try{const q=await _S(G),le=Array.isArray(q==null?void 0:q.presets)?q.presets:[];A(le),W(te=>te&&le.some(de=>de.id===te)?te:"")}catch(q){console.error("Failed to load workflow presets",q),A([]),pe("Presets unavailable.")}},[]);o.useEffect(()=>{qe(n)},[n,qe]);const lt=o.useCallback(async()=>{if(!n)return;const G=O.trim();if(!G){pe("Name a preset to save.");return}const q={},le=U;Object.entries(c||{}).forEach(([we,ee])=>{(!le.size||le.has(we))&&(q[we]=ee)});const te=R.find(we=>we.id===B),de=te&&te.name.toLowerCase()===G.toLowerCase()?te.id:void 0;try{const we=await IS(n,{id:de,name:G,values:q}),ee=Array.isArray(we==null?void 0:we.presets)?we.presets:[],We=we==null?void 0:we.preset;A(ee),We!=null&&We.id&&W(We.id),pe(`Saved "${G}".`)}catch(we){console.error("Failed to save preset",we),pe("Save failed.")}},[U,c,O,R,B,n]),Re=o.useCallback(async()=>{if(!(!n||!B))try{const G=await $S(n,B),q=Array.isArray(G==null?void 0:G.presets)?G.presets:[];A(q),W(""),pe("Preset deleted.")}catch(G){console.error("Failed to delete preset",G),pe("Delete failed.")}},[B,n]),Qe=o.useCallback(()=>{var G;return(G=T==null?void 0:T.render)==null?void 0:G.call(T,c)},[T,c]);return o.useEffect(()=>{const G=()=>{!ge||y||m()};return window.addEventListener("cozygen:request-render",G),()=>window.removeEventListener("cozygen:request-render",G)},[m,ge,y]),!t||t.length===0?l.jsx("div",{className:"page-shell",children:l.jsx("div",{className:"ui-card px-3 py-3 sm:px-4 sm:py-4",children:l.jsx("p",{className:"text-sm text-[#9DA3FFCC]",children:"No workflows found. Drop a workflow file in CozyGen and refresh."})})}):l.jsxs("div",{className:"page-shell page-stack has-dock controls-page",children:[l.jsxs("div",{className:"page-bar controls-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Controls"}),l.jsx("div",{className:"page-bar-actions",children:z?l.jsxs("span",{className:"controls-meta",children:["Last: ",z]}):null})]}),l.jsxs("section",{className:"controls-board",children:[l.jsx(Nk,{workflows:t,selectedWorkflow:n,onWorkflowChange:J,workflowData:s,presets:R,presetName:O,onPresetNameChange:_,selectedPresetId:B,onPresetSelect:H,onPresetSave:lt,onPresetDelete:Re,presetStatus:ue}),$e?l.jsx(_o,{ref:L,className:"controls-panel",title:l.jsxs(l.Fragment,{children:[l.jsx(KS,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Images"]}),bodyClassName:"control-shell controls-body",defaultOpen:!1,children:s?l.jsx("div",{className:"grid grid-cols-1 gap-3 lg:grid-cols-2",children:ve.map(G=>l.jsx(hk,{input:G,value:c[G.inputs.param_name]||"",onFormChange:d},G.id))}):null}):null,l.jsx(_o,{title:l.jsxs(l.Fragment,{children:[l.jsx(Iy,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Parameters"]}),bodyClassName:"control-shell controls-body",defaultOpen:!0,className:"controls-panel",children:s?l.jsx(oj,{workflowName:n,dynamicInputs:E,formData:c,onFormChange:d,parameterSectionRef:b,compactControls:!0,lastEditedParam:z,spotlightName:Z,onCloseSpotlight:ae,onVisibleParamsChange:ze,aliasOptions:g,aliasCatalog:v,onOpenComposer:he,onParamEdited:Me,onSpotlight:at}):l.jsxs("div",{className:"empty-state-inline",children:[l.jsx("span",{className:"empty-state-arrow",children:l.jsx(GS,{size:20})}),l.jsx("span",{children:"Select a workflow above to get started"})]})})]}),l.jsxs("div",{className:"controls-status-strip",children:[l.jsxs("div",{className:"controls-status-left",children:[l.jsx("span",{className:`controls-status-dot is-${N||"idle"}`,"aria-hidden":"true"}),l.jsxs("div",{className:"controls-status-text",children:[l.jsx("span",{className:"controls-status-phase",children:N||"idle"}),l.jsx("span",{className:"controls-status-msg",children:j||"Idle"})]})]}),l.jsxs("div",{className:"controls-status-right",children:[y&&S>0?l.jsx("div",{className:"controls-status-meter","aria-label":"Progress",children:l.jsx("div",{className:"controls-status-meter-fill",style:{width:`${Math.max(0,Math.min(100,Math.round((x||0)/S*100)))}%`}})}):null,l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>ye(!0),children:"Logs"})]})]}),l.jsx("section",{className:"dock-panel ui-card",children:l.jsx(sk,{busy:y,progressValue:x,progressMax:S,statusText:j,statusPhase:N,primaryLabel:"Render",onPrimary:m,primaryDisabled:!ge,onLogs:()=>ye(!0)})}),l.jsx(gk,{open:!!T,onClose:ae,title:T==null?void 0:T.label,description:T==null?void 0:T.description,render:Qe,index:(T==null?void 0:T.index)??0,total:(T==null?void 0:T.total)??0,onPrev:(T==null?void 0:T.onPrev)||null,onNext:(T==null?void 0:T.onNext)||null,onRender:(T==null?void 0:T.onRender)||null,children:null}),l.jsx(cj,{open:Ce,onClose:()=>ye(!1),logs:p,onClear:h})]})}function Oj(){return l.jsx("div",{className:"page-shell page-stack",children:l.jsxs("section",{className:"home-hero",children:[l.jsx("span",{className:"home-hero-orb is-warm","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-orb is-cool","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-spark","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-beam","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-ring","aria-hidden":"true"}),l.jsxs("div",{className:"home-hero-inner home-hero-full",children:[l.jsx("div",{className:"home-hero-kicker",children:"CozyGen Studio"}),l.jsx("h1",{className:"home-hero-title",children:"Creative studio for prompt-first storytelling"}),l.jsx("p",{className:"home-hero-description",children:"CozyGen is a quiet, cinematic workspace for people who sketch with wordsshape the mood, stage the scene, then send it down the render runway without losing your flow."}),l.jsxs("div",{className:"home-info-grid",children:[l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Control as composition"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Dial the palette, tempo, and texture in one place. The controls read like a creative brief, not a checklist."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Alias & tag storyboards"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Save characters, atmospheres, and motifs as building blocks, then arrange them like panels in a storyboard."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Gallery inspiration"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Pin your strongest frames, compare variations, and carry the aesthetic through to your next scene."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Render runway"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Stack iterations like takes on a set. Keep composing while the queue runs in the background."})]})]})]})]})})}const Fj=e=>l.jsxs("svg",{viewBox:"0 0 24 24",width:"14",height:"14","aria-hidden":"true",...e,children:[l.jsx("rect",{x:"3",y:"5",width:"10",height:"14",rx:"2.5",ry:"2.5",fill:"none",stroke:"currentColor",strokeWidth:"1.3"}),l.jsx("rect",{x:"7",y:"3",width:"10",height:"14",rx:"2.5",ry:"2.5",fill:"none",stroke:"currentColor",strokeWidth:"1.3",opacity:"0.8"}),l.jsx("circle",{cx:"12",cy:"11",r:"2.3",fill:"currentColor",opacity:"0.9"})]});function Dj({subfolder:e,crumbs:t=[],dirChips:n=[],onBack:r,onRoot:s,onCrumb:a,onSelectDir:i}){const c=!e;return l.jsxs("div",{className:"gallery-nav",children:[l.jsx("div",{className:"gallery-crumbs",role:"navigation","aria-label":"Gallery path",children:t.map((u,d)=>l.jsxs(o.Fragment,{children:[l.jsx("span",{className:"text-[#6A6FA8]",children:"/"}),l.jsx(X,{size:"xs",variant:"chip",onClick:()=>a==null?void 0:a(u.path),"aria-current":d===t.length-1?"page":void 0,children:u.name})]},u.path||u.name||d))}),l.jsxs("div",{className:"gallery-dir-chips",children:[l.jsxs(X,{size:"xs",variant:"chip",onClick:()=>s==null?void 0:s(),disabled:c,"aria-label":"Go to output root",title:"Output root",children:[l.jsx(Fj,{}),"Output"]}),n.map(u=>l.jsx(X,{size:"xs",variant:"chip",onClick:()=>i==null?void 0:i(u.subfolder),children:u.filename||u.subfolder||"Collection"},u.subfolder||u.filename))]})]})}const Bj=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e),Uj=({src:e,poster:t,autoPlay:n})=>{const r=o.useRef(null),s=xf();return o.useEffect(()=>{const a=r.current;a&&(a.pause(),a.currentTime=0,a.load())},[e]),o.useEffect(()=>{const a=r.current;if(!a)return;let i;const c=()=>{const d=a.play();d&&typeof d.catch=="function"&&d.catch(()=>{})},u=()=>{a.pause()};return n?s?typeof window<"u"&&"IntersectionObserver"in window?(i=new IntersectionObserver(g=>{g.forEach(v=>{v.isIntersecting?c():u()})},{threshold:.65}),i.observe(a)):c():u():(u(),a.currentTime=0),()=>{i&&i.disconnect(),u()}},[n,e,s]),e?l.jsx("video",{ref:r,src:e,poster:t||void 0,muted:!0,playsInline:!0,loop:!0,preload:n?"metadata":"none",className:"w-full h-auto max-h-[80vh] rounded-2xl object-contain bg-black/40"}):l.jsx("div",{className:"flex items-center justify-center py-16 text-[11px] text-[#9DA3FFCC]",children:"No preview available"})},Km={contentVisibility:"auto",containIntrinsicSize:"260px 320px"};function Vj({item:e,onSelect:t,onDelete:n,onRerun:r,onQuickRerun:s,isDeleting:a=!1,isQuickRunning:i=!1,variant:c="grid",autoPlay:u=!1}){if(!e)return null;const d=e.type==="directory",g=e.filename||"",v=e.subfolder||"",y=g||v||"Unknown",x=e.mtime??e.modified??e.updated_at??e.created_at,S=x?`&v=${encodeURIComponent(String(x))}`:"",j=()=>{t&&t(e)},N=c==="feed"?768:384,m=!d&&g?`/cozygen/thumb?type=output&subfolder=${encodeURIComponent(v)}&filename=${encodeURIComponent(g)}${S}&w=`:null,p=m?`${m}${N}`:null,h=m?c==="feed"?`${m}384 384w, ${m}768 768w`:`${m}192 192w, ${m}384 384w`:null,w=c==="feed"?"(max-width: 768px) 92vw, 768px":"(max-width: 640px) 45vw, (max-width: 1024px) 30vw, 240px",E=!d&&g?(()=>{const Y=e.type&&e.type!=="directory"?e.type:"output",Se=e.mtime?`&v=${encodeURIComponent(String(e.mtime))}`:"";return`/view?filename=${encodeURIComponent(g)}&subfolder=${encodeURIComponent(v)}&type=${encodeURIComponent(Y)}${Se}`})():null,b=Bj(g),L=!!n&&!d,z=(e==null?void 0:e.meta)||{},$=!!(z!=null&&z.has_prompt||z!=null&&z.prompt||z!=null&&z.model||Array.isArray(z==null?void 0:z.loras)&&z.loras.length),T=typeof g=="string"&&g.toLowerCase().endsWith(".png"),F=!!r&&!d&&$&&T,Z=!!s&&!d&&$&&T,ae=Y=>{Y.stopPropagation(),n==null||n(e)},Ce=Y=>{Y.stopPropagation(),r==null||r(e)},ye=Y=>{Y.stopPropagation(),s==null||s(e)};if(d)return l.jsx("button",{type:"button",onClick:j,className:"gallery-dir-tile",style:Km,children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"h-7 w-7 rounded-lg bg-gradient-to-br from-[#6B5BFF] to-[#FF4F9A] opacity-80 group-hover:opacity-100 flex items-center justify-center text-[11px] text-white",children:""}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("div",{className:"text-[11px] font-medium text-[#E5E7FF] truncate",children:y}),l.jsx("div",{className:"text-[10px] text-[#9DA3FFCC] truncate",children:"Collection"})]})]})});if(c==="feed"){const Y={contentVisibility:"auto",containIntrinsicSize:"520px 720px"};return l.jsxs("div",{className:"gallery-feed-item",style:Y,children:[l.jsxs("button",{type:"button",onClick:j,className:"gallery-feed-media",children:[l.jsx("div",{className:"relative w-full flex items-center justify-center bg-[#020312]",children:b?l.jsx(Uj,{src:E,poster:p,autoPlay:u}):p?l.jsx("img",{src:p,srcSet:h||void 0,sizes:w,alt:y,className:"w-full h-auto max-h-[80vh] rounded-2xl object-contain bg-black/40",loading:"lazy",decoding:"async"}):l.jsx("div",{className:"flex items-center justify-center py-16 text-[11px] text-[#9DA3FFCC]",children:"No preview available"})}),l.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[#05071680] opacity-0 group-hover:opacity-100 transition-opacity"}),b&&l.jsx("div",{className:"pointer-events-none absolute left-2 top-2 rounded-md bg-[#050716CC] px-2 py-[1px] text-[10px] text-[#CFFAFE] border border-[#3EF0FF80]",children:"Video"})]}),L?l.jsx(X,{size:"mini",variant:"muted",iconOnly:!0,className:"gallery-tile-delete",onClick:ae,disabled:a,"aria-label":"Delete item",title:a?"Deleting":"Delete item",children:l.jsx(sd,{size:12})}):null,Z?l.jsx(X,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-quickrun",onClick:ye,disabled:i,"aria-label":"Quick re-run",title:"Re-run with random seed",children:l.jsx(ld,{size:12})}):null,F?l.jsx(X,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-rerun",onClick:Ce,"aria-label":"Tweak",title:"Tweak",children:l.jsx(km,{size:12})}):null]})}return l.jsxs("div",{className:"gallery-tile",style:Km,children:[l.jsx("button",{type:"button",onClick:j,className:"gallery-tile-button",children:l.jsxs("div",{className:"gallery-tile-media",children:[p?l.jsx("img",{src:p,srcSet:h||void 0,sizes:w,alt:y,className:"gallery-tile-img",loading:"lazy",decoding:"async"}):l.jsx("div",{className:"gallery-tile-empty",children:"No preview"}),b&&l.jsx("div",{className:"gallery-badge",children:"Video"})]})}),L?l.jsx(X,{size:"mini",variant:"muted",iconOnly:!0,className:"gallery-tile-delete",onClick:ae,disabled:a,"aria-label":"Delete item",title:a?"Deleting":"Delete item",children:l.jsx(sd,{size:12})}):null,Z?l.jsx(X,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-quickrun",onClick:ye,disabled:i,"aria-label":"Quick re-run",title:"Re-run with random seed",children:l.jsx(ld,{size:12})}):null,F?l.jsx(X,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-rerun",onClick:Ce,"aria-label":"Tweak",title:"Tweak",children:l.jsx(km,{size:12})}):null]})}const Gm=o.memo(Vj),Ae={SUBJECT:"SUBJECT",POSE:"POSE",SCENE:"SCENE",STYLES:"STYLES",CAMERA:"CAMERA",PROMPTS:"PROMPTS"},Wj={[Ae.SUBJECT]:"Subject",[Ae.POSE]:"Pose",[Ae.SCENE]:"Scene",[Ae.STYLES]:"Styles",[Ae.CAMERA]:"Camera",[Ae.PROMPTS]:"Prompts"},fd={character:Ae.SUBJECT,media_char:Ae.SUBJECT,body:Ae.SUBJECT,expression:Ae.SUBJECT,outfit:Ae.SUBJECT,accessory:Ae.SUBJECT,dynamic:Ae.POSE,interaction:Ae.POSE,media_pose:Ae.POSE,posture:Ae.POSE,nsfw:Ae.POSE,indoor:Ae.SCENE,outdoor:Ae.SCENE,urban:Ae.SCENE,everyday:Ae.SCENE,media:Ae.SCENE,art:Ae.SCENE,history:Ae.SCENE,speculative:Ae.SCENE,weather:Ae.SCENE,artistic:Ae.STYLES,film:Ae.STYLES,game:Ae.STYLES,photo:Ae.STYLES,vintage:Ae.STYLES,angles:Ae.CAMERA,distance:Ae.CAMERA,lens:Ae.CAMERA,technique:Ae.CAMERA,device:Ae.CAMERA,lighting:Ae.CAMERA,render:Ae.CAMERA,filter:Ae.CAMERA,prompts:Ae.PROMPTS,prompts_action:Ae.PROMPTS,prompts_adventure:Ae.PROMPTS,prompts_cinematic:Ae.PROMPTS,prompts_fantasy:Ae.PROMPTS,prompts_historical:Ae.PROMPTS,prompts_horror:Ae.PROMPTS,prompts_mystery:Ae.PROMPTS,prompts_nsfw:Ae.PROMPTS,prompts_romance:Ae.PROMPTS,prompts_scifi:Ae.PROMPTS,prompts_slice:Ae.PROMPTS};function Cf(e){const t=String(e||"").trim().toLowerCase();return fd[t]||null}function Hj(e){return!e||e==="All"?Object.keys(fd):Object.entries(fd).filter(([t,n])=>n===e).map(([t])=>t)}function bf(e,t){if(!t||t==="All")return e;const n=Hj(t);return e.filter(r=>r==="All"?!0:n.includes(r))}function Ef({activeTopic:e,onTopicChange:t,showAll:n=!0}){const r=n?["All",Ae.SUBJECT,Ae.POSE,Ae.SCENE,Ae.STYLES,Ae.CAMERA,Ae.PROMPTS]:[Ae.SUBJECT,Ae.POSE,Ae.SCENE,Ae.STYLES,Ae.CAMERA,Ae.PROMPTS];return l.jsx("div",{className:"topic-tabs",children:r.map(s=>{const a=e===s,i=s==="All"?"All":Wj[s];return l.jsx("button",{type:"button",className:`topic-tab ${a?"active":""}`,onClick:()=>t(s),"aria-pressed":a,children:i},s)})})}const nu=30,Kj=20;function Ym(e,t,n){const r=Number(e);return Number.isFinite(r)?Math.max(t,Math.min(n,r)):t}function pd({open:e,onClose:t,mode:n="edit",tokenType:r="alias",tokenLabel:s="",tokenDisplay:a="",weight:i=1,onWeightChange:c,deferWeightApply:u=!1,onDelete:d,onAdd:g,aliases:v=[],aliasCategories:y=[],aliasLoading:x=!1,tags:S=[],tagLoading:j=!1,tagHasMore:N=!1,onLoadTags:m,onLoadMoreTags:p,replacementSearch:h="",onReplacementSearchChange:w,onReplace:E,activeCategory:b="All",onCategoryChange:L,initialCategory:z="All",initialSubcategory:$="All"}){const T=n==="add",F=o.useMemo(()=>Ym(i||1,.2,2),[i]),[Z,ae]=o.useState(F),[Ce,ye]=o.useState(!1),[Y,Se]=o.useState(r),[R,A]=o.useState(nu),[O,_]=o.useState("All"),[B,W]=o.useState("All"),ue=o.useRef(!1),pe=o.useRef(null);o.useEffect(()=>{e&&(ae(F),ye(T),Se(r),A(nu),ue.current=!1,_("All"),W($||"All"))},[e,F,r,T]),o.useEffect(()=>{A(nu)},[h,b,Y,O]),o.useEffect(()=>{Y==="alias"&&(L==null||L("All"),W("All"))},[O,Y,L]),o.useEffect(()=>{if(e){if(!ue.current&&$&&Y==="alias"){W($),ue.current=!0;return}W("All")}},[Y,b,$,e]),o.useEffect(()=>{e&&Y==="alias"&&(!z||z==="All"||b!==z&&(L==null||L(z)))},[e,Y,z,b,L]);const Q=q=>{if(!q)return"other";const le=hl(q.name||q.token||"",q.category||"");return String(q.subcategory||le||"").trim()||"other"},he=q=>q&&String(q.category||"").trim()||"other",J=o.useMemo(()=>{if(Y!=="alias")return[{value:"All",label:"All subcategories"}];const q=new Set(["All"]);return v.forEach(te=>{b!=="All"&&(te!=null&&te.category)&&te.category!==b||q.add(Q(te))}),Array.from(q).sort((te,de)=>te.localeCompare(de)).map(te=>({value:te,label:te==="other"?"Other":bn(te)||te}))},[v,b,Y]),U=o.useMemo(()=>{if(Y!=="tag")return[{value:"All",label:"All categories"}];const q=new Set(["All"]);return S.forEach(te=>{q.add(he(te))}),Array.from(q).sort((te,de)=>te.localeCompare(de)).map(te=>({value:te,label:te==="other"?"Other":bn(te)||te}))},[S,Y]),H=Y==="alias"?J:U;o.useEffect(()=>{H.some(q=>q.value===B)||W("All")},[H,B]),o.useEffect(()=>{e&&(Ce||T)&&Y==="tag"&&(m==null||m())},[e,Ce,Y,m,T]);const ve=o.useCallback(q=>{const le=q.target;!le||!(le.scrollHeight-le.scrollTop-le.clientHeight<100)||(A(de=>de+Kj),Y==="tag"&&N&&!j&&(p==null||p()))},[Y,N,j,p]),ge=o.useCallback(q=>{const le=Ym(q,.2,2);ae(le),u||c==null||c(le)},[u,c]),$e=o.useCallback(q=>{ge(parseFloat(q.target.value))},[ge]),ke=o.useMemo(()=>{const q=String(h||"").trim().toLowerCase();return Y==="alias"?v.filter(le=>{if(O!=="All"&&Cf(le.category)!==O||b!=="All"&&(le.category||"")!==b||B!=="All"&&Q(le)!==B)return!1;if(!q)return!0;const te=String(le.displayName||le.name||"").toLowerCase(),de=String(le.token||"").toLowerCase();return te.includes(q)||de.includes(q)}):S.filter(le=>B!=="All"&&he(le)!==B?!1:q?String(le.tag||"").toLowerCase().includes(q):!0)},[Y,h,b,v,S,B,O]),ze=o.useMemo(()=>{if(!ke.length)return ke;const q=[...ke];return q.sort((le,te)=>{const de=Oe=>String(Oe.displayName||Oe.name||Oe.tag||Oe.token||"").trim().toLowerCase();if(Y==="alias"){const Oe=Q(le),xt=Q(te);if(Oe!==xt)return Oe.localeCompare(xt);const D=de(le),re=de(te);return D!==re?D.localeCompare(re):0}const we=he(le),ee=he(te);if(we!==ee)return we.localeCompare(ee);const We=de(le),et=de(te);return We.localeCompare(et)}),q},[ke,Y]),Me=Y==="alias"?x:j,at=ze.length===0&&!Me,qe=o.useMemo(()=>Y!=="alias"?y:bf(y,O),[y,O,Y]),lt=rn(Z),Re=r==="alias",Qe=T?"Add to Prompt":Re?"Edit Alias":"Edit Tag",G=q=>{if(Se(q),w==null||w(""),q==="tag"){L==null||L("All"),m==null||m();return}ue.current=!1,L==null||L(z||"All"),W($||"All")};return l.jsx(Ht,{open:e,onClose:t,title:Qe,children:l.jsxs("div",{className:`token-edit-sheet ${Ce||T?"is-replace-open":""}`.trim(),children:[!T&&l.jsxs("div",{className:"token-edit-identity",children:[l.jsx("span",{className:"token-edit-type-badge","data-type":r,children:Re?"$":"#"}),l.jsxs("div",{className:"token-edit-name",children:[l.jsx("span",{className:"token-edit-display",children:a||s}),Re&&s&&s!==a&&l.jsxs("span",{className:"token-edit-token",children:["$",s,"$"]})]})]}),!T&&!Ce&&l.jsxs("div",{className:"token-edit-section",children:[l.jsxs("div",{className:"token-edit-strength-row",children:[l.jsx("span",{className:"token-edit-section-label",children:"Strength"}),l.jsxs("div",{className:"token-edit-strength-controls",children:[l.jsx("button",{type:"button",className:"token-edit-strength-btn",onClick:()=>ge(Z-.05),disabled:Z<=.2,"aria-label":"Decrease strength",children:""}),l.jsxs("span",{className:"token-edit-strength-value",children:[lt,""]}),l.jsx("button",{type:"button",className:"token-edit-strength-btn",onClick:()=>ge(Z+.05),disabled:Z>=2,"aria-label":"Increase strength",children:"+"})]})]}),l.jsx("input",{type:"range",min:.2,max:2,step:.05,value:Z,onChange:$e,className:"ui-range token-edit-slider","aria-label":"Token strength"}),l.jsxs("div",{className:"token-edit-strength-hint",children:[Z<.8?"Softened":Z>1.2?"Emphasized":"Normal"," influence"]})]}),l.jsxs("div",{className:"token-edit-section",children:[!T&&l.jsxs("button",{type:"button",className:`token-edit-replace-toggle ${Ce?"is-active":""}`,onClick:()=>ye(!Ce),children:[l.jsx("span",{className:"token-edit-section-label",children:"Replace with"}),l.jsx("span",{className:"token-edit-toggle-icon",children:Ce?"":"+"})]}),(Ce||T)&&l.jsxs("div",{className:"token-edit-replace-panel",children:[l.jsxs("div",{className:"token-edit-replace-header",children:[l.jsxs("div",{className:"token-edit-type-toggle",children:[l.jsxs("button",{type:"button",className:`token-edit-type-btn ${Y==="alias"?"is-active":""}`,onClick:()=>G("alias"),children:[l.jsx("span",{className:"token-edit-type-icon",children:"$"}),"Aliases"]}),l.jsxs("button",{type:"button",className:`token-edit-type-btn ${Y==="tag"?"is-active":""}`,onClick:()=>G("tag"),children:[l.jsx("span",{className:"token-edit-type-icon",children:"#"}),"Tags"]})]}),Y==="alias"&&l.jsx(Ef,{activeTopic:O,onTopicChange:_}),l.jsx("div",{className:"token-edit-filter-row",children:l.jsx("input",{type:"search",value:h,onChange:q=>w==null?void 0:w(q.target.value),placeholder:Y==="alias"?"Search aliases":"Search tags",className:"ui-control ui-input token-edit-search"})}),l.jsxs("div",{className:"token-edit-filter-row",children:[Y==="alias"&&qe.length>1&&l.jsx("select",{value:b,onChange:q=>L==null?void 0:L(q.target.value),className:"ui-control ui-select token-edit-category-select","aria-label":"Filter by category",children:qe.map(q=>l.jsx("option",{value:q,children:q==="All"?"All Categories":nn(q)},q))}),H.length>1&&l.jsx(mt,{value:B,onChange:W,size:"sm","aria-label":Y==="alias"?"Filter by subcategory":"Filter by category",options:H,wrapperClassName:"token-edit-sort-select"})]})]}),l.jsx("div",{ref:pe,className:"token-edit-replace-list",onScroll:ve,children:Me&&ze.length===0?l.jsx("div",{className:"token-edit-replace-empty",children:"Loading"}):at?l.jsx("div",{className:"token-edit-replace-empty",children:h?"No matches found":`No ${Y==="alias"?"aliases":"tags"} available`}):l.jsxs(l.Fragment,{children:[ze.slice(0,R).map(q=>{const le=q.key||q.token||q.tag||q.displayName,te=q.displayName||q.name||q.tag||q.token,de=!!q.token;return l.jsxs("button",{type:"button",className:"token-edit-replace-item",onClick:()=>{const we={...q,type:de?"alias":"tag"};T?g==null||g(we):E==null||E(we),t==null||t()},children:[l.jsx("span",{className:"token-edit-replace-type-icon","data-type":de?"alias":"tag",children:de?"$":"#"}),l.jsx("span",{className:"token-edit-replace-name",children:te})]},le)}),R<ze.length&&l.jsxs("div",{className:"token-edit-replace-more",children:[ze.length-R," more available"]}),Y==="tag"&&N&&R>=ze.length&&l.jsx("div",{className:"token-edit-replace-more",children:j?"Loading more":"Scroll for more"})]})})]})]}),l.jsxs("div",{className:"token-edit-actions",children:[l.jsx("button",{type:"button",className:"token-edit-apply",onClick:()=>{!T&&u&&(c==null||c(Z)),t==null||t()},children:T?"Done":"Apply"}),!T&&l.jsx("button",{type:"button",className:"token-edit-delete",onClick:()=>{d==null||d(),t==null||t()},children:"Remove from prompt"})]})]})})}const hv=o.memo(function({id:t,name:n,category:r,text:s,isSelected:a,onOpen:i,visibilityStyle:c}){const u=o.useCallback(()=>{i(t)},[t,i]),d=gl({name:n})||n||"Untitled",g=r?`${r}:${n}`:n,v=`${(s||"").slice(0,140)}${(s||"").length>140?"":""}`;return l.jsxs("button",{type:"button",role:"listitem",className:`composer-alias-item ${a?"is-selected":""}`,onClick:u,style:c,"data-virtual-row":"true",children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:d}),r?l.jsx("span",{className:"composer-alias-category",children:nn(r)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",g||"alias","$"]}),l.jsx("div",{className:"composer-alias-text",children:v||""})]})}),gv=o.memo(function({tag:t,category:n,count:r,isCollected:s,onToggle:a,visibilityStyle:i}){const c=o.useCallback(u=>{u.stopPropagation(),a(t)},[a,t]);return l.jsxs("button",{type:"button",className:`composer-alias-item composer-tag-item ${s?"is-collected":""}`,onClick:c,style:i,"data-virtual-row":"true",children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name composer-tag-name",children:l.jsx("code",{className:"composer-tag-code",children:t})}),n?l.jsx("span",{className:"composer-alias-category",children:bn(n)}):null]}),l.jsx("div",{className:"composer-alias-token composer-tag-count",children:Number(r||0).toLocaleString()})]})});function Gj({filename:e,locationLabel:t,isClip:n,url:r,canRerun:s,rerunOpen:a,canQuickRerun:i,quickRerunBusy:c,canDelete:u,deleteBusy:d,metaRows:g,metaOpen:v,onToggleMeta:y,onToggleRerun:x,onQuickRerun:S,onDelete:j,onClose:N,closeButtonRef:m}){return l.jsxs("header",{className:"media-viewer-head",children:[l.jsxs("div",{className:"media-viewer-head-bar bottom-sheet-head",children:[l.jsxs("div",{className:"media-viewer-meta",children:[l.jsx("div",{className:"media-viewer-title",title:e,children:e}),l.jsxs("div",{className:"media-viewer-sub",children:[l.jsx("span",{className:"media-chip",children:t}),l.jsx("span",{className:`media-chip ${n?"is-clip":"is-still"}`,children:n?"Video":"Image"})]})]}),l.jsx("button",{ref:m,type:"button",className:"bottom-sheet-close media-viewer-close",onClick:N,"aria-label":"Close",children:l.jsx(gs,{size:16})})]}),l.jsxs("div",{className:"media-viewer-actions",children:[l.jsx(X,{as:"a",href:r,target:"_blank",rel:"noreferrer",variant:"ghost",size:"sm",children:"Open"}),g.length?l.jsx(X,{variant:"ghost",size:"sm",onClick:y,"aria-expanded":v,children:"Meta"}):null,s?l.jsx(X,{variant:"ghost",size:"sm",onClick:x,"aria-expanded":a,"aria-label":"Tweak generation",children:"Tweak"}):null,i?l.jsx(X,{variant:"ghost",size:"sm",iconOnly:!0,className:"media-viewer-action-icon media-viewer-action-quickrun",onClick:S,disabled:c,"aria-label":"Re-run with random seed",title:"Re-run with random seed",children:c?l.jsx("span",{className:"loading-spinner","aria-hidden":"true"}):l.jsx(ld,{size:16})}):null,u?l.jsx(X,{variant:"ghost",size:"sm",iconOnly:!0,className:"media-viewer-action-icon media-viewer-action-delete",onClick:j,disabled:d,"aria-label":"Delete item",title:"Delete item",children:d?l.jsx("span",{className:"loading-spinner","aria-hidden":"true"}):l.jsx(sd,{size:16})}):null]})]})}function Yj({metaRows:e=[]}){return e.length?l.jsx("div",{className:"media-viewer-info","aria-label":"Generation metadata",children:e.map(t=>l.jsxs("div",{className:"media-info-row",children:[l.jsx("span",{className:"media-info-label",children:t.label}),l.jsx("span",{className:`media-info-value ${t.isPrompt?"is-prompt":""}`,children:t.value})]},t.label))}):null}function Qj({showNav:e,canPrev:t,canNext:n,onPrev:r,onNext:s,isClip:a,url:i,filename:c}){return l.jsxs("div",{className:"media-viewer-stage",children:[e?l.jsx("button",{type:"button",className:`media-stage-nav is-left ${t?"":"is-disabled"}`,onClick:r,"aria-label":"Previous",disabled:!t,children:l.jsx($y,{size:18})}):null,l.jsx("div",{className:"media-viewer-frame",children:a?l.jsx("video",{src:i,controls:!0,className:"media-viewer-media",autoPlay:!0,muted:!0,playsInline:!0}):l.jsx("img",{src:i,alt:c,className:"media-viewer-media",decoding:"async"})}),e?l.jsx("button",{type:"button",className:`media-stage-nav is-right ${n?"":"is-disabled"}`,onClick:s,"aria-label":"Next",disabled:!n,children:l.jsx(oc,{size:18})}):null]})}const qj=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e),Qm={contentVisibility:"auto",containIntrinsicSize:"240px 120px"},Xj=e=>{if(!e)return"";const t=e.filename||"",n=e.subfolder||"",r=e.type||"output",s=e.mtime?`&v=${encodeURIComponent(String(e.mtime))}`:"";return`/view?filename=${encodeURIComponent(t)}&subfolder=${encodeURIComponent(n)}&type=${encodeURIComponent(r)}${s}`},qm=e=>{if(!Rl(e))return null;const{folderPath:t,base:n}=dc(e);return{folderPath:t||"root",base:n||""}},Xm=(e="")=>{if(!e||e==="root")return"root";const t=e.split("/").filter(Boolean);return t[t.length-1]||e};function Jj({isOpen:e,media:t,onClose:n,onPrev:r,onNext:s,onDeleted:a,total:i=0,canPrev:c=!1,canNext:u=!1,autoOpenRerunKey:d="",onRerunAutoOpen:g}){var np,rp,sp;const{aliasCatalog:v=[],aliasLookup:y,aliasLoading:x,aliasError:S}=Nf(),j=o.useRef(!1),N=o.useRef(null),[m,p]=o.useState(!1),[h,w]=o.useState(!1),[E,b]=o.useState(!1),[L,z]=o.useState(!1),[$,T]=o.useState(!1),F=o.useRef(null),Z=o.useRef(null),ae=o.useRef(!1),Ce=o.useRef(null),[ye,Y]=o.useState(!1),[Se,R]=o.useState(null),[A,O]=o.useState(!1),[_,B]=o.useState(null),W=o.useRef("rerun"),[ue,pe]=o.useState("random"),[Q,he]=o.useState(""),[J,U]=o.useState(""),[H,ve]=o.useState(""),[ge,$e]=o.useState(""),[ke,ze]=o.useState(""),[Me,at]=o.useState("All"),[qe,lt]=o.useState("All"),[Re,Qe]=o.useState(""),[G,q]=o.useState(""),[le,te]=o.useState({hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null}),[de,we]=o.useState([]),[ee,We]=o.useState(null),[et,Oe]=o.useState({}),[xt,D]=o.useState(""),[re,be]=o.useState(""),[Ee,Fe]=o.useState("elements"),[tt,Ge]=o.useState("alias"),[Xe,V]=o.useState(""),ie=o.useDeferredValue(Xe),[je,Le]=o.useState("All"),[Be,Ze]=o.useState("All"),[I,K]=o.useState(30),[se,me]=o.useState(""),[_e,Te]=o.useState(""),ct=o.useDeferredValue(_e),[nt,ft]=o.useState(""),[ot,Or]=o.useState("count"),[Ss,Fr]=o.useState(""),[vn,ks]=o.useState([]),[on,xn]=o.useState([]),[wn,zt]=o.useState(0),[nr,rr]=o.useState(0),[Pn,Dr]=o.useState(!1),[Un,cn]=o.useState(!1),[Dl,Ft]=o.useState(""),[Br,js]=o.useState(""),Dt=o.useRef(null),Lt=o.useRef(null),[Ks,Tn]=o.useState(!1),[it,sr]=o.useState(null),[Bl,Ns]=o.useState(!1),[Gs,Sn]=o.useState(""),Ur=o.useDeferredValue(Gs),[Vr,Wr]=o.useState("All"),[Qa,Rn]=o.useState("All"),[pt,zn]=o.useState(null),[Xt,kn]=o.useState(null),qa=o.useRef(null),wt=o.useRef(null),[wr,Ul]=o.useState(!1),[Vn,Vl]=o.useState(""),[un,lr]=o.useState(!1),[Ys,Wl]=o.useState(""),[Hr,Xa]=o.useState([]),[Sr,Ja]=o.useState([]),Kr=o.useRef(null),Wn=o.useRef(null),Qs=o.useRef(""),Cs=f=>f?Array.from(f.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(k=>!k.hasAttribute("disabled")&&k.getAttribute("aria-hidden")!=="true"):[];o.useEffect(()=>{if(!e)return;const f=k=>{k.key==="Escape"&&(n==null||n()),k.key==="ArrowLeft"&&c&&(r==null||r()),k.key==="ArrowRight"&&u&&(s==null||s())};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[e,n,s,r,c,u]),o.useEffect(()=>{var f;e&&(p(!1),Y(!1),R(null),O(!1),B(null),W.current="rerun",b(!1),z(!1),pe("random"),he(""),U(""),ve(""),$e(""),ze(""),at("All"),lt("All"),te({hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null}),we([]),We(null),Oe({}),D(""),be(""),Fe("elements"),Ge("alias"),V(""),Le("All"),Ze("All"),K(30),me(""),Te(""),ft(""),Or("count"),Fr(""),ks([]),xn([]),zt(0),rr(0),Dr(!1),cn(!1),Ft(""),js(""),Tn(!1),sr(null),Ns(!1),Ul(!1),Vl(""),lr(!1),Wl(""),Xa([]),Ja([]),Kr.current=null,Wn.current&&(Wn.current.abort(),Wn.current=null),(f=wt.current)!=null&&f.timer&&(clearTimeout(wt.current.timer),wt.current=null),Dt.current&&(Dt.current.abort(),Dt.current=null),Lt.current&&(Lt.current.abort(),Lt.current=null),ae.current=!0,Ce.current&&clearTimeout(Ce.current),Ce.current=setTimeout(()=>{ae.current=!1,Ce.current=null},250))},[e,t]),o.useEffect(()=>()=>{var f;Ce.current&&(clearTimeout(Ce.current),Ce.current=null),(f=wt.current)!=null&&f.timer&&(clearTimeout(wt.current.timer),wt.current=null),Dt.current&&(Dt.current.abort(),Dt.current=null),Lt.current&&(Lt.current.abort(),Lt.current=null)},[]),o.useEffect(()=>{if(!e||typeof document>"u")return;const f=F.current;Z.current=document.activeElement;const k=()=>{var Ue;const ne=Cs(f),ce=N.current||ne[0]||f;(Ue=ce==null?void 0:ce.focus)==null||Ue.call(ce)},M=ne=>{if(ne.key!=="Tab"||!f)return;const ce=Cs(f);if(!ce.length){ne.preventDefault(),f.focus();return}const Ue=ce[0],rt=ce[ce.length-1],Ve=document.activeElement;ne.shiftKey&&Ve===Ue?(ne.preventDefault(),rt.focus()):!ne.shiftKey&&Ve===rt&&(ne.preventDefault(),Ue.focus())};return requestAnimationFrame(k),f==null||f.addEventListener("keydown",M),()=>{var ce;f==null||f.removeEventListener("keydown",M);const ne=Z.current;ne&&document.contains(ne)&&((ce=ne.focus)==null||ce.call(ne))}},[e]);const Za=!!t,ei=t?Xj(t):"",mc=(t==null?void 0:t.subfolder)||"Gallery",ti=qj((t==null?void 0:t.filename)||""),hc=i>1,$t=(t==null?void 0:t.meta)||{},Hl=[$t!=null&&$t.model?{label:"Model",value:$t.model}:null,$t!=null&&$t.prompt?{label:"Prompt",value:$t.prompt,isPrompt:!0}:null,Array.isArray($t==null?void 0:$t.loras)&&$t.loras.length?{label:"LoRAs",value:$t.loras.join(", ")}:null].filter(Boolean),gc=!!((np=t==null?void 0:t.meta)!=null&&np.has_prompt||Hl.length),yc=typeof(t==null?void 0:t.filename)=="string"&&t.filename.toLowerCase().endsWith(".png"),Hn=Za&&gc&&yc,ni=Za,vc=o.useMemo(()=>[{key:"random",label:"Random"},{key:"keep",label:"Keep"},{key:"custom",label:"Custom"}],[]),ri=o.useMemo(()=>{if(ue!=="custom")return null;const f=parseInt(String(Q),10);return Number.isFinite(f)?f:null},[Q,ue]),si=ue!=="custom"||ri!==null,qs=o.useMemo(()=>{if(!String(J||"").trim())return null;const f=parseInt(String(J),10);return Number.isFinite(f)&&f>0?f:null},[J]),bs=o.useMemo(()=>{if(!String(H||"").trim())return null;const f=parseInt(String(H),10);return Number.isFinite(f)&&f>0?f:null},[H]),li=(!String(J||"").trim()||qs!==null)&&(!String(H||"").trim()||bs!==null),ai=!!String(J||"").trim()&&qs===null,ii=!!String(H||"").trim()&&bs===null,C=le.checkpoint||($t==null?void 0:$t.model)||"",P=Array.isArray(le.loras)?le.loras:[],fe=C?cr(C):"",xe=P.length?P.map(f=>cr(f)).join(", "):"",De=o.useMemo(()=>(Hr||[]).map(f=>{const k=String(f||"");return{value:k,meta:qm(k)}}),[Hr]),Ie=o.useMemo(()=>(Sr||[]).map(f=>{const k=String(f||"");return{value:k,meta:qm(k)}}),[Sr]),Ke=o.useMemo(()=>{const f=new Set(["All"]);return De.forEach(({meta:k})=>{k!=null&&k.folderPath&&f.add(k.folderPath)}),Array.from(f).sort((k,M)=>k.localeCompare(M))},[De]),Pe=o.useMemo(()=>{const f=new Set(["All"]);return Ie.forEach(({meta:k})=>{k!=null&&k.folderPath&&f.add(k.folderPath)}),Array.from(f).sort((k,M)=>k.localeCompare(M))},[Ie]),He=Ke.length>2,Jt=Pe.length>2;o.useEffect(()=>{if(!He){Me!=="All"&&at("All");return}Ke.includes(Me)||at("All")},[Me,Ke,He]),o.useEffect(()=>{if(!Jt){qe!=="All"&&lt("All");return}Pe.includes(qe)||lt("All")},[qe,Pe,Jt]);const Kn=o.useMemo(()=>{const f=new Map;return De.forEach(({meta:k})=>{if(!(k!=null&&k.base))return;const M=k.base.toLowerCase();f.set(M,(f.get(M)||0)+1)}),f},[De]),Kl=o.useMemo(()=>{const f=new Map;return Ie.forEach(({meta:k})=>{if(!(k!=null&&k.base))return;const M=k.base.toLowerCase();f.set(M,(f.get(M)||0)+1)}),f},[Ie]),Es=o.useMemo(()=>{const f=[],k=He&&Me==="All";return De.forEach(({value:M,meta:ne})=>{if(!ne){f.push({value:M,label:M});return}if(He&&Me!=="All"&&ne.folderPath!==Me)return;let ce=ne.base||cr(M)||M;if(k&&ne.base){const Ue=ne.base.toLowerCase();Kn.get(Ue)>1&&(ce=`${ce} (${Xm(ne.folderPath)})`)}f.push({value:M,label:ce})}),f},[De,Me,Kn,He]),As=o.useMemo(()=>{const f=[],k=Jt&&qe==="All";return Ie.forEach(({value:M,meta:ne})=>{if(!ne){f.push({value:M,label:M});return}if(Jt&&qe!=="All"&&ne.folderPath!==qe)return;let ce=ne.base||cr(M)||M;if(k&&ne.base){const Ue=ne.base.toLowerCase();Kl.get(Ue)>1&&(ce=`${ce} (${Xm(ne.folderPath)})`)}f.push({value:M,label:ce})}),f},[Ie,qe,Kl,Jt]),Bt=o.useMemo(()=>ge?Es.some(f=>String(f.value)===String(ge)):!0,[Es,ge]),Zt=o.useMemo(()=>ke?As.some(f=>String(f.value)===String(ke)):!0,[As,ke]),Lf=o.useMemo(()=>{let f=Es;if(ge&&!Bt&&(f=[{value:ge,label:cr(String(ge))},...f]),Re.trim()){const k=Re.toLowerCase().trim();f=f.filter(M=>String(M.label).toLowerCase().includes(k)||String(M.value).toLowerCase().includes(k))}return f},[ge,Bt,Es,Re]),Pf=o.useMemo(()=>{let f=As;if(ke&&!Zt&&(f=[{value:ke,label:cr(String(ke))},...f]),G.trim()){const k=G.toLowerCase().trim();f=f.filter(M=>String(M.label).toLowerCase().includes(k)||String(M.value).toLowerCase().includes(k))}return f},[ke,Zt,As,G]),Tf=o.useCallback(async f=>{const k=f==null?void 0:f.hasCheckpoint,M=f==null?void 0:f.hasLora;if(!k&&!M)return;Wn.current&&Wn.current.abort();const ne=new AbortController;Wn.current=ne,lr(!0),Wl("");try{const[ce,Ue]=await Promise.all([k&&!Hr.length?rd("checkpoints",{signal:ne.signal}):null,M&&!Sr.length?rd("loras",{signal:ne.signal}):null]);ce!=null&&ce.choices&&Xa(ce.choices),Ue!=null&&Ue.choices&&Ja(Ue.choices)}catch(ce){if((ce==null?void 0:ce.name)==="AbortError")return;Wl("Unable to load model choices right now.")}finally{Wn.current===ne&&(Wn.current=null),lr(!1)}},[Hr.length,Sr.length]),xc=o.useRef(de),oi=o.useRef(ee),wc=o.useRef(et);o.useEffect(()=>{xc.current=de},[de]),o.useEffect(()=>{oi.current=ee},[ee]),o.useEffect(()=>{wc.current=et},[et]);const ci=o.useCallback(async()=>{var f;if(!t)throw new Error("media_missing");if(Kr.current)return{prompt:Kr.current,info:le,targets:xc.current,rawMap:oi.current};Ul(!0),Vl("");try{const k=await PS({filename:t.filename,subfolder:t.subfolder||""}),M=k==null?void 0:k.prompt;if(!M)throw new Error("prompt_missing");const ne=zj(M),ce=cv(M),Ue=k==null?void 0:k.cozygen_prompt_raw,rt=Ue&&typeof Ue=="object"?Ue:null;if(we(ce),We(rt),ce.length){const Ve={};ce.forEach(Ye=>{const Pt=rt&&typeof rt[Ye.key]=="string"?rt[Ye.key]:Ye.text;Ve[Ye.key]=Pt}),Oe(Ve),D(Ye=>Ye&&Ve[Ye]?Ye:ce[0].key)}else Oe({}),D("");return Kr.current=M,te(ne),{prompt:M,info:ne,targets:ce,rawMap:rt}}catch(k){const M=((f=k==null?void 0:k.payload)==null?void 0:f.error)||(k==null?void 0:k.message)||"Unable to load prompt metadata.";throw Vl(M),k}finally{Ul(!1)}},[t==null?void 0:t.filename,t==null?void 0:t.subfolder,le]),ui=o.useCallback(async()=>{if(Hn){O(!1),Y(!0),p(!1),B(null),R(null),b(!1),at("All"),lt("All");try{const f=await ci(),k=f==null?void 0:f.info;U(M=>String(M||"").trim()?M:(k==null?void 0:k.width)!==null&&(k==null?void 0:k.width)!==void 0?String(k.width):""),ve(M=>String(M||"").trim()?M:(k==null?void 0:k.height)!==null&&(k==null?void 0:k.height)!==void 0?String(k.height):""),await Tf(f==null?void 0:f.info)}catch{}}},[Hn,Tf,ci]),Rf=o.useCallback(()=>{if(Hn){if(ye){Y(!1),R(null);return}ui()}},[Hn,ui,ye]),wv=o.useCallback(()=>{Y(!1),R(null),p(f=>!f)},[]),zf=o.useCallback(f=>{f&&R(f)},[]),Xs=o.useCallback(()=>{R(null)},[]);o.useEffect(()=>{if(!e){Qs.current="";return}if(!d||!(t!=null&&t.filename))return;const f=`${t.subfolder||""}|${t.filename}`;f===d&&Qs.current!==f&&(Qs.current=f,ui(),g==null||g())},[d,e,t==null?void 0:t.filename,t==null?void 0:t.subfolder,g,ui]),o.useCallback(()=>{B(null),W.current="rerun",Y(!1),R(null),O(!0)},[]);const Sv=o.useCallback(()=>{Sn(""),Wr("All"),Ns(!0)},[]);o.useCallback((f,k)=>{f&&(W.current=A?"editor":"rerun",Fe(f.type==="alias"?"aliases":"tags"),B({element:f,displayName:k||f.text||""}),Y(!1),R(null),O(!0))},[A]);const kv=o.useCallback(()=>{O(!1),B(null),Fe("elements"),W.current="rerun"},[]),jv=o.useCallback(()=>{O(!1),B(null),Fe("elements"),p(!1),Y(!0),R(null),W.current="rerun"},[]),_f=ye||A,di=tt==="raw"&&(y==null?void 0:y.size),If=o.useMemo(()=>!_f||!de.length?[]:de.map(f=>{const k=et==null?void 0:et[f.key],M=typeof k=="string"?k:f.text||"",ne=di?ss(M,y):M,ce=Wy(ne||"");return{...f,text:ne,rawText:M,elements:ce}}),[de,et,_f,di,y]),Gn=o.useMemo(()=>If.filter(f=>String(f.text||"").trim().length>0),[If]);o.useEffect(()=>{if(!Gn.length){D("");return}Gn.some(k=>k.key===xt)||D(Gn[0].key)},[Gn,xt]);const ut=o.useMemo(()=>Gn.length?Gn.find(k=>k.key===xt)||Gn[0]:null,[Gn,xt]),fi=(ut==null?void 0:ut.text)||"",Gl=o.useMemo(()=>(Gn||[]).map(f=>({value:f.key,label:f.label})),[Gn]),dn=(ut==null?void 0:ut.elements)||[],$f=o.useMemo(()=>dn.some(f=>(f==null?void 0:f.type)==="alias"),[dn]),Mf=o.useMemo(()=>{if($f)return!0;const f=ut==null?void 0:ut.key;if(!f||!ee)return!1;const k=ee[f];return typeof k=="string"&&k.includes("$")},[ut==null?void 0:ut.key,$f,ee]),Nv=o.useMemo(()=>[{key:"elements",label:"Elements",icon:l.jsx(ic,{size:14})},{key:"aliases",label:"Aliases",icon:l.jsx(_y,{size:14})},{key:"tags",label:"Tags",icon:l.jsx(ac,{size:14})}],[]),Cv=o.useMemo(()=>[{key:"alias",label:"Alias"},{key:"raw",label:"Raw"}],[]),Gr=A;o.useMemo(()=>{if(!(_!=null&&_.element))return"";const f=_.element,k=_.displayName||f.text||"";return f.type==="alias"?`${k}  $${f.text}$`:k||f.text},[_]);const Of=_?"Replace prompt element":"Add prompt element",bv=_?"Replace with tag or $alias$":"Add tag or $alias$",pi=Gn.length>0,Ev=Gl.length>1||Mf,Av=!wr&&!Vn&&pi,Sc=o.useMemo(()=>{const f=new Set;return dn.forEach(k=>{if((k==null?void 0:k.type)!=="tag")return;const M=String(k.text||"").trim().toLowerCase();M&&f.add(M)}),f},[dn]),kc=o.useMemo(()=>{const f=new Set;return dn.forEach(k=>{if((k==null?void 0:k.type)!=="alias")return;const M=String(k.text||"").trim().toLowerCase();M&&f.add(M)}),f},[dn]),_n=o.useMemo(()=>Array.isArray(v)?v.map(f=>{if(!f)return null;const k=String(f.token||f.name||"").trim();if(!k)return null;const M=f.displayName||gl({token:k,name:f.name});return{...f,key:f.key||k,token:k,displayName:M,subcategory:f.subcategory||""}}).filter(Boolean):[],[v]),Lv=o.useMemo(()=>{const f=new Map;return _n.forEach(k=>{if(!(k!=null&&k.token))return;const M=String(k.token||"").trim().toLowerCase();if(!M)return;const ne=k.displayName||gl({token:k.token,name:k.name});ne&&f.set(M,ne)}),f},[_n]),Ff=o.useMemo(()=>{const f=new Map;return _n.forEach(k=>{k!=null&&k.token&&f.set(String(k.token).toLowerCase(),k)}),f},[_n]),jc=o.useMemo(()=>{const f=new Set;return _n.forEach(M=>{const ne=String(M.category||"").trim();ne&&f.add(ne)}),["All",...Array.from(f).sort((M,ne)=>M.localeCompare(ne))]},[_n]),Df=o.useMemo(()=>{const f=new Set;return _n.forEach(M=>{if(je!=="All"&&M.category!==je)return;const ne=String(M.subcategory||"").trim();ne&&f.add(ne)}),["All",...Array.from(f).sort((M,ne)=>M.localeCompare(ne))]},[_n,je]),Yl=o.useMemo(()=>{const f=String(ie||"").trim().toLowerCase();return _n.filter(k=>{if(je!=="All"&&(k.category||"")!==je||Be!=="All"&&(k.subcategory||"")!==Be)return!1;if(!f)return!0;const M=String(k.displayName||"").toLowerCase(),ne=String(k.token||"").toLowerCase(),ce=String(k.text||"").toLowerCase();return M.includes(f)||ne.includes(f)||ce.includes(f)})},[_n,je,Be,ie]),Pv=o.useMemo(()=>Yl.slice(0,I),[Yl,I]),Ql=o.useMemo(()=>{const f=Number.parseInt(String(Ss||""),10);return Number.isFinite(f)&&f>0?f:0},[Ss]),Tv=o.useMemo(()=>Array.isArray(vn)?vn.map(f=>{if(!f)return null;if(typeof f=="string"){const ne=f.trim();return ne?{value:ne,label:bn(ne)}:null}const k=String(f.key||"").trim();if(!k)return null;const M=Number(f.actual||f.count||0);return{value:k,label:`${bn(k)} (${M.toLocaleString()})`}}).filter(Boolean):[],[vn]);o.useEffect(()=>{Ze("All")},[je]),o.useEffect(()=>{K(30)},[je,Be,ie]),o.useEffect(()=>{if(!Gr||Ee!=="tags"||vn.length>0)return;let f=!1;return hf().then(k=>{f||ks(Array.isArray(k==null?void 0:k.categories)?k.categories:[])}).catch(()=>{f||ks([])}),()=>{f=!0}},[Gr,Ee,vn.length]);const Bf=o.useCallback(async()=>{if(!Gr||Ee!=="tags")return;Dt.current&&Dt.current.abort(),Lt.current&&(Lt.current.abort(),Lt.current=null);const f=new AbortController;Dt.current=f;try{Dr(!0),Ft("");const k=await hr({q:ct,category:nt,sort:ot,minCount:Ql,limit:40,offset:0},{signal:f.signal}),M=Array.isArray(k==null?void 0:k.items)?k.items:[];xn(M),zt(Number((k==null?void 0:k.total)||0)),rr(M.length)}catch(k){if((k==null?void 0:k.name)==="AbortError")return;Ft("Unable to load tags right now."),xn([]),zt(0),rr(0)}finally{Dr(!1)}},[ct,Gr,Ee,nt,Ql,ot]),mi=o.useCallback(async()=>{if(Pn)return;Dt.current&&Dt.current.abort();const f=new AbortController;Dt.current=f;try{Dr(!0),Ft("");const k=await hr({q:Ur,category:"",sort:"count",minCount:"",limit:100,offset:0},{signal:f.signal}),M=Array.isArray(k==null?void 0:k.items)?k.items:[];xn(M),zt(Number((k==null?void 0:k.total)||0)),rr(M.length)}catch(k){if((k==null?void 0:k.name)==="AbortError")return;Ft("Unable to load tags right now."),xn([]),zt(0),rr(0)}finally{Dr(!1)}},[Ur,Pn]),Uf=o.useCallback(async()=>{if(Pn||Un||on.length>=wn)return;Lt.current&&Lt.current.abort();const f=new AbortController;Lt.current=f;try{cn(!0);const k=await hr({q:Ur,category:"",sort:"count",minCount:"",limit:100,offset:nr},{signal:f.signal}),M=Array.isArray(k==null?void 0:k.items)?k.items:[];xn(ne=>[...ne,...M]),zt(Number((k==null?void 0:k.total)||0)),rr(nr+M.length)}catch(k){if((k==null?void 0:k.name)==="AbortError")return;Ft("Unable to load more tags.")}finally{cn(!1)}},[Ur,on.length,Pn,Un,nr,wn]),Rv=o.useCallback(async()=>{if(!Gr||Ee!=="tags"||Pn||Un||on.length>=wn)return;Lt.current&&Lt.current.abort();const f=new AbortController;Lt.current=f;try{cn(!0);const k=await hr({q:ct,category:nt,sort:ot,minCount:Ql,limit:40,offset:nr},{signal:f.signal}),M=Array.isArray(k==null?void 0:k.items)?k.items:[];xn(ne=>[...ne,...M]),zt(Number((k==null?void 0:k.total)||0)),rr(nr+M.length)}catch(k){if((k==null?void 0:k.name)==="AbortError")return;Ft("Unable to load more tags.")}finally{cn(!1)}},[ct,Gr,Ee,nt,on.length,Pn,Un,Ql,nr,ot,wn]);o.useEffect(()=>{if(!Gr||Ee!=="tags")return;const f=window.setTimeout(()=>{Bf()},250);return()=>window.clearTimeout(f)},[Gr,Ee,ct,nt,ot,Ql,Bf]),o.useEffect(()=>{Ee!=="elements"&&(zn(null),kn(null))},[Ee]),o.useEffect(()=>{if(!Ks&&!Bl)return;const f=window.setTimeout(()=>{mi()},300);return()=>window.clearTimeout(f)},[Ur,Ks,Bl,mi]);const en=o.useCallback(f=>{ut!=null&&ut.key&&Oe(k=>{const M=typeof(k==null?void 0:k[ut.key])=="string"?k[ut.key]:ut.rawText||ut.text||"",ne=di?ss(M,y):M,ce=typeof f=="function"?f(ne):String(f||"");return ce===ne?k:{...k,[ut.key]:ce}})},[ut,y,di]),Vf=o.useCallback((f,k,M)=>{if(!f)return!1;const ne=String(M||"").trim();return ne?(en(ce=>{const Ue=typeof ce=="string"?ce:"";if(!Ue||typeof f.start!="number"||typeof f.end!="number")return Ue;const rt=Zr(Ue,f),Ve=ne.replace(/^\$|\$$/g,""),Ye=k==="alias"?`$${Ve}$`:Ve,Pt=rt?`(${Ye}:${rn(rt.weight)})`:Ye;return Ue.slice(0,f.start)+Pt+Ue.slice(f.end)}),!0):!1},[en]),Ls=o.useCallback((f,k,M)=>{const ne=_==null?void 0:_.element;if(!ne)return!1;const ce=String(k||"").trim();return!ce||!Vf(ne,f,ce)?!1:(B(null),Tn(!1),sr(null),f==="alias"?me(`Replaced with ${M||ce.replace(/^\$|\$$/g,"")}`):js(`Replaced with ${M||ce.replace(/^\$|\$$/g,"")}`),Fe("elements"),W.current==="editor"?(O(!0),Y(!1)):(O(!1),Y(!0)),W.current="rerun",!0)},[_,Vf,Tn,sr,Fe,O,Y]),Js=o.useCallback(f=>{const k=String(f||"").trim();k&&en(M=>{const ne=M.trim();return ne?`${ne.replace(/[\s,]*$/,"")}, ${k}`.trim():k})},[en]),Wf=o.useCallback(()=>{const f=String(re||"").trim();if(!f)return;const k=f.split(",").map(ce=>ce.trim()).filter(Boolean),M=k[0];if(!M)return;if(_!=null&&_.element){const ce=M.match(/^\$([a-z0-9_:-]+)\$$/i);ce?Ls("alias",ce[1],ce[1]):Ls("tag",M,M),be("");return}const ne=k.join(", ");ne&&(Js(ne),be(""))},[re,Js,Ls,_]),zv=o.useCallback((f,k)=>{const M=String(f||"").trim();if(!M)return;if(_!=null&&_.element){Ls("alias",M,k||M);return}const ne=M.toLowerCase();if(kc.has(ne)){me(`Already added: ${k||M}`);return}Js(`$${M}$`),me(`Added: ${k||M}`)},[Js,kc,Ls,_]),_v=o.useCallback(f=>{const k=String(f||"").trim();if(!k)return;if(_!=null&&_.element){Ls("tag",k,k);return}const M=k.toLowerCase();if(Sc.has(M)){js(`Already added: ${k}`);return}Js(k),js(`Added: ${k}`)},[Js,Sc,Ls,_]);o.useEffect(()=>{if(!se)return;const f=window.setTimeout(()=>me(""),1600);return()=>window.clearTimeout(f)},[se]),o.useEffect(()=>{if(!Br)return;const f=window.setTimeout(()=>js(""),1600);return()=>window.clearTimeout(f)},[Br]);const hi=o.useCallback((f,k)=>{if(!f)return;if(f.type==="alias"){const ce=Ff.get(String(f.text||"").toLowerCase());Wr((ce==null?void 0:ce.category)||"All"),Rn((ce==null?void 0:ce.subcategory)||"All")}else Wr("All"),Rn("All");const M=Zr(fi||"",f),ne=(M==null?void 0:M.weight)??1;sr({element:f,displayName:k,weight:ne}),Sn(""),Tn(!0)},[Ff,fi]),Iv=o.useCallback(f=>{f&&(en(k=>Gy(k||"",f)),Tn(!1),sr(null))},[en]),gi=o.useCallback((f,k)=>{f===null||k===null||f===k||en(M=>Ky(M||"",dn,f,k))},[dn,en]),Hf=(f,k)=>{zn(k),kn(k),f!=null&&f.dataTransfer&&(f.dataTransfer.effectAllowed="move",f.dataTransfer.setData("text/plain",String(k)))},Kf=(f,k)=>{f.preventDefault(),!(pt===null||k===Xt)&&(kn(k),f!=null&&f.dataTransfer&&(f.dataTransfer.dropEffect="move"))},Gf=()=>{pt!==null&&Xt!==null&&pt!==Xt&&gi(pt,Xt),zn(null),kn(null)},Yf=()=>{Xt!==null&&kn(null)},Qf=(f,k)=>{f.preventDefault(),pt!==null&&pt!==k&&gi(pt,k),zn(null),kn(null)},qf=o.useCallback((f,k)=>{var Ue,rt;if(!((rt=(Ue=f.target)==null?void 0:Ue.closest)==null?void 0:rt.call(Ue,".composer-token-drag-handle, .rerun-token-grip")))return;const ne=f.touches[0],ce=window.setTimeout(()=>{wt.current&&(wt.current.active=!0,zn(k),kn(k))},240);wt.current={idx:k,startX:ne.clientX,startY:ne.clientY,active:!1,timer:ce}},[]),Xf=o.useCallback(f=>{var Ye,Pt;if(!wt.current)return;const k=f.touches[0],M=Math.abs(k.clientX-wt.current.startX),ne=Math.abs(k.clientY-wt.current.startY);if(!wt.current.active){(M>8||ne>8)&&(window.clearTimeout(wt.current.timer),wt.current=null);return}f.preventDefault();let ce=[];const Ue=qa.current;if(Ue&&(ce=Ue.querySelectorAll(".composer-token-draggable")),!ce.length){const bt=(Pt=(Ye=f.target)==null?void 0:Ye.closest)==null?void 0:Pt.call(Ye,".rerun-chip-row");bt&&(ce=bt.querySelectorAll(".rerun-token-drag"))}const rt=k.clientX,Ve=k.clientY;for(let bt=0;bt<ce.length;bt+=1){const Tt=ce[bt].getBoundingClientRect();if(rt>=Tt.left&&rt<=Tt.right&&Ve>=Tt.top&&Ve<=Tt.bottom){kn(bt);break}}},[]),Jf=o.useCallback(()=>{var f,k;(f=wt.current)!=null&&f.timer&&window.clearTimeout(wt.current.timer),(k=wt.current)!=null&&k.active&&pt!==null&&Xt!==null&&pt!==Xt&&gi(pt,Xt),wt.current=null,zn(null),kn(null)},[pt,Xt,gi]),Zf=o.useCallback(()=>{var f;(f=wt.current)!=null&&f.timer&&window.clearTimeout(wt.current.timer),wt.current=null,zn(null),kn(null)},[]),Zs=f=>{if(!(typeof window>"u"))try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:f}}))}catch{}},$v=async()=>{var f;if(!(!t||h||!Hn)){if(!si){alert("Enter a valid seed value.");return}if(!li){alert("Enter valid width and height values.");return}w(!0),Zs(!0);try{const{prompt:k}=await ci();let ne=Um(k,{seedMode:ue,seedValue:ue==="custom"?ri:null,checkpoint:ge||null,lora:ke||null,width:qs,height:bs});de.length&&(ne=Rj(ne,de,et,{mutate:!0}));const ce={};de.length&&de.forEach(Ve=>{const Ye=et==null?void 0:et[Ve.key];typeof Ye=="string"&&/\$[a-z0-9_:-]+\$/i.test(Ye)&&(ce[Ve.key]=Ye)});const Ue=To();if(Object.keys(ce).length)try{await Lo({promptId:Ue,promptRaw:ce})}catch{}let rt=ne;if(y&&y.size){const Ve=Ye=>{if(typeof Ye=="string")return ss(Ye,y);if(Array.isArray(Ye))return Ye.map(Pt=>Ve(Pt));if(Ye&&typeof Ye=="object"){const Pt=Array.isArray(Ye)?[]:{};return Object.entries(Ye).forEach(([bt,Tt])=>{Pt[bt]=Ve(Tt)}),Pt}return Ye};try{rt=Ve(ne)}catch{rt=ne}}ad({workflowName:t.filename||"gallery",workflow:rt,timestamp:Date.now(),promptRaw:Object.keys(ce).length?ce:null}),await Ao({prompt:rt,prompt_id:Ue}),Zs(!1),b(!0),setTimeout(()=>{b(!1)},1500)}catch(k){if(Zs(!1),k!=null&&k.unauthorized){window.location.hash="#/login";return}const M=((f=k==null?void 0:k.payload)==null?void 0:f.error)||(k==null?void 0:k.message)||"Unable to tweak this item.";alert(M)}finally{w(!1)}}},Mv=async()=>{var f;if(!(!t||$||!Hn)){T(!0),Zs(!0);try{const k=Kr.current?{prompt:Kr.current,targets:xc.current,rawMap:oi.current}:await ci(),{prompt:M,targets:ne=[],rawMap:ce=null}=k;let rt=Um(M,{seedMode:"random",seedValue:null,checkpoint:null,lora:null,width:qs,height:bs}),Ve=rt;if(y&&y.size){const bt=Tt=>{if(typeof Tt=="string")return ss(Tt,y);if(Array.isArray(Tt))return Tt.map(ar=>bt(ar));if(Tt&&typeof Tt=="object"){const ar=Array.isArray(Tt)?[]:{};return Object.entries(Tt).forEach(([Ut,Wv])=>{ar[Ut]=bt(Wv)}),ar}return Tt};try{Ve=bt(rt)}catch{Ve=rt}}const Ye=To(),Pt={};if((ne.length||wc.current)&&ne.forEach(bt=>{const Tt=wc.current||{},ar=ce||oi.current,Ut=ar&&typeof bt.key=="string"&&typeof ar[bt.key]=="string"?ar[bt.key]:Tt[bt.key]||bt.text;typeof Ut=="string"&&/\$[a-z0-9_:-]+\$/i.test(Ut)&&(Pt[bt.key]=Ut)}),Object.keys(Pt).length)try{await Lo({promptId:Ye,promptRaw:Pt})}catch{}ad({workflowName:t.filename||"gallery",workflow:Ve,timestamp:Date.now(),promptRaw:Object.keys(Pt).length?Pt:null}),await Ao({prompt:Ve,prompt_id:Ye}),Zs(!1)}catch(k){if(Zs(!1),k!=null&&k.unauthorized){window.location.hash="#/login";return}const M=((f=k==null?void 0:k.payload)==null?void 0:f.error)||(k==null?void 0:k.message)||"Unable to re-run this item.";alert(M)}finally{T(!1)}}},Ov=async()=>{var k;if(!(!(t!=null&&t.filename)||!window.confirm("Delete this item? This cannot be undone."))){z(!0);try{await Ty({filename:t.filename,subfolder:t.subfolder||""}),a==null||a(),n==null||n()}catch(M){if(M!=null&&M.unauthorized){window.location.hash="#/login";return}const ne=((k=M==null?void 0:M.payload)==null?void 0:k.error)||(M==null?void 0:M.message)||"Unable to delete this item.";alert(ne)}finally{z(!1)}}},ep=o.useMemo(()=>_n.map(f=>({key:f.key||f.token,token:f.token,displayName:f.displayName||f.name||f.token,category:f.category,name:f.name})),[_n]),tp=o.useMemo(()=>on.map(f=>({key:`${f.tag}-${f.category}`,tag:f.tag,displayName:f.tag,category:f.category,count:f.count})),[on]),Fv=o.useCallback(f=>{if(!(it!=null&&it.element))return;const k=f.type==="alias"?"alias":"tag",M=f.token||f.tag||"";en(ne=>{const ce=String(ne||""),Ue=Zr(ce,it.element),rt=String(M||"").replace(/^\$|\$$/g,"").trim();if(!rt)return ce;const Ve=k==="alias"?`$${rt}$`:rt,Ye=Ue?`(${Ve}:${rn(Ue.weight)})`:Ve;return Yy(ce,it.element,Ye)}),Tn(!1),sr(null)},[it,en]),Dv=o.useCallback(f=>{it!=null&&it.element&&(en(k=>Hy(k||"",it.element,f)),sr(k=>k?{...k,weight:f}:null))},[it==null?void 0:it.element,en]),Bv=l.jsx(pd,{open:Ks,onClose:()=>{Tn(!1),sr(null)},mode:"edit",tokenType:((rp=it==null?void 0:it.element)==null?void 0:rp.type)||"tag",tokenLabel:((sp=it==null?void 0:it.element)==null?void 0:sp.text)||"",tokenDisplay:(it==null?void 0:it.displayName)||"",weight:(it==null?void 0:it.weight)??1,onWeightChange:Dv,onDelete:()=>{it!=null&&it.element&&Iv(it.element)},aliases:ep,aliasCategories:jc,aliasLoading:x,tags:tp,tagLoading:Pn||Un,tagHasMore:on.length<wn,onLoadTags:mi,onLoadMoreTags:Uf,replacementSearch:Gs,onReplacementSearchChange:Sn,onReplace:Fv,activeCategory:Vr,onCategoryChange:Wr,initialCategory:Vr,initialSubcategory:Qa}),Uv=o.useCallback(f=>{f.type==="alias"&&f.token?en(k=>{const M=(k||"").trim();return M?`${M}, $${f.token}$`:`$${f.token}$`}):f.tag&&en(k=>{const M=(k||"").trim();return M?`${M}, ${f.tag}`:f.tag}),Ns(!1)},[en]),Vv=l.jsx(pd,{open:Bl,onClose:()=>Ns(!1),mode:"add",tokenType:"alias",aliases:ep,aliasCategories:jc,aliasLoading:x,tags:tp,tagLoading:Pn||Un,tagHasMore:on.length<wn,onLoadTags:mi,onLoadMoreTags:Uf,replacementSearch:Gs,onReplacementSearchChange:Sn,onAdd:Uv,activeCategory:Vr,onCategoryChange:Wr,initialCategory:Vr,initialSubcategory:Qa});return!t||!e||typeof document>"u"?null:cf.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"react-modal-overlay",role:"presentation",onPointerDown:f=>{j.current=f.target===f.currentTarget},onClick:f=>{j.current&&f.target===f.currentTarget&&(ae.current||n==null||n())},children:l.jsx("div",{className:"react-modal-content media-viewer-dialog",ref:F,role:"dialog","aria-modal":"true","aria-label":"Preview",onClick:f=>f.stopPropagation(),tabIndex:-1,children:l.jsxs("div",{className:"media-viewer-panel",children:[l.jsx(Gj,{filename:t.filename,locationLabel:mc,isClip:ti,url:ei,canRerun:Hn,rerunOpen:ye,canQuickRerun:Hn,quickRerunBusy:$,canDelete:ni,deleteBusy:L,metaRows:Hl,metaOpen:m,onToggleMeta:wv,onToggleRerun:Rf,onQuickRerun:Mv,onDelete:Ov,onClose:n,closeButtonRef:N}),l.jsxs("div",{className:"media-viewer-body",children:[l.jsx("div",{className:`media-viewer-drawer ${m?"is-open":""}`,children:l.jsx(Yj,{metaRows:Hl})}),l.jsx("div",{className:`media-viewer-drawer ${ye?"is-open":""}`,children:ye?l.jsxs("div",{className:"media-viewer-info rerun-info","aria-label":"Tweak options",children:[l.jsxs("div",{className:"media-info-row rerun-info-row rerun-controls-row",children:[l.jsx("span",{className:"media-info-label",children:"Seed & Size"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(_o,{title:"Adjust",defaultOpen:!1,variant:"bare",className:"rerun-collapsible",bodyClassName:"rerun-collapsible-body",children:l.jsxs("div",{className:"rerun-control-stack",children:[l.jsxs("div",{className:"rerun-control-group",children:[l.jsx(vr,{ariaLabel:"Seed mode",value:ue,onChange:pe,size:"sm",layout:"auto",wrap:!0,items:vc}),ue==="custom"?l.jsx("input",{type:"number",inputMode:"numeric",className:"ui-control ui-input",placeholder:"Enter seed",value:Q,onChange:f=>he(f.target.value)}):null,l.jsx("div",{className:"sheet-hint text-xs text-[#9DA3FFCC]",children:ue==="random"?"Randomize each run":"Keep or customize the seed used in the prompt."})]}),le.hasSize?l.jsx("div",{className:"rerun-control-group",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"number",inputMode:"numeric",min:1,step:1,className:"ui-control ui-input flex-1",placeholder:"Width",value:J,onChange:f=>U(f.target.value),"aria-label":"Width","aria-invalid":ai}),l.jsx("span",{className:"text-xs text-[#9DA3FF99]","aria-hidden":"true",children:""}),l.jsx("input",{type:"number",inputMode:"numeric",min:1,step:1,className:"ui-control ui-input flex-1",placeholder:"Height",value:H,onChange:f=>ve(f.target.value),"aria-label":"Height","aria-invalid":ii})]})}):null]})})})]}),le.hasCheckpoint?l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"Model"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(X,{variant:"bare",className:"w-full justify-start text-left text-[0.8rem] whitespace-normal break-words",onClick:()=>zf("model"),"aria-label":"Change model","aria-haspopup":"dialog","aria-expanded":Se==="model",children:ge||C||""})})]}):null,l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"Prompt"}),l.jsxs("div",{className:"media-info-value rerun-info-value",children:[wr?l.jsx("div",{className:"rerun-info-empty",children:"Loading prompt"}):null,Vn?l.jsx("div",{className:"rerun-info-empty rerun-info-error",children:Vn}):null,!wr&&!Vn&&!pi?l.jsx("div",{className:"rerun-info-empty",children:"No prompt text found for this image."}):null,Av?l.jsxs(l.Fragment,{children:[Ev?l.jsxs("div",{className:"rerun-prompt-controls",children:[Gl.length>1?l.jsx(mt,{value:(ut==null?void 0:ut.key)||"",onChange:D,"aria-label":"Prompt source",size:"sm",wrapperClassName:"rerun-select",options:Gl}):null,Mf?l.jsx(vr,{ariaLabel:"Alias display",value:tt,onChange:Ge,items:Cv,size:"sm",layout:"auto",className:"rerun-alias-toggle"}):null]}):null,l.jsx("div",{className:`media-info-value is-prompt rerun-prompt-box ${pt!==null?"is-reordering":""}`,role:"list",children:l.jsxs("div",{className:"ui-chip-row rerun-chip-row",children:[dn.length?dn.map((f,k)=>{const M=String(f.text||"").trim().toLowerCase(),ne=Lv.get(M)||`$${f.text}$`,ce=y==null?void 0:y.get(M),Ue=typeof ce=="string"&&ce.trim()?ce:`$${f.text}$`,rt=f.type==="alias"?tt==="alias"?ne:Ue:f.text,Ve=f.type==="alias"&&gl({token:f.text})||f.text,Ye=Zr(fi||"",f),Pt=(Ye==null?void 0:Ye.weight)??1,bt=Math.abs(Pt-1)>1e-6,Tt=pt===k,ar=Xt===k&&pt!==null&&pt!==k;return l.jsxs("span",{role:"button",tabIndex:0,draggable:!0,className:`ui-chip is-clickable rerun-token rerun-token-drag max-w-full whitespace-normal leading-snug ${f.type==="alias"?"is-alias":"is-raw"} ${Tt?"is-dragging":""} ${ar?"is-drop-target":""}`,onDragStart:Ut=>Hf(Ut,k),onDragEnd:Gf,onDragOver:Ut=>Kf(Ut,k),onDragLeave:Yf,onDrop:Ut=>Qf(Ut,k),onTouchStart:Ut=>qf(Ut,k),onTouchMove:Xf,onTouchEnd:Jf,onTouchCancel:Zf,onClick:()=>{pt===null&&hi(f,Ve)},onKeyDown:Ut=>{(Ut.key==="Enter"||Ut.key===" ")&&(Ut.preventDefault(),hi(f,Ve))},title:f.type==="alias"?`Alias: $${f.text}$`:`Tag: ${f.text}`,children:[l.jsx("span",{className:"rerun-token-grip","aria-hidden":"true",children:l.jsx(Da,{size:8})}),l.jsx("span",{className:"break-words",children:rt}),bt?l.jsxs("span",{className:"rerun-chip-weight",children:[rn(Pt),""]}):null]},`${f.type}-${f.text}-${f.start}`)}):null,l.jsx("button",{type:"button",className:"ui-chip is-clickable rerun-token rerun-token-add",onClick:Sv,"aria-label":"Add alias or tag",title:"Add alias or tag",children:"+"})]})})]}):null]})]}),le.hasLora?l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"LoRAs"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(X,{variant:"bare",className:"w-full justify-start text-left text-[0.8rem] whitespace-normal break-words",onClick:()=>zf("lora"),"aria-label":"Change LoRA","aria-haspopup":"dialog","aria-expanded":Se==="lora",children:ke||(P.length?P.join(", "):"")})})]}):null,l.jsxs("div",{className:"media-info-row rerun-info-row rerun-actions-row",children:[l.jsx("span",{className:"media-info-label",children:"Run"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:E?l.jsxs("div",{className:"rerun-success",children:[l.jsx("svg",{className:"rerun-success-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Render queued successfully!"]}):l.jsxs("div",{className:"rerun-actions",children:[l.jsx(X,{variant:"muted",size:"sm",onClick:Rf,children:"Close"}),l.jsx(X,{variant:"primary",size:"sm",onClick:$v,disabled:h||wr||!!Vn||!si||!li,children:h?"Tweaking":"Run"})]})})]})]}):null}),l.jsx(Qj,{showNav:hc,canPrev:c,canNext:u,onPrev:r,onNext:s,isClip:ti,url:ei,filename:t.filename})]})]})})}),l.jsx(Ht,{open:A,onClose:kv,title:"Edit prompt",variant:"fullscreen",footer:l.jsx("div",{className:"flex gap-2",children:l.jsx(X,{variant:"muted",className:"w-full",onClick:jv,children:"Back to tweak"})}),children:l.jsxs("div",{className:"sheet-stack",children:[wr?l.jsx("div",{className:"composer-alias-empty",children:"Loading prompt"}):null,Vn?l.jsx("div",{className:"text-xs text-[#FF8F70]",children:Vn}):null,!wr&&!Vn&&pi?l.jsxs(l.Fragment,{children:[Gl.length>1?l.jsx(mt,{value:(ut==null?void 0:ut.key)||"",onChange:D,"aria-label":"Prompt source",size:"sm",options:Gl}):null,l.jsx(vr,{ariaLabel:"Prompt element view",value:Ee,onChange:Fe,items:Nv,size:"sm"}),Ee==="elements"?l.jsxs("div",{className:"composer-panel composer-panel-compose is-visible",children:[l.jsx("div",{className:"composer-editor",children:l.jsxs("div",{className:"composer-input-row",children:[l.jsx("input",{type:"text",value:re,onChange:f=>be(f.target.value),onKeyDown:f=>{f.key==="Enter"&&(f.preventDefault(),Wf())},className:"composer-input ui-control ui-input is-compact",placeholder:bv,"aria-label":Of,disabled:!ut}),l.jsx(X,{size:"icon",variant:"ghost",onClick:Wf,disabled:!re.trim()||!ut,"aria-label":Of,children:"+"})]})}),l.jsxs("div",{className:"composer-tokens",children:[l.jsx("div",{className:"composer-tokens-header",children:l.jsxs("span",{className:"composer-tokens-label",children:["Elements",l.jsx("span",{className:"composer-tokens-count",children:dn.length})]})}),l.jsx("span",{className:"composer-tokens-hint",children:"Drag to reorder  Tap to edit"}),dn.length?l.jsx("div",{ref:qa,className:`composer-tokens-list ${pt!==null?"is-dragging":""}`,style:{"--composer-elements":dn.length},children:dn.map((f,k)=>{const M=f.type==="alias"&&gl({token:f.text})||f.text,ne=Zr(fi||"",f),ce=(ne==null?void 0:ne.weight)??1,Ue=pt===k,rt=Xt===k&&pt!==null&&pt!==k;return l.jsxs("span",{className:`composer-token composer-token-draggable ${f.type==="alias"?"is-alias":"is-tag"} ${Ue?"is-dragging":""} ${rt?"is-drop-target":""}`,role:"button",tabIndex:0,draggable:!0,title:f.type==="alias"?`Alias: $${f.text}$`:`Tag: ${f.text}`,onDragStart:Ve=>Hf(Ve,k),onDragEnd:Gf,onDragOver:Ve=>Kf(Ve,k),onDragLeave:Yf,onDrop:Ve=>Qf(Ve,k),onTouchStart:Ve=>qf(Ve,k),onTouchMove:Xf,onTouchEnd:Jf,onTouchCancel:Zf,onClick:()=>{pt===null&&hi(f,M)},onKeyDown:Ve=>{Ve.target===Ve.currentTarget&&(Ve.key==="Enter"||Ve.key===" ")&&(Ve.preventDefault(),hi(f,M))},children:[l.jsx("span",{className:"composer-token-order",children:k+1}),l.jsx("span",{className:"composer-token-drag-handle","aria-hidden":"true",children:l.jsx(Da,{size:10})}),l.jsx("span",{className:"composer-token-name",children:M}),f.type==="alias"&&l.jsx("span",{className:"composer-token-type",children:"$"}),Math.abs(ce-1)>1e-6&&l.jsxs("span",{className:"composer-token-weight",children:[rn(ce),""]})]},`${f.type}-${f.text}-${f.start}`)})}):l.jsx("div",{className:"composer-empty",children:"No elements yet."})]})]}):null,Ee==="aliases"?l.jsxs("div",{className:"composer-panel composer-panel-aliases is-visible",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{type:"text",value:Xe,onChange:f=>V(f.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>V(""),disabled:!Xe,children:"Clear"})]}),l.jsx(mt,{value:je,onChange:Le,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:jc.map(f=>({value:f,label:f==="All"?"Category: All":nn(f)}))}),Df.length>2?l.jsx(mt,{value:Be,onChange:Ze,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:Df.map(f=>({value:f,label:f==="All"?"All subcategories":bn(f)}))}):null]}),se?l.jsx("div",{className:"composer-tag-collection-status",role:"status",children:se}):null,l.jsx("div",{className:"composer-alias-list",role:"list",children:x?l.jsx("div",{className:"composer-alias-empty",children:"Loading aliases"}):S?l.jsx("div",{className:"composer-alias-empty",children:"Unable to load aliases."}):Yl.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[Pv.map(f=>l.jsx(hv,{id:f.key,name:f.name||f.token,category:f.category,text:f.text,isSelected:kc.has(String(f.token||"").toLowerCase()),onOpen:()=>zv(f.token,f.displayName),visibilityStyle:Qm},f.key)),I<Yl.length?l.jsxs(X,{variant:"muted",className:"w-full",onClick:()=>K(f=>f+30),children:["Show more (",Yl.length-I," left)"]}):null]})})]}):null,Ee==="tags"?l.jsxs("div",{className:"composer-panel composer-panel-tags is-visible",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{type:"search",value:_e,onChange:f=>Te(f.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>Te(""),disabled:!_e,children:"Clear"})]}),l.jsx(mt,{value:nt,onChange:ft,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...Tv]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(mt,{value:ot,onChange:Or,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"rerun-min-count",children:"Minimum count"}),l.jsx("input",{id:"rerun-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:Ss,onChange:f=>{const k=f.target.value;(k===""||Number(k)>=0)&&Fr(k)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),Dl?l.jsx("div",{className:"composer-tags-error",children:Dl}):null,Br?l.jsx("div",{className:"composer-tag-collection-status",role:"status",children:Br}):null,l.jsx("div",{className:"composer-alias-list composer-tags-grid",role:"list",children:Pn?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):on.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[on.map(f=>l.jsx(gv,{tag:f.tag,category:f.category,count:f.count,isCollected:Sc.has(String(f.tag||"").toLowerCase()),onToggle:_v,visibilityStyle:Qm},`${f.tag}-${f.category}`)),on.length<wn?l.jsx(X,{variant:"muted",className:"w-full",onClick:Rv,disabled:Un,children:Un?"Loading more":`Show more (${wn-on.length} left)`}):null]})})]}):null]}):null,!wr&&!Vn&&!pi?l.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:"No prompt text found for this image."}):null]})}),l.jsx(Ht,{open:Se==="model",onClose:()=>{Xs(),Qe("")},title:"Select model",children:l.jsx("div",{className:"model-picker",children:un?l.jsx("div",{className:"model-picker-loading",children:"Loading models"}):Ys?l.jsx("div",{className:"model-picker-error",children:Ys}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"model-picker-search",children:l.jsx("input",{type:"search",placeholder:"Search models",className:"model-picker-input",value:Re,onChange:f=>Qe(f.target.value),"aria-label":"Search models"})}),He&&!Re?l.jsx("div",{className:"model-picker-folders",children:Ke.map(f=>l.jsx("button",{type:"button",className:`model-picker-folder-chip ${Me===f?"is-active":""}`,onClick:()=>at(f),children:f==="All"?"All":f.split("/").pop()},f))}):null,l.jsxs("div",{className:"model-picker-current",children:[l.jsx("span",{className:"model-picker-current-label",children:"Current"}),l.jsx("span",{className:"model-picker-current-value",children:fe||"Default"})]}),l.jsxs("div",{className:"model-picker-list",children:[Re?null:l.jsxs("button",{type:"button",className:`model-picker-item ${ge?"":"is-selected"}`,onClick:()=>{$e(""),Qe(""),Xs()},children:[l.jsx("span",{className:"model-picker-item-icon",children:""}),l.jsx("span",{className:"model-picker-item-name",children:"Keep current"})]}),Lf.length===0&&Re?l.jsxs("div",{className:"model-picker-empty",children:['No models match "',Re,'"']}):null,Lf.map(f=>l.jsxs("button",{type:"button",className:`model-picker-item ${ge===f.value?"is-selected":""}`,onClick:()=>{$e(f.value),Qe(""),Xs()},children:[l.jsx("span",{className:"model-picker-item-icon",children:""}),l.jsx("span",{className:"model-picker-item-name",children:f.label}),ge===f.value&&l.jsx("span",{className:"model-picker-item-check",children:""})]},f.value))]})]})})}),l.jsx(Ht,{open:Se==="lora",onClose:()=>{Xs(),q("")},title:"Select LoRA",children:l.jsx("div",{className:"model-picker",children:un?l.jsx("div",{className:"model-picker-loading",children:"Loading LoRAs"}):Ys?l.jsx("div",{className:"model-picker-error",children:Ys}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"model-picker-search",children:l.jsx("input",{type:"search",placeholder:"Search LoRAs",className:"model-picker-input",value:G,onChange:f=>q(f.target.value),"aria-label":"Search LoRAs"})}),Jt&&!G?l.jsx("div",{className:"model-picker-folders",children:Pe.map(f=>l.jsx("button",{type:"button",className:`model-picker-folder-chip ${qe===f?"is-active":""}`,onClick:()=>lt(f),children:f==="All"?"All":f.split("/").pop()},f))}):null,l.jsxs("div",{className:"model-picker-current",children:[l.jsx("span",{className:"model-picker-current-label",children:"Current"}),l.jsx("span",{className:"model-picker-current-value",children:xe||"None"})]}),l.jsxs("div",{className:"model-picker-list",children:[G?null:l.jsxs("button",{type:"button",className:`model-picker-item ${ke?"":"is-selected"}`,onClick:()=>{ze(""),q(""),Xs()},children:[l.jsx("span",{className:"model-picker-item-icon",children:""}),l.jsx("span",{className:"model-picker-item-name",children:"Keep current"})]}),Pf.length===0&&G?l.jsxs("div",{className:"model-picker-empty",children:['No LoRAs match "',G,'"']}):null,Pf.map(f=>l.jsxs("button",{type:"button",className:`model-picker-item ${ke===f.value?"is-selected":""}`,onClick:()=>{ze(f.value),q(""),Xs()},children:[l.jsx("span",{className:"model-picker-item-icon",children:""}),l.jsx("span",{className:"model-picker-item-name",children:f.label}),ke===f.value&&l.jsx("span",{className:"model-picker-item-check",children:""})]},f.value))]})]})})}),Bv,Vv]}),document.body)}const Zj=(e="")=>e.startsWith("."),e1=(e="")=>/\.(png|jpe?g|gif|webp|bmp|tif?f)$/i.test(e),t1=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e);function n1(){const e=xf(),t=(J,U="")=>{try{return typeof window<"u"&&localStorage.getItem(J)||U}catch{return U}},n=(J,U)=>{try{typeof window<"u"&&localStorage.setItem(J,U)}catch{}},[r,s]=o.useState(t("galleryPath","")),[a,i]=o.useState([]),[c,u]=o.useState(!1),[d,g]=o.useState(!1),[v,y]=o.useState(""),[x,S]=o.useState(1),[j,N]=o.useState(1),[m,p]=o.useState(()=>{const J=t("galleryPageSize","30"),U=parseInt(J,10);return Number.isFinite(U)?U:30}),[h,w]=o.useState("all"),[E,b]=o.useState(!1),[L,z]=o.useState(""),[$,T]=o.useState(()=>t("galleryRecursive","0")==="1"),[F,Z]=o.useState(0);o.useEffect(()=>{let J=!1;const U=new AbortController;return(async()=>{u(!0),y("");try{typeof performance<"u"&&performance.mark&&performance.mark("cozygen:gallery:fetch")}catch{}try{const ve=await Py(r,x,m,E,$,h,F,{signal:U.signal,includeMeta:!0});if(J)return;ve&&ve.items?(i(ve.items),N(ve.total_pages||1),y("")):(i([]),N(1));try{typeof performance<"u"&&performance.measure&&(performance.mark("cozygen:gallery:ready"),performance.measure("cozygen:gallery:first-paint","cozygen:gallery:fetch","cozygen:gallery:ready"))}catch{}}catch(ve){if((ve==null?void 0:ve.name)==="AbortError")return;console.error("Failed to load gallery",ve),J||y("Unable to load gallery right now."),J||(i([]),N(1))}finally{!J&&!U.signal.aborted&&(u(!1),g(!0))}})(),n("galleryPath",r),n("galleryPageSize",String(m)),()=>{J=!0,U.abort()}},[r,x,m,F,E,$,h]);const ae=o.useMemo(()=>{if(!r)return[];const J=r.replace(/\\/g,"/").split("/").filter(Boolean),U=[];for(let H=0;H<J.length;H++)U.push({name:J[H],path:J.slice(0,H+1).join("/")});return U},[r]),Ce=o.useMemo(()=>a.filter(J=>J.type==="directory").map(J=>({filename:J.filename,subfolder:J.subfolder})),[a]),ye=o.useMemo(()=>{const J=(L||"").trim().toLowerCase();return a.filter(U=>{const H=(U.filename||"").toLowerCase();return!(!E&&Zj(H)||U.type!=="directory"&&(h==="image"&&!e1(H)||h==="video"&&!t1(H))||J&&!H.includes(J))})},[a,E,h,L]),Y=o.useMemo(()=>ye.filter(J=>J.type!=="directory"),[ye]),Se=o.useCallback(()=>{if(!r)return;const J=r.replace(/\\/g,"/").lastIndexOf("/"),U=J===-1?"":r.slice(0,J);s(U),S(1)},[r]),R=o.useCallback(()=>{s(""),S(1)},[]),A=o.useCallback(J=>{s(J||""),S(1)},[]),O=o.useCallback(J=>{s(J),S(1)},[]),_=o.useCallback(J=>{const U=parseInt(String(J),10)||30;p(U),S(1)},[]),B=o.useCallback(J=>{w(J),S(1)},[]),W=o.useCallback(J=>{const U=!!J;T(U),S(1),n("galleryRecursive",U?"1":"0")},[]),ue=o.useCallback(J=>{z(J),S(1)},[]),pe=o.useCallback(()=>{Z(J=>J+1)},[]),Q=o.useRef(null),he=o.useCallback(()=>{Q.current||(Q.current=window.setTimeout(()=>{Q.current=null,pe()},400))},[pe]);return o.useEffect(()=>{const J=()=>pe();return typeof window<"u"&&window.addEventListener&&window.addEventListener("cozygen:queue-finished",J),()=>{typeof window<"u"&&window.removeEventListener&&window.removeEventListener("cozygen:queue-finished",J)}},[pe]),o.useEffect(()=>{if(typeof window>"u"||!e)return;let J=!1,U,H,ve=8e3;const ge=()=>{H&&(clearTimeout(H),H=null)},$e=(ze=8e3)=>{ge(),H=window.setTimeout(()=>{J||(he(),$e(ve))},ze)};return(()=>{if(!("EventSource"in window)){$e();return}const ze=new URLSearchParams({subfolder:r||"",recursive:$?"1":"0",show_hidden:E?"1":"0"});U=new EventSource(`/cozygen/api/gallery/stream?${ze.toString()}`),U.onmessage=()=>{J||he()},U.onerror=()=>{U&&(U.close(),U=null),ve=Math.min(Math.ceil(ve*1.4),2e4),$e()}})(),()=>{J=!0,ge(),Q.current&&(clearTimeout(Q.current),Q.current=null),U&&(U.close(),U=null)}},[r,$,E,he,e]),o.useEffect(()=>{e&&pe()},[e,pe]),{path:r,items:a,loading:c,hasLoaded:d,error:v,page:x,totalPages:j,perPage:m,kind:h,showHidden:E,query:L,recursive:$,crumbs:ae,dirChips:Ce,filtered:ye,mediaItems:Y,setPage:S,setPerPage:_,setShowHidden:b,setQuery:ue,setKind:B,setRecursive:W,goBack:Se,goRoot:R,goToPath:A,selectDir:O,refresh:pe}}function r1(e){const[t,n]=o.useState(!1),[r,s]=o.useState(null);o.useEffect(()=>{if(!e||e.length===0){s(null),n(!1);return}s(x=>x==null?x:x>=e.length?e.length-1:x)},[e]);const a=o.useCallback(x=>{if(!e||!e.length||!x)return;const S=e.indexOf(x);S!==-1&&(s(S),n(!0))},[e]),i=o.useCallback(()=>{n(!1),s(null)},[]),c=o.useCallback(()=>{!e||!e.length||s(x=>x==null||x>=e.length-1?x:x+1)},[e]),u=o.useCallback(()=>{!e||!e.length||s(x=>x==null||x<=0?x:x-1)},[e]),d=r!=null&&r>=0&&e&&r<e.length?e[r]:null,g=(e==null?void 0:e.length)||0,v=r!==null&&r>0,y=r!==null&&r<g-1;return{viewerOpen:t,viewerIndex:r,currentMedia:d,total:g,canPrev:v,canNext:y,open:a,close:i,next:c,prev:u,setViewerOpen:n}}const Jm="cozygen_gallery_view_mode",Zm="cozygen_gallery_feed_autoplay";function s1(e,t){const n=o.useRef(null),[r,s]=o.useState(0),[a,i]=o.useState({width:0,cols:0,top:0,viewport:typeof window<"u"&&window.innerHeight||800}),c=y=>{if(!y||typeof window>"u")return null;let x=y.parentElement;for(;x;){const S=window.getComputedStyle(x);if(S.overflowY==="auto"||S.overflowY==="scroll")return x;x=x.parentElement}return window};o.useEffect(()=>{if(!t)return;const y=n.current;if(!y||typeof window>"u"||typeof ResizeObserver>"u")return;const x=c(y)||window,S=()=>{const p=y.getBoundingClientRect(),h=p.width||y.clientWidth||1,w=Math.max(1,Math.floor(h/160)),E=x===window?window.scrollY||0:x.scrollTop||0,b=x===window?{top:0}:x.getBoundingClientRect(),L=x===window?p.top+(window.scrollY||0):p.top-b.top+E,z=x===window?window.innerHeight||800:x.clientHeight||800;i($=>$.width===h&&$.cols===w&&$.top===L&&$.viewport===z?$:{width:h,cols:w,top:L,viewport:z}),s(E)};S();const j=new ResizeObserver(()=>S());j.observe(y),window.addEventListener("resize",S);let N=!1;const m=()=>{N||(N=!0,window.requestAnimationFrame(()=>{N=!1;const p=x===window?window.scrollY||0:x.scrollTop||0;s(p)}))};return x.addEventListener("scroll",m,{passive:!0}),()=>{j.disconnect(),window.removeEventListener("resize",S),x.removeEventListener("scroll",m)}},[t]);const u=t&&a.cols>0&&e.length>60,{visibleItems:d,topSpacer:g,bottomSpacer:v}=o.useMemo(()=>{if(!u)return{visibleItems:e,topSpacer:0,bottomSpacer:0};const y=a.width/a.cols,x=Math.max(180,Math.ceil(y*1.25)+32),S=Math.ceil(e.length/a.cols),j=Math.max(0,r-a.top),N=Math.max(0,Math.floor(j/x)-2),m=Math.min(S,Math.ceil((j+a.viewport)/x)+2),p=N*a.cols,h=Math.min(e.length,m*a.cols);return{visibleItems:e.slice(p,h),topSpacer:N*x,bottomSpacer:Math.max(0,(S-m)*x)}},[e,a,r,u]);return{containerRef:n,visibleItems:d,topSpacer:g,bottomSpacer:v,virtualized:u}}function l1(){const{path:e,loading:t,hasLoaded:n,page:r,totalPages:s,perPage:a,kind:i,showHidden:c,recursive:u,error:d,crumbs:g,dirChips:v,filtered:y,mediaItems:x,setPage:S,setPerPage:j,setShowHidden:N,setKind:m,setRecursive:p,goBack:h,goRoot:w,goToPath:E,selectDir:b,refresh:L}=n1(),{viewerOpen:z,currentMedia:$,total:T,canPrev:F,canNext:Z,open:ae,close:Ce,next:ye,prev:Y}=r1(x),[Se,R]=o.useState(()=>{if(typeof window>"u")return"grid";const ee=window.localStorage.getItem(Jm);return ee==="feed"||ee==="grid"?ee:"grid"}),[A,O]=o.useState(()=>typeof window>"u"?!1:window.localStorage.getItem(Zm)==="true"),[_,B]=o.useState(""),[W,ue]=o.useState(""),[pe,Q]=o.useState(!1);o.useEffect(()=>{try{window.localStorage.setItem(Jm,Se)}catch{}},[Se]),o.useEffect(()=>{try{window.localStorage.setItem(Zm,A?"true":"false")}catch{}},[A]);const he=o.useCallback(async()=>{try{await FS(),L(),alert("Cache cleared successfully! Thumbnails will be regenerated.")}catch(ee){alert("Failed to clear cache: "+(ee.message||"Unknown error"))}},[L]),J=o.useCallback(async()=>{var et;if(pe)return;const ee=e?`folder "${e}"`:"the gallery root";if(window.confirm(`Delete all media in ${ee}? This cannot be undone.`)){Q(!0);try{await TS({subfolder:e,recursive:!0,confirm:"delete-all"}),L(),alert("Deleted all media in the gallery.")}catch(Oe){if(Oe!=null&&Oe.unauthorized){window.location.hash="#/login";return}const xt=((et=Oe==null?void 0:Oe.payload)==null?void 0:et.error)||(Oe==null?void 0:Oe.message)||"Unable to delete gallery media.";alert(xt)}finally{Q(!1)}}},[pe,e,L]),U=o.useCallback(ee=>(ee==null?void 0:ee.type)==="directory"?`dir:${ee.subfolder||ee.filename}`:`${ee.subfolder||""}|${ee.filename}`,[]),H=o.useCallback(ee=>{if(ee.type==="directory"){b(ee.subfolder);return}ue(""),ae(ee)},[ae,b]),ve=o.useCallback(ee=>{!ee||ee.type==="directory"||(ue(U(ee)),ae(ee))},[U,ae]),ge=o.useCallback(async ee=>{var xt;if(!ee||ee.type==="directory"||!ee.filename)return;const We=ee.filename||"this item";if(!window.confirm(`Delete "${We}"? This cannot be undone.`))return;const Oe=U(ee);B(Oe);try{await Ty({filename:ee.filename,subfolder:ee.subfolder||""}),L()}catch(D){if(D!=null&&D.unauthorized){window.location.hash="#/login";return}const re=((xt=D==null?void 0:D.payload)==null?void 0:xt.error)||(D==null?void 0:D.message)||"Unable to delete this item.";alert(re)}finally{B("")}},[U,L]),$e=Se==="grid",[ke,ze]=o.useState(!1),Me=o.useMemo(()=>[{key:"all",label:"All"},{key:"image",label:"Images"},{key:"video",label:"Videos"}],[]),at=o.useMemo(()=>[{key:"grid",ariaLabel:"Grid view",icon:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[l.jsx("rect",{x:"1",y:"1",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"9",y:"1",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"1",y:"9",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"9",y:"9",width:"6",height:"6",rx:"1"})]})},{key:"feed",ariaLabel:"Feed view",icon:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[l.jsx("rect",{x:"2",y:"1",width:"12",height:"5",rx:"1"}),l.jsx("rect",{x:"2",y:"8",width:"12",height:"5",rx:"1"})]})}],[]);o.useEffect(()=>{try{window.localStorage.setItem("cozygen_gallery_pending","0")}catch{}window.dispatchEvent(new Event("cozygen:gallery-viewed"))},[]);const qe=t&&!n,lt=t&&n,Re=`${y.length} items`,Qe=qe?"Loading":Re,G=!!d,{containerRef:q,visibleItems:le,topSpacer:te,bottomSpacer:de,virtualized:we}=s1(y,$e);return l.jsxs("div",{className:"page-shell gallery-shell",children:[l.jsx("div",{className:"screen-sticky gallery-header",children:l.jsxs("div",{className:"gallery-header-inner",children:[l.jsxs("div",{className:"page-bar gallery-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Gallery"}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx("span",{className:"gallery-status",children:Qe}),l.jsx(vr,{ariaLabel:"View mode",value:Se,onChange:R,layout:"icon",size:"sm",items:at}),l.jsx(X,{size:"xs",className:"mobile-only",onClick:()=>ze(!0),children:"Filters"})]})]}),l.jsx("div",{className:"gallery-nav-row",children:l.jsx(Dj,{subfolder:e,crumbs:g,dirChips:v,onBack:h,onRoot:w,onCrumb:ee=>E(ee),onSelectDir:ee=>b(ee)})}),l.jsxs("div",{className:"gallery-toolbar",children:[l.jsx("div",{className:"gallery-toolbar-left",children:l.jsx(vr,{ariaLabel:"Filter by type",value:i,onChange:m,size:"sm",items:Me})}),l.jsxs("div",{className:"gallery-toolbar-right",children:[l.jsxs("div",{className:"gallery-options",children:[l.jsx(X,{size:"icon",active:u,pressed:u,onClick:()=>p(ee=>!ee),title:u?"Showing subfolders":"This folder only","aria-label":"Toggle subfolders",children:u?l.jsx(Po,{size:16}):l.jsx(jm,{size:16})}),l.jsx(X,{size:"icon",active:c,pressed:c,onClick:()=>N(ee=>!ee),title:c?"Showing hidden":"Hiding hidden","aria-label":"Toggle hidden items",children:c?l.jsx(Nm,{size:16}):l.jsx(Cm,{size:16})}),Se==="feed"&&l.jsx(X,{size:"icon",active:A,pressed:A,onClick:()=>O(ee=>!ee),title:A?"Autoplay on":"Autoplay off","aria-label":"Toggle autoplay",children:A?l.jsx(bm,{size:16}):l.jsx(Em,{size:16})}),l.jsx(X,{size:"icon",onClick:L,title:"Refresh","aria-label":"Refresh gallery",children:l.jsx(Ji,{size:16})})]}),l.jsx(X,{size:"xs",variant:"danger",onClick:J,disabled:pe,"aria-label":"Delete all gallery media",children:pe?"Deleting":"Delete all"}),l.jsx(X,{size:"xs",onClick:he,title:"Clear thumbnail cache","aria-label":"Clear cache",children:"Clear Cache"})]})]}),l.jsx("div",{className:"gallery-pagination",children:l.jsxs("div",{className:"gallery-pagination-controls",children:[l.jsx(X,{size:"icon",variant:"ghost",onClick:()=>S(ee=>Math.max(1,ee-1)),disabled:r<=1||t,"aria-label":"Previous page",children:l.jsx($y,{size:16})}),l.jsxs("span",{className:"gallery-page-indicator",children:[r," / ",s]}),l.jsx(X,{size:"icon",variant:"ghost",onClick:()=>S(ee=>ee<s?ee+1:ee),disabled:r>=s||t,"aria-label":"Next page",children:l.jsx(oc,{size:16})}),l.jsx(mt,{value:a,onChange:ee=>j(parseInt(ee,10)||30),className:"gallery-page-size","aria-label":"Items per page",size:"sm",options:[15,30,60,120]})]})})]})}),qe&&y.length===0?l.jsx("div",{className:"gallery-grid-responsive",children:Array.from({length:8}).map((ee,We)=>l.jsxs("div",{className:"gallery-skeleton-item",children:[l.jsx("div",{className:"gallery-skeleton-thumb skeleton"}),l.jsx("div",{className:"gallery-skeleton-label skeleton skeleton-text"})]},We))}):G&&y.length===0?l.jsxs("div",{className:"gallery-empty",role:"alert",children:[l.jsx("div",{className:"gallery-empty-icon",children:l.jsx(Am,{size:48})}),l.jsx("div",{className:"gallery-empty-title",children:"Gallery unavailable"}),l.jsx("div",{className:"gallery-empty-desc",children:d}),l.jsx(X,{size:"sm",variant:"primary",className:"mt-4",onClick:L,children:"Retry"})]}):y.length===0?l.jsxs("div",{className:"gallery-empty",children:[l.jsx("div",{className:"gallery-empty-icon",children:l.jsx(Am,{size:48})}),l.jsx("div",{className:"gallery-empty-title",children:"No media found"}),l.jsx("div",{className:"gallery-empty-desc",children:i!=="all"?`No ${i}s match your filters. Try selecting "All" or adjusting your search.`:"This folder is empty. Render something new or navigate to a different folder."})]}):$e?l.jsx("div",{className:"w-full overflow-hidden",children:l.jsxs("div",{className:"gallery-grid-responsive",ref:q,children:[we&&te>0?l.jsx("div",{"aria-hidden":!0,style:{gridColumn:"1 / -1",height:`${te}px`}}):null,le.map(ee=>l.jsx(Gm,{item:ee,onSelect:H,onDelete:ge,onRerun:ve,isDeleting:U(ee)===_,variant:"grid",autoPlay:!1},U(ee))),we&&de>0?l.jsx("div",{"aria-hidden":!0,style:{gridColumn:"1 / -1",height:`${de}px`}}):null]})}):l.jsx("div",{className:"flex flex-col gap-6 items-center",children:x.map(ee=>l.jsx("div",{className:"w-full flex justify-center",children:l.jsx(Gm,{item:ee,onSelect:H,onDelete:ge,onRerun:ve,isDeleting:U(ee)===_,variant:"feed",autoPlay:A})},U(ee)))}),l.jsx(Jj,{isOpen:z,media:$,onClose:Ce,onPrev:Y,onNext:ye,onDeleted:L,total:T,canPrev:F,canNext:Z,autoOpenRerunKey:W,onRerunAutoOpen:()=>ue("")}),l.jsx(Ht,{open:ke,onClose:()=>ze(!1),title:"Gallery filters",contentClassName:"gallery-filters-sheet",footer:l.jsx(X,{variant:"primary",className:"w-full",onClick:()=>ze(!1),children:"Done"}),children:l.jsxs("div",{className:"sheet-stack gallery-filters-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Type"}),l.jsx(vr,{ariaLabel:"Filter by type",value:i,onChange:m,size:"sm",items:Me})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Options"}),l.jsxs("div",{className:"gallery-filter-actions",children:[l.jsx(X,{size:"sm",variant:u?"primary":"muted",onClick:()=>p(ee=>!ee),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[u?l.jsx(Po,{size:14}):l.jsx(jm,{size:14}),l.jsx("span",{children:u?"Subfolders":"This folder"})]})}),l.jsx(X,{size:"sm",variant:c?"primary":"muted",onClick:()=>N(ee=>!ee),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[c?l.jsx(Nm,{size:14}):l.jsx(Cm,{size:14}),l.jsx("span",{children:c?"Hidden on":"Hidden off"})]})}),Se==="feed"?l.jsx(X,{size:"sm",variant:A?"primary":"muted",onClick:()=>O(ee=>!ee),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[A?l.jsx(bm,{size:14}):l.jsx(Em,{size:14}),l.jsx("span",{children:A?"Autoplay":"No autoplay"})]})}):null,l.jsx(X,{size:"sm",variant:"ghost",onClick:L,children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[l.jsx(Ji,{size:14}),l.jsx("span",{children:"Refresh"})]})}),l.jsx(X,{size:"sm",variant:"ghost",onClick:he,title:"Clear thumbnail cache",children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[l.jsx(Ji,{size:14}),l.jsx("span",{children:"Clear cache"})]})}),l.jsx(X,{size:"sm",variant:"danger",onClick:J,disabled:pe,"aria-label":"Delete all gallery media",children:pe?"Deleting":"Delete all"})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Page size"}),l.jsxs("div",{className:"gallery-filter-page",children:[l.jsx(mt,{value:a,onChange:ee=>j(parseInt(ee,10)||30),"aria-label":"Items per page",size:"sm",options:[15,30,60,120]}),l.jsxs("div",{className:"sheet-hint",children:[lt?l.jsx("span",{className:"loading-spinner","aria-hidden":"true"}):null,l.jsxs("span",{children:[Qe,"  Page ",r," of ",s]})]}),l.jsxs("div",{className:"gallery-filter-pagination",children:[l.jsx(X,{variant:"muted",className:"w-full",onClick:()=>S(ee=>Math.max(1,ee-1)),disabled:r<=1||t,children:"Prev"}),l.jsx(X,{variant:"muted",className:"w-full",onClick:()=>S(ee=>ee<s?ee+1:ee),disabled:r>=s||t,children:"Next"})]})]})]})]})})]})}const a1=()=>typeof window>"u"?800:window.innerHeight||800,i1=e=>{if(!e||typeof window>"u")return null;let t=e.parentElement;for(;t;){const n=window.getComputedStyle(t);if(n.overflowY==="auto"||n.overflowY==="scroll")return t;t=t.parentElement}return window};function Af({itemCount:e,enabled:t=!0,estimateRowHeight:n=72,overscan:r=6,minItems:s=80}={}){const a=o.useRef(null),i=o.useRef(n),[c,u]=o.useState({top:0,scrollTop:0,viewport:a1(),rowHeight:n});o.useEffect(()=>{if(!t)return;const j=a.current;if(!j||typeof window>"u"||typeof ResizeObserver>"u")return;const N=i1(j)||window,m=()=>{const E=j.getBoundingClientRect(),b=N===window?window.scrollY||0:N.scrollTop||0,L=N===window?{top:0}:N.getBoundingClientRect(),z=N===window?E.top+(window.scrollY||0):E.top-L.top+b,$=N===window?window.innerHeight||800:N.clientHeight||800;u(T=>T.top===z&&T.scrollTop===b&&T.viewport===$&&T.rowHeight===i.current?T:{top:z,scrollTop:b,viewport:$,rowHeight:i.current})};m();const p=new ResizeObserver(()=>m());p.observe(j),window.addEventListener("resize",m);let h=!1;const w=()=>{h||(h=!0,window.requestAnimationFrame(()=>{h=!1;const E=N===window?window.scrollY||0:N.scrollTop||0;u(b=>b.scrollTop===E&&b.rowHeight===i.current?b:{...b,scrollTop:E,rowHeight:i.current})}))};return N.addEventListener("scroll",w,{passive:!0}),()=>{p.disconnect(),window.removeEventListener("resize",m),N.removeEventListener("scroll",w)}},[t]),o.useEffect(()=>{if(!t||typeof window>"u")return;let j=0;const N=()=>{const m=a.current;if(!m)return;const p=m.querySelector('[data-virtual-row="true"]');if(!p)return;const h=p.getBoundingClientRect(),w=Math.max(24,Math.round(h.height||0));w&&Math.abs(w-i.current)>2&&(i.current=w,u(E=>({...E,rowHeight:w})))};return j=window.requestAnimationFrame(N),()=>{j&&window.cancelAnimationFrame(j)}},[t,e,c.scrollTop]);const d=!!(t&&e>s),{startIndex:g,endIndex:v,topSpacer:y,bottomSpacer:x}=o.useMemo(()=>{if(!d)return{startIndex:0,endIndex:e,topSpacer:0,bottomSpacer:0};const j=c.rowHeight||n,N=Math.max(0,c.scrollTop-c.top),m=Math.max(0,Math.floor(N/j)-r),p=Math.min(e,Math.ceil((N+c.viewport)/j)+r);return{startIndex:m,endIndex:p,topSpacer:m*j,bottomSpacer:Math.max(0,(e-p)*j)}},[e,c,r,n,d]),S=v>=e-Math.max(6,r*2);return{containerRef:a,startIndex:g,endIndex:v,topSpacer:y,bottomSpacer:x,virtualized:d,isNearEnd:S}}const o1={contentVisibility:"auto",containIntrinsicSize:"240px 120px"},c1=o.memo(function({tag:t,category:n,count:r,isCollected:s,onSelectTag:a,addToCollection:i,removeFromCollection:c,setStatus:u}){const d=o.useCallback(()=>{const g=String(t||"");if(a){a(g),u(`Added: ${g}`);return}s?(c(g),u(`Removed: ${g}`)):(i(g),u(`Added: ${g}`))},[i,s,a,c,u,t]);return l.jsx("div",{className:"tag-library-row",role:"listitem",style:o1,"data-virtual-row":"true",children:l.jsxs("button",{type:"button",className:`composer-alias-item tag-library-item ${!a&&s?"is-collected":""}`,onClick:d,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name tag-library-name",children:l.jsx("code",{className:"tag-library-code",children:t})}),n?l.jsx("span",{className:"composer-alias-category",children:bn(n)}):null]}),l.jsx("div",{className:"composer-alias-token",children:Number(r||0).toLocaleString()})]})})});function u1(e){var n,r;const t=String(e||"");if(!t)return!1;try{return(r=(n=navigator.clipboard)==null?void 0:n.writeText)==null||r.call(n,t),!0}catch{return!1}}function eh({open:e,onClose:t,onSelectTag:n,initialQuery:r="",title:s="Tag library",contextTitle:a="",contextToken:i="",contextText:c="",contextTagCount:u=null,inline:d=!1}){const[g,v]=o.useState(r||""),[y,x]=o.useState(""),[S,j]=o.useState("count"),[N,m]=o.useState(""),[p,h]=o.useState([]),[w,E]=o.useState([]),[b,L]=o.useState(0),[z,$]=o.useState(0),[T,F]=o.useState(!1),[Z,ae]=o.useState(!1),[Ce,ye]=o.useState(""),[Y,Se]=o.useState(""),R=o.useRef(null),A=o.useRef(null),O=o.useRef(new Map),_=o.useRef(new Map),[B,W]=o.useState([]),[ue,pe]=o.useState(!1),[Q,he]=o.useState(null),[J,U]=o.useState(null),H=o.useRef(null),ve=o.useRef(null),ge=o.useRef(null),$e=o.useRef(null),ke=o.useRef(null),ze=w.length<b,Me=d||e,{containerRef:at,startIndex:qe,endIndex:lt,topSpacer:Re,bottomSpacer:Qe,virtualized:G,isNearEnd:q}=Af({itemCount:w.length,enabled:Me,estimateRowHeight:74,overscan:8,minItems:90}),le=G?w.slice(qe,lt):w,te=o.useMemo(()=>B.join(", "),[B]),de=o.useMemo(()=>new Set(B.map(V=>V.toLowerCase())),[B]),we=o.useMemo(()=>{const V=Number.parseInt(String(N||""),10);return Number.isFinite(V)&&V>0?V:0},[N]),ee=o.useCallback((V,ie,je,Le,Be,Ze)=>[V||"",ie||"",je||"",String(Le||0),String(Be||0),String(Ze||0)].join("::"),[]),We=o.useCallback(()=>{const V=O.current;if(V.size<=50)return;const ie=Array.from(V.entries());ie.sort((je,Le)=>{var Be,Ze;return(((Be=je[1])==null?void 0:Be.ts)||0)-(((Ze=Le[1])==null?void 0:Ze.ts)||0)}),ie.slice(0,Math.max(0,ie.length-50)).forEach(([je])=>V.delete(je))},[]),et=o.useCallback(V=>{const ie=String(V||"").trim();ie&&W(je=>new Set(je.map(Be=>Be.toLowerCase())).has(ie.toLowerCase())?je:[...je,ie])},[]),Oe=o.useCallback(V=>{const ie=String(V||"").trim().toLowerCase();ie&&W(je=>je.filter(Le=>Le.toLowerCase()!==ie))},[]),xt=o.useCallback(()=>{W([]),Se("Cleared collected tags.")},[]),D=o.useCallback(()=>{var ie,je;if(!B.length){Se("No tags to copy.");return}if(u1(te)){Se(`Copied ${B.length} tag${B.length===1?"":"s"}.`);return}const V=ge.current;if(V)try{V.value=te,V.removeAttribute("readonly"),V.select(),V.setSelectionRange(0,te.length);const Le=document.execCommand&&document.execCommand("copy");if(V.setAttribute("readonly","readonly"),(je=(ie=window.getSelection())==null?void 0:ie.removeAllRanges)==null||je.call(ie),Le){Se(`Copied ${B.length} tag${B.length===1?"":"s"}.`);return}}catch{}Se("Copy not available on this browser.")},[B,te]),re=o.useCallback((V,ie)=>{W(je=>{const Le=[...je],[Be]=Le.splice(V,1);return Le.splice(ie,0,Be),Le})},[]);o.useCallback((V,ie)=>{he(ie),$e.current=V.target,V.dataTransfer.effectAllowed="move",V.dataTransfer.setData("text/plain",ie.toString()),requestAnimationFrame(()=>{$e.current&&$e.current.classList.add("is-dragging")})},[]),o.useCallback(()=>{$e.current&&$e.current.classList.remove("is-dragging"),Q!==null&&J!==null&&Q!==J&&re(Q,J),he(null),U(null),$e.current=null},[Q,J,re]),o.useCallback((V,ie)=>{V.preventDefault(),V.dataTransfer.dropEffect="move",U(ie)},[]),o.useCallback(()=>{},[]),o.useCallback((V,ie)=>{const je=V.touches[0];ke.current={idx:ie,startX:je.clientX,startY:je.clientY,moved:!1}},[]),o.useCallback(V=>{if(!ke.current)return;const ie=V.touches[0],je=Math.abs(ie.clientX-ke.current.startX),Le=Math.abs(ie.clientY-ke.current.startY);if(je>10||Le>10){ke.current.moved=!0,he(ke.current.idx),V.preventDefault();const Be=document.querySelectorAll(".tag-collection-chip"),Ze=ie.clientX,I=ie.clientY;for(let K=0;K<Be.length;K++){const se=Be[K].getBoundingClientRect();if(Ze>=se.left&&Ze<=se.right&&I>=se.top&&I<=se.bottom){U(K);break}}}},[]),o.useCallback(()=>{var V;(V=ke.current)!=null&&V.moved&&Q!==null&&J!==null&&Q!==J&&re(Q,J),ke.current=null,he(null),U(null)},[Q,J,re]);const be=o.useCallback(async({nextQuery:V,nextCategory:ie,nextSort:je,nextMinCount:Le}={})=>{var nt;const Be=typeof V=="string"?V:g,Ze=typeof ie=="string"?ie:y,I=typeof je=="string"?je:S,K=typeof Le=="number"?Le:we,se=ee(Be,Ze,I,K,80,0),me=Date.now(),_e=O.current.get(se);if(_e&&me-_e.ts<5*60*1e3){E(_e.items||[]),L(Number(_e.total||0)),$(0),ye(""),Se(""),F(!1);return}const Te=_.current.get(se);if(Te){try{const ft=await Te;E((ft==null?void 0:ft.items)||[]),L(Number((ft==null?void 0:ft.total)||0)),$(0),ye(""),Se("")}catch{}return}F(!0),ye(""),Se(""),$(0),R.current&&R.current.key!==se&&R.current.controller.abort();const ct=new AbortController;R.current={controller:ct,key:se};try{const ft=hr({q:Be,category:Ze,sort:I,minCount:K,limit:80,offset:0},{signal:ct.signal});_.current.set(se,ft);const ot=await ft;O.current.set(se,{items:(ot==null?void 0:ot.items)||[],total:Number((ot==null?void 0:ot.total)||0),ts:Date.now()}),We(),E((ot==null?void 0:ot.items)||[]),L(Number((ot==null?void 0:ot.total)||0))}catch(ft){if((ft==null?void 0:ft.name)==="AbortError")return;console.error("Failed to search tags",ft),ye("Unable to load tags right now."),E([]),L(0)}finally{_.current.delete(se),((nt=R.current)==null?void 0:nt.key)===se&&(R.current=null),F(!1)}},[ee,y,we,g,S,We]),Ee=o.useCallback(async()=>{var I;if(T||Z||!ze)return;const V=z+80,ie=ee(g,y,S,we,80,V),je=Date.now(),Le=O.current.get(ie);if(Le&&je-Le.ts<5*60*1e3){E(K=>[...K,...Le.items||[]]),L(Number(Le.total||0)),$(V),ae(!1);return}const Be=_.current.get(ie);if(Be){try{const K=await Be,se=(K==null?void 0:K.items)||[];E(me=>[...me,...se]),L(Number((K==null?void 0:K.total)||0)),$(V)}catch{}return}ae(!0),ye(""),A.current&&A.current.key!==ie&&A.current.controller.abort();const Ze=new AbortController;A.current={controller:Ze,key:ie};try{const K=hr({q:g,category:y,sort:S,minCount:we,limit:80,offset:V},{signal:Ze.signal});_.current.set(ie,K);const se=await K,me=(se==null?void 0:se.items)||[];O.current.set(ie,{items:me,total:Number((se==null?void 0:se.total)||0),ts:Date.now()}),We(),E(_e=>[..._e,...me]),L(Number((se==null?void 0:se.total)||0)),$(V)}catch(K){if((K==null?void 0:K.name)==="AbortError")return;console.error("Failed to load more tags",K),ye("Unable to load more tags.")}finally{_.current.delete(ie),((I=A.current)==null?void 0:I.key)===ie&&(A.current=null),ae(!1)}},[ee,ze,y,T,Z,we,z,g,S,We]);o.useEffect(()=>{if(!Me)return;ye(""),Se("");let V=!1;return(async()=>{try{const ie=await hf();if(V)return;h(Array.isArray(ie==null?void 0:ie.categories)?ie.categories:[])}catch(ie){console.error("Failed to load tag categories",ie),V||h([])}})(),()=>{V=!0}},[Me]),o.useEffect(()=>{Me&&(v(r||""),x(""),j("count"),m(""),E([]),L(0),$(0),F(!1),ae(!1),ye(""),Se(""),W([]))},[r,Me]),o.useEffect(()=>{if(!Me)return;const V=window.setTimeout(()=>{be()},220);return()=>window.clearTimeout(V)},[y,Me,we,g,be,S]),o.useEffect(()=>()=>{var V,ie,je,Le;R.current&&((ie=(V=R.current.controller)==null?void 0:V.abort)==null||ie.call(V)),A.current&&((Le=(je=A.current.controller)==null?void 0:je.abort)==null||Le.call(je))},[]),o.useEffect(()=>{if(!Me||G)return;const V=H.current;if(!V||typeof IntersectionObserver>"u")return;const ie=new IntersectionObserver(je=>{const Le=je[0];Le!=null&&Le.isIntersecting&&Ee()},{threshold:.1});return ie.observe(V),()=>ie.disconnect()},[Me,Ee]),o.useEffect(()=>{G&&(!ze||T||Z||q&&Ee())},[G,ze,T,Z,q,Ee]);const Fe=o.useMemo(()=>d?null:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(X,{variant:"muted",className:"w-full",onClick:t,children:"Done"}),l.jsx(X,{variant:"ghost",className:"w-full",onClick:()=>be(),disabled:T||Z,children:l.jsxs("span",{className:"inline-flex items-center gap-2",children:[l.jsx(Ji,{size:14}),"Refresh"]})})]}),[d,T,Z,t,be]),tt=!!(n&&(a||i||c)),Ge=Number.isFinite(u)?`${u} tags`:"",Xe=l.jsxs("div",{className:`sheet-stack ${d?"ui-card":""}`,children:[tt?l.jsxs("div",{className:"tag-library-context",children:[l.jsxs("div",{className:"tag-library-context-head",children:[l.jsxs("div",{className:"min-w-0",children:[l.jsx("div",{className:"sheet-label",children:"Adding to alias"}),l.jsx("div",{className:"tag-library-context-title",children:a||"Alias"}),i?l.jsx("div",{className:"tag-library-context-token",children:i}):null]}),l.jsx(X,{size:"xs",variant:"muted",onClick:t,children:"Back"})]}),l.jsx("div",{className:"tag-library-context-preview",children:c||""}),Ge?l.jsx("div",{className:"tag-library-context-meta",children:Ge}):null]}):null,l.jsxs("div",{className:"sheet-section",children:[d?null:l.jsx("div",{className:"sheet-label",children:"Browse"}),l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:ve,type:"search",value:g,onChange:V=>v(V.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>v(""),disabled:!g,children:"Clear"})]}),l.jsx(mt,{value:y,onChange:x,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...p.map(V=>({value:V.key,label:`${bn(V.key)} (${Number(V.actual||V.count||0).toLocaleString()})`}))]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(mt,{value:S,onChange:j,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"tag-library-min-count",children:"Minimum count"}),l.jsx("input",{id:"tag-library-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:N,onChange:V=>{const ie=V.target.value;(ie===""||Number(ie)>=0)&&m(ie)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),Y?l.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:Y}):null,Ce?l.jsx("div",{className:"text-xs text-[#FF8F70]",children:Ce}):null]}),l.jsx("div",{className:"composer-alias-list tag-library-grid",role:"list",ref:at,children:T?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):w.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[G&&Re>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Re}px`}}):null,le.map(V=>l.jsx(c1,{tag:V.tag,category:V.category,count:V.count,isCollected:de.has(String(V.tag||"").toLowerCase()),onSelectTag:n,addToCollection:et,removeFromCollection:Oe,setStatus:Se},`${V.tag}-${V.category}`)),G&&Qe>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Qe}px`}}):null,G?null:l.jsx("div",{ref:H,className:"composer-sentinel"}),Z?l.jsx("div",{className:"composer-alias-empty",children:"Loading more"}):null]})})]});return Me?d?l.jsxs("section",{className:"tag-library-surface",children:[s?l.jsx("div",{className:"sheet-label tag-library-page-title",children:s}):null,Xe,n?null:l.jsxs("div",{className:"tag-collection-bar","aria-live":"polite",children:[l.jsxs("div",{className:"tag-collection-bar-main",children:[l.jsx("div",{className:"tag-collection-bar-title",children:"Tags"}),l.jsx("div",{className:"tag-collection-bar-count","aria-live":"polite",children:B.length===0?"No tags selected":`${B.length} selected`})]}),l.jsx(X,{size:"icon",variant:"ghost",onClick:()=>pe(!0),"aria-label":"Manage collected tags",children:l.jsx(YS,{size:16})}),l.jsx("textarea",{ref:ge,value:te,onChange:V=>{const ie=V.target.value.split(",").map(Be=>Be.trim()).filter(Boolean),je=new Set,Le=[];ie.forEach(Be=>{const Ze=Be.toLowerCase();je.has(Ze)||(je.add(Ze),Le.push(Be))}),W(Le)},className:"sr-only","aria-label":"Collected tags text"})]}),n?null:l.jsx(Ht,{open:ue,onClose:()=>pe(!1),title:"Collected tags",variant:"sheet",shouldCloseOnOverlayClick:!0,children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsxs("div",{className:"sheet-label",children:["Tags (",B.length,")"]}),l.jsxs("div",{className:"tag-collection-codeblock",children:[l.jsx("pre",{className:"tag-collection-pre",children:te||""}),l.jsx(X,{size:"icon",variant:"ghost",className:"absolute top-2 right-2",onClick:D,disabled:B.length===0,"aria-label":"Copy collected tags",children:l.jsx(QS,{size:16})}),l.jsx("textarea",{ref:ge,value:te,readOnly:!0,className:"sr-only","aria-label":"Collected tags text"})]}),B.length?l.jsx("div",{className:"tag-collection-chips",children:B.map((V,ie)=>l.jsxs("span",{className:"ui-chip is-accent is-clickable tag-collection-chip",onClick:()=>Oe(V),role:"button",tabIndex:0,onKeyDown:je=>{je.target===je.currentTarget&&(je.key==="Enter"||je.key===" ")&&(je.preventDefault(),Oe(V))},children:[l.jsx("code",{className:"ui-chip-code",children:V}),l.jsx(X,{size:"mini",variant:"danger","aria-label":`Remove ${V}`,onClick:je=>{je.stopPropagation(),Oe(V)},children:l.jsx(gs,{size:12})})]},`${V}-${ie}`))}):l.jsx("div",{className:"sheet-hint",children:"No tags collected yet."})]}),l.jsxs("div",{className:"sheet-section flex gap-2",children:[l.jsx(X,{variant:"muted",className:"w-full",onClick:()=>pe(!1),children:"Close"}),l.jsx(X,{variant:"ghost",className:"w-full",onClick:xt,disabled:B.length===0,children:"Clear"})]})]})})]}):l.jsx(Ht,{open:e,onClose:t,title:s,variant:"fullscreen",contentClassName:"tag-library-sheet",footer:Fe,shouldCloseOnOverlayClick:!1,children:Xe}):null}function d1({inline:e=!1}){const t=$r(),[n]=pf(),r=n.get("q")||"",s=o.useMemo(()=>r?`Tag Library  ${r}`:"Tag Library",[r]);return e?l.jsx(eh,{inline:!0,initialQuery:r,title:"",onSelectTag:null}):l.jsxs("div",{className:"page-shell page-stack",children:[l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:s}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx(X,{size:"xs",onClick:()=>t("/library?tab=aliases"),children:"Aliases"}),l.jsx(X,{size:"xs",onClick:()=>t("/compose"),children:"Composer"})]})]}),l.jsx(eh,{inline:!0,initialQuery:r,title:"Browse",onSelectTag:null})]})}function yv(e,t=!1){const n=()=>typeof window>"u"||!window.matchMedia?t:window.matchMedia(e).matches,[r,s]=o.useState(n);return o.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const a=window.matchMedia(e),i=()=>s(a.matches);return i(),typeof a.addEventListener=="function"?(a.addEventListener("change",i),()=>a.removeEventListener("change",i)):(a.addListener(i),()=>a.removeListener(i))},[e]),r}const Fo="::",f1=()=>`alias-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,Nr=e=>String(e||"").split(",").map(t=>t.trim()).filter(Boolean),pc=e=>(e||[]).map(t=>String(t||"").trim()).filter(Boolean).join(", "),p1=(e,t)=>{const n=String(t||"").trim();if(!n)return String(e||"");const r=Nr(e);return new Set(r.map(a=>a.toLowerCase())).has(n.toLowerCase())||r.push(n),pc(r)},m1=(e,t)=>{const n=String(t||"").trim().toLowerCase();if(!n)return String(e||"");const r=Nr(e).filter(s=>s.toLowerCase()!==n);return pc(r)},h1=(e,t,n)=>{const r=String(t||"").trim().toLowerCase(),s=String(n||"").trim();if(!r||!s)return String(e||"");const a=Nr(e).map(u=>u.toLowerCase()===r?s:u),i=new Set,c=[];return a.forEach(u=>{const d=String(u||"").trim().toLowerCase();!d||i.has(d)||(i.add(d),c.push(u))}),pc(c)},ru=(e,t={})=>Object.entries(wa(e)).map(([n,r],s)=>{const[a,i]=String(n).includes(Fo)?n.split(Fo):["",n],c=i||n,u=t[n]||t[c]||a||"";return{id:`existing-${s}-${n}`,name:c,text:r,category:u}}),th=e=>{const t={};return e.forEach(n=>{const r=String((n==null?void 0:n.name)||"").trim(),s=typeof(n==null?void 0:n.text)=="string"?n.text.trim():"";if(r&&s){const a=String((n==null?void 0:n.category)||"").trim(),i=a?`${a}${Fo}${r}`:r;t[i]=s}}),t},nh=e=>{const t={};return e.forEach(n=>{const r=String((n==null?void 0:n.name)||"").trim(),s=typeof(n==null?void 0:n.category)=="string"?n.category.trim():"";if(r){const a=s?`${s}${Fo}${r}`:r;t[a]=s}}),t},g1={contentVisibility:"auto",containIntrinsicSize:"240px 120px"};function y1({inline:e=!1}){var Ze;const t=$r(),{aliases:n,aliasCategories:r,categoryList:s,loading:a,saving:i,error:c,persistAliases:u}=pv(),[d,g]=o.useState(()=>ru(n,r)),[v,y]=o.useState(()=>Array.isArray(s)?s:[]),[x,S]=o.useState("All"),[j,N]=o.useState("All"),[m,p]=o.useState("All"),[h,w]=o.useState(""),E=o.useDeferredValue(h),[b,L]=o.useState(""),[z,$]=o.useState(!1),[T,F]=o.useState(!1),[Z,ae]=o.useState({loading:!1,invalid:[],suggestions:{}}),[Ce,ye]=o.useState(!1),[Y,Se]=o.useState(null),[R,A]=o.useState(""),O=o.useRef(null),_=o.useRef(null),[B,W]=o.useState(!1),[ue,pe]=o.useState(""),[Q,he]=o.useState(""),J=yv("(min-width: 1024px)");o.useEffect(()=>{if(B)return;const I=ru(n,r||{});g(I),b&&!I.some(K=>K.id===b)&&(L(""),$(!1))},[r,B]),o.useEffect(()=>{B||Array.isArray(s)&&y(s)},[s,B]),o.useEffect(()=>{if(B)return;const I=ru(n,r||{});g(I),b&&!I.some(K=>K.id===b)&&(L(""),$(!1))},[n,r,b,B]),o.useEffect(()=>{N("All"),p("All")},[x]);const U=o.useMemo(()=>th(d),[d]),H=()=>{const I={id:f1(),name:"",text:"",category:""};g(K=>[...K,I]),L(I.id),A(""),W(!0),$(!0)},ve=(I,K,se)=>{W(!0),g(me=>me.map((_e,Te)=>Te===I?{..._e,[K]:se}:_e))},ge=I=>{W(!0),g(K=>{var me;const se=K.filter((_e,Te)=>Te!==I);return(se.length===0||b===((me=K[I])==null?void 0:me.id))&&(L(""),$(!1)),se})},$e=async()=>{A("");try{const I=new Map;if(d.forEach(se=>{Nr((se==null?void 0:se.text)||"").forEach(_e=>{const Te=String(_e).toLowerCase();Te&&(I.has(Te)||I.set(Te,{tag:_e,rows:[]}),I.get(Te).rows.push(se.id))})}),I.size){const se=Array.from(I.values()).map(me=>me.tag);try{const me=await Xc(se),_e=Array.isArray(me==null?void 0:me.invalid)?me.invalid:[],Te=new Set(_e.map(ct=>String(ct).toLowerCase()));if(Te.size){const ct=d.map(nt=>{const ot=Nr((nt==null?void 0:nt.text)||"").filter(Ss=>Te.has(String(Ss).toLowerCase()));if(!ot.length)return null;const Or=nt.category?`${nt.category}:${nt.name}`:nt.name;return{id:nt.id,token:Or,friendlyName:formatAliasFriendlyName({name:nt.name})||nt.name||"Untitled",category:nt.category||"",invalid:ot}}).filter(Boolean);Se({invalid:_e,invalidLower:Array.from(Te),rows:ct,suggestions:(me==null?void 0:me.suggestions)||{}}),ye(!0),A("Fix invalid tags before saving.");return}}catch(me){console.error("Unable to validate tags",me),A("Unable to validate tags right now.");return}}const K=nh(d);await u({items:U,categories:K,categoryList:v}),W(!1),A("Saved.")}catch{A("Unable to save right now.")}},ke=o.useMemo(()=>{const I=E.trim().toLowerCase(),se=[...d.filter(me=>{const _e=(me.category||"").trim();if(x!=="All"&&Cf(_e)!==x||j===""&&_e||j!=="All"&&j!==""&&_e!==j)return!1;const Te=hl(me.name||"",me.category||"");if(m!=="All"&&Te!==m)return!1;if(!I)return!0;const ct=_e?`${_e}:${me.name}`:me.name;return(me.name||"").toLowerCase().includes(I)||(me.text||"").toLowerCase().includes(I)||(_e||"").toLowerCase().includes(I)||(ct||"").toLowerCase().includes(I)})];return se.sort((me,_e)=>(me.name||"").localeCompare(_e.name||"")),se},[d,x,j,m,E]),{containerRef:ze,startIndex:Me,endIndex:at,topSpacer:qe,bottomSpacer:lt,virtualized:Re}=Af({itemCount:ke.length,enabled:!0,estimateRowHeight:86,overscan:8,minItems:120}),Qe=Re?ke.slice(Me,at):ke,G=ke.find(I=>I.id===b)||d.find(I=>I.id===b)||null,q=G?G.category?`${G.category}:${G.name}`:G.name||"alias":"",le=G&&(formatAliasFriendlyName({name:G.name})||G.name)||"Alias",te=q?`$${q}$`:"$alias$",de=ke.length?ke:d,we=G?de.findIndex(I=>I.id===G.id):-1,ee=we>0?de[we-1]:null,We=we>=0&&we<de.length-1?de[we+1]:null,et=I=>{I&&(L(I.id),$(!0),A(""))},Oe=o.useMemo(()=>{const I=new Set(v||[]);d.forEach(se=>{se.category&&I.add(se.category)});const K=Array.from(I).sort((se,me)=>nn(se).localeCompare(nn(me)));return bf(K,x)},[d,v,x]),xt=o.useMemo(()=>{const I=new Set;return d.forEach(K=>{const se=(K.category||"").trim();if(j===""&&se||j!=="All"&&j!==""&&se!==j)return;const me=hl(K.name||"",K.category||"");me&&I.add(me)}),Array.from(I).sort((K,se)=>K.localeCompare(se))},[d,j]);o.useEffect(()=>{m!=="All"&&(xt.includes(m)||p("All"))},[xt,m]),o.useEffect(()=>{he("")},[b]);const D=o.useMemo(()=>Nr((G==null?void 0:G.text)||""),[G==null?void 0:G.text]),re=o.useMemo(()=>{const I=Array.isArray(Z==null?void 0:Z.invalid)?Z.invalid:[];return new Set(I.map(K=>String(K).toLowerCase()))},[Z]);o.useEffect(()=>{if(!G||!(z||J))return;const I=D,K=[],se=new Set;if(I.forEach(Te=>{const ct=String(Te).toLowerCase();!ct||se.has(ct)||(se.add(ct),K.push(Te))}),!K.length){ae({loading:!1,invalid:[],suggestions:{}});return}let me=!1;const _e=window.setTimeout(async()=>{ae(Te=>({...Te,loading:!0}));try{const Te=await Xc(K);if(me)return;ae({loading:!1,invalid:Array.isArray(Te==null?void 0:Te.invalid)?Te.invalid:[],suggestions:(Te==null?void 0:Te.suggestions)||{}})}catch(Te){console.error("Failed to validate tags",Te),me||ae({loading:!1,invalid:[],suggestions:{}})}},260);return()=>{me=!0,window.clearTimeout(_e)}},[z,J,G,D]);const be=I=>{var se,me;const K=String(I||"");if(!K)return!1;try{return(me=(se=navigator.clipboard)==null?void 0:se.writeText)==null||me.call(se,K),!0}catch{return!1}},Ee=(I="")=>{const K=new URLSearchParams;K.set("tab","tags"),I&&K.set("q",I),t(`/library?${K.toString()}`)},Fe=()=>{var me;if(!G)return;const I=Nr(Q);if(!I.length){A("Enter a tag to add.");return}const K=d.findIndex(_e=>_e.id===G.id);if(K===-1)return;let se=((me=d[K])==null?void 0:me.text)||"";I.forEach(_e=>{se=p1(se,_e)}),ve(K,"text",se),he(""),A(`Added ${I.length} tag${I.length===1?"":"s"}.`)},tt=async()=>{const I=ue.trim();if(!I){A("Enter a category name.");return}const K=Array.from(new Set([...v||[],I]));y(K),pe(""),A("Category added.");const se=th(d),me=nh(d);W(!0);try{await u({items:se,categories:me,categoryList:K}),W(!1),A("Category saved.")}catch{A("Unable to save right now.")}},Ge=o.useCallback(I=>{I&&(L(I.id),$(!0),A(""))},[]),Xe=o.useMemo(()=>{const I=new Map;return d.forEach(K=>{K!=null&&K.id&&I.set(K.id,K)}),I},[d]),V=o.useCallback(I=>{const K=Xe.get(I);K&&Ge(K)},[Ge,Xe]),ie=()=>{J&&L(""),$(!1),A("")};o.useMemo(()=>{const I=d.length,K=ke.length;return a&&I===0?"Loading":I===K?`${I} aliases`:`${K} of ${I} aliases`},[d.length,ke.length,a]),o.useEffect(()=>{const I=K=>{var nt,ft;if(K.defaultPrevented)return;const se=K.target,me=(se==null?void 0:se.tagName)||"",_e=["INPUT","TEXTAREA","SELECT"].includes(me)||(se==null?void 0:se.isContentEditable),Te=String(K.key||"").toLowerCase(),ct=K.metaKey||K.ctrlKey;if(ct&&Te==="s"){K.preventDefault(),B&&!i&&$e();return}if(ct&&Te==="n"){K.preventDefault(),H();return}if(!_e&&Te==="/"){K.preventDefault(),(ft=(nt=_.current)==null?void 0:nt.focus)==null||ft.call(nt);return}Te==="escape"&&z&&!J&&(K.preventDefault(),ie())};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[H,ie,B,z,$e,J,i]);const je=l.jsxs("div",{className:"flex gap-2",children:[l.jsx(X,{variant:"muted",className:"w-full",onClick:ie,children:J?"Clear selection":"Close"}),l.jsx(X,{variant:"primary",className:"w-full",onClick:$e,disabled:i||!B,children:i?"Saving":B?"Save":"Saved"})]}),Le=G?l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"alias-editor-toolbar",children:[l.jsxs("div",{className:"alias-editor-heading",children:[l.jsx("div",{className:"alias-editor-title",children:le}),l.jsx("div",{className:"alias-editor-meta",children:te})]}),l.jsxs("div",{className:"alias-editor-actions",children:[l.jsx(X,{size:"xs",variant:"muted",onClick:()=>et(ee),disabled:!ee,title:"Previous alias",children:"Prev"}),l.jsx(X,{size:"xs",variant:"muted",onClick:()=>et(We),disabled:!We,title:"Next alias",children:"Next"}),l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>{q&&be(te)?A("Token copied."):A("Copy not available on this browser.")},title:"Copy token",children:"Copy token"})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Token"}),l.jsx("div",{className:"composer-token",children:te}),hl(G.name||"",G.category||"")?l.jsxs("div",{className:"sheet-hint",children:["Subcategory: ",bn(hl(G.name||"",G.category||""))]}):null]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Friendly name"}),l.jsx("div",{className:"composer-field",children:le})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Alias name"}),l.jsx("input",{ref:O,type:"text",value:G.name||"",onChange:I=>{const K=d.findIndex(se=>se.id===G.id);K!==-1&&ve(K,"name",I.target.value)},placeholder:"e.g. cherry_fruit",className:"sheet-input ui-control ui-input"})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Category"}),l.jsx(mt,{value:G.category||"",onChange:I=>{const K=d.findIndex(se=>se.id===G.id);K!==-1&&ve(K,"category",I)},size:"sm",searchThreshold:0,options:[{value:"",label:"Uncategorized"},...Oe.filter(Boolean).map(I=>({value:I,label:nn(I)}))]}),l.jsx(X,{size:"xs",variant:"muted",onClick:()=>F(!0),children:"Manage categories"})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Expands to"}),l.jsx("textarea",{value:G.text,onChange:I=>{const K=d.findIndex(se=>se.id===G.id);K!==-1&&ve(K,"text",I.target.value)},placeholder:"Prompt text for this alias",className:"sheet-textarea ui-control ui-textarea is-compact",rows:6}),l.jsxs("div",{className:"tag-quick-add",children:[l.jsx("input",{type:"text",value:Q,onChange:I=>he(I.target.value),onKeyDown:I=>{I.key==="Enter"&&(I.preventDefault(),Fe())},placeholder:"Add tags (comma separated)",className:"ui-control ui-input tag-quick-input","aria-label":"Add tags"}),l.jsx(X,{size:"sm",variant:"primary",onClick:Fe,disabled:!Q.trim(),children:"Add"})]}),l.jsxs("div",{className:"tag-editor-actions",children:[l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>Ee(""),children:l.jsxs("span",{className:"inline-flex items-center gap-2",children:[l.jsx(ac,{size:14}),"Open tag library"]})}),l.jsx(X,{size:"xs",variant:"muted",onClick:()=>{ae(K=>({...K,loading:!0}));const I=Nr(G.text||"");Xc(I).then(K=>{ae({loading:!1,invalid:Array.isArray(K==null?void 0:K.invalid)?K.invalid:[],suggestions:(K==null?void 0:K.suggestions)||{}})}).catch(()=>ae({loading:!1,invalid:[],suggestions:{}}))},disabled:Z.loading,title:"Validate against danbooru_tags.md",children:Z.loading?"Validating":"Validate"})]}),D.length?l.jsx("div",{className:"tag-chip-list","aria-label":"Alias tags",children:D.map(I=>{const K=re.has(String(I).toLowerCase());return l.jsxs("span",{className:`ui-chip ${K?"is-invalid":""}`,children:[l.jsx("code",{className:"ui-chip-code",children:I}),l.jsx(X,{size:"mini",variant:"danger",onClick:()=>{const se=d.findIndex(me=>me.id===G.id);se!==-1&&ve(se,"text",m1(G.text||"",I))},"aria-label":`Remove ${I}`,title:"Remove",children:l.jsx(gs,{size:12})})]},I)})}):l.jsx("div",{className:"sheet-hint",children:"Tip: Use the Tag library to add validated tags quickly."}),!Z.loading&&Array.isArray(Z.invalid)&&Z.invalid.length?l.jsxs("div",{className:"tag-invalid-panel",role:"alert",children:[l.jsxs("div",{className:"tag-invalid-title",children:["Invalid tags (",Z.invalid.length,")"]}),l.jsx("div",{className:"tag-invalid-body",children:Z.invalid.map(I=>{var se;const K=((se=Z==null?void 0:Z.suggestions)==null?void 0:se[I])||[];return l.jsxs("div",{className:"tag-invalid-row",children:[l.jsxs("div",{className:"tag-invalid-tag",children:[l.jsx("code",{children:I}),l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>Ee(I),children:"Find"})]}),Array.isArray(K)&&K.length?l.jsx("div",{className:"tag-invalid-suggestions",children:K.slice(0,6).map(me=>l.jsx(X,{size:"xs",variant:"chip",onClick:()=>{const _e=d.findIndex(Te=>Te.id===G.id);_e!==-1&&ve(_e,"text",h1(G.text||"",I,me))},title:`Replace ${I} with ${me}`,children:me},`${I}-${me}`))}):l.jsx("div",{className:"sheet-hint",children:"No suggestions found for this tag."})]},I)})})]}):null]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx(X,{variant:"danger",onClick:()=>{const I=d.findIndex(K=>K.id===G.id);I!==-1&&(ge(I),$(!1))},children:"Delete alias"}),l.jsx("div",{className:"sheet-hint",children:"Deleting removes it from your library. Use Save changes to persist."})]})]}):l.jsx("div",{className:"alias-editor-empty",children:"Select an alias to edit, or create a new one."}),Be=e?"page-stack alias-page":"page-shell page-stack alias-page";return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Be,children:[e?null:l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Aliases"}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx(X,{size:"xs",onClick:()=>Ee(h||""),title:"Browse danbooru tags",children:"Tags"}),l.jsx(X,{size:"xs",variant:"primary",onClick:H,children:"Add"})]})]}),l.jsx("div",{className:"library-toolbar screen-sticky",children:l.jsxs("div",{className:"library-toolbar-inner",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsx(Ef,{activeTopic:x,onTopicChange:S}),l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:_,type:"search",value:h,onChange:I=>w(I.target.value),className:"composer-search ui-control ui-input",placeholder:"Search aliases","aria-label":"Search aliases"}),l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>w(""),disabled:!h,children:"Clear"})]}),l.jsx(mt,{wrapperClassName:"composer-subcategory-select",value:j,onChange:N,"aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"All",label:"Category: All"},{value:"",label:"Uncategorized"},...Oe.filter(Boolean).map(I=>({value:I,label:nn(I)}))]}),l.jsx(mt,{wrapperClassName:"composer-subcategory-select",value:m,onChange:p,"aria-label":"Filter by subcategory",size:"sm",searchThreshold:0,options:[{value:"All",label:"Subcategory: All"},...xt.map(I=>({value:I,label:bn(I)}))]}),e?l.jsx(X,{size:"sm",variant:"primary",onClick:H,children:"Add alias"}):null,B?l.jsx(X,{size:"sm",variant:"primary",onClick:$e,disabled:i,children:i?"Saving":"Save changes"}):null]}),c?l.jsx("div",{className:"library-toolbar-status is-error",children:"Could not load aliases. Try again later."}):null,R?l.jsx("div",{className:"library-toolbar-status",children:R}):null]})}),l.jsxs("div",{className:"alias-layout",children:[l.jsx("div",{className:"alias-list",children:d.length===0&&!a?l.jsx("section",{className:"ui-panel text-center py-16",children:l.jsx("p",{className:"text-base text-[rgba(159,178,215,0.8)]",children:"No aliases yet. Add your first one."})}):l.jsxs("div",{className:"composer-alias-list",role:"list",ref:ze,children:[ke.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases match your filters."}):null,Re&&qe>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${qe}px`}}):null,Qe.map(I=>l.jsx(hv,{id:I.id,name:I.name,category:(I.category||"").trim(),text:I.text||"",isSelected:b===I.id,onOpen:V,visibilityStyle:g1},I.id)),Re&&lt>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${lt}px`}}):null]})}),l.jsx("aside",{className:"alias-editor-panel",children:l.jsxs("div",{className:"alias-editor-card ui-panel",children:[Le,G?l.jsx("div",{className:"alias-editor-footer",children:je}):null]})})]})]}),l.jsx(Ht,{open:z&&!!G&&!J,onClose:ie,title:"Alias",variant:"fullscreen",footer:je,children:Le}),l.jsx(Ht,{open:T,onClose:()=>{F(!1),pe(""),A("")},title:"Categories",variant:"sheet",footer:l.jsx("div",{className:"sheet-hint",children:"Categories help you organize aliases and improve the Insert alias picker."}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Add category"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:ue,onChange:I=>pe(I.target.value),placeholder:"e.g. styles",className:"sheet-input ui-control ui-input"}),l.jsx(X,{size:"sm",variant:"primary",onClick:tt,children:"Add"})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Existing"}),Oe.length===0?l.jsx("div",{className:"sheet-hint",children:"No categories yet."}):l.jsx(mt,{value:"",onChange:I=>{I&&(N(I),F(!1))},size:"sm",searchThreshold:0,placeholder:"Select a category",options:Oe.filter(Boolean).map(I=>({value:I,label:nn(I)}))})]})]})}),l.jsx(Ht,{open:Ce,onClose:()=>ye(!1),title:"Fix invalid tags",variant:"fullscreen",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(X,{variant:"muted",className:"w-full",onClick:()=>ye(!1),children:"Close"}),l.jsx(X,{variant:"primary",className:"w-full",onClick:()=>{const I=new Set(((Y==null?void 0:Y.invalidLower)||[]).map(K=>String(K).toLowerCase()));if(!I.size){ye(!1);return}g(K=>K.map(se=>{const _e=Nr((se==null?void 0:se.text)||"").filter(ct=>!I.has(String(ct).toLowerCase())),Te=pc(_e);return Te===((se==null?void 0:se.text)||"")?se:{...se,text:Te}})),W(!0),ye(!1),A("Removed invalid tags. Review and save again.")},children:"Remove invalid tags"})]}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsx("div",{className:"sheet-section",children:l.jsxs("div",{className:"sheet-hint",children:["These aliases contain tags not found in ",l.jsx("code",{className:"font-mono",children:"danbooru_tags.md"}),". Fix them before saving."]})}),(Ze=Y==null?void 0:Y.rows)!=null&&Ze.length?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Aliases with issues"}),l.jsx("div",{className:"composer-alias-list",role:"list",children:Y.rows.map(I=>l.jsxs("button",{type:"button",role:"listitem",className:"composer-alias-item",onClick:()=>{L(I.id),$(!0),ye(!1)},children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:I.friendlyName}),I.category?l.jsx("span",{className:"composer-alias-category",children:nn(I.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",I.token,"$"]}),l.jsx("div",{className:"tag-invalid-inline",children:I.invalid.map(K=>l.jsx("span",{className:"ui-chip is-invalid",children:l.jsx("code",{className:"ui-chip-code",children:K})},`${I.id}-${K}`))})]},I.id))})]}):null]})})]})}const vv="cozygen_library_tab",v1=new Set(["tags","aliases"]),xv=e=>v1.has(e)?e:"",x1=()=>{if(typeof window>"u")return"";try{return xv(window.localStorage.getItem(vv)||"")}catch{return""}};function w1(){const[e,t]=pf(),n=xv(e.get("tab")),[r,s]=o.useState(()=>{const i=x1();return n||i||"tags"}),a=o.useMemo(()=>[{key:"tags",label:"Tags"},{key:"aliases",label:"Aliases"}],[]);return o.useEffect(()=>{n&&n!==r&&s(n)},[r,n]),o.useEffect(()=>{try{typeof window<"u"&&window.localStorage.setItem(vv,r)}catch{}if(n!==r){const i=new URLSearchParams(e);i.set("tab",r),t(i,{replace:!0})}},[r,n,e,t]),l.jsxs("div",{className:"page-shell page-stack",children:[l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Library"}),l.jsx("div",{className:"page-bar-actions",children:l.jsx(vr,{ariaLabel:"Library tabs",value:r,onChange:s,items:a,size:"sm",layout:"auto"})})]}),r==="tags"?l.jsx(d1,{inline:!0}):null,r==="aliases"?l.jsx(y1,{inline:!0}):null]})}function rh({className:e="",style:t,label:n,status:r,applyLabel:s,onClear:a,onApply:i,disabled:c=!1}){return l.jsxs("div",{className:`composer-tag-collection-bar ${e}`.trim(),style:t,children:[l.jsxs("div",{children:[l.jsx("div",{className:"composer-tag-collection-label",children:n}),r?l.jsx("div",{className:"composer-tag-collection-status",children:r}):null]}),l.jsxs("div",{className:"composer-tag-collection-actions",children:[l.jsx(X,{size:"xs",variant:"muted",onClick:a,disabled:c,children:"Clear"}),l.jsx(X,{size:"xs",variant:"primary",onClick:i,disabled:c,children:s})]})]})}const sh={contentVisibility:"auto",containIntrinsicSize:"260px 140px"};function S1({open:e=!1,onClose:t,value:n="",onChange:r,aliasOptions:s=[],aliasCatalog:a=[],fieldLabel:i="Prompt",variant:c="sheet"}){var ai,ii;const u=o.useRef(null),d=o.useRef(null),g=o.useRef(null),v=o.useRef(null),[y,x]=o.useState(n),[S,j]=o.useState(""),N=o.useDeferredValue(S),[m,p]=o.useState("All"),[h,w]=o.useState("All"),[E,b]=o.useState("All"),[L,z]=o.useState(30),[$,T]=o.useState("compose"),F=c==="page",Z=F||e,ae=yv("(max-width: 640px)",!1),[Ce,ye]=o.useState(!ae),[Y,Se]=o.useState(null),[R,A]=o.useState(null),[O,_]=o.useState(null),B=o.useRef(null),W=o.useRef(null),[ue,pe]=o.useState(!1),[Q,he]=o.useState(null),[J,U]=o.useState(""),H=o.useDeferredValue(J),[ve,ge]=o.useState("All"),[$e,ke]=o.useState("All"),[ze,Me]=o.useState([]),[at,qe]=o.useState(0),[lt,Re]=o.useState(0),[Qe,G]=o.useState(!1),[q,le]=o.useState(!1),te=o.useRef(null),de=o.useRef(null),we=o.useRef(null),ee=o.useRef(null),[We,et]=o.useState(""),[Oe,xt]=o.useState(""),[D,re]=o.useState("count"),[be,Ee]=o.useState(""),[Fe,tt]=o.useState([]),[Ge,Xe]=o.useState([]),[V,ie]=o.useState(0),[je,Le]=o.useState(0),[Be,Ze]=o.useState(!1),[I,K]=o.useState(!1),[se,me]=o.useState(""),_e=o.useRef(null),Te=o.useRef(null),ct=o.useRef(new Map),nt=o.useRef(new Map),ft=o.useMemo(()=>{const C=Number.parseInt(String(be||""),10);return Number.isFinite(C)&&C>0?C:0},[be]),[ot,Or]=o.useState([]),[Ss,Fr]=o.useState(""),[vn,ks]=o.useState([]),[on,xn]=o.useState(""),wn=o.useMemo(()=>{if(!y)return{text:"",parts:[]};const C=new Map;if((a||[]).forEach(Ke=>{if(!Ke)return;const Pe=String(Ke.token||"").trim().toLowerCase(),He=typeof Ke.text=="string"?Ke.text.trim():"";!Pe||!He||C.set(Pe,He)}),!C.size||!y.includes("$"))return{text:y,parts:[{text:y,isAlias:!1}]};const P=[],fe=/\$([a-z0-9_:-]+)\$/gi;let xe=0,De;for(;(De=fe.exec(y))!==null;){const Ke=De.index;Ke>xe&&P.push({text:y.slice(xe,Ke),isAlias:!1});const Pe=String(De[1]||"").toLowerCase(),He=C.get(Pe);typeof He=="string"?P.push({text:He,isAlias:!0}):P.push({text:De[0],isAlias:!1}),xe=fe.lastIndex}return xe<y.length&&P.push({text:y.slice(xe),isAlias:!1}),{text:P.map(Ke=>Ke.text).join(""),parts:P}},[a,y]);o.useEffect(()=>{e&&(x(n),T("compose"),j(""),w("All"),b("All"),z(30),Se(null),A(null),_(null),pe(!1),he(null),U(""),ge("All"),ke("All"),Me([]),qe(0),Re(0),G(!1),le(!1),Xt(""),et(""),xt(""),re("count"),Ee(""),Xe([]),ie(0),Le(0),Ze(!1),K(!1),me(""))},[e,n]),o.useEffect(()=>{ye(!ae)},[ae]),o.useEffect(()=>{if(Y===null||typeof document>"u")return;const C=document.querySelector("main.app-content"),P={htmlOverscroll:document.documentElement.style.overscrollBehavior,bodyOverscroll:document.body.style.overscrollBehavior,bodyOverflow:document.body.style.overflow,scrollOverflow:C==null?void 0:C.style.overflow,scrollTouch:C==null?void 0:C.style.touchAction,scrollOverscroll:C==null?void 0:C.style.overscrollBehavior};return document.documentElement.style.overscrollBehavior="none",document.body.style.overscrollBehavior="none",document.body.style.overflow="hidden",C&&(C.style.overflow="hidden",C.style.touchAction="none",C.style.overscrollBehavior="none"),()=>{document.documentElement.style.overscrollBehavior=P.htmlOverscroll||"",document.body.style.overscrollBehavior=P.bodyOverscroll||"",document.body.style.overflow=P.bodyOverflow||"",C&&(C.style.overflow=P.scrollOverflow||"",C.style.touchAction=P.scrollTouch||"",C.style.overscrollBehavior=P.scrollOverscroll||"")}},[Y]);const zt=o.useMemo(()=>(Array.isArray(a)?a.filter(C=>C&&C.name):[]).map(C=>({...C,...yf(C)})),[a]),nr=o.useMemo(()=>{const C=new Map;return zt.forEach(P=>{P!=null&&P.token&&C.set(String(P.token).toLowerCase(),P)}),C},[zt]),rr=o.useMemo(()=>{const C=new Set(["All"]);zt.forEach(fe=>{fe.category&&C.add(fe.category)});const P=Array.from(C).sort((fe,xe)=>nn(fe).localeCompare(nn(xe)));return bf(P,m)},[zt,m]),Pn=o.useMemo(()=>{const C=new Set(["All"]);return zt.forEach(P=>{(!h||h==="All"||P.category===h)&&P.subcategory&&C.add(P.subcategory)}),Array.from(C).sort((P,fe)=>P.localeCompare(fe))},[zt,h]),Dr=o.useMemo(()=>["All",...rr.filter(C=>C!=="All")],[rr]),Un=o.useMemo(()=>["All",...Pn.filter(C=>C!=="All")],[Pn]),cn=o.useMemo(()=>{const C=N.trim().toLowerCase();return zt.filter(P=>{var fe,xe,De,Ie;return m!=="All"&&Cf(P.category)!==m||h!=="All"&&(P.category||"")!==h||E!=="All"&&(P.subcategory||"other")!==E?!1:C?((fe=P.token)==null?void 0:fe.toLowerCase().includes(C))||((xe=P.text)==null?void 0:xe.toLowerCase().includes(C))||((De=P.name)==null?void 0:De.toLowerCase().includes(C))||((Ie=P.displayName)==null?void 0:Ie.toLowerCase().includes(C)):!0}).sort((P,fe)=>{const xe=(P.subcategory||"").toLowerCase(),De=(fe.subcategory||"").toLowerCase();if(xe!==De)return xe.localeCompare(De);const Ie=(P.displayName||P.name||P.token||"").toLowerCase(),Ke=(fe.displayName||fe.name||fe.token||"").toLowerCase();return Ie.localeCompare(Ke)})},[zt,m,h,E,N]),Dl=o.useMemo(()=>cn.slice(0,L),[cn,L]);o.useEffect(()=>{z(30)},[m,h,E,S,zt]),o.useEffect(()=>{b("All")},[h]),o.useEffect(()=>{w("All"),b("All")},[m]),o.useEffect(()=>{const C=g.current;if(!C)return;const P=new IntersectionObserver(fe=>{fe[0].isIntersecting&&L<cn.length&&z(De=>Math.min(De+20,cn.length))},{threshold:.1});return P.observe(C),()=>P.disconnect()},[L,cn.length]);const Ft=o.useMemo(()=>typeof y!="string"?[]:Wy(y),[y]);o.useEffect(()=>{if(!e||$!=="tags"||Fe.length>0)return;let C=!1;return(async()=>{try{const P=await hf();if(C)return;tt(Array.isArray(P==null?void 0:P.categories)?P.categories:[])}catch(P){console.error("Failed to load tag categories",P),C||tt([])}})(),()=>{C=!0}},[e,$,Fe.length]);const Br=o.useCallback(async()=>{if(Qe)return;te.current&&te.current.abort();const C=new AbortController;te.current=C;try{G(!0);const P=await hr({q:H,category:"",sort:"count",minCount:"",limit:100,offset:0},{signal:C.signal}),fe=Array.isArray(P==null?void 0:P.items)?P.items:[];Me(fe),qe(Number((P==null?void 0:P.total)||0)),Re(fe.length)}catch(P){if((P==null?void 0:P.name)==="AbortError")return;Me([]),qe(0),Re(0)}finally{G(!1)}},[H,Qe]),js=o.useCallback(async()=>{if(Qe||q||ze.length>=at)return;de.current&&de.current.abort();const C=new AbortController;de.current=C;try{le(!0);const P=await hr({q:H,category:"",sort:"count",minCount:"",limit:100,offset:lt},{signal:C.signal}),fe=Array.isArray(P==null?void 0:P.items)?P.items:[];Me(xe=>[...xe,...fe]),qe(Number((P==null?void 0:P.total)||0)),Re(lt+fe.length)}catch(P){if((P==null?void 0:P.name)==="AbortError")return}finally{le(!1)}},[H,ze.length,Qe,q,lt,at]),Dt=o.useCallback((C,P,fe,xe,De,Ie)=>[C||"",P||"",fe||"",String(xe||0),String(De||0),String(Ie||0)].join("::"),[]),Lt=o.useCallback(()=>{const C=ct.current;if(C.size<=50)return;const P=Array.from(C.entries());P.sort((fe,xe)=>{var De,Ie;return(((De=fe[1])==null?void 0:De.ts)||0)-(((Ie=xe[1])==null?void 0:Ie.ts)||0)}),P.slice(0,Math.max(0,P.length-50)).forEach(([fe])=>C.delete(fe))},[]),Ks=o.useCallback(async({nextQuery:C,nextCategory:P,nextSort:fe,nextMinCount:xe}={})=>{var As;const De=typeof C=="string"?C:We,Ie=typeof P=="string"?P:Oe,Ke=typeof fe=="string"?fe:D,Pe=typeof xe=="number"?xe:ft,He=Dt(De,Ie,Ke,Pe,80,0),Jt=Date.now(),Kn=ct.current.get(He);if(Kn&&Jt-Kn.ts<5*60*1e3){Xe(Kn.items||[]),ie(Number(Kn.total||0)),Le(0),me(""),Ze(!1);return}const Kl=nt.current.get(He);if(Kl){try{const Bt=await Kl;Xe((Bt==null?void 0:Bt.items)||[]),ie(Number((Bt==null?void 0:Bt.total)||0)),Le(0),me("")}catch{}return}Ze(!0),me(""),Le(0),_e.current&&_e.current.key!==He&&_e.current.controller.abort();const Es=new AbortController;_e.current={controller:Es,key:He};try{const Bt=hr({q:De,category:Ie,sort:Ke,minCount:Pe,limit:80,offset:0},{signal:Es.signal});nt.current.set(He,Bt);const Zt=await Bt;ct.current.set(He,{items:(Zt==null?void 0:Zt.items)||[],total:Number((Zt==null?void 0:Zt.total)||0),ts:Date.now()}),Lt(),Xe((Zt==null?void 0:Zt.items)||[]),ie(Number((Zt==null?void 0:Zt.total)||0))}catch(Bt){if((Bt==null?void 0:Bt.name)==="AbortError")return;console.error("Failed to search tags",Bt),me("Unable to load tags right now."),Xe([]),ie(0)}finally{nt.current.delete(He),((As=_e.current)==null?void 0:As.key)===He&&(_e.current=null),Ze(!1)}},[Dt,Oe,ft,We,D,Lt]),Tn=o.useCallback(async()=>{var Ke;if(Be||I||Ge.length>=V)return;const C=je+80,P=Dt(We,Oe,D,ft,80,C),fe=Date.now(),xe=ct.current.get(P);if(xe&&fe-xe.ts<5*60*1e3){Xe(Pe=>[...Pe,...xe.items||[]]),ie(Number(xe.total||0)),Le(C),K(!1);return}const De=nt.current.get(P);if(De){try{const Pe=await De,He=(Pe==null?void 0:Pe.items)||[];Xe(Jt=>[...Jt,...He]),ie(Number((Pe==null?void 0:Pe.total)||0)),Le(C)}catch{}return}K(!0),me(""),Te.current&&Te.current.key!==P&&Te.current.controller.abort();const Ie=new AbortController;Te.current={controller:Ie,key:P};try{const Pe=hr({q:We,category:Oe,sort:D,minCount:ft,limit:80,offset:C},{signal:Ie.signal});nt.current.set(P,Pe);const He=await Pe,Jt=(He==null?void 0:He.items)||[];ct.current.set(P,{items:Jt,total:Number((He==null?void 0:He.total)||0),ts:Date.now()}),Lt(),Xe(Kn=>[...Kn,...Jt]),ie(Number((He==null?void 0:He.total)||0)),Le(C)}catch(Pe){if((Pe==null?void 0:Pe.name)==="AbortError")return;console.error("Failed to load more tags",Pe),me("Unable to load more tags.")}finally{nt.current.delete(P),((Ke=Te.current)==null?void 0:Ke.key)===P&&(Te.current=null),K(!1)}},[Dt,Oe,Be,I,ft,je,We,D,Ge.length,V,Lt]);o.useEffect(()=>{if(!e||$!=="tags")return;const C=window.setTimeout(()=>{Ks()},220);return()=>window.clearTimeout(C)},[e,$,We,Oe,D,ft,Ks]),o.useEffect(()=>()=>{var C,P,fe,xe,De,Ie,Ke,Pe;_e.current&&((P=(C=_e.current.controller)==null?void 0:C.abort)==null||P.call(C)),Te.current&&((xe=(fe=Te.current.controller)==null?void 0:fe.abort)==null||xe.call(fe)),te.current&&((Ie=(De=te.current).abort)==null||Ie.call(De)),de.current&&((Pe=(Ke=de.current).abort)==null||Pe.call(Ke))},[]),o.useEffect(()=>{if(!ue)return;const C=window.setTimeout(()=>{Br()},250);return()=>window.clearTimeout(C)},[ue,H,Br]);const{containerRef:it,startIndex:sr,endIndex:Bl,topSpacer:Ns,bottomSpacer:Gs,virtualized:Sn,isNearEnd:Ur}=Af({itemCount:Ge.length,enabled:e&&$==="tags",estimateRowHeight:70,overscan:8,minItems:90}),Vr=o.useMemo(()=>String(We||"").trim().toLowerCase(),[We]),Wr=o.useMemo(()=>{if(!Vr)return Ge;const C=[],P=[];return Ge.forEach(fe=>{String((fe==null?void 0:fe.tag)||"").toLowerCase()===Vr?C.push(fe):P.push(fe)}),C.length?[...C,...P]:Ge},[Ge,Vr]),Qa=Sn?Wr.slice(sr,Bl):Wr;o.useEffect(()=>{if(!e||$!=="tags"||Sn)return;const C=ee.current;if(!C||typeof IntersectionObserver>"u")return;const P=new IntersectionObserver(fe=>{const xe=fe[0];xe!=null&&xe.isIntersecting&&Tn()},{threshold:.1});return P.observe(C),()=>P.disconnect()},[e,$,Sn,Tn]),o.useEffect(()=>{Sn&&(Be||I||Ge.length>=V||Ur&&Tn())},[Sn,Be,I,Ge.length,V,Ur,Tn]);const Rn=o.useCallback(C=>{x(P=>{const xe=typeof C=="function"?C(typeof P=="string"?P:""):String(C||"");return c==="page"&&(r==null||r(xe)),xe})},[r,c]),pt=o.useCallback(C=>{const P=String(C||"").trim();if(P&&(Rn(fe=>{const xe=fe.length,De=fe.length,Ie=fe.slice(0,xe),Ke=fe.slice(De),Pe=Ie.match(/[^\s]$/),He=Ke.match(/^[^\s]/),Jt=Pe&&Pe[0]!==","?", ":"",Kn=He&&He[0]!==","?", ":"";return Ie+Jt+P+Kn+Ke}),u.current))try{u.current.blur()}catch{}},[Rn]),[zn,Xt]=o.useState(""),kn=o.useCallback(()=>{const C=String(zn||"").trim();if(!C)return;const fe=C.split(",").map(xe=>xe.trim()).filter(Boolean).join(", ");fe&&(pt(fe),Xt(""),T("compose"))},[zn,pt]),qa=o.useCallback(()=>{Or([]),Fr("Cleared collected tags.")},[]),wt=o.useCallback(()=>{if(!ot.length){Fr("No tags to apply.");return}pt(ot.join(", ")),Fr(`Applied ${ot.length} tag${ot.length===1?"":"s"}.`),Or([]),T("compose")},[ot,pt]),wr=o.useCallback(C=>{const P=String(C||"").trim();P&&Or(fe=>{const xe=P.toLowerCase();return fe.some(Ie=>Ie.toLowerCase()===xe)?(Fr(`Removed: ${P}`),fe.filter(Ie=>Ie.toLowerCase()!==xe)):(Fr(`Selected: ${P}`),[...fe,P])})},[]),Ul=o.useCallback(C=>{const P=String(C||"").trim();P&&ks(fe=>{const xe=P.toLowerCase();return fe.some(Ie=>Ie.toLowerCase()===xe)?(xn(`Removed: ${P}`),fe.filter(Ie=>Ie.toLowerCase()!==xe)):(xn(`Selected: ${P}`),[...fe,P])})},[]),Vn=o.useCallback(()=>{ks([]),xn("Cleared selected aliases.")},[]),Vl=o.useCallback(()=>{if(!vn.length){xn("No aliases to apply.");return}const C=vn.map(P=>`$${P}$`).join(", ");pt(C),xn(`Applied ${vn.length} alias${vn.length===1?"":"es"}.`),ks([]),T("compose")},[vn,pt]),un=$==="tags"?{kind:"tag",count:ot.length,status:Ss,onClear:qa,onApply:wt}:$==="aliases"?{kind:"alias",count:vn.length,status:on,onClear:Vn,onApply:Vl}:null,lr=(un==null?void 0:un.count)||0,Ys=un?`${lr} ${un.kind==="alias"?lr===1?"alias":"aliases":lr===1?un.kind:`${un.kind}s`} selected`:"",Wl=!F&&lr>0,Hr=F&&lr>0,Xa=Hr?{"--composer-selection-offset":"var(--bottom-nav-height, 64px)"}:void 0,Sr=un?{label:Ys,status:un.status,onClear:un.onClear,onApply:un.onApply,applyLabel:"Insert",disabled:!lr}:null,Ja=Wl&&Sr?l.jsx(rh,{...Sr,className:"is-footer"}):null,Kr=Hr&&Sr?l.jsx(rh,{...Sr,className:"is-floating",style:Xa}):null,Wn=C=>{Rn(P=>Gy(P||"",C))},Qs=C=>{if(!C)return;let P=C.text;if(C.type==="alias"){const xe=nr.get(C.text.toLowerCase());P=(xe==null?void 0:xe.displayName)||C.text}if(C.type==="alias"){const xe=nr.get(C.text.toLowerCase());ge((xe==null?void 0:xe.category)||"All"),ke((xe==null?void 0:xe.subcategory)||"All")}else ge("All"),ke("All");const fe=Zr(y||"",C);he({element:C,displayName:P,weight:(fe==null?void 0:fe.weight)??1}),U(""),ge("All"),pe(!0)},Cs=o.useCallback((C,P)=>{C===P||C===null||P===null||Ft!=null&&Ft.length&&Rn(fe=>Ky(fe||"",Ft,C,P))},[Ft,Rn]),Za=o.useCallback((C,P)=>{Se(P),B.current=C.target,C.dataTransfer.effectAllowed="move",C.dataTransfer.setData("text/plain",P.toString()),requestAnimationFrame(()=>{B.current&&B.current.classList.add("is-dragging")})},[]),ei=o.useCallback(()=>{B.current&&B.current.classList.remove("is-dragging"),Y!==null&&R!==null&&Y!==R&&Cs(Y,R),Se(null),A(null),B.current=null},[Y,R,Cs]),mc=o.useCallback((C,P)=>{C.preventDefault(),C.dataTransfer.dropEffect="move",P!==R&&A(P)},[R]),ti=o.useCallback(()=>{},[]),hc=o.useCallback((C,P)=>{var Ie,Ke;if((Ke=(Ie=C.target)==null?void 0:Ie.closest)==null?void 0:Ke.call(Ie,"button, a, input, select, textarea, .composer-token-shift"))return;const xe=C.touches[0],De=window.setTimeout(()=>{W.current&&(W.current.active=!0,Se(P),A(P))},240);W.current={idx:P,startX:xe.clientX,startY:xe.clientY,active:!1,timer:De}},[]),$t=o.useCallback(C=>{if(!W.current)return;const P=C.touches[0],fe=Math.abs(P.clientX-W.current.startX),xe=Math.abs(P.clientY-W.current.startY);if(!W.current.active){(fe>8||xe>8)&&(window.clearTimeout(W.current.timer),W.current=null);return}C.preventDefault();const De=document.querySelectorAll(".composer-token-draggable"),Ie=P.clientX,Ke=P.clientY;for(let Pe=0;Pe<De.length;Pe++){const He=De[Pe].getBoundingClientRect();if(Ie>=He.left&&Ie<=He.right&&Ke>=He.top&&Ke<=He.bottom){A(Pe);break}}},[]),Hl=o.useCallback(()=>{var C,P;(C=W.current)!=null&&C.timer&&window.clearTimeout(W.current.timer),(P=W.current)!=null&&P.active&&Y!==null&&R!==null&&Y!==R&&Cs(Y,R),W.current=null,Se(null),A(null)},[Y,R,Cs]),gc=o.useCallback(()=>{var C;(C=W.current)!=null&&C.timer&&window.clearTimeout(W.current.timer),W.current=null,Se(null),A(null)},[]),yc=()=>{r==null||r(y),t==null||t()},Hn=()=>{t==null||t()};if(!Z)return null;const ni=l.jsxs("div",{className:`composer-shell ${F?"ui-card":""} ${Hr?"has-selection-float":""}`,children:[l.jsx("div",{className:"composer-tabs-wrap",children:l.jsx(vr,{ariaLabel:"Composer tabs",value:$,onChange:T,items:[{key:"compose",label:"Compose",icon:l.jsx(ic,{size:14})},{key:"aliases",label:"Aliases",icon:l.jsx(_y,{size:14})},{key:"tags",label:"Tags",icon:l.jsx(ac,{size:14})}]})}),l.jsxs("div",{className:`composer-panel composer-panel-compose ${$==="compose"?"is-visible":""}`,children:[l.jsx("div",{className:"composer-editor",children:l.jsxs("div",{className:"composer-input-row",children:[l.jsx("input",{ref:u,type:"text",value:zn,onChange:C=>Xt(C.target.value),onKeyDown:C=>{C.key==="Enter"&&(C.preventDefault(),kn())},className:"composer-input ui-control ui-input is-compact",placeholder:"Add prompt text","aria-label":"Add prompt text"}),l.jsx(X,{size:"icon",variant:"ghost",onClick:kn,disabled:!zn.trim(),"aria-label":"Add prompt text",children:"+"})]})}),l.jsxs("div",{className:"composer-tokens",children:[l.jsxs("div",{className:"composer-tokens-header",children:[l.jsxs("span",{className:"composer-tokens-label",children:["Elements",l.jsx("span",{className:"composer-tokens-count",children:Ft.length})]}),l.jsx("span",{className:"composer-tokens-hint",children:"Drag to reorder  Tap to adjust"})]}),Ft.length?l.jsx("div",{ref:v,className:`composer-tokens-list ${Y!==null?"is-dragging":""}`,style:{"--composer-elements":Ft.length},children:Ft.map((C,P)=>{let fe=C.text;if(C.type==="alias"){const Pe=nr.get(C.text.toLowerCase());fe=(Pe==null?void 0:Pe.displayName)||C.text}const xe=Y===P,De=R===P&&Y!==null&&Y!==P,Ie=Zr(y||"",C),Ke=(Ie==null?void 0:Ie.weight)??1;return l.jsxs("span",{className:`composer-token composer-token-draggable ${C.type==="alias"?"is-alias":"is-tag"} ${xe?"is-dragging":""} ${De?"is-drop-target":""} ${O===P?"is-selected":""}`,title:C.type==="alias"?`Alias: $${C.text}$`:`Tag: ${C.text}`,role:"button",tabIndex:0,draggable:!0,onDragStart:Pe=>Za(Pe,P),onDragEnd:ei,onDragOver:Pe=>mc(Pe,P),onDragLeave:ti,onTouchStart:Pe=>hc(Pe,P),onTouchMove:$t,onTouchEnd:Hl,onTouchCancel:gc,onClick:()=>{Y===null&&(_(P),Qs(C))},onKeyDown:Pe=>{if(Pe.target===Pe.currentTarget&&(Pe.key==="Enter"||Pe.key===" ")){if(Pe.preventDefault(),Y!==null)return;_(P),Qs(C)}},children:[l.jsx("span",{className:"composer-token-order",children:P+1}),l.jsx("span",{className:"composer-token-drag-handle","aria-hidden":"true",children:l.jsx(Da,{size:10})}),l.jsx("span",{className:"composer-token-name",children:fe}),C.type==="alias"&&l.jsx("span",{className:"composer-token-type",children:"$"}),Math.abs(Ke-1)>1e-6&&l.jsxs("span",{className:"composer-token-weight",children:[rn(Ke),""]}),l.jsx(X,{size:"mini",variant:"danger",onClick:Pe=>{Pe.stopPropagation(),Wn(C)},"aria-label":`Remove ${C.text}`,children:l.jsx(gs,{size:9})})]},`${C.type}-${C.text}-${C.start}`)})}):l.jsx("div",{className:"composer-empty",children:"No elements yet."})]}),l.jsxs("div",{className:`composer-expanded ${Ce?"is-open":"is-collapsed"}`,children:[l.jsxs("div",{className:"composer-expanded-header",role:"button",tabIndex:0,"aria-expanded":Ce,"aria-controls":"composer-expanded-box",onClick:()=>ye(C=>!C),onKeyDown:C=>{(C.key==="Enter"||C.key===" ")&&(C.preventDefault(),ye(P=>!P))},children:[l.jsx("span",{className:"composer-expanded-label",children:"Expanded prompt"}),l.jsx("div",{className:"composer-expanded-actions",children:l.jsx("span",{className:"composer-expanded-meta",children:wn.text?`${wn.text.length} chars`:"Empty"})})]}),Ce?l.jsx("div",{id:"composer-expanded-box",className:"composer-expanded-box","aria-label":"Expanded prompt",children:wn.text?wn.parts.map((C,P)=>C.isAlias?l.jsx("span",{className:"composer-expanded-alias",children:C.text},`alias-${P}`):l.jsx("span",{children:C.text},`text-${P}`)):"No prompt yet."}):null]})]}),l.jsxs("div",{className:`composer-panel composer-panel-aliases ${$==="aliases"?"is-visible":""}`,children:[l.jsxs("div",{className:"composer-browser-header",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsx(Ef,{activeTopic:m,onTopicChange:p}),l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:d,type:"text",value:S,onChange:C=>j(C.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>j(""),disabled:!S,children:"Clear"})]}),l.jsx(mt,{value:h,onChange:w,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:Dr.map(C=>({value:C,label:C==="All"?"Category: All":nn(C)}))}),Un.length>2&&l.jsx(mt,{value:E,onChange:b,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:Un.map(C=>({value:C,label:C==="All"?"All subcategories":bn(C)}))})]}),l.jsx("div",{className:"composer-browser-meta",children:l.jsxs("span",{children:["Showing ",Dl.length," of ",cn.length," aliases"]})})]}),l.jsx("div",{className:"composer-alias-list",children:cn.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[Dl.map(C=>l.jsxs("button",{type:"button",onClick:()=>Ul(C.token),className:`composer-alias-item ${vn.some(P=>P.toLowerCase()===C.token.toLowerCase())?"is-collected":""}`,style:sh,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:C.displayName||C.token}),C.category?l.jsx("span",{className:"composer-alias-category",children:nn(C.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",C.token,"$"]}),l.jsx("div",{className:"composer-alias-text",children:C.text})]},C.key)),L<cn.length&&l.jsx("div",{ref:g,className:"composer-sentinel"})]})})]}),l.jsxs("div",{className:`composer-panel composer-panel-tags ${$==="tags"?"is-visible":""}`,onClick:C=>C.stopPropagation(),children:[l.jsxs("div",{className:"composer-browser-header",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:we,type:"search",value:We,onChange:C=>et(C.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(X,{size:"xs",variant:"ghost",onClick:()=>et(""),disabled:!We,children:"Clear"})]}),l.jsx(mt,{value:Oe,onChange:xt,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...Fe.map(C=>({value:C.key,label:`${bn(C.key)} (${Number(C.actual||C.count||0).toLocaleString()})`}))]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(mt,{value:D,onChange:re,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"composer-min-count",children:"Minimum count"}),l.jsx("input",{id:"composer-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:be,onChange:C=>{const P=C.target.value;(P===""||Number(P)>=0)&&Ee(P)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),se?l.jsx("div",{className:"composer-tags-error",children:se}):null,l.jsxs("div",{className:"composer-browser-meta",children:[l.jsx("span",{children:Be?"Loading tags":V?`${Ge.length} of ${V} tags`:`${Ge.length} tags`}),I?l.jsx("span",{children:"Loading more"}):null]})]}),l.jsx("div",{className:"composer-alias-list composer-tags-grid",role:"list",ref:it,children:Be?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):Ge.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[Sn&&Ns>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Ns}px`}}):null,Qa.map(C=>l.jsx(gv,{tag:C.tag,category:C.category,count:C.count,isCollected:ot.some(P=>P.toLowerCase()===String(C.tag||"").toLowerCase()),onToggle:wr,visibilityStyle:sh},`${C.tag}-${C.category}`)),Sn&&Gs>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Gs}px`}}):null,Ge.length<V&&!Sn?l.jsx("div",{ref:ee,className:"composer-sentinel"}):null,I?l.jsx("div",{className:"composer-alias-empty",children:"Loading more"}):null]})})]})]}),vc=o.useMemo(()=>zt.map(C=>({key:C.key||C.token,token:C.token,displayName:C.displayName||C.name||C.token,category:C.category,subcategory:C.subcategory,name:C.name})),[zt]),ri=o.useMemo(()=>ze.map(C=>({key:`${C.tag}-${C.category}`,tag:C.tag,displayName:C.tag,category:C.category,count:C.count})),[ze]),si=o.useCallback(C=>{if(!(Q!=null&&Q.element))return;const P=C.type==="alias"?"alias":"tag",fe=C.token||C.tag||"";Rn(xe=>{const De=String(xe||""),Ie=Zr(De,Q.element),Ke=String(fe||"").replace(/^\$|\$$/g,"").trim();if(!Ke)return De;const Pe=P==="alias"?`$${Ke}$`:Ke,He=Ie?`(${Pe}:${rn(Ie.weight)})`:Pe;return Yy(De,Q.element,He)}),pe(!1),he(null)},[Q,Rn]),qs=o.useCallback(C=>{Q!=null&&Q.element&&(Rn(P=>Hy(P||"",Q.element,C)),he(P=>P?{...P,weight:C}:null))},[Q,Rn]),bs=l.jsx(pd,{open:ue,onClose:()=>{pe(!1),he(null)},mode:"edit",tokenType:((ai=Q==null?void 0:Q.element)==null?void 0:ai.type)||"tag",tokenLabel:((ii=Q==null?void 0:Q.element)==null?void 0:ii.text)||"",tokenDisplay:(Q==null?void 0:Q.displayName)||"",weight:(Q==null?void 0:Q.weight)??1,onWeightChange:qs,deferWeightApply:!0,onDelete:()=>{Q!=null&&Q.element&&Wn(Q.element)},aliases:vc,aliasCategories:Dr,aliasLoading:!1,tags:ri,tagLoading:Qe||q,tagHasMore:ze.length<at,onLoadTags:Br,onLoadMoreTags:js,replacementSearch:J,onReplacementSearchChange:U,onReplace:si,activeCategory:ve,onCategoryChange:ge,initialCategory:ve,initialSubcategory:$e}),li=l.jsx("div",{className:"page-bar composer-bar",children:l.jsx("h1",{className:"page-bar-title",children:i||"Prompt"})});return F?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"page-shell page-stack",children:[li,ni]}),Kr,bs]}):l.jsxs(l.Fragment,{children:[l.jsx(Ht,{open:e,onClose:Hn,title:"Composer",variant:"fullscreen",shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,footer:l.jsxs("div",{className:"composer-footer-stack",children:[Ja,l.jsxs("div",{className:"flex gap-2",children:[l.jsx(X,{variant:"muted",className:"w-full",onClick:Hn,children:"Cancel"}),l.jsx(X,{variant:"primary",className:"w-full",onClick:yc,children:"Apply"})]})]}),children:ni}),bs]})}function k1(){const e=$r(),[t]=pf(),{formData:n,handleFormChange:r,aliasOptions:s,aliasCatalog:a,promptFieldName:i,handleGenerate:c,workflowData:u,selectedWorkflow:d,isLoading:g}=Nf(),y=t.get("field")||i||"prompt",x=(n==null?void 0:n[y])||"";return o.useEffect(()=>{if(!(typeof document>"u"))return document.body.classList.add("no-pull-refresh"),document.documentElement.classList.add("no-pull-refresh"),()=>{document.body.classList.remove("no-pull-refresh"),document.documentElement.classList.remove("no-pull-refresh")}},[]),o.useEffect(()=>{const S=()=>{!u||!d||g||c()};return window.addEventListener("cozygen:request-render",S),()=>window.removeEventListener("cozygen:request-render",S)},[c,g,d,u]),l.jsx(S1,{open:!0,onClose:()=>e("/controls"),value:x,onChange:S=>r(y,S),aliasOptions:s,aliasCatalog:a,fieldLabel:y,variant:"page"})}function j1(){var m,p;const{authed:e,ready:t,login:n}=lc(),r=$r(),a=((p=(m=yn().state)==null?void 0:m.from)==null?void 0:p.pathname)||"/studio",[i,c]=o.useState(""),[u,d]=o.useState(""),[g,v]=o.useState(""),[y,x]=o.useState(!1),[S,j]=o.useState(!1);o.useEffect(()=>{try{localStorage.getItem("cozygen_idle_logout")&&(j(!0),localStorage.removeItem("cozygen_idle_logout"))}catch{}},[]),o.useEffect(()=>{t&&e&&r(a,{replace:!0})},[t,e,a,r]);const N=async h=>{h.preventDefault(),v(""),x(!0);try{await n(i,u),r(a,{replace:!0})}catch(w){w!=null&&w.unauthorized?v("Invalid username or password."):v("Unable to sign in. Please try again.")}finally{x(!1)}};return l.jsx("div",{className:"login-shell",children:l.jsxs("div",{className:"ui-card w-full max-w-[420px] p-6 sm:p-7",children:[l.jsxs("div",{className:"login-brand",children:[l.jsx(zy,{size:34}),l.jsxs("div",{className:"min-w-0",children:[l.jsx("div",{className:"login-title",children:"Sign in"}),l.jsx("div",{className:"login-subtitle",children:"Continue to CozyGen Studio"})]})]}),l.jsxs("form",{className:"login-form",onSubmit:N,children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"login-username",className:"login-label",children:"Username"}),l.jsx("input",{id:"login-username",type:"text",className:"ui-control ui-input",value:i,onChange:h=>c(h.target.value),autoComplete:"username",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"login-password",className:"login-label",children:"Password"}),l.jsx("input",{id:"login-password",type:"password",className:"ui-control ui-input",value:u,onChange:h=>d(h.target.value),autoComplete:"current-password",required:!0})]}),g?l.jsx("div",{className:"ui-alert",children:g}):S?l.jsx("div",{className:"ui-alert is-warn",children:"You were signed out due to inactivity. Please sign in again."}):null,l.jsx(X,{type:"submit",disabled:y,variant:"primary",className:"w-full",children:y?"Signing in":"Sign in"})]}),l.jsxs("p",{className:"login-footnote",children:["Access is protected by CozyGen auth. Set ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_USER"})," /"," ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_PASS"})," on the server to enable."]})]})})}function N1({containerRef:e}){const{pathname:t,hash:n}=yn();return o.useEffect(()=>{if(n)return;const r=e==null?void 0:e.current;if(r&&typeof r.scrollTo=="function"){r.scrollTo({top:0,left:0,behavior:"auto"});return}typeof window<"u"&&window.scrollTo(0,0)},[t,n,e]),null}function C1({children:e}){const{authed:t,ready:n}=lc(),r=yn();return n?t?e:l.jsx(Co,{to:"/login",state:{from:r},replace:!0}):l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 text-slate-200",children:l.jsxs("div",{className:"page-loading",children:[l.jsx("span",{className:"loading-spinner lg","aria-hidden":"true"}),l.jsx("span",{className:"sr-only",children:"Checking session"})]})})}function lh({tab:e}){const t=yn(),n=new URLSearchParams(t.search||"");n.set("tab",e);const r=n.toString();return l.jsx(Co,{to:`/library?${r}`,replace:!0})}function b1(){const{pathname:e}=yn(),t=$r(),{defaultCreds:n,authed:r}=lc(),s=e==="/login",a=o.useRef(null),i=!s;return o.useEffect(()=>{if(!r)return;const c=u=>{var v;const d=String(((v=u==null?void 0:u.detail)==null?void 0:v.fieldName)||"").trim(),g=d?`?field=${encodeURIComponent(d)}`:"";t(`/compose${g}`)};return window.addEventListener("cozygen:open-composer",c),()=>window.removeEventListener("cozygen:open-composer",c)},[r,t]),l.jsxs("div",{className:"app-shell",children:[!s&&l.jsx(qS,{}),!s&&r&&n&&l.jsxs("div",{className:"flex-shrink-0 bg-amber-500/10 text-amber-200 border-b border-amber-400/50 px-4 py-2 text-sm text-center",children:["Default CozyGen credentials are still in use. Change ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_USER"})," /",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_PASS"})," on the server."]}),l.jsx(N1,{containerRef:a}),l.jsxs("div",{className:"app-body",children:[l.jsx("main",{ref:a,className:s?"app-content is-login":"app-content",children:l.jsxs(uS,{children:[l.jsx(In,{path:"/login",element:l.jsx(j1,{})}),l.jsxs(In,{element:l.jsx(C1,{children:l.jsx($j,{children:l.jsx(oS,{})})}),children:[l.jsx(In,{path:"/",element:l.jsx(Co,{to:"/studio",replace:!0})}),l.jsx(In,{path:"/studio",element:l.jsx(Oj,{})}),l.jsx(In,{path:"/controls",element:l.jsx(Mj,{})}),l.jsx(In,{path:"/compose",element:l.jsx(k1,{})}),l.jsx(In,{path:"/gallery",element:l.jsx(l1,{})}),l.jsx(In,{path:"/library",element:l.jsx(w1,{})}),l.jsx(In,{path:"/aliases",element:l.jsx(lh,{tab:"aliases"})}),l.jsx(In,{path:"/tags",element:l.jsx(lh,{tab:"tags"})})]}),l.jsx(In,{path:"*",element:l.jsx(Co,{to:"/studio",replace:!0})})]})}),i?l.jsx(nk,{}):null]})]})}function E1(){return l.jsx(xS,{children:l.jsx(US,{children:l.jsx(b1,{})})})}su.createRoot(document.getElementById("root")).render(l.jsx(ca.StrictMode,{children:l.jsx(E1,{})}));

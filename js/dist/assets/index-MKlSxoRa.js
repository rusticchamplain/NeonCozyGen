function cv(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in e)){const a=Object.getOwnPropertyDescriptor(r,s);a&&Object.defineProperty(e,s,a.get?a:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function uv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var mh={exports:{}},fo={},gh={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ba=Symbol.for("react.element"),dv=Symbol.for("react.portal"),fv=Symbol.for("react.fragment"),pv=Symbol.for("react.strict_mode"),hv=Symbol.for("react.profiler"),mv=Symbol.for("react.provider"),gv=Symbol.for("react.context"),yv=Symbol.for("react.forward_ref"),vv=Symbol.for("react.suspense"),xv=Symbol.for("react.memo"),wv=Symbol.for("react.lazy"),vf=Symbol.iterator;function Sv(e){return e===null||typeof e!="object"?null:(e=vf&&e[vf]||e["@@iterator"],typeof e=="function"?e:null)}var yh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vh=Object.assign,xh={};function cl(e,t,n){this.props=e,this.context=t,this.refs=xh,this.updater=n||yh}cl.prototype.isReactComponent={};cl.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};cl.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function wh(){}wh.prototype=cl.prototype;function Tu(e,t,n){this.props=e,this.context=t,this.refs=xh,this.updater=n||yh}var Iu=Tu.prototype=new wh;Iu.constructor=Tu;vh(Iu,cl.prototype);Iu.isPureReactComponent=!0;var xf=Array.isArray,Sh=Object.prototype.hasOwnProperty,$u={current:null},jh={key:!0,ref:!0,__self:!0,__source:!0};function kh(e,t,n){var r,s={},a=null,i=null;if(t!=null)for(r in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(a=""+t.key),t)Sh.call(t,r)&&!jh.hasOwnProperty(r)&&(s[r]=t[r]);var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];s.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps,c)s[r]===void 0&&(s[r]=c[r]);return{$$typeof:ba,type:e,key:a,ref:i,props:s,_owner:$u.current}}function jv(e,t){return{$$typeof:ba,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Mu(e){return typeof e=="object"&&e!==null&&e.$$typeof===ba}function kv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var wf=/\/+/g;function Ko(e,t){return typeof e=="object"&&e!==null&&e.key!=null?kv(""+e.key):t.toString(36)}function fi(e,t,n,r,s){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(a){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case ba:case dv:i=!0}}if(i)return i=e,s=s(i),e=r===""?"."+Ko(i,0):r,xf(s)?(n="",e!=null&&(n=e.replace(wf,"$&/")+"/"),fi(s,t,n,"",function(d){return d})):s!=null&&(Mu(s)&&(s=jv(s,n+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(wf,"$&/")+"/")+e)),t.push(s)),1;if(i=0,r=r===""?".":r+":",xf(e))for(var c=0;c<e.length;c++){a=e[c];var u=r+Ko(a,c);i+=fi(a,t,n,u,s)}else if(u=Sv(e),typeof u=="function")for(e=u.call(e),c=0;!(a=e.next()).done;)a=a.value,u=r+Ko(a,c++),i+=fi(a,t,n,u,s);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function Wa(e,t,n){if(e==null)return e;var r=[],s=0;return fi(e,r,"","",function(a){return t.call(n,a,s++)}),r}function Nv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Vt={current:null},pi={transition:null},Cv={ReactCurrentDispatcher:Vt,ReactCurrentBatchConfig:pi,ReactCurrentOwner:$u};function Nh(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:Wa,forEach:function(e,t,n){Wa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Wa(e,function(){t++}),t},toArray:function(e){return Wa(e,function(t){return t})||[]},only:function(e){if(!Mu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};He.Component=cl;He.Fragment=fv;He.Profiler=hv;He.PureComponent=Tu;He.StrictMode=pv;He.Suspense=vv;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Cv;He.act=Nh;He.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=vh({},e.props),s=e.key,a=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,i=$u.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)Sh.call(t,u)&&!jh.hasOwnProperty(u)&&(r[u]=t[u]===void 0&&c!==void 0?c[u]:t[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:ba,type:e.type,key:s,ref:a,props:r,_owner:i}};He.createContext=function(e){return e={$$typeof:gv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:mv,_context:e},e.Consumer=e};He.createElement=kh;He.createFactory=function(e){var t=kh.bind(null,e);return t.type=e,t};He.createRef=function(){return{current:null}};He.forwardRef=function(e){return{$$typeof:yv,render:e}};He.isValidElement=Mu;He.lazy=function(e){return{$$typeof:wv,_payload:{_status:-1,_result:e},_init:Nv}};He.memo=function(e,t){return{$$typeof:xv,type:e,compare:t===void 0?null:t}};He.startTransition=function(e){var t=pi.transition;pi.transition={};try{e()}finally{pi.transition=t}};He.unstable_act=Nh;He.useCallback=function(e,t){return Vt.current.useCallback(e,t)};He.useContext=function(e){return Vt.current.useContext(e)};He.useDebugValue=function(){};He.useDeferredValue=function(e){return Vt.current.useDeferredValue(e)};He.useEffect=function(e,t){return Vt.current.useEffect(e,t)};He.useId=function(){return Vt.current.useId()};He.useImperativeHandle=function(e,t,n){return Vt.current.useImperativeHandle(e,t,n)};He.useInsertionEffect=function(e,t){return Vt.current.useInsertionEffect(e,t)};He.useLayoutEffect=function(e,t){return Vt.current.useLayoutEffect(e,t)};He.useMemo=function(e,t){return Vt.current.useMemo(e,t)};He.useReducer=function(e,t,n){return Vt.current.useReducer(e,t,n)};He.useRef=function(e){return Vt.current.useRef(e)};He.useState=function(e){return Vt.current.useState(e)};He.useSyncExternalStore=function(e,t,n){return Vt.current.useSyncExternalStore(e,t,n)};He.useTransition=function(){return Vt.current.useTransition()};He.version="18.3.1";gh.exports=He;var o=gh.exports;const Kl=uv(o),bv=cv({__proto__:null,default:Kl},[o]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ev=o,Lv=Symbol.for("react.element"),Pv=Symbol.for("react.fragment"),zv=Object.prototype.hasOwnProperty,_v=Ev.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Av={key:!0,ref:!0,__self:!0,__source:!0};function Ch(e,t,n){var r,s={},a=null,i=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(i=t.ref);for(r in t)zv.call(t,r)&&!Av.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)s[r]===void 0&&(s[r]=t[r]);return{$$typeof:Lv,type:e,key:a,ref:i,props:s,_owner:_v.current}}fo.Fragment=Pv;fo.jsx=Ch;fo.jsxs=Ch;mh.exports=fo;var l=mh.exports,Cc={},bh={exports:{}},an={},Eh={exports:{}},Lh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(R,b){var I=R.length;R.push(b);e:for(;0<I;){var A=I-1>>>1,H=R[A];if(0<s(H,b))R[A]=b,R[I]=H,I=A;else break e}}function n(R){return R.length===0?null:R[0]}function r(R){if(R.length===0)return null;var b=R[0],I=R.pop();if(I!==b){R[0]=I;e:for(var A=0,H=R.length,J=H>>>1;A<J;){var ue=2*(A+1)-1,ce=R[ue],Q=ue+1,me=R[Q];if(0>s(ce,I))Q<H&&0>s(me,ce)?(R[A]=me,R[Q]=I,A=Q):(R[A]=ce,R[ue]=I,A=ue);else if(Q<H&&0>s(me,I))R[A]=me,R[Q]=I,A=Q;else break e}}return b}function s(R,b){var I=R.sortIndex-b.sortIndex;return I!==0?I:R.id-b.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var i=Date,c=i.now();e.unstable_now=function(){return i.now()-c}}var u=[],d=[],p=1,v=null,g=3,x=!1,S=!1,k=!1,j=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(R){for(var b=n(d);b!==null;){if(b.callback===null)r(d);else if(b.startTime<=R)r(d),b.sortIndex=b.expirationTime,t(u,b);else break;b=n(d)}}function w(R){if(k=!1,m(R),!S)if(n(u)!==null)S=!0,ke(C);else{var b=n(d);b!==null&&le(w,b.startTime-R)}}function C(R,b){S=!1,k&&(k=!1,h(M),M=-1),x=!0;var I=g;try{for(m(b),v=n(u);v!==null&&(!(v.expirationTime>b)||R&&!T());){var A=v.callback;if(typeof A=="function"){v.callback=null,g=v.priorityLevel;var H=A(v.expirationTime<=b);b=e.unstable_now(),typeof H=="function"?v.callback=H:v===n(u)&&r(u),m(b)}else r(u);v=n(u)}if(v!==null)var J=!0;else{var ue=n(d);ue!==null&&le(w,ue.startTime-b),J=!1}return J}finally{v=null,g=I,x=!1}}var E=!1,P=null,M=-1,B=5,_=-1;function T(){return!(e.unstable_now()-_<B)}function q(){if(P!==null){var R=e.unstable_now();_=R;var b=!0;try{b=P(!0,R)}finally{b?X():(E=!1,P=null)}}else E=!1}var X;if(typeof f=="function")X=function(){f(q)};else if(typeof MessageChannel<"u"){var xe=new MessageChannel,Le=xe.port2;xe.port1.onmessage=q,X=function(){Le.postMessage(null)}}else X=function(){j(q,0)};function ke(R){P=R,E||(E=!0,X())}function le(R,b){M=j(function(){R(e.unstable_now())},b)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(R){R.callback=null},e.unstable_continueExecution=function(){S||x||(S=!0,ke(C))},e.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<R?Math.floor(1e3/R):5},e.unstable_getCurrentPriorityLevel=function(){return g},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(R){switch(g){case 1:case 2:case 3:var b=3;break;default:b=g}var I=g;g=b;try{return R()}finally{g=I}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(R,b){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var I=g;g=R;try{return b()}finally{g=I}},e.unstable_scheduleCallback=function(R,b,I){var A=e.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?A+I:A):I=A,R){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=I+H,R={id:p++,callback:b,priorityLevel:R,startTime:I,expirationTime:H,sortIndex:-1},I>A?(R.sortIndex=I,t(d,R),n(u)===null&&R===n(d)&&(k?(h(M),M=-1):k=!0,le(w,I-A))):(R.sortIndex=H,t(u,R),S||x||(S=!0,ke(C))),R},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(R){var b=g;return function(){var I=g;g=b;try{return R.apply(this,arguments)}finally{g=I}}}})(Lh);Eh.exports=Lh;var Rv=Eh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tv=o,ln=Rv;function te(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ph=new Set,la={};function fs(e,t){Zs(e,t),Zs(e+"Capture",t)}function Zs(e,t){for(la[e]=t,e=0;e<t.length;e++)Ph.add(t[e])}var ar=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bc=Object.prototype.hasOwnProperty,Iv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Sf={},jf={};function $v(e){return bc.call(jf,e)?!0:bc.call(Sf,e)?!1:Iv.test(e)?jf[e]=!0:(Sf[e]=!0,!1)}function Mv(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Fv(e,t,n,r){if(t===null||typeof t>"u"||Mv(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Wt(e,t,n,r,s,a,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var Tt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Tt[e]=new Wt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Tt[t]=new Wt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Tt[e]=new Wt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Tt[e]=new Wt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Tt[e]=new Wt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Tt[e]=new Wt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Tt[e]=new Wt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Tt[e]=new Wt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Tt[e]=new Wt(e,5,!1,e.toLowerCase(),null,!1,!1)});var Fu=/[\-:]([a-z])/g;function Ou(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Fu,Ou);Tt[t]=new Wt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Fu,Ou);Tt[t]=new Wt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Fu,Ou);Tt[t]=new Wt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Tt[e]=new Wt(e,1,!1,e.toLowerCase(),null,!1,!1)});Tt.xlinkHref=new Wt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Tt[e]=new Wt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Du(e,t,n,r){var s=Tt.hasOwnProperty(t)?Tt[t]:null;(s!==null?s.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Fv(t,n,s,r)&&(n=null),r||s===null?$v(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=n===null?s.type===3?!1:"":n:(t=s.attributeName,r=s.attributeNamespace,n===null?e.removeAttribute(t):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var ur=Tv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ha=Symbol.for("react.element"),As=Symbol.for("react.portal"),Rs=Symbol.for("react.fragment"),Bu=Symbol.for("react.strict_mode"),Ec=Symbol.for("react.profiler"),zh=Symbol.for("react.provider"),_h=Symbol.for("react.context"),Uu=Symbol.for("react.forward_ref"),Lc=Symbol.for("react.suspense"),Pc=Symbol.for("react.suspense_list"),Vu=Symbol.for("react.memo"),jr=Symbol.for("react.lazy"),Ah=Symbol.for("react.offscreen"),kf=Symbol.iterator;function Al(e){return e===null||typeof e!="object"?null:(e=kf&&e[kf]||e["@@iterator"],typeof e=="function"?e:null)}var xt=Object.assign,Go;function Dl(e){if(Go===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Go=t&&t[1]||""}return`
`+Go+e}var Yo=!1;function Qo(e,t){if(!e||Yo)return"";Yo=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),a=r.stack.split(`
`),i=s.length-1,c=a.length-1;1<=i&&0<=c&&s[i]!==a[c];)c--;for(;1<=i&&0<=c;i--,c--)if(s[i]!==a[c]){if(i!==1||c!==1)do if(i--,c--,0>c||s[i]!==a[c]){var u=`
`+s[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=i&&0<=c);break}}}finally{Yo=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Dl(e):""}function Ov(e){switch(e.tag){case 5:return Dl(e.type);case 16:return Dl("Lazy");case 13:return Dl("Suspense");case 19:return Dl("SuspenseList");case 0:case 2:case 15:return e=Qo(e.type,!1),e;case 11:return e=Qo(e.type.render,!1),e;case 1:return e=Qo(e.type,!0),e;default:return""}}function zc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Rs:return"Fragment";case As:return"Portal";case Ec:return"Profiler";case Bu:return"StrictMode";case Lc:return"Suspense";case Pc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case _h:return(e.displayName||"Context")+".Consumer";case zh:return(e._context.displayName||"Context")+".Provider";case Uu:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Vu:return t=e.displayName||null,t!==null?t:zc(e.type)||"Memo";case jr:t=e._payload,e=e._init;try{return zc(e(t))}catch{}}return null}function Dv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zc(t);case 8:return t===Bu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Fr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Rh(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Bv(e){var t=Rh(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(i){r=""+i,a.call(this,i)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(i){r=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ka(e){e._valueTracker||(e._valueTracker=Bv(e))}function Th(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Rh(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function bi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function _c(e,t){var n=t.checked;return xt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Nf(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Fr(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Ih(e,t){t=t.checked,t!=null&&Du(e,"checked",t,!1)}function Ac(e,t){Ih(e,t);var n=Fr(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Rc(e,t.type,n):t.hasOwnProperty("defaultValue")&&Rc(e,t.type,Fr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Cf(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Rc(e,t,n){(t!=="number"||bi(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Bl=Array.isArray;function Ks(e,t,n,r){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Fr(n),t=null,s=0;s<e.length;s++){if(e[s].value===n){e[s].selected=!0,r&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function Tc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(te(91));return xt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function bf(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(te(92));if(Bl(n)){if(1<n.length)throw Error(te(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Fr(n)}}function $h(e,t){var n=Fr(t.value),r=Fr(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Ef(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Mh(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ic(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Mh(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ga,Fh=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,s){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ga=Ga||document.createElement("div"),Ga.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ga.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function aa(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Gl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Uv=["Webkit","ms","Moz","O"];Object.keys(Gl).forEach(function(e){Uv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Gl[t]=Gl[e]})});function Oh(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Gl.hasOwnProperty(e)&&Gl[e]?(""+t).trim():t+"px"}function Dh(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Oh(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,s):e[n]=s}}var Vv=xt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $c(e,t){if(t){if(Vv[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(te(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(te(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(te(61))}if(t.style!=null&&typeof t.style!="object")throw Error(te(62))}}function Mc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fc=null;function Wu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Oc=null,Gs=null,Ys=null;function Lf(e){if(e=Pa(e)){if(typeof Oc!="function")throw Error(te(280));var t=e.stateNode;t&&(t=yo(t),Oc(e.stateNode,e.type,t))}}function Bh(e){Gs?Ys?Ys.push(e):Ys=[e]:Gs=e}function Uh(){if(Gs){var e=Gs,t=Ys;if(Ys=Gs=null,Lf(e),t)for(e=0;e<t.length;e++)Lf(t[e])}}function Vh(e,t){return e(t)}function Wh(){}var qo=!1;function Hh(e,t,n){if(qo)return e(t,n);qo=!0;try{return Vh(e,t,n)}finally{qo=!1,(Gs!==null||Ys!==null)&&(Wh(),Uh())}}function ia(e,t){var n=e.stateNode;if(n===null)return null;var r=yo(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(te(231,t,typeof n));return n}var Dc=!1;if(ar)try{var Rl={};Object.defineProperty(Rl,"passive",{get:function(){Dc=!0}}),window.addEventListener("test",Rl,Rl),window.removeEventListener("test",Rl,Rl)}catch{Dc=!1}function Wv(e,t,n,r,s,a,i,c,u){var d=Array.prototype.slice.call(arguments,3);try{t.apply(n,d)}catch(p){this.onError(p)}}var Yl=!1,Ei=null,Li=!1,Bc=null,Hv={onError:function(e){Yl=!0,Ei=e}};function Kv(e,t,n,r,s,a,i,c,u){Yl=!1,Ei=null,Wv.apply(Hv,arguments)}function Gv(e,t,n,r,s,a,i,c,u){if(Kv.apply(this,arguments),Yl){if(Yl){var d=Ei;Yl=!1,Ei=null}else throw Error(te(198));Li||(Li=!0,Bc=d)}}function ps(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Kh(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Pf(e){if(ps(e)!==e)throw Error(te(188))}function Yv(e){var t=e.alternate;if(!t){if(t=ps(e),t===null)throw Error(te(188));return t!==e?null:e}for(var n=e,r=t;;){var s=n.return;if(s===null)break;var a=s.alternate;if(a===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return Pf(s),e;if(a===r)return Pf(s),t;a=a.sibling}throw Error(te(188))}if(n.return!==r.return)n=s,r=a;else{for(var i=!1,c=s.child;c;){if(c===n){i=!0,n=s,r=a;break}if(c===r){i=!0,r=s,n=a;break}c=c.sibling}if(!i){for(c=a.child;c;){if(c===n){i=!0,n=a,r=s;break}if(c===r){i=!0,r=a,n=s;break}c=c.sibling}if(!i)throw Error(te(189))}}if(n.alternate!==r)throw Error(te(190))}if(n.tag!==3)throw Error(te(188));return n.stateNode.current===n?e:t}function Gh(e){return e=Yv(e),e!==null?Yh(e):null}function Yh(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Yh(e);if(t!==null)return t;e=e.sibling}return null}var Qh=ln.unstable_scheduleCallback,zf=ln.unstable_cancelCallback,Qv=ln.unstable_shouldYield,qv=ln.unstable_requestPaint,kt=ln.unstable_now,Xv=ln.unstable_getCurrentPriorityLevel,Hu=ln.unstable_ImmediatePriority,qh=ln.unstable_UserBlockingPriority,Pi=ln.unstable_NormalPriority,Jv=ln.unstable_LowPriority,Xh=ln.unstable_IdlePriority,po=null,Yn=null;function Zv(e){if(Yn&&typeof Yn.onCommitFiberRoot=="function")try{Yn.onCommitFiberRoot(po,e,void 0,(e.current.flags&128)===128)}catch{}}var An=Math.clz32?Math.clz32:nx,ex=Math.log,tx=Math.LN2;function nx(e){return e>>>=0,e===0?32:31-(ex(e)/tx|0)|0}var Ya=64,Qa=4194304;function Ul(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function zi(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,s=e.suspendedLanes,a=e.pingedLanes,i=n&268435455;if(i!==0){var c=i&~s;c!==0?r=Ul(c):(a&=i,a!==0&&(r=Ul(a)))}else i=n&~s,i!==0?r=Ul(i):a!==0&&(r=Ul(a));if(r===0)return 0;if(t!==0&&t!==r&&!(t&s)&&(s=r&-r,a=t&-t,s>=a||s===16&&(a&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-An(t),s=1<<n,r|=e[n],t&=~s;return r}function rx(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sx(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,s=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-An(a),c=1<<i,u=s[i];u===-1?(!(c&n)||c&r)&&(s[i]=rx(c,t)):u<=t&&(e.expiredLanes|=c),a&=~c}}function Uc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Jh(){var e=Ya;return Ya<<=1,!(Ya&4194240)&&(Ya=64),e}function Xo(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ea(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-An(t),e[t]=n}function lx(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-An(n),a=1<<s;t[s]=0,r[s]=-1,e[s]=-1,n&=~a}}function Ku(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-An(n),s=1<<r;s&t|e[r]&t&&(e[r]|=t),n&=~s}}var lt=0;function Zh(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var em,Gu,tm,nm,rm,Vc=!1,qa=[],Pr=null,zr=null,_r=null,oa=new Map,ca=new Map,Nr=[],ax="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _f(e,t){switch(e){case"focusin":case"focusout":Pr=null;break;case"dragenter":case"dragleave":zr=null;break;case"mouseover":case"mouseout":_r=null;break;case"pointerover":case"pointerout":oa.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ca.delete(t.pointerId)}}function Tl(e,t,n,r,s,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[s]},t!==null&&(t=Pa(t),t!==null&&Gu(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function ix(e,t,n,r,s){switch(t){case"focusin":return Pr=Tl(Pr,e,t,n,r,s),!0;case"dragenter":return zr=Tl(zr,e,t,n,r,s),!0;case"mouseover":return _r=Tl(_r,e,t,n,r,s),!0;case"pointerover":var a=s.pointerId;return oa.set(a,Tl(oa.get(a)||null,e,t,n,r,s)),!0;case"gotpointercapture":return a=s.pointerId,ca.set(a,Tl(ca.get(a)||null,e,t,n,r,s)),!0}return!1}function sm(e){var t=ns(e.target);if(t!==null){var n=ps(t);if(n!==null){if(t=n.tag,t===13){if(t=Kh(n),t!==null){e.blockedOn=t,rm(e.priority,function(){tm(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function hi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Wc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);Fc=r,n.target.dispatchEvent(r),Fc=null}else return t=Pa(n),t!==null&&Gu(t),e.blockedOn=n,!1;t.shift()}return!0}function Af(e,t,n){hi(e)&&n.delete(t)}function ox(){Vc=!1,Pr!==null&&hi(Pr)&&(Pr=null),zr!==null&&hi(zr)&&(zr=null),_r!==null&&hi(_r)&&(_r=null),oa.forEach(Af),ca.forEach(Af)}function Il(e,t){e.blockedOn===t&&(e.blockedOn=null,Vc||(Vc=!0,ln.unstable_scheduleCallback(ln.unstable_NormalPriority,ox)))}function ua(e){function t(s){return Il(s,e)}if(0<qa.length){Il(qa[0],e);for(var n=1;n<qa.length;n++){var r=qa[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Pr!==null&&Il(Pr,e),zr!==null&&Il(zr,e),_r!==null&&Il(_r,e),oa.forEach(t),ca.forEach(t),n=0;n<Nr.length;n++)r=Nr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Nr.length&&(n=Nr[0],n.blockedOn===null);)sm(n),n.blockedOn===null&&Nr.shift()}var Qs=ur.ReactCurrentBatchConfig,_i=!0;function cx(e,t,n,r){var s=lt,a=Qs.transition;Qs.transition=null;try{lt=1,Yu(e,t,n,r)}finally{lt=s,Qs.transition=a}}function ux(e,t,n,r){var s=lt,a=Qs.transition;Qs.transition=null;try{lt=4,Yu(e,t,n,r)}finally{lt=s,Qs.transition=a}}function Yu(e,t,n,r){if(_i){var s=Wc(e,t,n,r);if(s===null)ic(e,t,r,Ai,n),_f(e,r);else if(ix(s,e,t,n,r))r.stopPropagation();else if(_f(e,r),t&4&&-1<ax.indexOf(e)){for(;s!==null;){var a=Pa(s);if(a!==null&&em(a),a=Wc(e,t,n,r),a===null&&ic(e,t,r,Ai,n),a===s)break;s=a}s!==null&&r.stopPropagation()}else ic(e,t,r,null,n)}}var Ai=null;function Wc(e,t,n,r){if(Ai=null,e=Wu(r),e=ns(e),e!==null)if(t=ps(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Kh(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ai=e,null}function lm(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xv()){case Hu:return 1;case qh:return 4;case Pi:case Jv:return 16;case Xh:return 536870912;default:return 16}default:return 16}}var br=null,Qu=null,mi=null;function am(){if(mi)return mi;var e,t=Qu,n=t.length,r,s="value"in br?br.value:br.textContent,a=s.length;for(e=0;e<n&&t[e]===s[e];e++);var i=n-e;for(r=1;r<=i&&t[n-r]===s[a-r];r++);return mi=s.slice(e,1<r?1-r:void 0)}function gi(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Xa(){return!0}function Rf(){return!1}function on(e){function t(n,r,s,a,i){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=a,this.target=i,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(n=e[c],this[c]=n?n(a):a[c]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Xa:Rf,this.isPropagationStopped=Rf,this}return xt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Xa)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Xa)},persist:function(){},isPersistent:Xa}),t}var ul={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qu=on(ul),La=xt({},ul,{view:0,detail:0}),dx=on(La),Jo,Zo,$l,ho=xt({},La,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Xu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$l&&($l&&e.type==="mousemove"?(Jo=e.screenX-$l.screenX,Zo=e.screenY-$l.screenY):Zo=Jo=0,$l=e),Jo)},movementY:function(e){return"movementY"in e?e.movementY:Zo}}),Tf=on(ho),fx=xt({},ho,{dataTransfer:0}),px=on(fx),hx=xt({},La,{relatedTarget:0}),ec=on(hx),mx=xt({},ul,{animationName:0,elapsedTime:0,pseudoElement:0}),gx=on(mx),yx=xt({},ul,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vx=on(yx),xx=xt({},ul,{data:0}),If=on(xx),wx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kx(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=jx[e])?!!t[e]:!1}function Xu(){return kx}var Nx=xt({},La,{key:function(e){if(e.key){var t=wx[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=gi(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Sx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Xu,charCode:function(e){return e.type==="keypress"?gi(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?gi(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Cx=on(Nx),bx=xt({},ho,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$f=on(bx),Ex=xt({},La,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Xu}),Lx=on(Ex),Px=xt({},ul,{propertyName:0,elapsedTime:0,pseudoElement:0}),zx=on(Px),_x=xt({},ho,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ax=on(_x),Rx=[9,13,27,32],Ju=ar&&"CompositionEvent"in window,Ql=null;ar&&"documentMode"in document&&(Ql=document.documentMode);var Tx=ar&&"TextEvent"in window&&!Ql,im=ar&&(!Ju||Ql&&8<Ql&&11>=Ql),Mf=" ",Ff=!1;function om(e,t){switch(e){case"keyup":return Rx.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ts=!1;function Ix(e,t){switch(e){case"compositionend":return cm(t);case"keypress":return t.which!==32?null:(Ff=!0,Mf);case"textInput":return e=t.data,e===Mf&&Ff?null:e;default:return null}}function $x(e,t){if(Ts)return e==="compositionend"||!Ju&&om(e,t)?(e=am(),mi=Qu=br=null,Ts=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return im&&t.locale!=="ko"?null:t.data;default:return null}}var Mx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Of(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Mx[e.type]:t==="textarea"}function um(e,t,n,r){Bh(r),t=Ri(t,"onChange"),0<t.length&&(n=new qu("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var ql=null,da=null;function Fx(e){Sm(e,0)}function mo(e){var t=Ms(e);if(Th(t))return e}function Ox(e,t){if(e==="change")return t}var dm=!1;if(ar){var tc;if(ar){var nc="oninput"in document;if(!nc){var Df=document.createElement("div");Df.setAttribute("oninput","return;"),nc=typeof Df.oninput=="function"}tc=nc}else tc=!1;dm=tc&&(!document.documentMode||9<document.documentMode)}function Bf(){ql&&(ql.detachEvent("onpropertychange",fm),da=ql=null)}function fm(e){if(e.propertyName==="value"&&mo(da)){var t=[];um(t,da,e,Wu(e)),Hh(Fx,t)}}function Dx(e,t,n){e==="focusin"?(Bf(),ql=t,da=n,ql.attachEvent("onpropertychange",fm)):e==="focusout"&&Bf()}function Bx(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return mo(da)}function Ux(e,t){if(e==="click")return mo(t)}function Vx(e,t){if(e==="input"||e==="change")return mo(t)}function Wx(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var In=typeof Object.is=="function"?Object.is:Wx;function fa(e,t){if(In(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!bc.call(t,s)||!In(e[s],t[s]))return!1}return!0}function Uf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Vf(e,t){var n=Uf(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Uf(n)}}function pm(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?pm(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function hm(){for(var e=window,t=bi();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=bi(e.document)}return t}function Zu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Hx(e){var t=hm(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&pm(n.ownerDocument.documentElement,n)){if(r!==null&&Zu(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=n.textContent.length,a=Math.min(r.start,s);r=r.end===void 0?a:Math.min(r.end,s),!e.extend&&a>r&&(s=r,r=a,a=s),s=Vf(n,a);var i=Vf(n,r);s&&i&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Kx=ar&&"documentMode"in document&&11>=document.documentMode,Is=null,Hc=null,Xl=null,Kc=!1;function Wf(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Kc||Is==null||Is!==bi(r)||(r=Is,"selectionStart"in r&&Zu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Xl&&fa(Xl,r)||(Xl=r,r=Ri(Hc,"onSelect"),0<r.length&&(t=new qu("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Is)))}function Ja(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var $s={animationend:Ja("Animation","AnimationEnd"),animationiteration:Ja("Animation","AnimationIteration"),animationstart:Ja("Animation","AnimationStart"),transitionend:Ja("Transition","TransitionEnd")},rc={},mm={};ar&&(mm=document.createElement("div").style,"AnimationEvent"in window||(delete $s.animationend.animation,delete $s.animationiteration.animation,delete $s.animationstart.animation),"TransitionEvent"in window||delete $s.transitionend.transition);function go(e){if(rc[e])return rc[e];if(!$s[e])return e;var t=$s[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in mm)return rc[e]=t[n];return e}var gm=go("animationend"),ym=go("animationiteration"),vm=go("animationstart"),xm=go("transitionend"),wm=new Map,Hf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Br(e,t){wm.set(e,t),fs(t,[e])}for(var sc=0;sc<Hf.length;sc++){var lc=Hf[sc],Gx=lc.toLowerCase(),Yx=lc[0].toUpperCase()+lc.slice(1);Br(Gx,"on"+Yx)}Br(gm,"onAnimationEnd");Br(ym,"onAnimationIteration");Br(vm,"onAnimationStart");Br("dblclick","onDoubleClick");Br("focusin","onFocus");Br("focusout","onBlur");Br(xm,"onTransitionEnd");Zs("onMouseEnter",["mouseout","mouseover"]);Zs("onMouseLeave",["mouseout","mouseover"]);Zs("onPointerEnter",["pointerout","pointerover"]);Zs("onPointerLeave",["pointerout","pointerover"]);fs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fs("onBeforeInput",["compositionend","keypress","textInput","paste"]);fs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vl));function Kf(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,Gv(r,t,void 0,e),e.currentTarget=null}function Sm(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],s=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var c=r[i],u=c.instance,d=c.currentTarget;if(c=c.listener,u!==a&&s.isPropagationStopped())break e;Kf(s,c,d),a=u}else for(i=0;i<r.length;i++){if(c=r[i],u=c.instance,d=c.currentTarget,c=c.listener,u!==a&&s.isPropagationStopped())break e;Kf(s,c,d),a=u}}}if(Li)throw e=Bc,Li=!1,Bc=null,e}function dt(e,t){var n=t[Xc];n===void 0&&(n=t[Xc]=new Set);var r=e+"__bubble";n.has(r)||(jm(t,e,2,!1),n.add(r))}function ac(e,t,n){var r=0;t&&(r|=4),jm(n,e,r,t)}var Za="_reactListening"+Math.random().toString(36).slice(2);function pa(e){if(!e[Za]){e[Za]=!0,Ph.forEach(function(n){n!=="selectionchange"&&(Qx.has(n)||ac(n,!1,e),ac(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Za]||(t[Za]=!0,ac("selectionchange",!1,t))}}function jm(e,t,n,r){switch(lm(t)){case 1:var s=cx;break;case 4:s=ux;break;default:s=Yu}n=s.bind(null,t,n,e),s=void 0,!Dc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),r?s!==void 0?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):s!==void 0?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function ic(e,t,n,r,s){var a=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var i=r.tag;if(i===3||i===4){var c=r.stateNode.containerInfo;if(c===s||c.nodeType===8&&c.parentNode===s)break;if(i===4)for(i=r.return;i!==null;){var u=i.tag;if((u===3||u===4)&&(u=i.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;i=i.return}for(;c!==null;){if(i=ns(c),i===null)return;if(u=i.tag,u===5||u===6){r=a=i;continue e}c=c.parentNode}}r=r.return}Hh(function(){var d=a,p=Wu(n),v=[];e:{var g=wm.get(e);if(g!==void 0){var x=qu,S=e;switch(e){case"keypress":if(gi(n)===0)break e;case"keydown":case"keyup":x=Cx;break;case"focusin":S="focus",x=ec;break;case"focusout":S="blur",x=ec;break;case"beforeblur":case"afterblur":x=ec;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=Tf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=px;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=Lx;break;case gm:case ym:case vm:x=gx;break;case xm:x=zx;break;case"scroll":x=dx;break;case"wheel":x=Ax;break;case"copy":case"cut":case"paste":x=vx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=$f}var k=(t&4)!==0,j=!k&&e==="scroll",h=k?g!==null?g+"Capture":null:g;k=[];for(var f=d,m;f!==null;){m=f;var w=m.stateNode;if(m.tag===5&&w!==null&&(m=w,h!==null&&(w=ia(f,h),w!=null&&k.push(ha(f,w,m)))),j)break;f=f.return}0<k.length&&(g=new x(g,S,null,n,p),v.push({event:g,listeners:k}))}}if(!(t&7)){e:{if(g=e==="mouseover"||e==="pointerover",x=e==="mouseout"||e==="pointerout",g&&n!==Fc&&(S=n.relatedTarget||n.fromElement)&&(ns(S)||S[ir]))break e;if((x||g)&&(g=p.window===p?p:(g=p.ownerDocument)?g.defaultView||g.parentWindow:window,x?(S=n.relatedTarget||n.toElement,x=d,S=S?ns(S):null,S!==null&&(j=ps(S),S!==j||S.tag!==5&&S.tag!==6)&&(S=null)):(x=null,S=d),x!==S)){if(k=Tf,w="onMouseLeave",h="onMouseEnter",f="mouse",(e==="pointerout"||e==="pointerover")&&(k=$f,w="onPointerLeave",h="onPointerEnter",f="pointer"),j=x==null?g:Ms(x),m=S==null?g:Ms(S),g=new k(w,f+"leave",x,n,p),g.target=j,g.relatedTarget=m,w=null,ns(p)===d&&(k=new k(h,f+"enter",S,n,p),k.target=m,k.relatedTarget=j,w=k),j=w,x&&S)t:{for(k=x,h=S,f=0,m=k;m;m=Ps(m))f++;for(m=0,w=h;w;w=Ps(w))m++;for(;0<f-m;)k=Ps(k),f--;for(;0<m-f;)h=Ps(h),m--;for(;f--;){if(k===h||h!==null&&k===h.alternate)break t;k=Ps(k),h=Ps(h)}k=null}else k=null;x!==null&&Gf(v,g,x,k,!1),S!==null&&j!==null&&Gf(v,j,S,k,!0)}}e:{if(g=d?Ms(d):window,x=g.nodeName&&g.nodeName.toLowerCase(),x==="select"||x==="input"&&g.type==="file")var C=Ox;else if(Of(g))if(dm)C=Vx;else{C=Bx;var E=Dx}else(x=g.nodeName)&&x.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(C=Ux);if(C&&(C=C(e,d))){um(v,C,n,p);break e}E&&E(e,g,d),e==="focusout"&&(E=g._wrapperState)&&E.controlled&&g.type==="number"&&Rc(g,"number",g.value)}switch(E=d?Ms(d):window,e){case"focusin":(Of(E)||E.contentEditable==="true")&&(Is=E,Hc=d,Xl=null);break;case"focusout":Xl=Hc=Is=null;break;case"mousedown":Kc=!0;break;case"contextmenu":case"mouseup":case"dragend":Kc=!1,Wf(v,n,p);break;case"selectionchange":if(Kx)break;case"keydown":case"keyup":Wf(v,n,p)}var P;if(Ju)e:{switch(e){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Ts?om(e,n)&&(M="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(im&&n.locale!=="ko"&&(Ts||M!=="onCompositionStart"?M==="onCompositionEnd"&&Ts&&(P=am()):(br=p,Qu="value"in br?br.value:br.textContent,Ts=!0)),E=Ri(d,M),0<E.length&&(M=new If(M,e,null,n,p),v.push({event:M,listeners:E}),P?M.data=P:(P=cm(n),P!==null&&(M.data=P)))),(P=Tx?Ix(e,n):$x(e,n))&&(d=Ri(d,"onBeforeInput"),0<d.length&&(p=new If("onBeforeInput","beforeinput",null,n,p),v.push({event:p,listeners:d}),p.data=P))}Sm(v,t)})}function ha(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ri(e,t){for(var n=t+"Capture",r=[];e!==null;){var s=e,a=s.stateNode;s.tag===5&&a!==null&&(s=a,a=ia(e,n),a!=null&&r.unshift(ha(e,a,s)),a=ia(e,t),a!=null&&r.push(ha(e,a,s))),e=e.return}return r}function Ps(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Gf(e,t,n,r,s){for(var a=t._reactName,i=[];n!==null&&n!==r;){var c=n,u=c.alternate,d=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&d!==null&&(c=d,s?(u=ia(n,a),u!=null&&i.unshift(ha(n,u,c))):s||(u=ia(n,a),u!=null&&i.push(ha(n,u,c)))),n=n.return}i.length!==0&&e.push({event:t,listeners:i})}var qx=/\r\n?/g,Xx=/\u0000|\uFFFD/g;function Yf(e){return(typeof e=="string"?e:""+e).replace(qx,`
`).replace(Xx,"")}function ei(e,t,n){if(t=Yf(t),Yf(e)!==t&&n)throw Error(te(425))}function Ti(){}var Gc=null,Yc=null;function Qc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var qc=typeof setTimeout=="function"?setTimeout:void 0,Jx=typeof clearTimeout=="function"?clearTimeout:void 0,Qf=typeof Promise=="function"?Promise:void 0,Zx=typeof queueMicrotask=="function"?queueMicrotask:typeof Qf<"u"?function(e){return Qf.resolve(null).then(e).catch(ew)}:qc;function ew(e){setTimeout(function(){throw e})}function oc(e,t){var n=t,r=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){e.removeChild(s),ua(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);ua(t)}function Ar(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function qf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var dl=Math.random().toString(36).slice(2),Un="__reactFiber$"+dl,ma="__reactProps$"+dl,ir="__reactContainer$"+dl,Xc="__reactEvents$"+dl,tw="__reactListeners$"+dl,nw="__reactHandles$"+dl;function ns(e){var t=e[Un];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ir]||n[Un]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=qf(e);e!==null;){if(n=e[Un])return n;e=qf(e)}return t}e=n,n=e.parentNode}return null}function Pa(e){return e=e[Un]||e[ir],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Ms(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(te(33))}function yo(e){return e[ma]||null}var Jc=[],Fs=-1;function Ur(e){return{current:e}}function ft(e){0>Fs||(e.current=Jc[Fs],Jc[Fs]=null,Fs--)}function it(e,t){Fs++,Jc[Fs]=e.current,e.current=t}var Or={},Ot=Ur(Or),qt=Ur(!1),is=Or;function el(e,t){var n=e.type.contextTypes;if(!n)return Or;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var s={},a;for(a in n)s[a]=t[a];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Xt(e){return e=e.childContextTypes,e!=null}function Ii(){ft(qt),ft(Ot)}function Xf(e,t,n){if(Ot.current!==Or)throw Error(te(168));it(Ot,t),it(qt,n)}function km(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in t))throw Error(te(108,Dv(e)||"Unknown",s));return xt({},n,r)}function $i(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Or,is=Ot.current,it(Ot,e),it(qt,qt.current),!0}function Jf(e,t,n){var r=e.stateNode;if(!r)throw Error(te(169));n?(e=km(e,t,is),r.__reactInternalMemoizedMergedChildContext=e,ft(qt),ft(Ot),it(Ot,e)):ft(qt),it(qt,n)}var er=null,vo=!1,cc=!1;function Nm(e){er===null?er=[e]:er.push(e)}function rw(e){vo=!0,Nm(e)}function Vr(){if(!cc&&er!==null){cc=!0;var e=0,t=lt;try{var n=er;for(lt=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}er=null,vo=!1}catch(s){throw er!==null&&(er=er.slice(e+1)),Qh(Hu,Vr),s}finally{lt=t,cc=!1}}return null}var Os=[],Ds=0,Mi=null,Fi=0,pn=[],hn=0,os=null,nr=1,rr="";function Zr(e,t){Os[Ds++]=Fi,Os[Ds++]=Mi,Mi=e,Fi=t}function Cm(e,t,n){pn[hn++]=nr,pn[hn++]=rr,pn[hn++]=os,os=e;var r=nr;e=rr;var s=32-An(r)-1;r&=~(1<<s),n+=1;var a=32-An(t)+s;if(30<a){var i=s-s%5;a=(r&(1<<i)-1).toString(32),r>>=i,s-=i,nr=1<<32-An(t)+s|n<<s|r,rr=a+e}else nr=1<<a|n<<s|r,rr=e}function ed(e){e.return!==null&&(Zr(e,1),Cm(e,1,0))}function td(e){for(;e===Mi;)Mi=Os[--Ds],Os[Ds]=null,Fi=Os[--Ds],Os[Ds]=null;for(;e===os;)os=pn[--hn],pn[hn]=null,rr=pn[--hn],pn[hn]=null,nr=pn[--hn],pn[hn]=null}var sn=null,rn=null,ht=!1,zn=null;function bm(e,t){var n=mn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Zf(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,sn=e,rn=Ar(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,sn=e,rn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=os!==null?{id:nr,overflow:rr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=mn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,sn=e,rn=null,!0):!1;default:return!1}}function Zc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function eu(e){if(ht){var t=rn;if(t){var n=t;if(!Zf(e,t)){if(Zc(e))throw Error(te(418));t=Ar(n.nextSibling);var r=sn;t&&Zf(e,t)?bm(r,n):(e.flags=e.flags&-4097|2,ht=!1,sn=e)}}else{if(Zc(e))throw Error(te(418));e.flags=e.flags&-4097|2,ht=!1,sn=e}}}function ep(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;sn=e}function ti(e){if(e!==sn)return!1;if(!ht)return ep(e),ht=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Qc(e.type,e.memoizedProps)),t&&(t=rn)){if(Zc(e))throw Em(),Error(te(418));for(;t;)bm(e,t),t=Ar(t.nextSibling)}if(ep(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(te(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){rn=Ar(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}rn=null}}else rn=sn?Ar(e.stateNode.nextSibling):null;return!0}function Em(){for(var e=rn;e;)e=Ar(e.nextSibling)}function tl(){rn=sn=null,ht=!1}function nd(e){zn===null?zn=[e]:zn.push(e)}var sw=ur.ReactCurrentBatchConfig;function Ml(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(te(309));var r=n.stateNode}if(!r)throw Error(te(147,e));var s=r,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(i){var c=s.refs;i===null?delete c[a]:c[a]=i},t._stringRef=a,t)}if(typeof e!="string")throw Error(te(284));if(!n._owner)throw Error(te(290,e))}return e}function ni(e,t){throw e=Object.prototype.toString.call(t),Error(te(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function tp(e){var t=e._init;return t(e._payload)}function Lm(e){function t(h,f){if(e){var m=h.deletions;m===null?(h.deletions=[f],h.flags|=16):m.push(f)}}function n(h,f){if(!e)return null;for(;f!==null;)t(h,f),f=f.sibling;return null}function r(h,f){for(h=new Map;f!==null;)f.key!==null?h.set(f.key,f):h.set(f.index,f),f=f.sibling;return h}function s(h,f){return h=$r(h,f),h.index=0,h.sibling=null,h}function a(h,f,m){return h.index=m,e?(m=h.alternate,m!==null?(m=m.index,m<f?(h.flags|=2,f):m):(h.flags|=2,f)):(h.flags|=1048576,f)}function i(h){return e&&h.alternate===null&&(h.flags|=2),h}function c(h,f,m,w){return f===null||f.tag!==6?(f=gc(m,h.mode,w),f.return=h,f):(f=s(f,m),f.return=h,f)}function u(h,f,m,w){var C=m.type;return C===Rs?p(h,f,m.props.children,w,m.key):f!==null&&(f.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===jr&&tp(C)===f.type)?(w=s(f,m.props),w.ref=Ml(h,f,m),w.return=h,w):(w=ki(m.type,m.key,m.props,null,h.mode,w),w.ref=Ml(h,f,m),w.return=h,w)}function d(h,f,m,w){return f===null||f.tag!==4||f.stateNode.containerInfo!==m.containerInfo||f.stateNode.implementation!==m.implementation?(f=yc(m,h.mode,w),f.return=h,f):(f=s(f,m.children||[]),f.return=h,f)}function p(h,f,m,w,C){return f===null||f.tag!==7?(f=as(m,h.mode,w,C),f.return=h,f):(f=s(f,m),f.return=h,f)}function v(h,f,m){if(typeof f=="string"&&f!==""||typeof f=="number")return f=gc(""+f,h.mode,m),f.return=h,f;if(typeof f=="object"&&f!==null){switch(f.$$typeof){case Ha:return m=ki(f.type,f.key,f.props,null,h.mode,m),m.ref=Ml(h,null,f),m.return=h,m;case As:return f=yc(f,h.mode,m),f.return=h,f;case jr:var w=f._init;return v(h,w(f._payload),m)}if(Bl(f)||Al(f))return f=as(f,h.mode,m,null),f.return=h,f;ni(h,f)}return null}function g(h,f,m,w){var C=f!==null?f.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return C!==null?null:c(h,f,""+m,w);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Ha:return m.key===C?u(h,f,m,w):null;case As:return m.key===C?d(h,f,m,w):null;case jr:return C=m._init,g(h,f,C(m._payload),w)}if(Bl(m)||Al(m))return C!==null?null:p(h,f,m,w,null);ni(h,m)}return null}function x(h,f,m,w,C){if(typeof w=="string"&&w!==""||typeof w=="number")return h=h.get(m)||null,c(f,h,""+w,C);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Ha:return h=h.get(w.key===null?m:w.key)||null,u(f,h,w,C);case As:return h=h.get(w.key===null?m:w.key)||null,d(f,h,w,C);case jr:var E=w._init;return x(h,f,m,E(w._payload),C)}if(Bl(w)||Al(w))return h=h.get(m)||null,p(f,h,w,C,null);ni(f,w)}return null}function S(h,f,m,w){for(var C=null,E=null,P=f,M=f=0,B=null;P!==null&&M<m.length;M++){P.index>M?(B=P,P=null):B=P.sibling;var _=g(h,P,m[M],w);if(_===null){P===null&&(P=B);break}e&&P&&_.alternate===null&&t(h,P),f=a(_,f,M),E===null?C=_:E.sibling=_,E=_,P=B}if(M===m.length)return n(h,P),ht&&Zr(h,M),C;if(P===null){for(;M<m.length;M++)P=v(h,m[M],w),P!==null&&(f=a(P,f,M),E===null?C=P:E.sibling=P,E=P);return ht&&Zr(h,M),C}for(P=r(h,P);M<m.length;M++)B=x(P,h,M,m[M],w),B!==null&&(e&&B.alternate!==null&&P.delete(B.key===null?M:B.key),f=a(B,f,M),E===null?C=B:E.sibling=B,E=B);return e&&P.forEach(function(T){return t(h,T)}),ht&&Zr(h,M),C}function k(h,f,m,w){var C=Al(m);if(typeof C!="function")throw Error(te(150));if(m=C.call(m),m==null)throw Error(te(151));for(var E=C=null,P=f,M=f=0,B=null,_=m.next();P!==null&&!_.done;M++,_=m.next()){P.index>M?(B=P,P=null):B=P.sibling;var T=g(h,P,_.value,w);if(T===null){P===null&&(P=B);break}e&&P&&T.alternate===null&&t(h,P),f=a(T,f,M),E===null?C=T:E.sibling=T,E=T,P=B}if(_.done)return n(h,P),ht&&Zr(h,M),C;if(P===null){for(;!_.done;M++,_=m.next())_=v(h,_.value,w),_!==null&&(f=a(_,f,M),E===null?C=_:E.sibling=_,E=_);return ht&&Zr(h,M),C}for(P=r(h,P);!_.done;M++,_=m.next())_=x(P,h,M,_.value,w),_!==null&&(e&&_.alternate!==null&&P.delete(_.key===null?M:_.key),f=a(_,f,M),E===null?C=_:E.sibling=_,E=_);return e&&P.forEach(function(q){return t(h,q)}),ht&&Zr(h,M),C}function j(h,f,m,w){if(typeof m=="object"&&m!==null&&m.type===Rs&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case Ha:e:{for(var C=m.key,E=f;E!==null;){if(E.key===C){if(C=m.type,C===Rs){if(E.tag===7){n(h,E.sibling),f=s(E,m.props.children),f.return=h,h=f;break e}}else if(E.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===jr&&tp(C)===E.type){n(h,E.sibling),f=s(E,m.props),f.ref=Ml(h,E,m),f.return=h,h=f;break e}n(h,E);break}else t(h,E);E=E.sibling}m.type===Rs?(f=as(m.props.children,h.mode,w,m.key),f.return=h,h=f):(w=ki(m.type,m.key,m.props,null,h.mode,w),w.ref=Ml(h,f,m),w.return=h,h=w)}return i(h);case As:e:{for(E=m.key;f!==null;){if(f.key===E)if(f.tag===4&&f.stateNode.containerInfo===m.containerInfo&&f.stateNode.implementation===m.implementation){n(h,f.sibling),f=s(f,m.children||[]),f.return=h,h=f;break e}else{n(h,f);break}else t(h,f);f=f.sibling}f=yc(m,h.mode,w),f.return=h,h=f}return i(h);case jr:return E=m._init,j(h,f,E(m._payload),w)}if(Bl(m))return S(h,f,m,w);if(Al(m))return k(h,f,m,w);ni(h,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,f!==null&&f.tag===6?(n(h,f.sibling),f=s(f,m),f.return=h,h=f):(n(h,f),f=gc(m,h.mode,w),f.return=h,h=f),i(h)):n(h,f)}return j}var nl=Lm(!0),Pm=Lm(!1),Oi=Ur(null),Di=null,Bs=null,rd=null;function sd(){rd=Bs=Di=null}function ld(e){var t=Oi.current;ft(Oi),e._currentValue=t}function tu(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function qs(e,t){Di=e,rd=Bs=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Qt=!0),e.firstContext=null)}function vn(e){var t=e._currentValue;if(rd!==e)if(e={context:e,memoizedValue:t,next:null},Bs===null){if(Di===null)throw Error(te(308));Bs=e,Di.dependencies={lanes:0,firstContext:e}}else Bs=Bs.next=e;return t}var rs=null;function ad(e){rs===null?rs=[e]:rs.push(e)}function zm(e,t,n,r){var s=t.interleaved;return s===null?(n.next=n,ad(t)):(n.next=s.next,s.next=n),t.interleaved=n,or(e,r)}function or(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var kr=!1;function id(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _m(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function sr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Rr(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Je&2){var s=r.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),r.pending=t,or(e,n)}return s=r.interleaved,s===null?(t.next=t,ad(r)):(t.next=s.next,s.next=t),r.interleaved=t,or(e,n)}function yi(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Ku(e,n)}}function np(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?s=a=i:a=a.next=i,n=n.next}while(n!==null);a===null?s=a=t:a=a.next=t}else s=a=t;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Bi(e,t,n,r){var s=e.updateQueue;kr=!1;var a=s.firstBaseUpdate,i=s.lastBaseUpdate,c=s.shared.pending;if(c!==null){s.shared.pending=null;var u=c,d=u.next;u.next=null,i===null?a=d:i.next=d,i=u;var p=e.alternate;p!==null&&(p=p.updateQueue,c=p.lastBaseUpdate,c!==i&&(c===null?p.firstBaseUpdate=d:c.next=d,p.lastBaseUpdate=u))}if(a!==null){var v=s.baseState;i=0,p=d=u=null,c=a;do{var g=c.lane,x=c.eventTime;if((r&g)===g){p!==null&&(p=p.next={eventTime:x,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var S=e,k=c;switch(g=t,x=n,k.tag){case 1:if(S=k.payload,typeof S=="function"){v=S.call(x,v,g);break e}v=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=k.payload,g=typeof S=="function"?S.call(x,v,g):S,g==null)break e;v=xt({},v,g);break e;case 2:kr=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,g=s.effects,g===null?s.effects=[c]:g.push(c))}else x={eventTime:x,lane:g,tag:c.tag,payload:c.payload,callback:c.callback,next:null},p===null?(d=p=x,u=v):p=p.next=x,i|=g;if(c=c.next,c===null){if(c=s.shared.pending,c===null)break;g=c,c=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(!0);if(p===null&&(u=v),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=p,t=s.shared.interleaved,t!==null){s=t;do i|=s.lane,s=s.next;while(s!==t)}else a===null&&(s.shared.lanes=0);us|=i,e.lanes=i,e.memoizedState=v}}function rp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(te(191,s));s.call(r)}}}var za={},Qn=Ur(za),ga=Ur(za),ya=Ur(za);function ss(e){if(e===za)throw Error(te(174));return e}function od(e,t){switch(it(ya,t),it(ga,e),it(Qn,za),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ic(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ic(t,e)}ft(Qn),it(Qn,t)}function rl(){ft(Qn),ft(ga),ft(ya)}function Am(e){ss(ya.current);var t=ss(Qn.current),n=Ic(t,e.type);t!==n&&(it(ga,e),it(Qn,n))}function cd(e){ga.current===e&&(ft(Qn),ft(ga))}var gt=Ur(0);function Ui(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var uc=[];function ud(){for(var e=0;e<uc.length;e++)uc[e]._workInProgressVersionPrimary=null;uc.length=0}var vi=ur.ReactCurrentDispatcher,dc=ur.ReactCurrentBatchConfig,cs=0,yt=null,bt=null,Pt=null,Vi=!1,Jl=!1,va=0,lw=0;function It(){throw Error(te(321))}function dd(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!In(e[n],t[n]))return!1;return!0}function fd(e,t,n,r,s,a){if(cs=a,yt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,vi.current=e===null||e.memoizedState===null?cw:uw,e=n(r,s),Jl){a=0;do{if(Jl=!1,va=0,25<=a)throw Error(te(301));a+=1,Pt=bt=null,t.updateQueue=null,vi.current=dw,e=n(r,s)}while(Jl)}if(vi.current=Wi,t=bt!==null&&bt.next!==null,cs=0,Pt=bt=yt=null,Vi=!1,t)throw Error(te(300));return e}function pd(){var e=va!==0;return va=0,e}function Dn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?yt.memoizedState=Pt=e:Pt=Pt.next=e,Pt}function xn(){if(bt===null){var e=yt.alternate;e=e!==null?e.memoizedState:null}else e=bt.next;var t=Pt===null?yt.memoizedState:Pt.next;if(t!==null)Pt=t,bt=e;else{if(e===null)throw Error(te(310));bt=e,e={memoizedState:bt.memoizedState,baseState:bt.baseState,baseQueue:bt.baseQueue,queue:bt.queue,next:null},Pt===null?yt.memoizedState=Pt=e:Pt=Pt.next=e}return Pt}function xa(e,t){return typeof t=="function"?t(e):t}function fc(e){var t=xn(),n=t.queue;if(n===null)throw Error(te(311));n.lastRenderedReducer=e;var r=bt,s=r.baseQueue,a=n.pending;if(a!==null){if(s!==null){var i=s.next;s.next=a.next,a.next=i}r.baseQueue=s=a,n.pending=null}if(s!==null){a=s.next,r=r.baseState;var c=i=null,u=null,d=a;do{var p=d.lane;if((cs&p)===p)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var v={lane:p,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(c=u=v,i=r):u=u.next=v,yt.lanes|=p,us|=p}d=d.next}while(d!==null&&d!==a);u===null?i=r:u.next=c,In(r,t.memoizedState)||(Qt=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=u,n.lastRenderedState=r}if(e=n.interleaved,e!==null){s=e;do a=s.lane,yt.lanes|=a,us|=a,s=s.next;while(s!==e)}else s===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function pc(e){var t=xn(),n=t.queue;if(n===null)throw Error(te(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,a=t.memoizedState;if(s!==null){n.pending=null;var i=s=s.next;do a=e(a,i.action),i=i.next;while(i!==s);In(a,t.memoizedState)||(Qt=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Rm(){}function Tm(e,t){var n=yt,r=xn(),s=t(),a=!In(r.memoizedState,s);if(a&&(r.memoizedState=s,Qt=!0),r=r.queue,hd(Mm.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||Pt!==null&&Pt.memoizedState.tag&1){if(n.flags|=2048,wa(9,$m.bind(null,n,r,s,t),void 0,null),zt===null)throw Error(te(349));cs&30||Im(n,t,s)}return s}function Im(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=yt.updateQueue,t===null?(t={lastEffect:null,stores:null},yt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function $m(e,t,n,r){t.value=n,t.getSnapshot=r,Fm(t)&&Om(e)}function Mm(e,t,n){return n(function(){Fm(t)&&Om(e)})}function Fm(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!In(e,n)}catch{return!0}}function Om(e){var t=or(e,1);t!==null&&Rn(t,e,1,-1)}function sp(e){var t=Dn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:e},t.queue=e,e=e.dispatch=ow.bind(null,yt,e),[t.memoizedState,e]}function wa(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=yt.updateQueue,t===null?(t={lastEffect:null,stores:null},yt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Dm(){return xn().memoizedState}function xi(e,t,n,r){var s=Dn();yt.flags|=e,s.memoizedState=wa(1|t,n,void 0,r===void 0?null:r)}function xo(e,t,n,r){var s=xn();r=r===void 0?null:r;var a=void 0;if(bt!==null){var i=bt.memoizedState;if(a=i.destroy,r!==null&&dd(r,i.deps)){s.memoizedState=wa(t,n,a,r);return}}yt.flags|=e,s.memoizedState=wa(1|t,n,a,r)}function lp(e,t){return xi(8390656,8,e,t)}function hd(e,t){return xo(2048,8,e,t)}function Bm(e,t){return xo(4,2,e,t)}function Um(e,t){return xo(4,4,e,t)}function Vm(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Wm(e,t,n){return n=n!=null?n.concat([e]):null,xo(4,4,Vm.bind(null,t,e),n)}function md(){}function Hm(e,t){var n=xn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&dd(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Km(e,t){var n=xn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&dd(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Gm(e,t,n){return cs&21?(In(n,t)||(n=Jh(),yt.lanes|=n,us|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Qt=!0),e.memoizedState=n)}function aw(e,t){var n=lt;lt=n!==0&&4>n?n:4,e(!0);var r=dc.transition;dc.transition={};try{e(!1),t()}finally{lt=n,dc.transition=r}}function Ym(){return xn().memoizedState}function iw(e,t,n){var r=Ir(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Qm(e))qm(t,n);else if(n=zm(e,t,n,r),n!==null){var s=Ut();Rn(n,e,r,s),Xm(n,t,r)}}function ow(e,t,n){var r=Ir(e),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qm(e))qm(t,s);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var i=t.lastRenderedState,c=a(i,n);if(s.hasEagerState=!0,s.eagerState=c,In(c,i)){var u=t.interleaved;u===null?(s.next=s,ad(t)):(s.next=u.next,u.next=s),t.interleaved=s;return}}catch{}finally{}n=zm(e,t,s,r),n!==null&&(s=Ut(),Rn(n,e,r,s),Xm(n,t,r))}}function Qm(e){var t=e.alternate;return e===yt||t!==null&&t===yt}function qm(e,t){Jl=Vi=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Xm(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Ku(e,n)}}var Wi={readContext:vn,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useInsertionEffect:It,useLayoutEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useMutableSource:It,useSyncExternalStore:It,useId:It,unstable_isNewReconciler:!1},cw={readContext:vn,useCallback:function(e,t){return Dn().memoizedState=[e,t===void 0?null:t],e},useContext:vn,useEffect:lp,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,xi(4194308,4,Vm.bind(null,t,e),n)},useLayoutEffect:function(e,t){return xi(4194308,4,e,t)},useInsertionEffect:function(e,t){return xi(4,2,e,t)},useMemo:function(e,t){var n=Dn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Dn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=iw.bind(null,yt,e),[r.memoizedState,e]},useRef:function(e){var t=Dn();return e={current:e},t.memoizedState=e},useState:sp,useDebugValue:md,useDeferredValue:function(e){return Dn().memoizedState=e},useTransition:function(){var e=sp(!1),t=e[0];return e=aw.bind(null,e[1]),Dn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=yt,s=Dn();if(ht){if(n===void 0)throw Error(te(407));n=n()}else{if(n=t(),zt===null)throw Error(te(349));cs&30||Im(r,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,lp(Mm.bind(null,r,a,e),[e]),r.flags|=2048,wa(9,$m.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Dn(),t=zt.identifierPrefix;if(ht){var n=rr,r=nr;n=(r&~(1<<32-An(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=va++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=lw++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},uw={readContext:vn,useCallback:Hm,useContext:vn,useEffect:hd,useImperativeHandle:Wm,useInsertionEffect:Bm,useLayoutEffect:Um,useMemo:Km,useReducer:fc,useRef:Dm,useState:function(){return fc(xa)},useDebugValue:md,useDeferredValue:function(e){var t=xn();return Gm(t,bt.memoizedState,e)},useTransition:function(){var e=fc(xa)[0],t=xn().memoizedState;return[e,t]},useMutableSource:Rm,useSyncExternalStore:Tm,useId:Ym,unstable_isNewReconciler:!1},dw={readContext:vn,useCallback:Hm,useContext:vn,useEffect:hd,useImperativeHandle:Wm,useInsertionEffect:Bm,useLayoutEffect:Um,useMemo:Km,useReducer:pc,useRef:Dm,useState:function(){return pc(xa)},useDebugValue:md,useDeferredValue:function(e){var t=xn();return bt===null?t.memoizedState=e:Gm(t,bt.memoizedState,e)},useTransition:function(){var e=pc(xa)[0],t=xn().memoizedState;return[e,t]},useMutableSource:Rm,useSyncExternalStore:Tm,useId:Ym,unstable_isNewReconciler:!1};function Ln(e,t){if(e&&e.defaultProps){t=xt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function nu(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:xt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var wo={isMounted:function(e){return(e=e._reactInternals)?ps(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Ut(),s=Ir(e),a=sr(r,s);a.payload=t,n!=null&&(a.callback=n),t=Rr(e,a,s),t!==null&&(Rn(t,e,s,r),yi(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Ut(),s=Ir(e),a=sr(r,s);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=Rr(e,a,s),t!==null&&(Rn(t,e,s,r),yi(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ut(),r=Ir(e),s=sr(n,r);s.tag=2,t!=null&&(s.callback=t),t=Rr(e,s,r),t!==null&&(Rn(t,e,r,n),yi(t,e,r))}};function ap(e,t,n,r,s,a,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,a,i):t.prototype&&t.prototype.isPureReactComponent?!fa(n,r)||!fa(s,a):!0}function Jm(e,t,n){var r=!1,s=Or,a=t.contextType;return typeof a=="object"&&a!==null?a=vn(a):(s=Xt(t)?is:Ot.current,r=t.contextTypes,a=(r=r!=null)?el(e,s):Or),t=new t(n,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=wo,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=a),t}function ip(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&wo.enqueueReplaceState(t,t.state,null)}function ru(e,t,n,r){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},id(e);var a=t.contextType;typeof a=="object"&&a!==null?s.context=vn(a):(a=Xt(t)?is:Ot.current,s.context=el(e,a)),s.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(nu(e,t,a,n),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&wo.enqueueReplaceState(s,s.state,null),Bi(e,n,s,r),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function sl(e,t){try{var n="",r=t;do n+=Ov(r),r=r.return;while(r);var s=n}catch(a){s=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:s,digest:null}}function hc(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function su(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var fw=typeof WeakMap=="function"?WeakMap:Map;function Zm(e,t,n){n=sr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Ki||(Ki=!0,hu=r),su(e,t)},n}function eg(e,t,n){n=sr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var s=t.value;n.payload=function(){return r(s)},n.callback=function(){su(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){su(e,t),typeof r!="function"&&(Tr===null?Tr=new Set([this]):Tr.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),n}function op(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new fw;var s=new Set;r.set(t,s)}else s=r.get(t),s===void 0&&(s=new Set,r.set(t,s));s.has(n)||(s.add(n),e=bw.bind(null,e,t,n),t.then(e,e))}function cp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function up(e,t,n,r,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=sr(-1,1),t.tag=2,Rr(n,t,1))),n.lanes|=1),e)}var pw=ur.ReactCurrentOwner,Qt=!1;function Bt(e,t,n,r){t.child=e===null?Pm(t,null,n,r):nl(t,e.child,n,r)}function dp(e,t,n,r,s){n=n.render;var a=t.ref;return qs(t,s),r=fd(e,t,n,r,a,s),n=pd(),e!==null&&!Qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,cr(e,t,s)):(ht&&n&&ed(t),t.flags|=1,Bt(e,t,r,s),t.child)}function fp(e,t,n,r,s){if(e===null){var a=n.type;return typeof a=="function"&&!kd(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=a,tg(e,t,a,r,s)):(e=ki(n.type,null,r,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&s)){var i=a.memoizedProps;if(n=n.compare,n=n!==null?n:fa,n(i,r)&&e.ref===t.ref)return cr(e,t,s)}return t.flags|=1,e=$r(a,r),e.ref=t.ref,e.return=t,t.child=e}function tg(e,t,n,r,s){if(e!==null){var a=e.memoizedProps;if(fa(a,r)&&e.ref===t.ref)if(Qt=!1,t.pendingProps=r=a,(e.lanes&s)!==0)e.flags&131072&&(Qt=!0);else return t.lanes=e.lanes,cr(e,t,s)}return lu(e,t,n,r,s)}function ng(e,t,n){var r=t.pendingProps,s=r.children,a=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},it(Vs,nn),nn|=n;else{if(!(n&1073741824))return e=a!==null?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,it(Vs,nn),nn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,it(Vs,nn),nn|=r}else a!==null?(r=a.baseLanes|n,t.memoizedState=null):r=n,it(Vs,nn),nn|=r;return Bt(e,t,s,n),t.child}function rg(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function lu(e,t,n,r,s){var a=Xt(n)?is:Ot.current;return a=el(t,a),qs(t,s),n=fd(e,t,n,r,a,s),r=pd(),e!==null&&!Qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,cr(e,t,s)):(ht&&r&&ed(t),t.flags|=1,Bt(e,t,n,s),t.child)}function pp(e,t,n,r,s){if(Xt(n)){var a=!0;$i(t)}else a=!1;if(qs(t,s),t.stateNode===null)wi(e,t),Jm(t,n,r),ru(t,n,r,s),r=!0;else if(e===null){var i=t.stateNode,c=t.memoizedProps;i.props=c;var u=i.context,d=n.contextType;typeof d=="object"&&d!==null?d=vn(d):(d=Xt(n)?is:Ot.current,d=el(t,d));var p=n.getDerivedStateFromProps,v=typeof p=="function"||typeof i.getSnapshotBeforeUpdate=="function";v||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(c!==r||u!==d)&&ip(t,i,r,d),kr=!1;var g=t.memoizedState;i.state=g,Bi(t,r,i,s),u=t.memoizedState,c!==r||g!==u||qt.current||kr?(typeof p=="function"&&(nu(t,n,p,r),u=t.memoizedState),(c=kr||ap(t,n,c,r,g,u,d))?(v||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),i.props=r,i.state=u,i.context=d,r=c):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,_m(e,t),c=t.memoizedProps,d=t.type===t.elementType?c:Ln(t.type,c),i.props=d,v=t.pendingProps,g=i.context,u=n.contextType,typeof u=="object"&&u!==null?u=vn(u):(u=Xt(n)?is:Ot.current,u=el(t,u));var x=n.getDerivedStateFromProps;(p=typeof x=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(c!==v||g!==u)&&ip(t,i,r,u),kr=!1,g=t.memoizedState,i.state=g,Bi(t,r,i,s);var S=t.memoizedState;c!==v||g!==S||qt.current||kr?(typeof x=="function"&&(nu(t,n,x,r),S=t.memoizedState),(d=kr||ap(t,n,d,r,g,S,u)||!1)?(p||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(r,S,u),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(r,S,u)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||c===e.memoizedProps&&g===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&g===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=S),i.props=r,i.state=S,i.context=u,r=d):(typeof i.componentDidUpdate!="function"||c===e.memoizedProps&&g===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&g===e.memoizedState||(t.flags|=1024),r=!1)}return au(e,t,n,r,a,s)}function au(e,t,n,r,s,a){rg(e,t);var i=(t.flags&128)!==0;if(!r&&!i)return s&&Jf(t,n,!1),cr(e,t,a);r=t.stateNode,pw.current=t;var c=i&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&i?(t.child=nl(t,e.child,null,a),t.child=nl(t,null,c,a)):Bt(e,t,c,a),t.memoizedState=r.state,s&&Jf(t,n,!0),t.child}function sg(e){var t=e.stateNode;t.pendingContext?Xf(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Xf(e,t.context,!1),od(e,t.containerInfo)}function hp(e,t,n,r,s){return tl(),nd(s),t.flags|=256,Bt(e,t,n,r),t.child}var iu={dehydrated:null,treeContext:null,retryLane:0};function ou(e){return{baseLanes:e,cachePool:null,transitions:null}}function lg(e,t,n){var r=t.pendingProps,s=gt.current,a=!1,i=(t.flags&128)!==0,c;if((c=i)||(c=e!==null&&e.memoizedState===null?!1:(s&2)!==0),c?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),it(gt,s&1),e===null)return eu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=r.children,e=r.fallback,a?(r=t.mode,a=t.child,i={mode:"hidden",children:i},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=i):a=ko(i,r,0,null),e=as(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=ou(n),t.memoizedState=iu,e):gd(t,i));if(s=e.memoizedState,s!==null&&(c=s.dehydrated,c!==null))return hw(e,t,i,r,c,s,n);if(a){a=r.fallback,i=t.mode,s=e.child,c=s.sibling;var u={mode:"hidden",children:r.children};return!(i&1)&&t.child!==s?(r=t.child,r.childLanes=0,r.pendingProps=u,t.deletions=null):(r=$r(s,u),r.subtreeFlags=s.subtreeFlags&14680064),c!==null?a=$r(c,a):(a=as(a,i,n,null),a.flags|=2),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,i=e.child.memoizedState,i=i===null?ou(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},a.memoizedState=i,a.childLanes=e.childLanes&~n,t.memoizedState=iu,r}return a=e.child,e=a.sibling,r=$r(a,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function gd(e,t){return t=ko({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function ri(e,t,n,r){return r!==null&&nd(r),nl(t,e.child,null,n),e=gd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function hw(e,t,n,r,s,a,i){if(n)return t.flags&256?(t.flags&=-257,r=hc(Error(te(422))),ri(e,t,i,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=r.fallback,s=t.mode,r=ko({mode:"visible",children:r.children},s,0,null),a=as(a,s,i,null),a.flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,t.mode&1&&nl(t,e.child,null,i),t.child.memoizedState=ou(i),t.memoizedState=iu,a);if(!(t.mode&1))return ri(e,t,i,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var c=r.dgst;return r=c,a=Error(te(419)),r=hc(a,r,void 0),ri(e,t,i,r)}if(c=(i&e.childLanes)!==0,Qt||c){if(r=zt,r!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|i)?0:s,s!==0&&s!==a.retryLane&&(a.retryLane=s,or(e,s),Rn(r,e,s,-1))}return jd(),r=hc(Error(te(421))),ri(e,t,i,r)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=Ew.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,rn=Ar(s.nextSibling),sn=t,ht=!0,zn=null,e!==null&&(pn[hn++]=nr,pn[hn++]=rr,pn[hn++]=os,nr=e.id,rr=e.overflow,os=t),t=gd(t,r.children),t.flags|=4096,t)}function mp(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),tu(e.return,t,n)}function mc(e,t,n,r,s){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=s)}function ag(e,t,n){var r=t.pendingProps,s=r.revealOrder,a=r.tail;if(Bt(e,t,r.children,n),r=gt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&mp(e,n,t);else if(e.tag===19)mp(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(it(gt,r),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;n!==null;)e=n.alternate,e!==null&&Ui(e)===null&&(s=n),n=n.sibling;n=s,n===null?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),mc(t,!1,s,n,a);break;case"backwards":for(n=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&Ui(e)===null){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}mc(t,!0,n,null,a);break;case"together":mc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function wi(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function cr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),us|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(te(153));if(t.child!==null){for(e=t.child,n=$r(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=$r(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function mw(e,t,n){switch(t.tag){case 3:sg(t),tl();break;case 5:Am(t);break;case 1:Xt(t.type)&&$i(t);break;case 4:od(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,s=t.memoizedProps.value;it(Oi,r._currentValue),r._currentValue=s;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(it(gt,gt.current&1),t.flags|=128,null):n&t.child.childLanes?lg(e,t,n):(it(gt,gt.current&1),e=cr(e,t,n),e!==null?e.sibling:null);it(gt,gt.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return ag(e,t,n);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),it(gt,gt.current),r)break;return null;case 22:case 23:return t.lanes=0,ng(e,t,n)}return cr(e,t,n)}var ig,cu,og,cg;ig=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};cu=function(){};og=function(e,t,n,r){var s=e.memoizedProps;if(s!==r){e=t.stateNode,ss(Qn.current);var a=null;switch(n){case"input":s=_c(e,s),r=_c(e,r),a=[];break;case"select":s=xt({},s,{value:void 0}),r=xt({},r,{value:void 0}),a=[];break;case"textarea":s=Tc(e,s),r=Tc(e,r),a=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Ti)}$c(n,r);var i;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var c=s[d];for(i in c)c.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(la.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var u=r[d];if(c=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==c&&(u!=null||c!=null))if(d==="style")if(c){for(i in c)!c.hasOwnProperty(i)||u&&u.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in u)u.hasOwnProperty(i)&&c[i]!==u[i]&&(n||(n={}),n[i]=u[i])}else n||(a||(a=[]),a.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(a=a||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(a=a||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(la.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&dt("scroll",e),a||c===u||(a=[])):(a=a||[]).push(d,u))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}};cg=function(e,t,n,r){n!==r&&(t.flags|=4)};function Fl(e,t){if(!ht)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function $t(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var s=e.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function gw(e,t,n){var r=t.pendingProps;switch(td(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $t(t),null;case 1:return Xt(t.type)&&Ii(),$t(t),null;case 3:return r=t.stateNode,rl(),ft(qt),ft(Ot),ud(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(ti(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,zn!==null&&(yu(zn),zn=null))),cu(e,t),$t(t),null;case 5:cd(t);var s=ss(ya.current);if(n=t.type,e!==null&&t.stateNode!=null)og(e,t,n,r,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(te(166));return $t(t),null}if(e=ss(Qn.current),ti(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[Un]=t,r[ma]=a,e=(t.mode&1)!==0,n){case"dialog":dt("cancel",r),dt("close",r);break;case"iframe":case"object":case"embed":dt("load",r);break;case"video":case"audio":for(s=0;s<Vl.length;s++)dt(Vl[s],r);break;case"source":dt("error",r);break;case"img":case"image":case"link":dt("error",r),dt("load",r);break;case"details":dt("toggle",r);break;case"input":Nf(r,a),dt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},dt("invalid",r);break;case"textarea":bf(r,a),dt("invalid",r)}$c(n,a),s=null;for(var i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="children"?typeof c=="string"?r.textContent!==c&&(a.suppressHydrationWarning!==!0&&ei(r.textContent,c,e),s=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(a.suppressHydrationWarning!==!0&&ei(r.textContent,c,e),s=["children",""+c]):la.hasOwnProperty(i)&&c!=null&&i==="onScroll"&&dt("scroll",r)}switch(n){case"input":Ka(r),Cf(r,a,!0);break;case"textarea":Ka(r),Ef(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Ti)}r=s,t.updateQueue=r,r!==null&&(t.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Mh(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=i.createElement(n,{is:r.is}):(e=i.createElement(n),n==="select"&&(i=e,r.multiple?i.multiple=!0:r.size&&(i.size=r.size))):e=i.createElementNS(e,n),e[Un]=t,e[ma]=r,ig(e,t,!1,!1),t.stateNode=e;e:{switch(i=Mc(n,r),n){case"dialog":dt("cancel",e),dt("close",e),s=r;break;case"iframe":case"object":case"embed":dt("load",e),s=r;break;case"video":case"audio":for(s=0;s<Vl.length;s++)dt(Vl[s],e);s=r;break;case"source":dt("error",e),s=r;break;case"img":case"image":case"link":dt("error",e),dt("load",e),s=r;break;case"details":dt("toggle",e),s=r;break;case"input":Nf(e,r),s=_c(e,r),dt("invalid",e);break;case"option":s=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},s=xt({},r,{value:void 0}),dt("invalid",e);break;case"textarea":bf(e,r),s=Tc(e,r),dt("invalid",e);break;default:s=r}$c(n,s),c=s;for(a in c)if(c.hasOwnProperty(a)){var u=c[a];a==="style"?Dh(e,u):a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Fh(e,u)):a==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&aa(e,u):typeof u=="number"&&aa(e,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(la.hasOwnProperty(a)?u!=null&&a==="onScroll"&&dt("scroll",e):u!=null&&Du(e,a,u,i))}switch(n){case"input":Ka(e),Cf(e,r,!1);break;case"textarea":Ka(e),Ef(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Fr(r.value));break;case"select":e.multiple=!!r.multiple,a=r.value,a!=null?Ks(e,!!r.multiple,a,!1):r.defaultValue!=null&&Ks(e,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=Ti)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return $t(t),null;case 6:if(e&&t.stateNode!=null)cg(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(te(166));if(n=ss(ya.current),ss(Qn.current),ti(t)){if(r=t.stateNode,n=t.memoizedProps,r[Un]=t,(a=r.nodeValue!==n)&&(e=sn,e!==null))switch(e.tag){case 3:ei(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ei(r.nodeValue,n,(e.mode&1)!==0)}a&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Un]=t,t.stateNode=r}return $t(t),null;case 13:if(ft(gt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ht&&rn!==null&&t.mode&1&&!(t.flags&128))Em(),tl(),t.flags|=98560,a=!1;else if(a=ti(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(te(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(te(317));a[Un]=t}else tl(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;$t(t),a=!1}else zn!==null&&(yu(zn),zn=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||gt.current&1?Et===0&&(Et=3):jd())),t.updateQueue!==null&&(t.flags|=4),$t(t),null);case 4:return rl(),cu(e,t),e===null&&pa(t.stateNode.containerInfo),$t(t),null;case 10:return ld(t.type._context),$t(t),null;case 17:return Xt(t.type)&&Ii(),$t(t),null;case 19:if(ft(gt),a=t.memoizedState,a===null)return $t(t),null;if(r=(t.flags&128)!==0,i=a.rendering,i===null)if(r)Fl(a,!1);else{if(Et!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=Ui(e),i!==null){for(t.flags|=128,Fl(a,!1),r=i.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)a=n,e=r,a.flags&=14680066,i=a.alternate,i===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,a.type=i.type,e=i.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return it(gt,gt.current&1|2),t.child}e=e.sibling}a.tail!==null&&kt()>ll&&(t.flags|=128,r=!0,Fl(a,!1),t.lanes=4194304)}else{if(!r)if(e=Ui(i),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Fl(a,!0),a.tail===null&&a.tailMode==="hidden"&&!i.alternate&&!ht)return $t(t),null}else 2*kt()-a.renderingStartTime>ll&&n!==1073741824&&(t.flags|=128,r=!0,Fl(a,!1),t.lanes=4194304);a.isBackwards?(i.sibling=t.child,t.child=i):(n=a.last,n!==null?n.sibling=i:t.child=i,a.last=i)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=kt(),t.sibling=null,n=gt.current,it(gt,r?n&1|2:n&1),t):($t(t),null);case 22:case 23:return Sd(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?nn&1073741824&&($t(t),t.subtreeFlags&6&&(t.flags|=8192)):$t(t),null;case 24:return null;case 25:return null}throw Error(te(156,t.tag))}function yw(e,t){switch(td(t),t.tag){case 1:return Xt(t.type)&&Ii(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return rl(),ft(qt),ft(Ot),ud(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return cd(t),null;case 13:if(ft(gt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(te(340));tl()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ft(gt),null;case 4:return rl(),null;case 10:return ld(t.type._context),null;case 22:case 23:return Sd(),null;case 24:return null;default:return null}}var si=!1,Mt=!1,vw=typeof WeakSet=="function"?WeakSet:Set,Se=null;function Us(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){St(e,t,r)}else n.current=null}function uu(e,t,n){try{n()}catch(r){St(e,t,r)}}var gp=!1;function xw(e,t){if(Gc=_i,e=hm(),Zu(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var i=0,c=-1,u=-1,d=0,p=0,v=e,g=null;t:for(;;){for(var x;v!==n||s!==0&&v.nodeType!==3||(c=i+s),v!==a||r!==0&&v.nodeType!==3||(u=i+r),v.nodeType===3&&(i+=v.nodeValue.length),(x=v.firstChild)!==null;)g=v,v=x;for(;;){if(v===e)break t;if(g===n&&++d===s&&(c=i),g===a&&++p===r&&(u=i),(x=v.nextSibling)!==null)break;v=g,g=v.parentNode}v=x}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Yc={focusedElem:e,selectionRange:n},_i=!1,Se=t;Se!==null;)if(t=Se,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Se=e;else for(;Se!==null;){t=Se;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var k=S.memoizedProps,j=S.memoizedState,h=t.stateNode,f=h.getSnapshotBeforeUpdate(t.elementType===t.type?k:Ln(t.type,k),j);h.__reactInternalSnapshotBeforeUpdate=f}break;case 3:var m=t.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(te(163))}}catch(w){St(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,Se=e;break}Se=t.return}return S=gp,gp=!1,S}function Zl(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&e)===e){var a=s.destroy;s.destroy=void 0,a!==void 0&&uu(t,n,a)}s=s.next}while(s!==r)}}function So(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function du(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function ug(e){var t=e.alternate;t!==null&&(e.alternate=null,ug(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Un],delete t[ma],delete t[Xc],delete t[tw],delete t[nw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function dg(e){return e.tag===5||e.tag===3||e.tag===4}function yp(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||dg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function fu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Ti));else if(r!==4&&(e=e.child,e!==null))for(fu(e,t,n),e=e.sibling;e!==null;)fu(e,t,n),e=e.sibling}function pu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(pu(e,t,n),e=e.sibling;e!==null;)pu(e,t,n),e=e.sibling}var At=null,Pn=!1;function Sr(e,t,n){for(n=n.child;n!==null;)fg(e,t,n),n=n.sibling}function fg(e,t,n){if(Yn&&typeof Yn.onCommitFiberUnmount=="function")try{Yn.onCommitFiberUnmount(po,n)}catch{}switch(n.tag){case 5:Mt||Us(n,t);case 6:var r=At,s=Pn;At=null,Sr(e,t,n),At=r,Pn=s,At!==null&&(Pn?(e=At,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):At.removeChild(n.stateNode));break;case 18:At!==null&&(Pn?(e=At,n=n.stateNode,e.nodeType===8?oc(e.parentNode,n):e.nodeType===1&&oc(e,n),ua(e)):oc(At,n.stateNode));break;case 4:r=At,s=Pn,At=n.stateNode.containerInfo,Pn=!0,Sr(e,t,n),At=r,Pn=s;break;case 0:case 11:case 14:case 15:if(!Mt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var a=s,i=a.destroy;a=a.tag,i!==void 0&&(a&2||a&4)&&uu(n,t,i),s=s.next}while(s!==r)}Sr(e,t,n);break;case 1:if(!Mt&&(Us(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){St(n,t,c)}Sr(e,t,n);break;case 21:Sr(e,t,n);break;case 22:n.mode&1?(Mt=(r=Mt)||n.memoizedState!==null,Sr(e,t,n),Mt=r):Sr(e,t,n);break;default:Sr(e,t,n)}}function vp(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new vw),t.forEach(function(r){var s=Lw.bind(null,e,r);n.has(r)||(n.add(r),r.then(s,s))})}}function En(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var a=e,i=t,c=i;e:for(;c!==null;){switch(c.tag){case 5:At=c.stateNode,Pn=!1;break e;case 3:At=c.stateNode.containerInfo,Pn=!0;break e;case 4:At=c.stateNode.containerInfo,Pn=!0;break e}c=c.return}if(At===null)throw Error(te(160));fg(a,i,s),At=null,Pn=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){St(s,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)pg(t,e),t=t.sibling}function pg(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(En(t,e),On(e),r&4){try{Zl(3,e,e.return),So(3,e)}catch(k){St(e,e.return,k)}try{Zl(5,e,e.return)}catch(k){St(e,e.return,k)}}break;case 1:En(t,e),On(e),r&512&&n!==null&&Us(n,n.return);break;case 5:if(En(t,e),On(e),r&512&&n!==null&&Us(n,n.return),e.flags&32){var s=e.stateNode;try{aa(s,"")}catch(k){St(e,e.return,k)}}if(r&4&&(s=e.stateNode,s!=null)){var a=e.memoizedProps,i=n!==null?n.memoizedProps:a,c=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{c==="input"&&a.type==="radio"&&a.name!=null&&Ih(s,a),Mc(c,i);var d=Mc(c,a);for(i=0;i<u.length;i+=2){var p=u[i],v=u[i+1];p==="style"?Dh(s,v):p==="dangerouslySetInnerHTML"?Fh(s,v):p==="children"?aa(s,v):Du(s,p,v,d)}switch(c){case"input":Ac(s,a);break;case"textarea":$h(s,a);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var x=a.value;x!=null?Ks(s,!!a.multiple,x,!1):g!==!!a.multiple&&(a.defaultValue!=null?Ks(s,!!a.multiple,a.defaultValue,!0):Ks(s,!!a.multiple,a.multiple?[]:"",!1))}s[ma]=a}catch(k){St(e,e.return,k)}}break;case 6:if(En(t,e),On(e),r&4){if(e.stateNode===null)throw Error(te(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(k){St(e,e.return,k)}}break;case 3:if(En(t,e),On(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ua(t.containerInfo)}catch(k){St(e,e.return,k)}break;case 4:En(t,e),On(e);break;case 13:En(t,e),On(e),s=e.child,s.flags&8192&&(a=s.memoizedState!==null,s.stateNode.isHidden=a,!a||s.alternate!==null&&s.alternate.memoizedState!==null||(xd=kt())),r&4&&vp(e);break;case 22:if(p=n!==null&&n.memoizedState!==null,e.mode&1?(Mt=(d=Mt)||p,En(t,e),Mt=d):En(t,e),On(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!p&&e.mode&1)for(Se=e,p=e.child;p!==null;){for(v=Se=p;Se!==null;){switch(g=Se,x=g.child,g.tag){case 0:case 11:case 14:case 15:Zl(4,g,g.return);break;case 1:Us(g,g.return);var S=g.stateNode;if(typeof S.componentWillUnmount=="function"){r=g,n=g.return;try{t=r,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(k){St(r,n,k)}}break;case 5:Us(g,g.return);break;case 22:if(g.memoizedState!==null){wp(v);continue}}x!==null?(x.return=g,Se=x):wp(v)}p=p.sibling}e:for(p=null,v=e;;){if(v.tag===5){if(p===null){p=v;try{s=v.stateNode,d?(a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(c=v.stateNode,u=v.memoizedProps.style,i=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=Oh("display",i))}catch(k){St(e,e.return,k)}}}else if(v.tag===6){if(p===null)try{v.stateNode.nodeValue=d?"":v.memoizedProps}catch(k){St(e,e.return,k)}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===e)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===e)break e;for(;v.sibling===null;){if(v.return===null||v.return===e)break e;p===v&&(p=null),v=v.return}p===v&&(p=null),v.sibling.return=v.return,v=v.sibling}}break;case 19:En(t,e),On(e),r&4&&vp(e);break;case 21:break;default:En(t,e),On(e)}}function On(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(dg(n)){var r=n;break e}n=n.return}throw Error(te(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(aa(s,""),r.flags&=-33);var a=yp(e);pu(e,a,s);break;case 3:case 4:var i=r.stateNode.containerInfo,c=yp(e);fu(e,c,i);break;default:throw Error(te(161))}}catch(u){St(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function ww(e,t,n){Se=e,hg(e)}function hg(e,t,n){for(var r=(e.mode&1)!==0;Se!==null;){var s=Se,a=s.child;if(s.tag===22&&r){var i=s.memoizedState!==null||si;if(!i){var c=s.alternate,u=c!==null&&c.memoizedState!==null||Mt;c=si;var d=Mt;if(si=i,(Mt=u)&&!d)for(Se=s;Se!==null;)i=Se,u=i.child,i.tag===22&&i.memoizedState!==null?Sp(s):u!==null?(u.return=i,Se=u):Sp(s);for(;a!==null;)Se=a,hg(a),a=a.sibling;Se=s,si=c,Mt=d}xp(e)}else s.subtreeFlags&8772&&a!==null?(a.return=s,Se=a):xp(e)}}function xp(e){for(;Se!==null;){var t=Se;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Mt||So(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Mt)if(n===null)r.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:Ln(t.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&rp(t,a,r);break;case 3:var i=t.updateQueue;if(i!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}rp(t,i,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var p=d.memoizedState;if(p!==null){var v=p.dehydrated;v!==null&&ua(v)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(te(163))}Mt||t.flags&512&&du(t)}catch(g){St(t,t.return,g)}}if(t===e){Se=null;break}if(n=t.sibling,n!==null){n.return=t.return,Se=n;break}Se=t.return}}function wp(e){for(;Se!==null;){var t=Se;if(t===e){Se=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Se=n;break}Se=t.return}}function Sp(e){for(;Se!==null;){var t=Se;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{So(4,t)}catch(u){St(t,n,u)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var s=t.return;try{r.componentDidMount()}catch(u){St(t,s,u)}}var a=t.return;try{du(t)}catch(u){St(t,a,u)}break;case 5:var i=t.return;try{du(t)}catch(u){St(t,i,u)}}}catch(u){St(t,t.return,u)}if(t===e){Se=null;break}var c=t.sibling;if(c!==null){c.return=t.return,Se=c;break}Se=t.return}}var Sw=Math.ceil,Hi=ur.ReactCurrentDispatcher,yd=ur.ReactCurrentOwner,yn=ur.ReactCurrentBatchConfig,Je=0,zt=null,Nt=null,Rt=0,nn=0,Vs=Ur(0),Et=0,Sa=null,us=0,jo=0,vd=0,ea=null,Yt=null,xd=0,ll=1/0,Zn=null,Ki=!1,hu=null,Tr=null,li=!1,Er=null,Gi=0,ta=0,mu=null,Si=-1,ji=0;function Ut(){return Je&6?kt():Si!==-1?Si:Si=kt()}function Ir(e){return e.mode&1?Je&2&&Rt!==0?Rt&-Rt:sw.transition!==null?(ji===0&&(ji=Jh()),ji):(e=lt,e!==0||(e=window.event,e=e===void 0?16:lm(e.type)),e):1}function Rn(e,t,n,r){if(50<ta)throw ta=0,mu=null,Error(te(185));Ea(e,n,r),(!(Je&2)||e!==zt)&&(e===zt&&(!(Je&2)&&(jo|=n),Et===4&&Cr(e,Rt)),Jt(e,r),n===1&&Je===0&&!(t.mode&1)&&(ll=kt()+500,vo&&Vr()))}function Jt(e,t){var n=e.callbackNode;sx(e,t);var r=zi(e,e===zt?Rt:0);if(r===0)n!==null&&zf(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&zf(n),t===1)e.tag===0?rw(jp.bind(null,e)):Nm(jp.bind(null,e)),Zx(function(){!(Je&6)&&Vr()}),n=null;else{switch(Zh(r)){case 1:n=Hu;break;case 4:n=qh;break;case 16:n=Pi;break;case 536870912:n=Xh;break;default:n=Pi}n=jg(n,mg.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function mg(e,t){if(Si=-1,ji=0,Je&6)throw Error(te(327));var n=e.callbackNode;if(Xs()&&e.callbackNode!==n)return null;var r=zi(e,e===zt?Rt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Yi(e,r);else{t=r;var s=Je;Je|=2;var a=yg();(zt!==e||Rt!==t)&&(Zn=null,ll=kt()+500,ls(e,t));do try{Nw();break}catch(c){gg(e,c)}while(!0);sd(),Hi.current=a,Je=s,Nt!==null?t=0:(zt=null,Rt=0,t=Et)}if(t!==0){if(t===2&&(s=Uc(e),s!==0&&(r=s,t=gu(e,s))),t===1)throw n=Sa,ls(e,0),Cr(e,r),Jt(e,kt()),n;if(t===6)Cr(e,r);else{if(s=e.current.alternate,!(r&30)&&!jw(s)&&(t=Yi(e,r),t===2&&(a=Uc(e),a!==0&&(r=a,t=gu(e,a))),t===1))throw n=Sa,ls(e,0),Cr(e,r),Jt(e,kt()),n;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(te(345));case 2:es(e,Yt,Zn);break;case 3:if(Cr(e,r),(r&130023424)===r&&(t=xd+500-kt(),10<t)){if(zi(e,0)!==0)break;if(s=e.suspendedLanes,(s&r)!==r){Ut(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=qc(es.bind(null,e,Yt,Zn),t);break}es(e,Yt,Zn);break;case 4:if(Cr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,s=-1;0<r;){var i=31-An(r);a=1<<i,i=t[i],i>s&&(s=i),r&=~a}if(r=s,r=kt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Sw(r/1960))-r,10<r){e.timeoutHandle=qc(es.bind(null,e,Yt,Zn),r);break}es(e,Yt,Zn);break;case 5:es(e,Yt,Zn);break;default:throw Error(te(329))}}}return Jt(e,kt()),e.callbackNode===n?mg.bind(null,e):null}function gu(e,t){var n=ea;return e.current.memoizedState.isDehydrated&&(ls(e,t).flags|=256),e=Yi(e,t),e!==2&&(t=Yt,Yt=n,t!==null&&yu(t)),e}function yu(e){Yt===null?Yt=e:Yt.push.apply(Yt,e)}function jw(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],a=s.getSnapshot;s=s.value;try{if(!In(a(),s))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Cr(e,t){for(t&=~vd,t&=~jo,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-An(t),r=1<<n;e[n]=-1,t&=~r}}function jp(e){if(Je&6)throw Error(te(327));Xs();var t=zi(e,0);if(!(t&1))return Jt(e,kt()),null;var n=Yi(e,t);if(e.tag!==0&&n===2){var r=Uc(e);r!==0&&(t=r,n=gu(e,r))}if(n===1)throw n=Sa,ls(e,0),Cr(e,t),Jt(e,kt()),n;if(n===6)throw Error(te(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,es(e,Yt,Zn),Jt(e,kt()),null}function wd(e,t){var n=Je;Je|=1;try{return e(t)}finally{Je=n,Je===0&&(ll=kt()+500,vo&&Vr())}}function ds(e){Er!==null&&Er.tag===0&&!(Je&6)&&Xs();var t=Je;Je|=1;var n=yn.transition,r=lt;try{if(yn.transition=null,lt=1,e)return e()}finally{lt=r,yn.transition=n,Je=t,!(Je&6)&&Vr()}}function Sd(){nn=Vs.current,ft(Vs)}function ls(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Jx(n)),Nt!==null)for(n=Nt.return;n!==null;){var r=n;switch(td(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ii();break;case 3:rl(),ft(qt),ft(Ot),ud();break;case 5:cd(r);break;case 4:rl();break;case 13:ft(gt);break;case 19:ft(gt);break;case 10:ld(r.type._context);break;case 22:case 23:Sd()}n=n.return}if(zt=e,Nt=e=$r(e.current,null),Rt=nn=t,Et=0,Sa=null,vd=jo=us=0,Yt=ea=null,rs!==null){for(t=0;t<rs.length;t++)if(n=rs[t],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,a=n.pending;if(a!==null){var i=a.next;a.next=s,r.next=i}n.pending=r}rs=null}return e}function gg(e,t){do{var n=Nt;try{if(sd(),vi.current=Wi,Vi){for(var r=yt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Vi=!1}if(cs=0,Pt=bt=yt=null,Jl=!1,va=0,yd.current=null,n===null||n.return===null){Et=1,Sa=t,Nt=null;break}e:{var a=e,i=n.return,c=n,u=t;if(t=Rt,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,p=c,v=p.tag;if(!(p.mode&1)&&(v===0||v===11||v===15)){var g=p.alternate;g?(p.updateQueue=g.updateQueue,p.memoizedState=g.memoizedState,p.lanes=g.lanes):(p.updateQueue=null,p.memoizedState=null)}var x=cp(i);if(x!==null){x.flags&=-257,up(x,i,c,a,t),x.mode&1&&op(a,d,t),t=x,u=d;var S=t.updateQueue;if(S===null){var k=new Set;k.add(u),t.updateQueue=k}else S.add(u);break e}else{if(!(t&1)){op(a,d,t),jd();break e}u=Error(te(426))}}else if(ht&&c.mode&1){var j=cp(i);if(j!==null){!(j.flags&65536)&&(j.flags|=256),up(j,i,c,a,t),nd(sl(u,c));break e}}a=u=sl(u,c),Et!==4&&(Et=2),ea===null?ea=[a]:ea.push(a),a=i;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var h=Zm(a,u,t);np(a,h);break e;case 1:c=u;var f=a.type,m=a.stateNode;if(!(a.flags&128)&&(typeof f.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Tr===null||!Tr.has(m)))){a.flags|=65536,t&=-t,a.lanes|=t;var w=eg(a,c,t);np(a,w);break e}}a=a.return}while(a!==null)}xg(n)}catch(C){t=C,Nt===n&&n!==null&&(Nt=n=n.return);continue}break}while(!0)}function yg(){var e=Hi.current;return Hi.current=Wi,e===null?Wi:e}function jd(){(Et===0||Et===3||Et===2)&&(Et=4),zt===null||!(us&268435455)&&!(jo&268435455)||Cr(zt,Rt)}function Yi(e,t){var n=Je;Je|=2;var r=yg();(zt!==e||Rt!==t)&&(Zn=null,ls(e,t));do try{kw();break}catch(s){gg(e,s)}while(!0);if(sd(),Je=n,Hi.current=r,Nt!==null)throw Error(te(261));return zt=null,Rt=0,Et}function kw(){for(;Nt!==null;)vg(Nt)}function Nw(){for(;Nt!==null&&!Qv();)vg(Nt)}function vg(e){var t=Sg(e.alternate,e,nn);e.memoizedProps=e.pendingProps,t===null?xg(e):Nt=t,yd.current=null}function xg(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=yw(n,t),n!==null){n.flags&=32767,Nt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Et=6,Nt=null;return}}else if(n=gw(n,t,nn),n!==null){Nt=n;return}if(t=t.sibling,t!==null){Nt=t;return}Nt=t=e}while(t!==null);Et===0&&(Et=5)}function es(e,t,n){var r=lt,s=yn.transition;try{yn.transition=null,lt=1,Cw(e,t,n,r)}finally{yn.transition=s,lt=r}return null}function Cw(e,t,n,r){do Xs();while(Er!==null);if(Je&6)throw Error(te(327));n=e.finishedWork;var s=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(te(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(lx(e,a),e===zt&&(Nt=zt=null,Rt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||li||(li=!0,jg(Pi,function(){return Xs(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=yn.transition,yn.transition=null;var i=lt;lt=1;var c=Je;Je|=4,yd.current=null,xw(e,n),pg(n,e),Hx(Yc),_i=!!Gc,Yc=Gc=null,e.current=n,ww(n),qv(),Je=c,lt=i,yn.transition=a}else e.current=n;if(li&&(li=!1,Er=e,Gi=s),a=e.pendingLanes,a===0&&(Tr=null),Zv(n.stateNode),Jt(e,kt()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Ki)throw Ki=!1,e=hu,hu=null,e;return Gi&1&&e.tag!==0&&Xs(),a=e.pendingLanes,a&1?e===mu?ta++:(ta=0,mu=e):ta=0,Vr(),null}function Xs(){if(Er!==null){var e=Zh(Gi),t=yn.transition,n=lt;try{if(yn.transition=null,lt=16>e?16:e,Er===null)var r=!1;else{if(e=Er,Er=null,Gi=0,Je&6)throw Error(te(331));var s=Je;for(Je|=4,Se=e.current;Se!==null;){var a=Se,i=a.child;if(Se.flags&16){var c=a.deletions;if(c!==null){for(var u=0;u<c.length;u++){var d=c[u];for(Se=d;Se!==null;){var p=Se;switch(p.tag){case 0:case 11:case 15:Zl(8,p,a)}var v=p.child;if(v!==null)v.return=p,Se=v;else for(;Se!==null;){p=Se;var g=p.sibling,x=p.return;if(ug(p),p===d){Se=null;break}if(g!==null){g.return=x,Se=g;break}Se=x}}}var S=a.alternate;if(S!==null){var k=S.child;if(k!==null){S.child=null;do{var j=k.sibling;k.sibling=null,k=j}while(k!==null)}}Se=a}}if(a.subtreeFlags&2064&&i!==null)i.return=a,Se=i;else e:for(;Se!==null;){if(a=Se,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Zl(9,a,a.return)}var h=a.sibling;if(h!==null){h.return=a.return,Se=h;break e}Se=a.return}}var f=e.current;for(Se=f;Se!==null;){i=Se;var m=i.child;if(i.subtreeFlags&2064&&m!==null)m.return=i,Se=m;else e:for(i=f;Se!==null;){if(c=Se,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:So(9,c)}}catch(C){St(c,c.return,C)}if(c===i){Se=null;break e}var w=c.sibling;if(w!==null){w.return=c.return,Se=w;break e}Se=c.return}}if(Je=s,Vr(),Yn&&typeof Yn.onPostCommitFiberRoot=="function")try{Yn.onPostCommitFiberRoot(po,e)}catch{}r=!0}return r}finally{lt=n,yn.transition=t}}return!1}function kp(e,t,n){t=sl(n,t),t=Zm(e,t,1),e=Rr(e,t,1),t=Ut(),e!==null&&(Ea(e,1,t),Jt(e,t))}function St(e,t,n){if(e.tag===3)kp(e,e,n);else for(;t!==null;){if(t.tag===3){kp(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Tr===null||!Tr.has(r))){e=sl(n,e),e=eg(t,e,1),t=Rr(t,e,1),e=Ut(),t!==null&&(Ea(t,1,e),Jt(t,e));break}}t=t.return}}function bw(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Ut(),e.pingedLanes|=e.suspendedLanes&n,zt===e&&(Rt&n)===n&&(Et===4||Et===3&&(Rt&130023424)===Rt&&500>kt()-xd?ls(e,0):vd|=n),Jt(e,t)}function wg(e,t){t===0&&(e.mode&1?(t=Qa,Qa<<=1,!(Qa&130023424)&&(Qa=4194304)):t=1);var n=Ut();e=or(e,t),e!==null&&(Ea(e,t,n),Jt(e,n))}function Ew(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),wg(e,n)}function Lw(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(te(314))}r!==null&&r.delete(t),wg(e,n)}var Sg;Sg=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||qt.current)Qt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Qt=!1,mw(e,t,n);Qt=!!(e.flags&131072)}else Qt=!1,ht&&t.flags&1048576&&Cm(t,Fi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;wi(e,t),e=t.pendingProps;var s=el(t,Ot.current);qs(t,n),s=fd(null,t,r,e,s,n);var a=pd();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Xt(r)?(a=!0,$i(t)):a=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,id(t),s.updater=wo,t.stateNode=s,s._reactInternals=t,ru(t,r,e,n),t=au(null,t,r,!0,a,n)):(t.tag=0,ht&&a&&ed(t),Bt(null,t,s,n),t=t.child),t;case 16:r=t.elementType;e:{switch(wi(e,t),e=t.pendingProps,s=r._init,r=s(r._payload),t.type=r,s=t.tag=zw(r),e=Ln(r,e),s){case 0:t=lu(null,t,r,e,n);break e;case 1:t=pp(null,t,r,e,n);break e;case 11:t=dp(null,t,r,e,n);break e;case 14:t=fp(null,t,r,Ln(r.type,e),n);break e}throw Error(te(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Ln(r,s),lu(e,t,r,s,n);case 1:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Ln(r,s),pp(e,t,r,s,n);case 3:e:{if(sg(t),e===null)throw Error(te(387));r=t.pendingProps,a=t.memoizedState,s=a.element,_m(e,t),Bi(t,r,null,n);var i=t.memoizedState;if(r=i.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){s=sl(Error(te(423)),t),t=hp(e,t,r,n,s);break e}else if(r!==s){s=sl(Error(te(424)),t),t=hp(e,t,r,n,s);break e}else for(rn=Ar(t.stateNode.containerInfo.firstChild),sn=t,ht=!0,zn=null,n=Pm(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(tl(),r===s){t=cr(e,t,n);break e}Bt(e,t,r,n)}t=t.child}return t;case 5:return Am(t),e===null&&eu(t),r=t.type,s=t.pendingProps,a=e!==null?e.memoizedProps:null,i=s.children,Qc(r,s)?i=null:a!==null&&Qc(r,a)&&(t.flags|=32),rg(e,t),Bt(e,t,i,n),t.child;case 6:return e===null&&eu(t),null;case 13:return lg(e,t,n);case 4:return od(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=nl(t,null,r,n):Bt(e,t,r,n),t.child;case 11:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Ln(r,s),dp(e,t,r,s,n);case 7:return Bt(e,t,t.pendingProps,n),t.child;case 8:return Bt(e,t,t.pendingProps.children,n),t.child;case 12:return Bt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,a=t.memoizedProps,i=s.value,it(Oi,r._currentValue),r._currentValue=i,a!==null)if(In(a.value,i)){if(a.children===s.children&&!qt.current){t=cr(e,t,n);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var c=a.dependencies;if(c!==null){i=a.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(a.tag===1){u=sr(-1,n&-n),u.tag=2;var d=a.updateQueue;if(d!==null){d=d.shared;var p=d.pending;p===null?u.next=u:(u.next=p.next,p.next=u),d.pending=u}}a.lanes|=n,u=a.alternate,u!==null&&(u.lanes|=n),tu(a.return,n,t),c.lanes|=n;break}u=u.next}}else if(a.tag===10)i=a.type===t.type?null:a.child;else if(a.tag===18){if(i=a.return,i===null)throw Error(te(341));i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),tu(i,n,t),i=a.sibling}else i=a.child;if(i!==null)i.return=a;else for(i=a;i!==null;){if(i===t){i=null;break}if(a=i.sibling,a!==null){a.return=i.return,i=a;break}i=i.return}a=i}Bt(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,qs(t,n),s=vn(s),r=r(s),t.flags|=1,Bt(e,t,r,n),t.child;case 14:return r=t.type,s=Ln(r,t.pendingProps),s=Ln(r.type,s),fp(e,t,r,s,n);case 15:return tg(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Ln(r,s),wi(e,t),t.tag=1,Xt(r)?(e=!0,$i(t)):e=!1,qs(t,n),Jm(t,r,s),ru(t,r,s,n),au(null,t,r,!0,e,n);case 19:return ag(e,t,n);case 22:return ng(e,t,n)}throw Error(te(156,t.tag))};function jg(e,t){return Qh(e,t)}function Pw(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function mn(e,t,n,r){return new Pw(e,t,n,r)}function kd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function zw(e){if(typeof e=="function")return kd(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Uu)return 11;if(e===Vu)return 14}return 2}function $r(e,t){var n=e.alternate;return n===null?(n=mn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ki(e,t,n,r,s,a){var i=2;if(r=e,typeof e=="function")kd(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case Rs:return as(n.children,s,a,t);case Bu:i=8,s|=8;break;case Ec:return e=mn(12,n,t,s|2),e.elementType=Ec,e.lanes=a,e;case Lc:return e=mn(13,n,t,s),e.elementType=Lc,e.lanes=a,e;case Pc:return e=mn(19,n,t,s),e.elementType=Pc,e.lanes=a,e;case Ah:return ko(n,s,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case zh:i=10;break e;case _h:i=9;break e;case Uu:i=11;break e;case Vu:i=14;break e;case jr:i=16,r=null;break e}throw Error(te(130,e==null?e:typeof e,""))}return t=mn(i,n,t,s),t.elementType=e,t.type=r,t.lanes=a,t}function as(e,t,n,r){return e=mn(7,e,r,t),e.lanes=n,e}function ko(e,t,n,r){return e=mn(22,e,r,t),e.elementType=Ah,e.lanes=n,e.stateNode={isHidden:!1},e}function gc(e,t,n){return e=mn(6,e,null,t),e.lanes=n,e}function yc(e,t,n){return t=mn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function _w(e,t,n,r,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xo(0),this.expirationTimes=Xo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xo(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Nd(e,t,n,r,s,a,i,c,u){return e=new _w(e,t,n,c,u),t===1?(t=1,a===!0&&(t|=8)):t=0,a=mn(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},id(a),e}function Aw(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:As,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function kg(e){if(!e)return Or;e=e._reactInternals;e:{if(ps(e)!==e||e.tag!==1)throw Error(te(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Xt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(te(171))}if(e.tag===1){var n=e.type;if(Xt(n))return km(e,n,t)}return t}function Ng(e,t,n,r,s,a,i,c,u){return e=Nd(n,r,!0,e,s,a,i,c,u),e.context=kg(null),n=e.current,r=Ut(),s=Ir(n),a=sr(r,s),a.callback=t??null,Rr(n,a,s),e.current.lanes=s,Ea(e,s,r),Jt(e,r),e}function No(e,t,n,r){var s=t.current,a=Ut(),i=Ir(s);return n=kg(n),t.context===null?t.context=n:t.pendingContext=n,t=sr(a,i),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Rr(s,t,i),e!==null&&(Rn(e,s,i,a),yi(e,s,i)),i}function Qi(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Np(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Cd(e,t){Np(e,t),(e=e.alternate)&&Np(e,t)}function Rw(){return null}var Cg=typeof reportError=="function"?reportError:function(e){console.error(e)};function bd(e){this._internalRoot=e}Co.prototype.render=bd.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(te(409));No(e,t,null,null)};Co.prototype.unmount=bd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ds(function(){No(null,e,null,null)}),t[ir]=null}};function Co(e){this._internalRoot=e}Co.prototype.unstable_scheduleHydration=function(e){if(e){var t=nm();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Nr.length&&t!==0&&t<Nr[n].priority;n++);Nr.splice(n,0,e),n===0&&sm(e)}};function Ed(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function bo(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Cp(){}function Tw(e,t,n,r,s){if(s){if(typeof r=="function"){var a=r;r=function(){var d=Qi(i);a.call(d)}}var i=Ng(t,r,e,0,null,!1,!1,"",Cp);return e._reactRootContainer=i,e[ir]=i.current,pa(e.nodeType===8?e.parentNode:e),ds(),i}for(;s=e.lastChild;)e.removeChild(s);if(typeof r=="function"){var c=r;r=function(){var d=Qi(u);c.call(d)}}var u=Nd(e,0,!1,null,null,!1,!1,"",Cp);return e._reactRootContainer=u,e[ir]=u.current,pa(e.nodeType===8?e.parentNode:e),ds(function(){No(t,u,n,r)}),u}function Eo(e,t,n,r,s){var a=n._reactRootContainer;if(a){var i=a;if(typeof s=="function"){var c=s;s=function(){var u=Qi(i);c.call(u)}}No(t,i,e,s)}else i=Tw(n,t,e,s,r);return Qi(i)}em=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ul(t.pendingLanes);n!==0&&(Ku(t,n|1),Jt(t,kt()),!(Je&6)&&(ll=kt()+500,Vr()))}break;case 13:ds(function(){var r=or(e,1);if(r!==null){var s=Ut();Rn(r,e,1,s)}}),Cd(e,1)}};Gu=function(e){if(e.tag===13){var t=or(e,134217728);if(t!==null){var n=Ut();Rn(t,e,134217728,n)}Cd(e,134217728)}};tm=function(e){if(e.tag===13){var t=Ir(e),n=or(e,t);if(n!==null){var r=Ut();Rn(n,e,t,r)}Cd(e,t)}};nm=function(){return lt};rm=function(e,t){var n=lt;try{return lt=e,t()}finally{lt=n}};Oc=function(e,t,n){switch(t){case"input":if(Ac(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=yo(r);if(!s)throw Error(te(90));Th(r),Ac(r,s)}}}break;case"textarea":$h(e,n);break;case"select":t=n.value,t!=null&&Ks(e,!!n.multiple,t,!1)}};Vh=wd;Wh=ds;var Iw={usingClientEntryPoint:!1,Events:[Pa,Ms,yo,Bh,Uh,wd]},Ol={findFiberByHostInstance:ns,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$w={bundleType:Ol.bundleType,version:Ol.version,rendererPackageName:Ol.rendererPackageName,rendererConfig:Ol.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ur.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Gh(e),e===null?null:e.stateNode},findFiberByHostInstance:Ol.findFiberByHostInstance||Rw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ai=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ai.isDisabled&&ai.supportsFiber)try{po=ai.inject($w),Yn=ai}catch{}}an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Iw;an.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ed(t))throw Error(te(200));return Aw(e,t,null,n)};an.createRoot=function(e,t){if(!Ed(e))throw Error(te(299));var n=!1,r="",s=Cg;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=Nd(e,1,!1,null,null,n,!1,r,s),e[ir]=t.current,pa(e.nodeType===8?e.parentNode:e),new bd(t)};an.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(te(188)):(e=Object.keys(e).join(","),Error(te(268,e)));return e=Gh(t),e=e===null?null:e.stateNode,e};an.flushSync=function(e){return ds(e)};an.hydrate=function(e,t,n){if(!bo(t))throw Error(te(200));return Eo(null,e,t,!0,n)};an.hydrateRoot=function(e,t,n){if(!Ed(e))throw Error(te(405));var r=n!=null&&n.hydratedSources||null,s=!1,a="",i=Cg;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),t=Ng(t,null,e,1,n??null,s,!1,a,i),e[ir]=t.current,pa(e),r)for(e=0;e<r.length;e++)n=r[e],s=n._getVersion,s=s(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Co(t)};an.render=function(e,t,n){if(!bo(t))throw Error(te(200));return Eo(null,e,t,!1,n)};an.unmountComponentAtNode=function(e){if(!bo(e))throw Error(te(40));return e._reactRootContainer?(ds(function(){Eo(null,null,e,!1,function(){e._reactRootContainer=null,e[ir]=null})}),!0):!1};an.unstable_batchedUpdates=wd;an.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!bo(n))throw Error(te(200));if(e==null||e._reactInternals===void 0)throw Error(te(38));return Eo(e,t,n,!1,r)};an.version="18.3.1-next-f1338f8080-20240426";function bg(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(bg)}catch(e){console.error(e)}}bg(),bh.exports=an;var Ld=bh.exports,bp=Ld;Cc.createRoot=bp.createRoot,Cc.hydrateRoot=bp.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ja(){return ja=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ja.apply(this,arguments)}var Lr;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Lr||(Lr={}));const Ep="popstate";function Mw(e){e===void 0&&(e={});function t(s,a){let{pathname:i="/",search:c="",hash:u=""}=hs(s.location.hash.substr(1));return!i.startsWith("/")&&!i.startsWith(".")&&(i="/"+i),vu("",{pathname:i,search:c,hash:u},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(s,a){let i=s.document.querySelector("base"),c="";if(i&&i.getAttribute("href")){let u=s.location.href,d=u.indexOf("#");c=d===-1?u:u.slice(0,d)}return c+"#"+(typeof a=="string"?a:qi(a))}function r(s,a){Pd(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")}return Ow(t,n,r,e)}function vt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Pd(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Fw(){return Math.random().toString(36).substr(2,8)}function Lp(e,t){return{usr:e.state,key:e.key,idx:t}}function vu(e,t,n,r){return n===void 0&&(n=null),ja({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?hs(t):t,{state:n,key:t&&t.key||r||Fw()})}function qi(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function hs(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function Ow(e,t,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:a=!1}=r,i=s.history,c=Lr.Pop,u=null,d=p();d==null&&(d=0,i.replaceState(ja({},i.state,{idx:d}),""));function p(){return(i.state||{idx:null}).idx}function v(){c=Lr.Pop;let j=p(),h=j==null?null:j-d;d=j,u&&u({action:c,location:k.location,delta:h})}function g(j,h){c=Lr.Push;let f=vu(k.location,j,h);n&&n(f,j),d=p()+1;let m=Lp(f,d),w=k.createHref(f);try{i.pushState(m,"",w)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;s.location.assign(w)}a&&u&&u({action:c,location:k.location,delta:1})}function x(j,h){c=Lr.Replace;let f=vu(k.location,j,h);n&&n(f,j),d=p();let m=Lp(f,d),w=k.createHref(f);i.replaceState(m,"",w),a&&u&&u({action:c,location:k.location,delta:0})}function S(j){let h=s.location.origin!=="null"?s.location.origin:s.location.href,f=typeof j=="string"?j:qi(j);return f=f.replace(/ $/,"%20"),vt(h,"No window.location.(origin|href) available to create URL for href: "+f),new URL(f,h)}let k={get action(){return c},get location(){return e(s,i)},listen(j){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(Ep,v),u=j,()=>{s.removeEventListener(Ep,v),u=null}},createHref(j){return t(s,j)},createURL:S,encodeLocation(j){let h=S(j);return{pathname:h.pathname,search:h.search,hash:h.hash}},push:g,replace:x,go(j){return i.go(j)}};return k}var Pp;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Pp||(Pp={}));function Dw(e,t,n){return n===void 0&&(n="/"),Bw(e,t,n)}function Bw(e,t,n,r){let s=typeof t=="string"?hs(t):t,a=al(s.pathname||"/",n);if(a==null)return null;let i=Eg(e);Uw(i);let c=null;for(let u=0;c==null&&u<i.length;++u){let d=Zw(a);c=Xw(i[u],d)}return c}function Eg(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(a,i,c)=>{let u={relativePath:c===void 0?a.path||"":c,caseSensitive:a.caseSensitive===!0,childrenIndex:i,route:a};u.relativePath.startsWith("/")&&(vt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=Mr([r,u.relativePath]),p=n.concat(u);a.children&&a.children.length>0&&(vt(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Eg(a.children,t,p,d)),!(a.path==null&&!a.index)&&t.push({path:d,score:Qw(d,a.index),routesMeta:p})};return e.forEach((a,i)=>{var c;if(a.path===""||!((c=a.path)!=null&&c.includes("?")))s(a,i);else for(let u of Lg(a.path))s(a,i,u)}),t}function Lg(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,s=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return s?[a,""]:[a];let i=Lg(r.join("/")),c=[];return c.push(...i.map(u=>u===""?a:[a,u].join("/"))),s&&c.push(...i),c.map(u=>e.startsWith("/")&&u===""?"/":u)}function Uw(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:qw(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const Vw=/^:[\w-]+$/,Ww=3,Hw=2,Kw=1,Gw=10,Yw=-2,zp=e=>e==="*";function Qw(e,t){let n=e.split("/"),r=n.length;return n.some(zp)&&(r+=Yw),t&&(r+=Hw),n.filter(s=>!zp(s)).reduce((s,a)=>s+(Vw.test(a)?Ww:a===""?Kw:Gw),r)}function qw(e,t){return e.length===t.length&&e.slice(0,-1).every((r,s)=>r===t[s])?e[e.length-1]-t[t.length-1]:0}function Xw(e,t,n){let{routesMeta:r}=e,s={},a="/",i=[];for(let c=0;c<r.length;++c){let u=r[c],d=c===r.length-1,p=a==="/"?t:t.slice(a.length)||"/",v=xu({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},p),g=u.route;if(!v)return null;Object.assign(s,v.params),i.push({params:s,pathname:Mr([a,v.pathname]),pathnameBase:r0(Mr([a,v.pathnameBase])),route:g}),v.pathnameBase!=="/"&&(a=Mr([a,v.pathnameBase]))}return i}function xu(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=Jw(e.path,e.caseSensitive,e.end),s=t.match(n);if(!s)return null;let a=s[0],i=a.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:r.reduce((d,p,v)=>{let{paramName:g,isOptional:x}=p;if(g==="*"){let k=c[v]||"";i=a.slice(0,a.length-k.length).replace(/(.)\/+$/,"$1")}const S=c[v];return x&&!S?d[g]=void 0:d[g]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:i,pattern:e}}function Jw(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),Pd(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,c,u)=>(r.push({paramName:c,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),r]}function Zw(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Pd(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function al(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function e0(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:s=""}=typeof e=="string"?hs(e):e;return{pathname:n?n.startsWith("/")?n:t0(n,t):t,search:s0(r),hash:l0(s)}}function t0(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function vc(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function n0(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function zd(e,t){let n=n0(e);return t?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function _d(e,t,n,r){r===void 0&&(r=!1);let s;typeof e=="string"?s=hs(e):(s=ja({},e),vt(!s.pathname||!s.pathname.includes("?"),vc("?","pathname","search",s)),vt(!s.pathname||!s.pathname.includes("#"),vc("#","pathname","hash",s)),vt(!s.search||!s.search.includes("#"),vc("#","search","hash",s)));let a=e===""||s.pathname==="",i=a?"/":s.pathname,c;if(i==null)c=n;else{let v=t.length-1;if(!r&&i.startsWith("..")){let g=i.split("/");for(;g[0]==="..";)g.shift(),v-=1;s.pathname=g.join("/")}c=v>=0?t[v]:"/"}let u=e0(s,c),d=i&&i!=="/"&&i.endsWith("/"),p=(a||i===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||p)&&(u.pathname+="/"),u}const Mr=e=>e.join("/").replace(/\/\/+/g,"/"),r0=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),s0=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,l0=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function a0(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Pg=["post","put","patch","delete"];new Set(Pg);const i0=["get",...Pg];new Set(i0);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ka(){return ka=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ka.apply(this,arguments)}const Lo=o.createContext(null),zg=o.createContext(null),dr=o.createContext(null),Po=o.createContext(null),fr=o.createContext({outlet:null,matches:[],isDataRoute:!1}),_g=o.createContext(null);function o0(e,t){let{relative:n}=t===void 0?{}:t;fl()||vt(!1);let{basename:r,navigator:s}=o.useContext(dr),{hash:a,pathname:i,search:c}=zo(e,{relative:n}),u=i;return r!=="/"&&(u=i==="/"?r:Mr([r,i])),s.createHref({pathname:u,search:c,hash:a})}function fl(){return o.useContext(Po)!=null}function Zt(){return fl()||vt(!1),o.useContext(Po).location}function Ag(e){o.useContext(dr).static||o.useLayoutEffect(e)}function pr(){let{isDataRoute:e}=o.useContext(fr);return e?k0():c0()}function c0(){fl()||vt(!1);let e=o.useContext(Lo),{basename:t,future:n,navigator:r}=o.useContext(dr),{matches:s}=o.useContext(fr),{pathname:a}=Zt(),i=JSON.stringify(zd(s,n.v7_relativeSplatPath)),c=o.useRef(!1);return Ag(()=>{c.current=!0}),o.useCallback(function(d,p){if(p===void 0&&(p={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let v=_d(d,JSON.parse(i),a,p.relative==="path");e==null&&t!=="/"&&(v.pathname=v.pathname==="/"?t:Mr([t,v.pathname])),(p.replace?r.replace:r.push)(v,p.state,p)},[t,r,i,a,e])}const u0=o.createContext(null);function d0(e){let t=o.useContext(fr).outlet;return t&&o.createElement(u0.Provider,{value:e},t)}function zo(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=o.useContext(dr),{matches:s}=o.useContext(fr),{pathname:a}=Zt(),i=JSON.stringify(zd(s,r.v7_relativeSplatPath));return o.useMemo(()=>_d(e,JSON.parse(i),a,n==="path"),[e,i,a,n])}function f0(e,t){return p0(e,t)}function p0(e,t,n,r){fl()||vt(!1);let{navigator:s}=o.useContext(dr),{matches:a}=o.useContext(fr),i=a[a.length-1],c=i?i.params:{};i&&i.pathname;let u=i?i.pathnameBase:"/";i&&i.route;let d=Zt(),p;if(t){var v;let j=typeof t=="string"?hs(t):t;u==="/"||(v=j.pathname)!=null&&v.startsWith(u)||vt(!1),p=j}else p=d;let g=p.pathname||"/",x=g;if(u!=="/"){let j=u.replace(/^\//,"").split("/");x="/"+g.replace(/^\//,"").split("/").slice(j.length).join("/")}let S=Dw(e,{pathname:x}),k=v0(S&&S.map(j=>Object.assign({},j,{params:Object.assign({},c,j.params),pathname:Mr([u,s.encodeLocation?s.encodeLocation(j.pathname).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?u:Mr([u,s.encodeLocation?s.encodeLocation(j.pathnameBase).pathname:j.pathnameBase])})),a,n,r);return t&&k?o.createElement(Po.Provider,{value:{location:ka({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:Lr.Pop}},k):k}function h0(){let e=j0(),t=a0(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return o.createElement(o.Fragment,null,o.createElement("h2",null,"Unexpected Application Error!"),o.createElement("h3",{style:{fontStyle:"italic"}},t),n?o.createElement("pre",{style:s},n):null,null)}const m0=o.createElement(h0,null);class g0 extends o.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?o.createElement(fr.Provider,{value:this.props.routeContext},o.createElement(_g.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function y0(e){let{routeContext:t,match:n,children:r}=e,s=o.useContext(Lo);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),o.createElement(fr.Provider,{value:t},r)}function v0(e,t,n,r){var s;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var a;if(!n)return null;if(n.errors)e=n.matches;else if((a=r)!=null&&a.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let i=e,c=(s=n)==null?void 0:s.errors;if(c!=null){let p=i.findIndex(v=>v.route.id&&(c==null?void 0:c[v.route.id])!==void 0);p>=0||vt(!1),i=i.slice(0,Math.min(i.length,p+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let p=0;p<i.length;p++){let v=i[p];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(d=p),v.route.id){let{loaderData:g,errors:x}=n,S=v.route.loader&&g[v.route.id]===void 0&&(!x||x[v.route.id]===void 0);if(v.route.lazy||S){u=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}return i.reduceRight((p,v,g)=>{let x,S=!1,k=null,j=null;n&&(x=c&&v.route.id?c[v.route.id]:void 0,k=v.route.errorElement||m0,u&&(d<0&&g===0?(N0("route-fallback"),S=!0,j=null):d===g&&(S=!0,j=v.route.hydrateFallbackElement||null)));let h=t.concat(i.slice(0,g+1)),f=()=>{let m;return x?m=k:S?m=j:v.route.Component?m=o.createElement(v.route.Component,null):v.route.element?m=v.route.element:m=p,o.createElement(y0,{match:v,routeContext:{outlet:p,matches:h,isDataRoute:n!=null},children:m})};return n&&(v.route.ErrorBoundary||v.route.errorElement||g===0)?o.createElement(g0,{location:n.location,revalidation:n.revalidation,component:k,error:x,children:f(),routeContext:{outlet:null,matches:h,isDataRoute:!0}}):f()},null)}var Rg=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Rg||{}),Tg=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Tg||{});function x0(e){let t=o.useContext(Lo);return t||vt(!1),t}function w0(e){let t=o.useContext(zg);return t||vt(!1),t}function S0(e){let t=o.useContext(fr);return t||vt(!1),t}function Ig(e){let t=S0(),n=t.matches[t.matches.length-1];return n.route.id||vt(!1),n.route.id}function j0(){var e;let t=o.useContext(_g),n=w0(),r=Ig();return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function k0(){let{router:e}=x0(Rg.UseNavigateStable),t=Ig(Tg.UseNavigateStable),n=o.useRef(!1);return Ag(()=>{n.current=!0}),o.useCallback(function(s,a){a===void 0&&(a={}),n.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,ka({fromRouteId:t},a)))},[e,t])}const _p={};function N0(e,t,n){_p[e]||(_p[e]=!0)}function C0(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Xi(e){let{to:t,replace:n,state:r,relative:s}=e;fl()||vt(!1);let{future:a,static:i}=o.useContext(dr),{matches:c}=o.useContext(fr),{pathname:u}=Zt(),d=pr(),p=_d(t,zd(c,a.v7_relativeSplatPath),u,s==="path"),v=JSON.stringify(p);return o.useEffect(()=>d(JSON.parse(v),{replace:n,state:r,relative:s}),[d,v,s,n,r]),null}function b0(e){return d0(e.context)}function fn(e){vt(!1)}function E0(e){let{basename:t="/",children:n=null,location:r,navigationType:s=Lr.Pop,navigator:a,static:i=!1,future:c}=e;fl()&&vt(!1);let u=t.replace(/^\/*/,"/"),d=o.useMemo(()=>({basename:u,navigator:a,static:i,future:ka({v7_relativeSplatPath:!1},c)}),[u,c,a,i]);typeof r=="string"&&(r=hs(r));let{pathname:p="/",search:v="",hash:g="",state:x=null,key:S="default"}=r,k=o.useMemo(()=>{let j=al(p,u);return j==null?null:{location:{pathname:j,search:v,hash:g,state:x,key:S},navigationType:s}},[u,p,v,g,x,S,s]);return k==null?null:o.createElement(dr.Provider,{value:d},o.createElement(Po.Provider,{children:n,value:k}))}function L0(e){let{children:t,location:n}=e;return f0(wu(t),n)}new Promise(()=>{});function wu(e,t){t===void 0&&(t=[]);let n=[];return o.Children.forEach(e,(r,s)=>{if(!o.isValidElement(r))return;let a=[...t,s];if(r.type===o.Fragment){n.push.apply(n,wu(r.props.children,a));return}r.type!==fn&&vt(!1),!r.props.index||!r.props.children||vt(!1);let i={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=wu(r.props.children,a)),n.push(i)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ji(){return Ji=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ji.apply(this,arguments)}function $g(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,a;for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function P0(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function z0(e,t){return e.button===0&&(!t||t==="_self")&&!P0(e)}function Su(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(s=>[n,s]):[[n,r]])},[]))}function _0(e,t){let n=Su(e);return t&&t.forEach((r,s)=>{n.has(s)||t.getAll(s).forEach(a=>{n.append(s,a)})}),n}const A0=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],R0=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],T0="6";try{window.__reactRouterVersion=T0}catch{}const I0=o.createContext({isTransitioning:!1}),$0="startTransition",Ap=bv[$0];function M0(e){let{basename:t,children:n,future:r,window:s}=e,a=o.useRef();a.current==null&&(a.current=Mw({window:s,v5Compat:!0}));let i=a.current,[c,u]=o.useState({action:i.action,location:i.location}),{v7_startTransition:d}=r||{},p=o.useCallback(v=>{d&&Ap?Ap(()=>u(v)):u(v)},[u,d]);return o.useLayoutEffect(()=>i.listen(p),[i,p]),o.useEffect(()=>C0(r),[r]),o.createElement(E0,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:i,future:r})}const F0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",O0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Mg=o.forwardRef(function(t,n){let{onClick:r,relative:s,reloadDocument:a,replace:i,state:c,target:u,to:d,preventScrollReset:p,viewTransition:v}=t,g=$g(t,A0),{basename:x}=o.useContext(dr),S,k=!1;if(typeof d=="string"&&O0.test(d)&&(S=d,F0))try{let m=new URL(window.location.href),w=d.startsWith("//")?new URL(m.protocol+d):new URL(d),C=al(w.pathname,x);w.origin===m.origin&&C!=null?d=C+w.search+w.hash:k=!0}catch{}let j=o0(d,{relative:s}),h=U0(d,{replace:i,state:c,target:u,preventScrollReset:p,relative:s,viewTransition:v});function f(m){r&&r(m),m.defaultPrevented||h(m)}return o.createElement("a",Ji({},g,{href:S||j,onClick:k||a?r:f,ref:n,target:u}))}),D0=o.forwardRef(function(t,n){let{"aria-current":r="page",caseSensitive:s=!1,className:a="",end:i=!1,style:c,to:u,viewTransition:d,children:p}=t,v=$g(t,R0),g=zo(u,{relative:v.relative}),x=Zt(),S=o.useContext(zg),{navigator:k,basename:j}=o.useContext(dr),h=S!=null&&V0(g)&&d===!0,f=k.encodeLocation?k.encodeLocation(g).pathname:g.pathname,m=x.pathname,w=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;s||(m=m.toLowerCase(),w=w?w.toLowerCase():null,f=f.toLowerCase()),w&&j&&(w=al(w,j)||w);const C=f!=="/"&&f.endsWith("/")?f.length-1:f.length;let E=m===f||!i&&m.startsWith(f)&&m.charAt(C)==="/",P=w!=null&&(w===f||!i&&w.startsWith(f)&&w.charAt(f.length)==="/"),M={isActive:E,isPending:P,isTransitioning:h},B=E?r:void 0,_;typeof a=="function"?_=a(M):_=[a,E?"active":null,P?"pending":null,h?"transitioning":null].filter(Boolean).join(" ");let T=typeof c=="function"?c(M):c;return o.createElement(Mg,Ji({},v,{"aria-current":B,className:_,ref:n,style:T,to:u,viewTransition:d}),typeof p=="function"?p(M):p)});var ju;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(ju||(ju={}));var Rp;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Rp||(Rp={}));function B0(e){let t=o.useContext(Lo);return t||vt(!1),t}function U0(e,t){let{target:n,replace:r,state:s,preventScrollReset:a,relative:i,viewTransition:c}=t===void 0?{}:t,u=pr(),d=Zt(),p=zo(e,{relative:i});return o.useCallback(v=>{if(z0(v,n)){v.preventDefault();let g=r!==void 0?r:qi(d)===qi(p);u(e,{replace:g,state:s,preventScrollReset:a,relative:i,viewTransition:c})}},[d,u,p,r,s,n,e,a,i,c])}function Ad(e){let t=o.useRef(Su(e)),n=o.useRef(!1),r=Zt(),s=o.useMemo(()=>_0(r.search,n.current?null:t.current),[r.search]),a=pr(),i=o.useCallback((c,u)=>{const d=Su(typeof c=="function"?c(s):c);n.current=!0,a("?"+d,u)},[a,s]);return[s,i]}function V0(e,t){t===void 0&&(t={});let n=o.useContext(I0);n==null&&vt(!1);let{basename:r}=B0(ju.useViewTransitionState),s=zo(e,{relative:t.relative});if(!n.isTransitioning)return!1;let a=al(n.currentLocation.pathname,r)||n.currentLocation.pathname,i=al(n.nextLocation.pathname,r)||n.nextLocation.pathname;return xu(s.pathname,i)!=null||xu(s.pathname,a)!=null}const ku="cozygen_token",Zi="cozygen:auth-expired";function Rd(){try{return typeof window>"u"?null:localStorage.getItem(ku)}catch{return null}}function Fg(e){try{if(typeof window>"u")return;e?localStorage.setItem(ku,e):localStorage.removeItem(ku)}catch{}}function Ni(){Fg(null)}function pl(){const e=Rd();return e?{Authorization:`Bearer ${e}`}:{}}function W0(e={}){if(Ni(),!(typeof window>"u"||typeof window.dispatchEvent!="function"))try{window.dispatchEvent(new CustomEvent(Zi,{detail:e}))}catch{window.dispatchEvent(new Event(Zi))}}const _a=async(e,t)=>{if(t.status===401){W0({url:e,status:t.status});const r=new Error("unauthorized");throw r.unauthorized=!0,r.status=401,r}if(!t.ok)throw new Error(`${e} failed`);return(t.headers.get("content-type")||"").includes("application/json")?t.json():t.text()},Wr=async(e,t={})=>{const{signal:n}=t,r=await fetch(e,{headers:{...pl()},credentials:"include",signal:n});return _a(e,r)},Hr=async(e,t,n={})=>{const{signal:r}=n,s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",...pl()},body:JSON.stringify(t),credentials:"include",signal:r});return _a(e,s)};async function H0(e={}){return Wr("/cozygen/workflows",e)}async function K0(e,t={}){return Wr(`/cozygen/workflows/${encodeURIComponent(e)}`,t)}async function Nu(e,t={}){const{refresh:n=!1,cacheBust:r="",...s}=t||{},a=new URLSearchParams({type:String(e||"")});return n&&a.set("refresh","1"),r&&a.set("cache_bust",String(r)),Wr(`/cozygen/get_choices?${a.toString()}`,s)}async function Td(e){const t=await fetch("/prompt",{method:"POST",headers:{"Content-Type":"application/json",...pl()},body:JSON.stringify(e),credentials:"include"});return _a("/prompt",t)}async function G0(e){const t=new FormData;t.append("image",e);const n=await fetch("/cozygen/upload_image",{method:"POST",headers:{...pl()},body:t,credentials:"include"});return _a("/cozygen/upload_image",n)}async function Og(e="",t=1,n=50,r=!1,s=!1,a="all",i="",c={}){const{includeMeta:u=!1,...d}=c||{},p=new URLSearchParams({subfolder:e,page:String(t),per_page:String(n),show_hidden:r?"1":"0",recursive:s?"1":"0",kind:a});return u&&p.set("include_meta","1"),i&&p.set("cache_bust",String(i)),Wr(`/cozygen/api/gallery?${p.toString()}`,d)}async function Y0({filename:e="",subfolder:t=""}={},n={}){const r=new URLSearchParams({filename:String(e||""),subfolder:String(t||"")}),s=await fetch(`/cozygen/api/gallery/prompt?${r.toString()}`,{headers:{...pl()},credentials:"include",signal:n==null?void 0:n.signal}),i=(s.headers.get("content-type")||"").includes("application/json")?await s.json():await s.text();if(!s.ok){const c=new Error((i==null?void 0:i.error)||"Prompt metadata not found");throw c.status=s.status,c.payload=i,c}return i}async function Id({promptId:e="",promptRaw:t=null}={},n={}){return!e||!t?{ok:!1}:typeof t!="object"?{ok:!1}:Hr("/cozygen/api/prompt_raw",{prompt_id:String(e),prompt_raw:t},n)}async function Dg({filename:e="",subfolder:t=""}={},n={}){return Hr("/cozygen/api/gallery/delete",{filename:e,subfolder:t},n)}async function Q0(){return Wr("/cozygen/api/aliases")}async function q0(e){return Hr("/cozygen/api/aliases",e||{})}async function $d(e={}){return Wr("/cozygen/api/tags/categories",e)}async function il({q:e="",category:t="",sort:n="count",minCount:r=0,limit:s=80,offset:a=0}={},i={}){const c=Number.isFinite(Number(r))?Math.max(0,Number(r)):0,u=new URLSearchParams({q:String(e||""),category:String(t||""),sort:String(n||"count"),limit:String(s||80),offset:String(a||0)});return c>0&&u.set("min_count",String(c)),Wr(`/cozygen/api/tags/search?${u.toString()}`,i)}async function xc(e=[],t={}){return Hr("/cozygen/api/tags/validate",{tags:Array.isArray(e)?e:[]},t)}async function X0(e,t={}){const n=new URLSearchParams;return e&&n.set("workflow",e),Wr(`/cozygen/api/workflow_presets?${n.toString()}`,t)}async function J0(e,t,n={}){return Hr("/cozygen/api/workflow_presets",{workflow:e,preset:t},n)}async function Z0(e,t,n={}){return Hr("/cozygen/api/workflow_presets",{workflow:e,delete:t},n)}async function eS(e,t){return Hr("/cozygen/api/login",{username:e,password:t})}async function tS(){return fetch("/cozygen/api/auth_status",{headers:{...pl()},credentials:"include"}).then(e=>_a("/cozygen/api/auth_status",e))}async function nS(){return Hr("/cozygen/api/clear_cache",{})}const rS=30*60*1e3,Tp="cozygen_idle_logout",Bg=o.createContext(null);function sS({children:e}){const[t,n]=o.useState(!1),[r,s]=o.useState(null),[a,i]=o.useState(!1),c=o.useRef(null),u=o.useCallback(async()=>{if(!Rd()){s(null),i(!1),n(!0);return}try{const x=await tS();s((x==null?void 0:x.user)||null),i(!!(x!=null&&x.default_credentials))}catch{Ni(),s(null),i(!1)}finally{n(!0)}},[]);o.useEffect(()=>{u()},[u]);const d=o.useCallback(async(g,x)=>{const S=await eS(g,x);Fg((S==null?void 0:S.token)||""),s((S==null?void 0:S.user)||g),i(!!(S!=null&&S.default_credentials));try{localStorage.removeItem(Tp)}catch{}return S},[]),p=o.useCallback(()=>{Ni(),s(null),i(!1)},[]);o.useEffect(()=>{if(typeof window>"u")return;const g=()=>{p(),n(!0)};return window.addEventListener(Zi,g),()=>window.removeEventListener(Zi,g)},[p]),o.useEffect(()=>{if(!t)return;const g=()=>{c.current&&clearTimeout(c.current);const S=setTimeout(()=>{Ni(),s(null),i(!1);try{localStorage.setItem(Tp,"1")}catch{}window.location.hash="#/login"},rS);c.current=S};g();const x=["pointerdown","keydown","visibilitychange"];return x.forEach(S=>window.addEventListener(S,g,{passive:!0})),()=>{c.current&&(clearTimeout(c.current),c.current=null),x.forEach(S=>window.removeEventListener(S,g))}},[t]);const v=o.useMemo(()=>({ready:t,user:r,authed:!!r,defaultCreds:a,login:d,logout:p,refresh:u}),[t,r,a,d,p,u]);return l.jsx(Bg.Provider,{value:v,children:e})}function _o(){const e=o.useContext(Bg);if(!e)throw new Error("useAuth must be used within AuthProvider");return e}function lS({children:e}){return l.jsx(sS,{children:e})}const G=o.forwardRef(function({as:t,href:n,variant:r,size:s="md",iconOnly:a=!1,active:i=!1,pressed:c,className:u="",type:d,...p},v){const g=t||(n?"a":"button"),x=s==="lg"?"is-lg":s==="sm"?"is-compact":s==="xs"?"is-tiny":s==="mini"?"is-mini":s==="icon"?"is-icon":"",S=r?`is-${r}`:"",h=["ui-button",x,S,a?"is-icon":"",i?"is-active":"",u].filter(Boolean).join(" "),f={ref:v,className:h,"aria-pressed":c,...p};return g==="button"?l.jsx("button",{...f,type:d||"button"}):l.jsx(g,{...f,href:n})}),Ug=({size:e=32,className:t=""})=>l.jsxs("svg",{width:e,height:e,viewBox:"0 0 32 32",fill:"none",className:t,"aria-hidden":"true",children:[l.jsx("path",{d:"M8 24L20 4",stroke:"url(#logo-gradient)",strokeWidth:"3",strokeLinecap:"round"}),l.jsx("path",{d:"M6 26C6 26 7 24 8 24C9 24 10 25 8 27C6 29 4 28 6 26Z",fill:"url(#logo-warm)"}),l.jsx("circle",{cx:"22",cy:"8",r:"2",fill:"url(#logo-spark)"}),l.jsx("circle",{cx:"26",cy:"12",r:"1.5",fill:"url(#logo-spark)",opacity:"0.8"}),l.jsx("circle",{cx:"24",cy:"16",r:"1",fill:"url(#logo-spark)",opacity:"0.6"}),l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"logo-gradient",x1:"8",y1:"24",x2:"20",y2:"4",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{stopColor:"#FF9F7A"}),l.jsx("stop",{offset:"0.5",stopColor:"#9F8CFF"}),l.jsx("stop",{offset:"1",stopColor:"#44E1C5"})]}),l.jsxs("linearGradient",{id:"logo-warm",x1:"4",y1:"24",x2:"10",y2:"28",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{stopColor:"#FF9F7A"}),l.jsx("stop",{offset:"1",stopColor:"#FFD666"})]}),l.jsxs("radialGradient",{id:"logo-spark",cx:"0.3",cy:"0.3",r:"0.7",children:[l.jsx("stop",{stopColor:"#FFFFFF"}),l.jsx("stop",{offset:"0.5",stopColor:"#44E1C5"}),l.jsx("stop",{offset:"1",stopColor:"#9F8CFF"})]})]})]}),mt=({children:e,size:t=16,className:n="",...r})=>l.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,"aria-hidden":"true",...r,children:e}),aS=e=>l.jsxs(mt,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),l.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("path",{d:"M21 15l-5-5L5 21"})]}),Ao=e=>l.jsxs(mt,{...e,children:[l.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"}),l.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7",strokeWidth:"3"})]}),Vg=e=>l.jsxs(mt,{...e,children:[l.jsx("path",{d:"M14 3H4a2 2 0 00-2 2v10l6 6h10a2 2 0 002-2V9l-6-6z"}),l.jsx("path",{d:"M14 3v6h6"}),l.jsx("path",{d:"M7 7h5"}),l.jsx("path",{d:"M7 11h7"})]}),Ro=e=>l.jsx(mt,{...e,children:l.jsx("path",{d:"M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"})}),Cu=e=>l.jsx(mt,{...e,children:l.jsx("polygon",{points:"5 3 19 12 5 21 5 3",fill:"currentColor",stroke:"none"})}),iS=e=>l.jsxs(mt,{...e,children:[l.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"}),l.jsx("polyline",{points:"16 17 21 12 16 7"}),l.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),Wg=e=>l.jsxs(mt,{...e,children:[l.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),l.jsx("line",{x1:"9",y1:"9",x2:"9",y2:"15"}),l.jsx("line",{x1:"15",y1:"9",x2:"15",y2:"15"}),l.jsx("circle",{cx:"9",cy:"12",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"10",r:"1.5",fill:"currentColor",stroke:"none"})]}),oS=e=>l.jsxs(mt,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),l.jsx("circle",{cx:"12",cy:"12",r:"4"}),l.jsx("line",{x1:"3",y1:"9",x2:"6",y2:"9"})]}),eo=e=>l.jsxs(mt,{...e,children:[l.jsx("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"}),l.jsx("path",{d:"M2 10h20"})]}),Ip=e=>l.jsx(mt,{...e,children:l.jsx("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"})}),$p=e=>l.jsxs(mt,{...e,children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),Mp=e=>l.jsxs(mt,{...e,children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"}),l.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),Fp=e=>l.jsx(mt,{...e,children:l.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),bu=e=>l.jsxs(mt,{...e,children:[l.jsx("path",{d:"M3 6h18"}),l.jsx("path",{d:"M8 6V4h8v2"}),l.jsx("path",{d:"M6 6l1 14h10l1-14"}),l.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),l.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),Op=e=>l.jsxs(mt,{...e,children:[l.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),l.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]}),Ci=e=>l.jsxs(mt,{...e,children:[l.jsx("polyline",{points:"23 4 23 10 17 10"}),l.jsx("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10"})]}),Hg=e=>l.jsx(mt,{...e,children:l.jsx("polyline",{points:"15 18 9 12 15 6"})}),To=e=>l.jsx(mt,{...e,children:l.jsx("polyline",{points:"9 18 15 12 9 6"})}),to=e=>l.jsxs(mt,{...e,children:[l.jsx("circle",{cx:"9",cy:"6",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"6",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"9",cy:"12",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"12",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"9",cy:"18",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"18",r:"1",fill:"currentColor",stroke:"none"})]}),Dr=e=>l.jsxs(mt,{...e,children:[l.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Dp=e=>l.jsxs(mt,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",strokeDasharray:"4 2"}),l.jsx("line",{x1:"9",y1:"12",x2:"15",y2:"12"})]}),cS=e=>l.jsxs(mt,{...e,children:[l.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),l.jsx("polyline",{points:"5 12 12 5 19 12"})]}),uS=e=>l.jsxs(mt,{...e,children:[l.jsx("circle",{cx:"6",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"12",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"18",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"})]}),dS=e=>l.jsxs(mt,{...e,children:[l.jsx("rect",{x:"9",y:"9",width:"10",height:"10",rx:"2"}),l.jsx("path",{d:"M7 15H6a2 2 0 01-2-2V6a2 2 0 012-2h7"})]});function fS(){const{pathname:e}=Zt(),{logout:t,user:n}=_o(),r=e==="/login",s=()=>{try{t()}catch{}window.location.hash="#/login"};return l.jsx("header",{className:"top-bar",children:l.jsx("div",{className:"top-bar-shell",children:l.jsxs("div",{className:"brand-row",children:[l.jsxs(Mg,{to:"/studio",className:"brand-mark",children:[l.jsx(Ug,{size:28,className:"brand-logo"}),l.jsx("span",{className:"brand-text",children:"CozyGen"})]}),l.jsx("div",{className:"flex-1"}),r?null:l.jsxs(G,{variant:"muted",size:"sm",onClick:s,title:"Sign out",children:[l.jsx("span",{className:"inline-flex items-center justify-center",children:l.jsx(iS,{size:16})}),l.jsx("span",{children:"Logout"}),n?l.jsxs("span",{className:"text-xs text-[#9DA3FFB3] hidden sm:inline",children:["@",n]}):null]})]})})})}function pS(){const[e,t]=o.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("cozygen_gallery_pending")==="1"}catch{return!1}});return o.useEffect(()=>{const n=()=>t(!0),r=()=>t(!1),s=a=>{a.key==="cozygen_gallery_pending"&&t(a.newValue==="1")};return window.addEventListener("cozygen:gallery-pending",n),window.addEventListener("cozygen:gallery-viewed",r),window.addEventListener("storage",s),()=>{window.removeEventListener("cozygen:gallery-pending",n),window.removeEventListener("cozygen:gallery-viewed",r),window.removeEventListener("storage",s)}},[]),e}function Md(){if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const e=Math.random().toString(16).slice(2);return`cozy-${Date.now().toString(16)}-${e}`}const Kg="cozygen_last_render_payload";function Gg(e){if(e)try{if(typeof window>"u")return;window.localStorage.setItem(Kg,JSON.stringify(e))}catch{}}function Yg(){try{if(typeof window>"u")return null;const e=window.localStorage.getItem(Kg);return e?JSON.parse(e):null}catch{return null}}async function hS(){var t,n;const e=Yg();if(!e||!e.workflow)return{success:!1,error:"No previous render to repeat"};try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!0}}));const r=Md(),s=e.promptRaw||((n=(t=e==null?void 0:e.extraData)==null?void 0:t.extra_pnginfo)==null?void 0:n.cozygen_prompt_raw);if(s&&typeof s=="object")try{await Id({promptId:r,promptRaw:s})}catch{}return await Td({prompt:e.workflow,prompt_id:r}),window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!1}})),{success:!0}}catch(r){return console.error("Failed to requeue prompt",r),window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!1}})),r!=null&&r.unauthorized?(window.location.hash="#/login",{success:!1,error:"Session expired"}):{success:!1,error:"Failed to queue prompt"}}}function mS(){const e=Yg();return!!(e&&e.workflow)}const gS=[{to:"/controls",label:"Controls",Icon:Wg},{to:"/compose",label:"Compose",Icon:Ro},{to:"/gallery",label:"Gallery",Icon:aS},{to:"/library",label:"Library",Icon:eo}],yS=({isActive:e})=>["bottom-nav-link",e?"is-active":""].filter(Boolean).join(" ");function vS(){const e=Zt(),t=pS(),[n,r]=Kl.useState(!1),[s,a]=Kl.useState(!1),i=e.pathname==="/controls",c=e.pathname==="/compose",u=async()=>{if(!(typeof window>"u")&&!s)if(r(!0),setTimeout(()=>r(!1),400),i||c)try{window.dispatchEvent(new CustomEvent("cozygen:request-render"))}catch{}else{if(!mS())return;const d=await hS();d.success||console.warn("Requeue failed:",d.error)}};return Kl.useEffect(()=>{const d=p=>{var g;const v=!!((g=p==null?void 0:p.detail)!=null&&g.active);a(v),v&&(r(!0),setTimeout(()=>r(!1),400))};return window.addEventListener("cozygen:render-state",d),()=>window.removeEventListener("cozygen:render-state",d)},[]),l.jsxs("nav",{className:"bottom-nav","aria-label":"Bottom navigation",children:[gS.map(d=>l.jsxs(D0,{to:d.to,end:d.end,className:yS,children:[l.jsx("span",{className:"bottom-nav-icon","aria-hidden":"true",children:l.jsx(d.Icon,{size:20})}),l.jsxs("span",{className:"bottom-nav-label",children:[d.label,d.to==="/gallery"&&t?l.jsx("span",{className:"badge-dot pulse","aria-hidden":"true"}):null]})]},d.to)),l.jsxs("button",{type:"button",className:`bottom-nav-link is-action ${n?"is-flash":""} ${s?"is-rendering":""}`,onClick:u,"aria-label":"Render","aria-busy":s,"aria-disabled":s,disabled:s,children:[l.jsx("span",{className:"bottom-nav-icon","aria-hidden":"true",children:l.jsx(Cu,{size:20})}),l.jsx("span",{className:"bottom-nav-label",children:"Render"})]},"render")]})}function xS(e,t){if(!t||t<=0)return null;const n=Number(e)||0,r=Number(t)||0,s=Math.round(n/r*100);return Number.isFinite(s)?Math.max(0,Math.min(100,s)):null}function wS({busy:e=!1,progressValue:t=0,progressMax:n=0,statusText:r="Idle",statusPhase:s="idle",primaryLabel:a="Render",onPrimary:i,primaryDisabled:c=!1,onLogs:u,logsLabel:d="Logs"}){const p=xS(t,n),v=s==="queued"?"rgba(255, 143, 112, 0.95)":s==="running"?"rgba(68, 225, 197, 0.95)":s==="finished"?"rgba(92, 255, 154, 0.95)":s==="error"?"rgba(255, 143, 112, 0.95)":"rgba(159, 178, 215, 0.55)",x={idle:"Idle",queued:"Queued",running:"Running",finished:"Finished",error:"Error"}[s]||"Status",S=e||c;return l.jsxs("div",{className:"dock-bar-inner",children:[l.jsx(G,{variant:"primary",size:"lg",className:"w-full",onClick:i,disabled:S,children:e?"Rendering":a}),l.jsxs("div",{className:"dock-status-row",children:[l.jsxs("span",{className:"dock-status-left",children:[l.jsx("span",{className:"dock-status-dot",style:{background:v}}),l.jsx("span",{className:"dock-status-label",children:x})]}),l.jsxs("span",{className:"dock-status-right",children:[p!=null&&e?l.jsxs("span",{className:"dock-progress",children:[l.jsx("span",{className:"dock-progress-bar","aria-hidden":"true",children:l.jsx("span",{className:"dock-progress-fill",style:{width:`${p}%`}})}),l.jsxs("span",{children:[p,"%"]})]}):null,l.jsx("span",{className:"dock-status-text",children:r||(e?"Working":"Idle")}),u?l.jsx(G,{size:"xs",variant:"ghost",onClick:u,children:d}):null]})]})]})}const Qg="jpg,jpeg,png,webp,gif,bmp,tif,tiff",Fd=(e="")=>/\.(png|jpe?g|gif|webp|bmp|tif?f)$/i.test(e),qg=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e);async function wc({subfolder:e="",page:t=1,perPage:n=50,exts:r=Qg,signal:s}={}){const a=new URLSearchParams({subfolder:e,page:String(t),per_page:String(n),exts:r}),i=await fetch(`/cozygen/input?${a.toString()}`,{signal:s});if(!i.ok)throw new Error(`Input list failed: ${i.status}`);return i.json()}const no=e=>`/cozygen/input/file?path=${encodeURIComponent(e)}`,Eu="output::",Io=(e="")=>e.replace(/\\/g,"/").replace(/^\/+/,"").replace(/\/+$/,""),Xg=(e="")=>{const t=e.replace(/\\/g,"/").split("/").filter(Boolean);return t[t.length-1]||""},SS=({subfolder:e="",filename:t=""}={})=>{const n=Xg(t);if(!n)return"";const r=Io(e);return`${Eu}${r}::${n}`},Lu=(e="")=>{if(typeof e!="string"||!e.startsWith(Eu))return null;const t=e.slice(Eu.length);if(!t)return null;const n=t.lastIndexOf("::"),r=n===-1?t:t.slice(n+2);return r?{subfolder:n===-1?"":t.slice(0,n),filename:r}:null},ro=({filename:e="",subfolder:t="",type:n="output"}={})=>{const r=Xg(e);return r?`/view?${new URLSearchParams({filename:r,subfolder:Io(t),type:n||"output"}).toString()}`:""},Pu=(e="")=>e.split("/").slice(0,-1).join("/"),jS=e=>{if(typeof e!="string"||!e)return e!=null&&e.path?Pu(e.path):"";const t=Lu(e);return t?Io(t.subfolder):Pu(e)},Bp=(e=[])=>e.map(t=>{const n=t.rel_path||t.name||"",r=t.name||n||"Untitled",s=!!t.is_dir,a=s?"":no(n);return{...t,name:r,rel_path:n,is_dir:s,is_image:!s&&Fd(r),is_video:!s&&qg(r),source:"input",preview_url:a}}),kS=(e=[])=>e.map(t=>{const n=t.filename||"",r=t.subfolder||"",s=t.type==="directory",a=s?r||n:[r,n].filter(Boolean).join("/"),i=n||r||a||"Untitled",c=s?"":ro({filename:n,subfolder:r,type:t.type});return{...t,name:i,rel_path:a,is_dir:s,is_image:!s&&Fd(n),is_video:!s&&qg(n),source:"output",preview_url:c}}),Jr={get(e,t){try{return(typeof window<"u"?JSON.parse(localStorage.getItem(e)):null)??t}catch{return t}},set(e,t){try{typeof window<"u"&&localStorage.setItem(e,JSON.stringify(t))}catch{}}};function NS({input:e,value:t,onFormChange:n}){var Y;const r=((Y=e==null?void 0:e.inputs)==null?void 0:Y.param_name)||"Image Input",s=(e==null?void 0:e.class_type)||"CozyGenImageInput",a=`cg_last_input_cwd::${r}`,i=`cg_last_picker_source::${r}`,[c,u]=o.useState(""),[d,p]=o.useState(!1),[v,g]=o.useState(!1),[x,S]=o.useState(Jr.get(a,"")),[k,j]=o.useState(1),[h,f]=o.useState(50),[m,w]=o.useState([]),[C,E]=o.useState(1),[P,M]=o.useState(!1),[B,_]=o.useState(""),[T,q]=o.useState([]),[X,xe]=o.useState(!0),Le=o.useRef(null),[ke,le]=o.useState(()=>Jr.get(i,"inputs")==="outputs"?"outputs":"inputs"),R=ke,b=o.useCallback(D=>{const K=D==="outputs"?"outputs":"inputs";le(K),Jr.set(i,K),S(""),j(1)},[]),I=o.useMemo(()=>{if(c)try{const D=new URL(c,window.location.origin);return(D.searchParams.get("path")||D.searchParams.get("filename")||D.pathname.split("/").pop()||"").split("/").pop()||"No file selected."}catch{}if(!t)return"No file selected.";if(typeof t=="string"){const D=Lu(t);return D!=null&&D.filename?D.filename.split("/").pop():t.split("/").pop()}return t!=null&&t.path?t.path.split("/").pop():"No file selected."},[c,t]);o.useEffect(()=>{if(typeof t=="string"&&t){const D=Lu(t);D!=null&&D.filename?u(ro({filename:D.filename,subfolder:D.subfolder,type:"output"})):u(no(t)),p(!1)}else t!=null&&t.url?(u(t.url),p(!1)):(u(""),p(!1))},[t]);const A=o.useCallback(async D=>{const K=await G0(D),we=`/view?filename=${K.filename}&type=input`;u(we),p(!1),Jr.set(a,""),s==="CozyGenImageInput"?n(r,K.filename):n(r,{source:"Upload",path:K.filename,url:we})},[s,n,r]),H=o.useCallback(()=>{u(""),p(!1),s==="CozyGenImageInput"?n(r,""):n(r,{source:"Upload",path:"",url:""})},[s,n,r]),J=o.useCallback(()=>{const K=jS(t)||Jr.get(a,"");S(K),j(1),g(!0)},[t]),ue=o.useCallback(()=>{g(!1)},[]);o.useEffect(()=>{if(v){if(R!=="inputs"){q([]);return}(async()=>{try{const D=await wc({subfolder:"",page:1,perPage:0,exts:""});q((D.items||[]).filter(K=>K.is_dir))}catch{}})()}},[v,R]),o.useEffect(()=>{if(!v)return;let D=!1;Le.current&&Le.current.abort();const K=new AbortController;Le.current=K;async function we(){M(!0);try{if(R==="outputs"){const de=await Og(x,k,h,!1,!1,"all","",{signal:K.signal});if(D)return;const Te=kS(de&&de.items||[]);D||(w(Te),E(de&&de.total_pages||1))}else{const Te=await wc({subfolder:x,page:k,perPage:h,exts:X?Qg:"",signal:K.signal}),Re=(Te.items||[]).some(_e=>!_e.is_dir);if(X&&!Re){const _e=await wc({subfolder:x,page:k,perPage:h,exts:"",signal:K.signal});D||(w(Bp(_e.items||[])),E(_e.total_pages||1),xe(!1));return}D||(w(Bp(Te.items||[])),E(Te.total_pages||1))}}catch(de){if((de==null?void 0:de.name)==="AbortError")return;console.error(R==="outputs"?"Failed to load output directory":"Failed to load input directory",de),D||(w([]),E(1))}finally{D||M(!1)}}return we(),()=>{D=!0,Le.current===K&&(Le.current=null),K.abort()}},[v,x,k,h,X,R]);const ce=o.useDeferredValue(B),Q=o.useMemo(()=>{const D=ce.trim().toLowerCase();let K=m;return X&&(K=K.filter(we=>{if(we.is_dir)return!0;const de=we.name||we.filename||we.rel_path||"";return Fd(String(de))})),D?K.filter(we=>(we.name||we.filename||we.rel_path||"").toLowerCase().includes(D)):K},[m,ce,X]),me=o.useCallback(D=>{if(!D)return;const K=typeof D=="object"?D:null;if(((K==null?void 0:K.source)||"inputs")==="output"){const Re=SS({subfolder:(K==null?void 0:K.subfolder)||"",filename:(K==null?void 0:K.filename)||(K==null?void 0:K.name)||""});if(!Re)return;const _e=(K==null?void 0:K.preview_url)||ro({filename:K==null?void 0:K.filename,subfolder:K==null?void 0:K.subfolder,type:K==null?void 0:K.type});u(_e),p(!1),Jr.set(a,Io((K==null?void 0:K.subfolder)||"")),s==="CozyGenImageInput"?n(r,Re):n(r,{source:"OutputGallery",path:Re,url:_e}),g(!1);return}const de=typeof D=="string"?D:(K==null?void 0:K.rel_path)||(K==null?void 0:K.path)||"";if(!de)return;const Te=(K==null?void 0:K.preview_url)||no(de);u(Te),p(!1),Jr.set(a,Pu(de)),s==="CozyGenImageInput"?n(r,de):n(r,{source:"Server",path:de,url:Te}),g(!1)},[s,n,r]);return{param:r,previewUrl:c,imgReady:d,setImgReady:p,displayName:I,serverOpen:v,openServer:J,closeServer:ue,cwd:x,setCwd:S,page:k,setPage:j,perPage:h,setPerPage:f,totalPages:C,loading:P,search:B,setSearch:_,topDirs:T,imagesOnly:X,setImagesOnly:xe,shownEntries:Q,pickerSource:R,setPickerSource:b,handleUpload:A,clearImage:H,selectServer:me}}function Ft({open:e,onClose:t,title:n,children:r,footer:s,variant:a="sheet",className:i="",contentClassName:c="",shouldCloseOnOverlayClick:u=!0,shouldCloseOnEsc:d=!0}){const p=o.useRef(!1),v=o.useRef(null),g=o.useRef(null),x=j=>j?Array.from(j.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(h=>!h.hasAttribute("disabled")&&h.getAttribute("aria-hidden")!=="true"):[],S=o.useMemo(()=>["bottom-sheet-content",a==="fullscreen"?"is-fullscreen":"is-sheet",c].filter(Boolean).join(" "),[c,a]),k=o.useMemo(()=>["bottom-sheet-overlay",i].filter(Boolean).join(" "),[i]);return o.useEffect(()=>{if(!e||!d)return;const j=h=>{h.key==="Escape"&&(t==null||t())};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[e,t,d]),o.useEffect(()=>{if(!e||typeof document>"u")return;const j=v.current;g.current=document.activeElement;const h=()=>{var C;const w=x(j)[0]||j;(C=w==null?void 0:w.focus)==null||C.call(w)},f=m=>{if(m.key!=="Tab"||!j)return;const w=x(j);if(!w.length){m.preventDefault(),j.focus();return}const C=w[0],E=w[w.length-1],P=document.activeElement;m.shiftKey&&P===C?(m.preventDefault(),E.focus()):!m.shiftKey&&P===E&&(m.preventDefault(),C.focus())};return requestAnimationFrame(h),j==null||j.addEventListener("keydown",f),()=>{var w;j==null||j.removeEventListener("keydown",f);const m=g.current;m&&document.contains(m)&&((w=m.focus)==null||w.call(m))}},[e]),!e||typeof document>"u"?null:Ld.createPortal(l.jsx("div",{className:k,role:"presentation",onPointerDown:j=>{p.current=j.target===j.currentTarget},onClick:j=>{u&&p.current&&j.target===j.currentTarget&&(t==null||t())},children:l.jsx("div",{ref:v,className:S,role:"dialog","aria-modal":"true","aria-label":n||"Sheet",onClick:j=>j.stopPropagation(),tabIndex:-1,children:l.jsxs("div",{className:"bottom-sheet-panel",children:[l.jsxs("header",{className:"bottom-sheet-head",children:[l.jsx("div",{className:"bottom-sheet-title",children:n||""}),l.jsx("button",{type:"button",className:"bottom-sheet-close",onClick:t,"aria-label":"Close",children:l.jsx(Dr,{size:16})})]}),l.jsx("div",{className:"bottom-sheet-body",children:r}),s?l.jsx("footer",{className:"bottom-sheet-foot",children:s}):null]})})}),document.body)}function CS({items:e=[],value:t,onChange:n,ariaLabel:r,role:s="tablist",className:a="",tabClassName:i="",size:c="md",layout:u="equal",wrap:d=!1}){const p=["segmented-tabs",c==="sm"?"is-compact":"",u==="auto"?"is-auto":"",u==="icon"?"is-icon":"",d?"is-wrap":"",a].filter(Boolean).join(" "),v=s==="tablist"?"tab":"button",g=o.useRef([]);o.useEffect(()=>{g.current=g.current.slice(0,e.length)},[e.length]);const x=o.useMemo(()=>e.map((m,w)=>m.disabled?null:w).filter(m=>m!==null),[e]),S=o.useMemo(()=>e.findIndex(m=>m.key===t&&!m.disabled),[e,t]),k=x.length?x[0]:-1,j=S>=0?S:k,h=m=>{var C;const w=g.current[m];(C=w==null?void 0:w.focus)==null||C.call(w)},f=(m,w)=>{var E;if(!e.length)return m;let C=m;for(let P=0;P<e.length;P+=1)if(C=(C+w+e.length)%e.length,!((E=e[C])!=null&&E.disabled))return C;return m};return l.jsx("div",{className:p,role:s,"aria-label":r,children:e.map((m,w)=>{const C=m.key===t,E=m.label?String(m.label):"";return l.jsxs("button",{type:"button",ref:P=>{g.current[w]=P},role:v,"aria-selected":s==="tablist"?C:void 0,"aria-pressed":s!=="tablist"?C:void 0,"aria-controls":s==="tablist"?m.controls:void 0,className:["segmented-tab",C?"is-active":"",m.icon&&!E?"is-icon":"",m.className||"",i].filter(Boolean).join(" "),onClick:()=>{m.disabled||n==null||n(m.key)},onKeyDown:P=>{if(s!=="tablist"||!["ArrowRight","ArrowLeft","Home","End"].includes(P.key)||(P.preventDefault(),!e.length))return;let M=w;P.key==="Home"?M=x.length?x[0]:M:P.key==="End"?M=x.length?x[x.length-1]:M:P.key==="ArrowRight"?M=f(M,1):P.key==="ArrowLeft"&&(M=f(M,-1));const B=e[M];!B||B.disabled||(n==null||n(B.key),h(M))},disabled:m.disabled,title:m.title||E||m.ariaLabel,"aria-label":m.ariaLabel,tabIndex:s==="tablist"?w===j?0:-1:void 0,children:[m.icon?l.jsx("span",{className:"segmented-tab-icon",children:m.icon}):null,E?l.jsx("span",{className:"segmented-tab-label",children:E}):null,m.badge?l.jsx("span",{className:"segmented-tab-badge",children:m.badge}):null]},m.key)})})}const _n=o.memo(CS),bS=(e=[])=>(e||[]).map(t=>typeof t=="string"||typeof t=="number"?{value:t,label:String(t)}:{value:(t==null?void 0:t.value)??(t==null?void 0:t.id)??"",label:(t==null?void 0:t.label)??(t==null?void 0:t.name)??String((t==null?void 0:t.value)??""),disabled:!!(t!=null&&t.disabled)}),ES=(e,t)=>{if(!t)return e;const n=t.trim().toLowerCase();return n?e.filter(r=>{const s=String(r.label||"").toLowerCase(),a=String(r.value||"").toLowerCase();return s.includes(n)||a.includes(n)}):e};function LS({value:e,onChange:t,options:n,children:r,placeholder:s,emptyLabel:a="No matches",disabled:i=!1,size:c="md",className:u="",wrapperClassName:d="",searchable:p=!1,searchThreshold:v=0,searchPlaceholder:g="Search options...",searchValue:x,onSearchChange:S,searchAriaLabel:k="Search options",...j}){const[h,f]=o.useState(""),m=typeof x=="string"?x:h,w=S||f,C=o.useMemo(()=>bS(n),[n]),E=p||typeof v=="number"&&v>0&&C.length>v,P=o.useMemo(()=>E?ES(C,m):C,[C,m,E]),M=["ui-control","ui-select",c==="sm"?"is-compact":"",u,E?"":d].filter(Boolean).join(" "),B=()=>r||(P.length?P.map(T=>l.jsx("option",{value:T.value,disabled:T.disabled,children:T.label},String(T.value))):l.jsx("option",{value:"",disabled:!0,children:a})),_=l.jsxs("select",{...j,className:M,value:e??"",onChange:T=>t==null?void 0:t(T.target.value),disabled:i,children:[s?l.jsx("option",{value:"",children:s}):null,B()]});return E?l.jsxs("div",{className:["ui-select-stack",d].filter(Boolean).join(" "),children:[l.jsx("input",{type:"search",value:m,onChange:T=>w(T.target.value),placeholder:g,className:"ui-control ui-input is-compact","aria-label":k,disabled:i}),_]}):_}const nt=o.memo(LS);function PS({open:e,cwd:t,setCwd:n,page:r,setPage:s,perPage:a,setPerPage:i,totalPages:c,topDirs:u,loading:d,imagesOnly:p,setImagesOnly:v,search:g,setSearch:x,shownEntries:S,onSelect:k,onClose:j,pickerSource:h,setPickerSource:f}){if(!e)return null;const m=h||"inputs",w=typeof f=="function",C=()=>{n(""),s(1)},E=T=>{w&&T!==m&&(f(T),n(""),s(1))},P=t.split("/").filter(Boolean),M=m==="outputs"?"Choose output":"Choose input",B=[{key:"",label:"Root"},...u.map(T=>({key:T.rel_path,label:T.name}))],_=T=>{n(T),s(1)};return l.jsx(Ft,{open:e,onClose:j,title:M,variant:"fullscreen",footer:l.jsxs("div",{className:"flex items-center gap-2 w-full",children:[l.jsx(G,{variant:"muted",className:"w-full",disabled:r<=1||d,onClick:()=>s(T=>Math.max(1,T-1)),children:"Prev"}),l.jsxs("div",{className:"text-xs text-center text-[rgba(159,178,215,0.75)] min-w-[92px]",children:[r," / ",c]}),l.jsx(G,{variant:"muted",className:"w-full",disabled:r>=c||d,onClick:()=>s(T=>T<c?T+1:T),children:"Next"})]}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Location"}),l.jsxs("div",{className:"imagepicker-breadcrumb",children:[l.jsx("button",{type:"button",className:"imagepicker-crumb",onClick:C,children:"Root"}),P.map((T,q)=>{const X=P.slice(0,q+1).join("/");return l.jsx("button",{type:"button",className:"imagepicker-crumb",onClick:()=>{n(X),s(1)},children:T},X)})]})]}),w?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Source"}),l.jsx(_n,{ariaLabel:"Source",value:m,onChange:E,size:"sm",items:[{key:"inputs",label:"Inputs"},{key:"outputs",label:"Outputs"}]})]}):null,l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Filters"}),l.jsxs("div",{className:"composer-filters",children:[l.jsxs("label",{className:"inline-flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:p,onChange:T=>{v(T.target.checked),s(1)}}),l.jsx("span",{className:"text-sm text-[rgba(159,178,215,0.85)]",children:"Images only"})]}),l.jsx("input",{type:"search",value:g,onChange:T=>x(T.target.value),placeholder:"Search files",className:"sheet-input ui-control ui-input","aria-label":"Search files"}),l.jsx(nt,{value:a,onChange:T=>{const q=parseInt(T,10)||50;i(q),s(1)},"aria-label":"Items per page",size:"sm",options:[25,50,100]})]})]}),u.length>0?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Quick folders"}),l.jsx(_n,{ariaLabel:"Quick folders",value:t,onChange:_,size:"sm",layout:"auto",wrap:!0,className:"imagepicker-chips",items:B})]}):null,l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Results"}),d?l.jsxs("div",{className:"sheet-hint",children:["Scanning ",m==="outputs"?"output":"input"," folders"]}):S.length===0?l.jsx("div",{className:"sheet-hint",children:"Nothing here yet. Try a different folder or turn off Images only."}):null,l.jsx("div",{className:"imagepicker-grid",children:!d&&S.map(T=>{const q=`${T.source||"input"}::${T.rel_path||T.name}`,X=T.is_dir?"":T.preview_url||(T.source==="output"?ro({filename:T.filename,subfolder:T.subfolder,type:T.type}):no(T.rel_path||""));return l.jsx("button",{type:"button",className:`imagepicker-item ${T.is_dir?"is-dir":""}`,onClick:()=>{T.is_dir?(n(T.rel_path||""),s(1)):k(T)},children:T.is_dir?l.jsxs("div",{className:"imagepicker-dir-row",children:[l.jsx("div",{className:"imagepicker-dir-dot","aria-hidden":"true"}),l.jsx("div",{className:"imagepicker-name",children:T.name})]}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"imagepicker-thumb",children:X?l.jsx("img",{className:"imagepicker-img",alt:T.name,src:X}):l.jsx("div",{className:"imagepicker-img is-placeholder"})}),l.jsx("div",{className:"imagepicker-name",children:T.name})]})},q)})})]})]})})}function zS({open:e,onClose:t,title:n,url:r,kind:s="image"}){return r?l.jsx(Ft,{open:e,onClose:t,title:n||"Preview",variant:"fullscreen",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(G,{href:r,target:"_blank",rel:"noreferrer",variant:"muted",className:"w-full text-center",children:"Open"}),l.jsx(G,{variant:"primary",className:"w-full",onClick:t,children:"Close"})]}),children:l.jsx("div",{className:"url-viewer-stage",children:s==="video"?l.jsx("video",{src:r,controls:!0,className:"url-viewer-media",autoPlay:!0}):l.jsx("img",{src:r,alt:n||"Preview",className:"url-viewer-media"})})}):null}function _S({input:e,value:t,onFormChange:n}){const{previewUrl:r,imgReady:s,setImgReady:a,displayName:i,serverOpen:c,openServer:u,closeServer:d,cwd:p,setCwd:v,page:g,setPage:x,perPage:S,setPerPage:k,totalPages:j,topDirs:h,loading:f,search:m,setSearch:w,imagesOnly:C,setImagesOnly:E,shownEntries:P,pickerSource:M,setPickerSource:B,handleUpload:_,clearImage:T,selectServer:q}=NS({input:e,value:t,onFormChange:n}),X=o.useRef(null),xe=o.useRef(null),[Le,ke]=o.useState(0),[le,R]=o.useState(!1);o.useEffect(()=>{const A=xe.current;if(!A)return;const H=ue=>{ue.preventDefault(),ue.stopPropagation()},J=async ue=>{var Q,me;H(ue);const ce=(me=(Q=ue.dataTransfer)==null?void 0:Q.files)==null?void 0:me[0];ce&&(await _(ce),X.current&&(X.current.value=""),ke(Y=>Y+1))};return["dragenter","dragover","dragleave","drop"].forEach(ue=>A.addEventListener(ue,ue==="drop"?J:H)),()=>{["dragenter","dragover","dragleave","drop"].forEach(ue=>A.removeEventListener(ue,ue==="drop"?J:H))}},[_]);const b=async A=>{var J;const H=(J=A.target.files)==null?void 0:J[0];H&&(await _(H),X.current&&(X.current.value=""),ke(ue=>ue+1))},I=()=>{X.current&&X.current.click()};return l.jsxs("div",{className:"ui-card",children:[l.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[l.jsx("h3",{className:"text-sm font-semibold text-[#F8F4FF] truncate",children:i}),l.jsx("span",{className:"text-[11px] text-[#C3C7FFB3] truncate",children:"Image"})]}),l.jsx("div",{ref:xe,className:"mb-3 rounded-xl border border-dashed border-[rgba(255,255,255,0.14)] bg-[rgba(255,255,255,0.02)] flex items-center justify-center min-h-[140px] sm:min-h-[180px] overflow-hidden",children:r?l.jsx(G,{variant:"bare",className:"w-full h-full",onClick:()=>R(!0),"aria-label":`Preview ${i}`,title:"Open preview",children:l.jsx("img",{src:r,alt:i,className:`max-h-64 max-w-full object-contain transition-opacity ${s?"opacity-100":"opacity-0"}`,onLoad:()=>a(!0)})}):l.jsx("div",{className:"text-[11px] text-[#9DA3FFCC] text-center px-6",children:"Drop an image here, upload from your device, or choose one from your server."})}),l.jsx("input",{ref:X,type:"file",accept:"image/*",className:"hidden",onChange:b},Le),l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[l.jsx(G,{size:"sm",variant:"primary",onClick:u,children:"Choose"}),l.jsx(G,{size:"sm",variant:"muted",onClick:I,children:"Upload"}),l.jsx(G,{size:"sm",variant:"ghost",onClick:T,children:"Clear"})]}),l.jsx(PS,{open:c,cwd:p,setCwd:v,page:g,setPage:x,perPage:S,setPerPage:k,totalPages:j,topDirs:h,loading:f,imagesOnly:C,setImagesOnly:E,search:m,setSearch:w,shownEntries:P,pickerSource:M,setPickerSource:B,onSelect:q,onClose:d}),l.jsx(zS,{open:le,onClose:()=>R(!1),title:i||"Preview",url:r,kind:"image"})]})}function AS({open:e,onClose:t,title:n,description:r,render:s,index:a=0,total:i=0,children:c}){const[u,d]=o.useState("idle"),p=o.useRef(null),v=o.useRef(null),g=S=>S?Array.from(S.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(k=>!k.hasAttribute("disabled")&&k.getAttribute("aria-hidden")!=="true"):[];if(o.useEffect(()=>{if(u==="queued"){const S=setTimeout(()=>d("idle"),1600);return()=>clearTimeout(S)}},[u]),o.useEffect(()=>{if(!e||typeof document>"u")return;const S=p.current;v.current=document.activeElement;const k=()=>{var m;const f=g(S)[0]||S;(m=f==null?void 0:f.focus)==null||m.call(f)},j=h=>{if(h.key==="Escape"){t==null||t();return}if(h.key!=="Tab"||!S)return;const f=g(S);if(!f.length){h.preventDefault(),S.focus();return}const m=f[0],w=f[f.length-1],C=document.activeElement;h.shiftKey&&C===m?(h.preventDefault(),w.focus()):!h.shiftKey&&C===w&&(h.preventDefault(),m.focus())};return requestAnimationFrame(k),S==null||S.addEventListener("keydown",j),()=>{var f;S==null||S.removeEventListener("keydown",j);const h=v.current;h&&document.contains(h)&&((f=h.focus)==null||f.call(h))}},[e,t]),!e)return null;const x=typeof s=="function"?s():c;return l.jsxs("div",{className:"spotlight-overlay",role:"dialog","aria-modal":"true",children:[l.jsx("div",{className:"spotlight-backdrop",onClick:t}),l.jsxs("div",{className:"spotlight-sheet",ref:p,tabIndex:-1,children:[l.jsxs("div",{className:"spotlight-header",children:[l.jsxs("div",{className:"spotlight-meta",children:[l.jsx("div",{className:"spotlight-kicker",children:"Focused control"}),l.jsx("div",{className:"spotlight-title",children:n||"Control"}),r?l.jsx("div",{className:"spotlight-hint",children:r}):null]}),l.jsx("button",{type:"button",className:"spotlight-close",onClick:t,"aria-label":"Close",children:l.jsx(Dr,{size:16})})]}),l.jsx("div",{className:"spotlight-body",children:x}),l.jsx("div",{className:"spotlight-footer",children:l.jsx("div",{className:"spotlight-footer-right",children:l.jsx(G,{size:"sm",variant:"muted",onClick:t,"aria-label":"Close",children:"Close"})})})]})]})}const so=o.forwardRef(function({title:t,kicker:n,meta:r,defaultOpen:s=!0,variant:a="card",className:i="",bodyClassName:c,children:u},d){const p=a==="bare",v=(p?["collapsible-section","collapsible-section--bare",i]:["ui-panel","collapsible-card",i]).filter(Boolean).join(" "),g=(p?["collapsible-section-body",c||"space-y-4"]:["collapsible-card-body",c||"space-y-4"]).filter(Boolean).join(" "),x=r!=null?l.jsx("div",{className:"collapsible-card-summary-meta",children:r}):null;return l.jsxs("details",{ref:d,className:v,open:s,children:[l.jsxs("summary",{className:p?"collapsible-section-summary":"collapsible-card-summary",children:[l.jsxs("div",{className:"flex flex-col gap-1",children:[n?l.jsx("span",{className:"ui-kicker",children:n}):null,l.jsx("span",{className:"text-sm font-semibold tracking-wide",children:t})]}),x,p?l.jsx("span",{className:"collapsible-section-chevron","aria-hidden":"true",children:l.jsx(To,{size:16})}):null]}),l.jsx("div",{className:g,children:u})]})}),RS=/\.(safetensors|ckpt|pt|pth)$/i,TS=/\.([a-z0-9]{2,16})$/i,IS=e=>/[a-z]/i.test(e),$o=e=>e.replace(/\\/g,"/"),Jg=e=>{const{folder:t,base:n}=$S(e);if(!n)return e;if(!t)return n;const r=t.split(/\s+/).filter(Boolean),s=r[r.length-1]||"";if(s&&n.toLowerCase().startsWith(s.toLowerCase())){const a=n.slice(s.length);return a?`${t}${a}`:t}return`${t} ${n}`.trim()};function Zg(e){if(typeof e!="string")return!1;const t=e.trim();if(!t)return!1;const r=$o(t).split("/").filter(Boolean).pop()||"";return RS.test(r)}function ol(e){if(typeof e!="string")return!1;const t=e.trim();if(!t)return!1;const s=($o(t).split("/").filter(Boolean).pop()||"").match(TS);return s?IS(s[1]):!1}function Mo(e){if(typeof e!="string")return{folderPath:"",base:"",filename:""};const t=$o(e.trim());if(!t)return{folderPath:"",base:"",filename:""};const n=t.split("/").filter(Boolean),r=n.pop()||"",s=r.replace(/\.[^.]+$/,"");return{folderPath:n.join("/"),base:s,filename:r}}function $S(e){if(typeof e!="string")return{folder:"",base:""};const n=$o(e.trim()).split("/").filter(Boolean),s=(n.pop()||"").replace(/\.[^.]+$/,"");return{folder:n.join(" ").trim(),base:s}}function MS(e){return Zg(e)?Jg(e):e}function FS(e){return ol(e)?Jg(e):e}function Bn(e){if(!ol(e))return e;const{base:t}=Mo(e);return t||FS(e)}const OS=(e="")=>{if(!e||e==="root")return"root";const t=e.split("/").filter(Boolean);return t[t.length-1]||e},DS=o.memo(function({workflows:t=[],selectedWorkflow:n,onWorkflowChange:r,workflowData:s,presets:a=[],presetName:i="",onPresetNameChange:c,selectedPresetId:u="",onPresetSelect:d,onPresetSave:p,onPresetDelete:v,presetStatus:g}){const x=Array.isArray(t)?t:[],S=Array.isArray(a)?a:[],[k,j]=o.useState("All"),h=o.useMemo(()=>x.map(_=>{const T=String(_||"");if(!ol(T))return{value:T,isFile:!1,base:"",folderPath:""};const{folderPath:q,base:X}=Mo(T);return{value:T,isFile:!0,base:X,folderPath:q||"root"}}),[x]),f=o.useMemo(()=>{const _=new Set(["All"]);return h.forEach(T=>{T.isFile&&T.folderPath&&_.add(T.folderPath)}),Array.from(_).sort((T,q)=>T.localeCompare(q))},[h]),m=f.length>2;o.useEffect(()=>{if(!m){k!=="All"&&j("All");return}f.includes(k)||j("All")},[m,k,f]);const w=o.useMemo(()=>{const _=new Map;return h.forEach(T=>{if(!T.isFile||!T.base)return;const q=T.base.toLowerCase();_.set(q,(_.get(q)||0)+1)}),_},[h]),C=o.useMemo(()=>{const _=[],T=m&&k==="All";return h.forEach(q=>{if(!q.isFile){_.push({value:q.value,label:q.value});return}if(m&&k!=="All"&&q.folderPath!==k)return;let X=q.base||Bn(q.value)||q.value;if(T&&q.base){const xe=q.base.toLowerCase();w.get(xe)>1&&(X=`${X} (${OS(q.folderPath)})`)}_.push({value:q.value,label:X})}),_},[h,k,w,m]),E=o.useMemo(()=>n?C.some(_=>String(_.value)===String(n)):!0,[C,n]),P=o.useMemo(()=>!n||E?C:[{value:n,label:Bn(String(n))},...C],[E,n,C]),M=()=>{p()},B=()=>{v()};return l.jsxs(so,{title:l.jsxs(l.Fragment,{children:[l.jsx(eo,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Workflow"]}),bodyClassName:"control-shell controls-body",defaultOpen:!1,className:"controls-panel",children:[l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"workflow-select",children:"Workflow"}),m?l.jsx(nt,{value:k,onChange:j,wrapperClassName:"mb-2","aria-label":"Workflow folder filter",size:"sm",options:f.map(_=>({value:_,label:_}))}):null,l.jsx(nt,{id:"workflow-select",value:n||"",onChange:r,"aria-label":"Workflow",size:"sm",placeholder:"Select workflow...",options:P})]}),l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"preset-select",children:"Preset"}),l.jsx(nt,{id:"preset-select",value:u||"",onChange:d,"aria-label":"Workflow preset",disabled:!s,size:"sm",placeholder:"Select preset...",options:S.map(_=>({value:_.id,label:_.name}))})]}),l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"preset-name-input",children:"Preset name"}),l.jsx("input",{id:"preset-name-input",type:"text",value:i,onChange:_=>c(_.target.value),className:"ui-control ui-input",placeholder:"Name for new preset...","aria-label":"Preset name",disabled:!s})]}),l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsx(G,{size:"sm",variant:"primary",onClick:M,disabled:!s||!i.trim(),children:"Save preset"}),l.jsx(G,{size:"sm",variant:"muted",onClick:B,disabled:!s||!u,children:"Delete preset"})]}),g?l.jsx("div",{className:"text-xs text-[#6D8BFF]",children:g}):null]})]})});function BS({open:e,onClose:t,title:n,value:r,onChange:s,placeholder:a="",description:i}){const c=n||"Edit",u=o.useMemo(()=>`sheet-textarea-${Math.random().toString(36).slice(2,9)}`,[]);return l.jsxs(Ft,{open:e,onClose:t,title:c,variant:"fullscreen",footer:l.jsx(G,{variant:"primary",className:"w-full",onClick:t,children:"Done"}),children:[i?l.jsx("div",{className:"text-[12px] text-[rgba(159,178,215,0.75)] mb-3",children:i}):null,l.jsx("textarea",{id:u,value:r??"",onChange:d=>s==null?void 0:s(d.target.value),placeholder:a,className:"sheet-textarea ui-control ui-textarea",rows:12})]})}function gn(e){const t=Number(e);return Number.isFinite(t)?t.toFixed(2).replace(/\.?0+$/u,""):"1"}function ey(e=""){const t=String(e||"");if(!t.trim())return[];const n=[];let r=0;for(;r<t.length;){for(;r<t.length&&/[\s,]/.test(t[r]);)r++;if(r>=t.length)break;let s=r,a=r,i="tag",c="";const u=t[r]==="(";if(u&&(s=r,r++),t[r]==="$"){i="alias";const d=r;for(r++;r<t.length&&t[r]!=="$"&&t[r]!==","&&t[r]!==`
`;)c+=t[r],r++;t[r]==="$"&&r++,u||(s=d)}else if(u){for(i="tag";r<t.length&&!(t[r]===":"||t[r]===`
`||t[r]===")");)c+=t[r],r++;c=c.trim()}else{i="tag";const d=r;for(;r<t.length&&!(t[r]===","||t[r]==="$"||t[r]===`
`||t[r]==="(");)c+=t[r],r++;c=c.trim(),s=d}if(u&&t[r]===":"){for(r++;r<t.length&&t[r]!==")"&&t[r]!==","&&t[r]!==`
`;)r++;t[r]===")"&&r++}u&&t[r]===")"&&r++,a=r,c&&n.push({type:i,text:c,start:s,end:a})}return n}function Ws(e="",t){if(!t||typeof t.start!="number"||typeof t.end!="number")return null;const r=String(e||"").slice(t.start,t.end);if(!r.startsWith("(")||!r.includes(":"))return null;const s=r.lastIndexOf(":");if(s===-1)return null;const a=r.slice(s+1);if(!a.endsWith(")"))return null;const i=a.slice(0,-1).trim();if(!/^\d+(\.\d+)?$/u.test(i))return null;const c=Number.parseFloat(i);return Number.isFinite(c)?{weight:c,wrapperStart:t.start,wrapperEnd:t.end}:null}function zu(e="",t,n){const r=String(e||"");if(!t||typeof t.start!="number"||typeof t.end!="number")return r;const s=n==null?null:Number(n),a=s===null||!Number.isFinite(s)||Math.abs(s-1)<1e-6,i=t.type==="alias"?`$${t.text}$`:t.text;if(a)return r.slice(0,t.start)+i+r.slice(t.end);const c=gn(s),u=`(${i}:${c})`;return r.slice(0,t.start)+u+r.slice(t.end)}function _u(e="",t,n,r){var g;if(n===r||n===null||r===null||!(t!=null&&t.length))return e;const s=String(e||""),a=t.map(x=>({start:x.start,end:x.end,text:s.slice(x.start,x.end)})),i=a.slice(0,-1).map((x,S)=>{const k=a[S+1];return s.slice(x.end,k.start)}),c=a.length?s.slice(0,a[0].start):"",u=a.length?s.slice(a[a.length-1].end):"",d=[...a],[p]=d.splice(n,1);d.splice(r,0,p);let v=c+(((g=d[0])==null?void 0:g.text)||"");for(let x=1;x<d.length;x++)v+=(i[x-1]??", ")+d[x].text;return v+=u,v}function ty(e="",t){const n=String(e||"");if(!t||typeof t.start!="number"||typeof t.end!="number")return n;const r=n.slice(0,t.start).replace(/[\s,]*$/,""),s=n.slice(t.end).replace(/^[\s,]*/,"");return r?`${r}, ${s}`.trim():s.trim()}function zs(e="",t){if(!t||typeof t.index!="number"||typeof t.length!="number")return null;const n=String(e||""),r=t.index,s=t.index+t.length;if(r<=0||n[r-1]!=="("||n[s]!==":")return null;let a=s+1,i="";for(;a<n.length&&n[a]!==")";)if(i+=n[a],a+=1,i.length>12)return null;if(a>=n.length||n[a]!==")")return null;const c=i.trim();if(!/^\d+(\.\d+)?$/u.test(c))return null;const u=Number.parseFloat(c);return Number.isFinite(u)?{weight:u,wrapperStart:r-1,wrapperEnd:a+1}:null}function ii(e="",t,n){const r=String(e||"");if(!t||typeof t.index!="number"||typeof t.length!="number")return r;const s=t.index,a=t.index+t.length,i=zs(r,t),c=n==null?null:Number(n),u=c===null||!Number.isFinite(c)||Math.abs(c-1)<1e-6;if(i){if(u)return r.slice(0,i.wrapperStart)+r.slice(s,a)+r.slice(i.wrapperEnd);const p=gn(c);return r.slice(0,a+1)+p+r.slice(i.wrapperEnd-1)}if(u)return r;const d=gn(c);return r.slice(0,s)+"("+r.slice(s,a)+":"+d+")"+r.slice(a)}function oi(e,t,n){const r=Number(e);return Number.isFinite(r)?Math.max(t,Math.min(n,r)):t}function lo({open:e,onClose:t,title:n="Alias strength",tokenLabel:r="",weight:s=1,onApply:a,onRemoveWeight:i,onDeleteToken:c,onReplace:u,replaceLabel:d="Replace"}){const p=o.useMemo(()=>oi(s||1,.2,2),[s]),[v,g]=o.useState(p);o.useEffect(()=>{e&&g(p)},[e,p]);const x=gn(v);return l.jsx(Ft,{open:e,onClose:t,title:n,footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(G,{variant:"muted",className:"w-full",onClick:t,children:"Cancel"}),l.jsx(G,{variant:"primary",className:"w-full",onClick:()=>{a==null||a(v),t==null||t()},children:"Done"})]}),children:l.jsxs("div",{className:"sheet-stack token-strength-sheet",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Alias"}),l.jsx("div",{className:"sheet-hint",children:r||""})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Strength"}),l.jsxs("div",{className:"token-strength-row",children:[l.jsx(G,{size:"sm",variant:"muted",onClick:()=>g(S=>oi(S-.05,.2,2)),children:""}),l.jsxs("div",{className:"token-strength-value tabular-nums",children:[x,""]}),l.jsx(G,{size:"sm",variant:"muted",onClick:()=>g(S=>oi(S+.05,.2,2)),children:"+"})]}),l.jsx("input",{type:"range",min:.2,max:2,step:.05,value:v,onChange:S=>g(oi(S.target.value,.2,2)),className:"ui-range","aria-label":"Alias strength"}),l.jsx("div",{className:"sheet-hint token-strength-hint",children:"1.0 is normal. Increase to emphasize or reduce to soften."})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Actions"}),l.jsxs("div",{className:"token-strength-actions",children:[l.jsx(G,{size:"sm",variant:"ghost",onClick:()=>g(1),children:"Reset"}),u?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"token-strength-divider","aria-hidden":"true",children:"|"}),l.jsx(G,{size:"sm",variant:"ghost",onClick:()=>{u==null||u(),t==null||t()},children:d})]}):null,l.jsx("span",{className:"token-strength-divider","aria-hidden":"true",children:"|"}),l.jsx(G,{size:"sm",variant:"danger",onClick:()=>{c==null||c(),t==null||t()},children:"Delete"})]})]})]})})}function ts(e){const t=String(e||"").trim();if(!t)return"";const n=t.toLowerCase(),r={scifi:"Sci-Fi",sci:"Sci",ui:"UI",vfx:"VFX",hdr:"HDR",dof:"DoF",bokeh:"Bokeh",vhs:"VHS",jpeg:"JPEG",jpg:"JPG",png:"PNG",gif:"GIF",webp:"WebP",api:"API",nsfw:"NSFW",sfw:"SFW",sfx:"SFX",fx:"FX",lora:"LoRA",loras:"LoRAs",ip:"IP",egirl:"E-girl",i2v:"I2V",t2i:"T2I",img2img:"Img2Img",txt2img:"Txt2Img",tts:"TTS",asmr:"ASMR",ai:"AI",highleg:"High-Leg","one-piece":"One-Piece","three-quarter":"Three-Quarter"};return r[n]?r[n]:/^\d+$/.test(n)?n:n==="3d"?"3D":n==="2d"?"2D":n.length===1?n.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1)}function US(e=""){const t=String(e||"").trim().toLowerCase();return t?t.startsWith("flirty_")?"flirty":t.startsWith("action_")||t.startsWith("dynamic_")||t.startsWith("stealth_")||t.startsWith("athletic_")||t.startsWith("running_")||t.startsWith("walking_")?"action":t.startsWith("sleepy_")||t.startsWith("relaxed_")||t.startsWith("reclining_")||t.startsWith("sitting_")||t.startsWith("kneeling_")?"rest":t.startsWith("happy_")||t.startsWith("sad_")||t.startsWith("angry_")||t.startsWith("nervous_")||t.startsWith("smug_")||t.startsWith("surprised_")||t.startsWith("scared_")||t.startsWith("tipsy_")?"emotion":t.startsWith("composed_")||t.startsWith("contemplative_")||t.startsWith("looking_")?"posed":"everyday":""}function VS(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return n==="lingerie"?"lingerie":n==="swimwear"||n==="swim"?"swimwear":n==="costumes"||n==="tech"?"costumes":n==="uniform"?"uniform":n==="formal"?"formal":n==="alt"?"alt":n==="casual"||n==="street"||n==="lounge"||n==="sporty"||n==="dress"?"everyday":n||"everyday"}function WS(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return["fire","candlelight","embers"].includes(n)?"fire":["moonlight"].includes(n)?"night":["neon"].includes(n)?"neon":["studio","stage","sidelighting","dim"].includes(n)?"studio":["golden","sunbeam","dappled"].includes(n)?"natural":["lens","light"].includes(n)?"effects":n||"other"}function Wl(e="",t=""){const n=String(e||"").trim(),r=String(t||"").trim().toLowerCase();if(!n)return"";if(r==="outfit")return VS(n)||"everyday";if(r==="pose")return US(n)||"everyday";if(r==="lighting")return WS(n)||"effects";const s=n.indexOf("_");return s<=0?"":n.slice(0,s).trim()}function ny(e=""){const t=String(e||"").trim();return t?t.includes(":")?t.split(":").slice(1).join(":"):t:""}function Hs({token:e="",name:t=""}={}){const n=String(t||"").trim()||ny(e);if(!n)return"";let s=n.replace(/_(\d+)$/u,"").split("_").filter(Boolean);if(s.length===0)return n;const a=[];for(let v=0;v<s.length;v++){const g=s[v],x=s[v+1];if(g&&x&&g.toLowerCase()==="one"&&x.toLowerCase()==="piece"){a.push("one-piece"),v+=1;continue}if(g&&x&&g.toLowerCase()==="three"&&x.toLowerCase()==="quarter"){a.push("three-quarter"),v+=1;continue}a.push(g)}if(s=a,Array.from(new Set(s.map(v=>String(v).toLowerCase()))).length===1)return ts(s[0]);const c=s[0],u=s.slice(1),d=ts(c),p=u.map(ts).join(" ").trim();return p?p.toLowerCase()===d.toLowerCase()?u.length===1&&String(u[0]).toLowerCase()===String(c).toLowerCase()?d||n:s.map(ts).join(" ").trim()||n:`${d} - ${p}`:s.map(ts).join(" ").trim()||n}function Od(e){if(!e)return{subcategory:"",displayName:""};const t=e.name||"",n=e.token||"",r=ny(n)||t,s=Wl(r,e.category)||"other",a=Hs({token:n,name:t})||n||t||"Alias";return{subcategory:s,displayName:a}}function Gn(e=""){const t=String(e||"").trim();return t?t==="All"?"All":{action:"Actions",camera:"Camera",body:"Body",char:"Characters",mood:"Mood",outfit:"Outfits",pose:"Poses",prop:"Props",scene:"Scenes",weather:"Weather",style:"Style",hair:"Hair",lighting:"Lighting"}[t]||ts(t):""}function Tn(e=""){const t=String(e||"").trim();return t?t==="All"?"All":t.split(/[_-]+/u).filter(Boolean).map(n=>ts(n)).join(" ").trim():""}function Up({open:e,onClose:t,isPromptLike:n,pickerSearch:r,onSearchChange:s,pickerSearchRef:a,categories:i,pickerCategory:c,onCategoryChange:u,subcategories:d,pickerSubcategory:p,onSubcategoryChange:v,filteredAliases:g,visibleAliases:x,visibleCount:S,onShowMore:k,listItemVisibilityStyles:j,onInsertAlias:h}){return l.jsx(Ft,{open:e,onClose:t,title:n?"Insert alias":"Aliases",footer:l.jsx(G,{variant:"primary",className:"w-full",onClick:t,children:"Done"}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Search"}),l.jsxs("div",{className:"composer-filters",children:[l.jsx("input",{ref:a,type:"text",value:r,onChange:f=>s(f.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(nt,{value:c,onChange:u,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:["All",...i.filter(f=>f!=="All")].map(f=>({value:f,label:f==="All"?"Category: All":Gn(f)}))}),d.length>2?l.jsx(nt,{value:p,onChange:v,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:d.map(f=>({value:f,label:f==="All"?"All subcategories":Tn(f)}))}):null]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Results"}),l.jsx("div",{className:"composer-alias-list",children:g.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[x.map(f=>l.jsxs("button",{type:"button",onClick:()=>h(f.token,{closeAfter:!n}),className:"composer-alias-item",style:j,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:f.displayName||f.token}),f.category?l.jsx("span",{className:"composer-alias-category",children:Gn(f.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",f.token,"$"]}),l.jsx("div",{className:"composer-alias-text",children:f.text})]},f.key)),S<g.length?l.jsxs(G,{variant:"muted",className:"w-full",onClick:k,children:["Show more (",g.length-S," left)"]}):null]})})]})]})})}const Vp={contentVisibility:"auto",containIntrinsicSize:"240px 120px"};function HS({name:e,label:t,description:n,value:r,onChange:s,onEnter:a,disabled:i=!1,multiline:c=!1,aliasOptions:u=[],aliasCatalog:d=[],onOpenComposer:p}){var Ye,Ct;const v=o.useRef(null),g=o.useRef(null),x=o.useRef({start:null,end:null}),S=o.useRef(null),k=o.useRef(null),[j,h]=o.useState(null),[f,m]=o.useState(null),[w,C]=o.useState(!1),[E,P]=o.useState(""),M=o.useDeferredValue(E),[B,_]=o.useState("All"),[T,q]=o.useState("All"),[X]=o.useState([]),xe=o.useRef(null),[Le,ke]=o.useState(!1),[le,R]=o.useState(!1),[b,I]=o.useState(null),A=typeof r=="string"?r:String(r??"");o.useMemo(()=>Array.isArray(u)?u.filter(Boolean):[],[u]);const H=o.useMemo(()=>(Array.isArray(d)?d.filter(W=>W&&W.name):[]).map(W=>({...W,...Od(W)})),[d]),J=o.useMemo(()=>H,[H]),ue=W=>{const ee=W.target.value;s==null||s(ee)},ce=W=>{if(!c&&W.key==="Enter"){W.preventDefault(),a==null||a(W.target.value,W);return}},Q=o.useMemo(()=>{const W=new Map;return J.forEach(ee=>{ee!=null&&ee.token&&W.set(String(ee.token).toLowerCase(),ee)}),W},[J]),me=o.useMemo(()=>{const W=new Set(["All"]);return H.forEach(ee=>{ee.category&&W.add(ee.category)}),Array.from(W).sort((ee,je)=>ee.localeCompare(je))},[H]),Y=o.useMemo(()=>{const W=new Set(["All"]);return J.forEach(ee=>{(!B||B==="All"||ee.category===B)&&ee.subcategory&&W.add(ee.subcategory)}),Array.from(W).sort((ee,je)=>ee.localeCompare(je))},[J,B]);o.useEffect(()=>{q("All")},[B]);const D=o.useMemo(()=>{const W=A||"";if(!W||!W.includes("$"))return[];const ee=[],je=/\$([a-z0-9_:-]+)\$/gi;let ze;for(;ze=je.exec(W);)ee.push({token:ze[1],index:ze.index,length:ze[0].length});return ee},[A]),K=()=>{try{const W=v.current;W?x.current={start:W.selectionStart??null,end:W.selectionEnd??null}:x.current={start:null,end:null}}catch{x.current={start:null,end:null}}g.current&&g.current.scrollIntoView({block:"center",behavior:"smooth"}),C(!0)},we=o.useMemo(()=>{const W=M.trim().toLowerCase();return J.filter(ee=>{var je,ze,$e,Qe;return B!=="All"&&(ee.category||"")!==B||T!=="All"&&(ee.subcategory||"other")!==T?!1:W?((je=ee.token)==null?void 0:je.toLowerCase().includes(W))||((ze=ee.text)==null?void 0:ze.toLowerCase().includes(W))||(($e=ee.name)==null?void 0:$e.toLowerCase().includes(W))||((Qe=ee.displayName)==null?void 0:Qe.toLowerCase().includes(W)):!0}).sort((ee,je)=>{const ze=(ee.subcategory||"").toLowerCase(),$e=(je.subcategory||"").toLowerCase();return ze!==$e?ze.localeCompare($e):ee.token.localeCompare(je.token)})},[J,B,T,M]),[de,Te]=o.useState(30),Re=o.useMemo(()=>we.slice(0,de),[we,de]);o.useEffect(()=>{Te(30)},[B,T,E,H]),o.useEffect(()=>{q("All")},[B]);const _e=(W,{closeAfter:ee=!0}={})=>{var Ce,et;const je=v.current,ze=`$${W}$`,$e=A||"",Qe=(Ce=x.current)==null?void 0:Ce.start,De=(et=x.current)==null?void 0:et.end,qe=(je==null?void 0:je.selectionStart)??(typeof Qe=="number"?Qe:$e.length),O=(je==null?void 0:je.selectionEnd)??(typeof De=="number"?De:$e.length),se=$e.slice(0,qe),Ee=$e.slice(O),Pe=se.match(/[^\s]$/),z=Ee.match(/^[^\s]/),U=Pe&&Pe[0]!==","?", ":"",re=z&&z[0]!==","?", ":"",ie=se+U+ze+re+Ee;s==null||s(ie);const oe=(se+U+ze+re).length;x.current={start:oe,end:oe},ee&&(C(!1),requestAnimationFrame(()=>{var tt;(tt=je==null?void 0:je.blur)==null||tt.call(je)}))},Ae=W=>{const ee=A||"",je=zs(ee,W),ze=je?je.wrapperStart:W.index,$e=je?je.wrapperEnd:W.index+W.length,Qe=ee.slice(0,ze).replace(/[\s,]*$/,""),De=ee.slice($e).replace(/^[\s,]*/,""),qe=Qe?`${Qe} ${De}`.trim():De.trim();s==null||s(qe)},Ze=W=>{if(!W)return;const ee=Q.get(W.token.toLowerCase()),je=(ee==null?void 0:ee.displayName)||W.token,ze=zs(A||"",W);I({tokenObj:W,displayName:je,weight:(ze==null?void 0:ze.weight)??1}),R(!0),requestAnimationFrame(()=>{var $e,Qe;return(Qe=($e=v.current)==null?void 0:$e.blur)==null?void 0:Qe.call($e)})},Oe=o.useMemo(()=>(W,ee)=>{var Ee;if(W===ee||W===null||ee===null||!(D!=null&&D.length))return;const je=A||"",ze=D.map(Pe=>{const z=zs(je,Pe),U=z?z.wrapperStart:Pe.index,re=z?z.wrapperEnd:Pe.index+Pe.length;return{start:U,end:re,text:je.slice(U,re)||`$${Pe.token}$`}}),$e=ze.slice(0,-1).map((Pe,z)=>{const U=ze[z+1];return je.slice(Pe.end,U.start)}),Qe=ze.length?je.slice(0,ze[0].start):"",De=ze.length?je.slice(ze[ze.length-1].end):"",qe=[...ze],[O]=qe.splice(W,1);qe.splice(ee,0,O);let se=Qe+(((Ee=qe[0])==null?void 0:Ee.text)||"");for(let Pe=1;Pe<qe.length;Pe+=1)se+=($e[Pe-1]??", ")+qe[Pe].text;se+=De,s==null||s(se)},[s,D,A]),ot=(W,ee)=>{h(ee),S.current=W.currentTarget,W.dataTransfer.effectAllowed="move",W.dataTransfer.setData("text/plain",String(ee)),requestAnimationFrame(()=>{S.current&&S.current.classList.add("is-dragging")})},ne=(W,ee)=>{W.preventDefault(),W.dataTransfer.dropEffect="move",ee!==f&&m(ee)},Ge=W=>{W!==f&&m(W)},ae=W=>{j!==null&&W!==null&&j!==W&&Oe(j,W),h(null),m(null),S.current=null},ve=()=>{S.current&&S.current.classList.remove("is-dragging"),ae(f)},fe=(W,ee)=>{W.preventDefault(),ae(ee)},F=(W,ee)=>{var $e,Qe;if(!((Qe=($e=W.target)==null?void 0:$e.closest)==null?void 0:Qe.call($e,".token-chip-drag-handle")))return;const ze=W.touches[0];k.current={idx:ee,startX:ze.clientX,startY:ze.clientY,moved:!1}},Ne=W=>{if(!k.current)return;const ee=W.touches[0],je=Math.abs(ee.clientX-k.current.startX),ze=Math.abs(ee.clientY-k.current.startY);if(je<=10&&ze<=10)return;k.current.moved=!0,h(k.current.idx),W.preventDefault();const $e=g.current,Qe=$e?$e.querySelectorAll(".token-chip-draggable"):document.querySelectorAll(".token-chip-draggable"),De=ee.clientX,qe=ee.clientY;for(let O=0;O<Qe.length;O++){const se=Qe[O].getBoundingClientRect();if(De>=se.left&&De<=se.right&&qe>=se.top&&qe<=se.bottom){m(O);break}}},ge=()=>{var W;(W=k.current)!=null&&W.moved&&j!==null&&f!==null&&j!==f&&Oe(j,f),k.current=null,h(null),m(null)},Fe={id:e,name:e,value:A,onChange:ue,disabled:i,className:"ui-control ui-input pr-10 text-[13px] sm:text-sm",placeholder:"","aria-label":t||e,"aria-describedby":n?`${e}-description`:void 0},Ue=()=>{C(!1),requestAnimationFrame(()=>{var W,ee;(ee=(W=v.current)==null?void 0:W.blur)==null||ee.call(W)})},Ie=(()=>{const W=String(e||"").toLowerCase(),ee=String(t||"").toLowerCase();return!!`${W} ${ee}`.trim().includes("prompt")})();return c?l.jsxs("div",{className:"relative space-y-2",ref:g,children:[p&&!Ie?l.jsxs("div",{className:"stringinput-toolbar",children:[l.jsx(G,{size:"sm",variant:"muted",onClick:()=>p(e),children:"Open composer"}),H.length?l.jsx(G,{size:"sm",variant:"ghost",onClick:K,children:"Aliases"}):null,l.jsx(G,{size:"sm",variant:"ghost",onClick:()=>ke(!0),children:"Expand"})]}):null,l.jsx("textarea",{ref:v,...Fe,rows:3,wrap:"soft",onKeyDown:ce,className:Fe.className+" resize-none min-h-[88px] max-h-[160px] leading-relaxed overflow-y-auto overflow-x-hidden break-words whitespace-pre-wrap",style:{whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere"}}),p&&Ie?l.jsx("div",{className:"stringinput-underbar",children:l.jsxs("div",{className:"stringinput-underbar-actions",children:[l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>p(e),children:"Open composer"}),H.length?l.jsx(G,{size:"xs",variant:"ghost",onClick:K,children:"Insert alias"}):null]})}):null,l.jsx(BS,{open:Le,onClose:()=>ke(!1),title:t||e,value:A,onChange:s,description:n}),D.length?l.jsxs("div",{className:"stringinput-tokens",children:[l.jsxs("div",{className:"stringinput-tokens-label",children:["Active aliases ",l.jsx("span",{className:"stringinput-tokens-hint",children:"(drag to reorder)"})]}),l.jsx("div",{className:"stringinput-tokens-list",children:D.map((W,ee)=>{var qe;const je=Q.get(W.token.toLowerCase()),ze=(je==null?void 0:je.displayName)||W.token,$e=j===ee,Qe=f===ee&&j!==null&&j!==ee,De=((qe=zs(A||"",W))==null?void 0:qe.weight)??1;return l.jsxs("div",{className:`ui-chip is-clickable token-chip token-chip-draggable ${$e?"is-dragging":""} ${Qe?"is-drop-target":""}`,title:`$${W.token}$`,role:"button",tabIndex:0,draggable:!0,onDragStart:O=>ot(O,ee),onDragEnd:ve,onDragEnter:()=>Ge(ee),onDragOver:O=>ne(O,ee),onDrop:O=>fe(O,ee),onTouchStart:O=>F(O,ee),onTouchMove:Ne,onTouchEnd:ge,onClick:()=>{j===null&&Ze(W)},onKeyDown:O=>{(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),Ze(W))},children:[l.jsx("span",{className:"token-chip-drag-handle","aria-hidden":"true",children:l.jsx(to,{size:14})}),l.jsx("span",{className:"token-chip-label",children:ze}),Math.abs(De-1)>1e-6?l.jsxs("span",{className:"token-chip-weight","aria-label":`Strength ${gn(De)}x`,children:["",gn(De)]}):null,l.jsx(G,{size:"mini",variant:"danger",onClick:O=>{O.stopPropagation(),Ae(W)},"aria-label":`Remove ${W.token}`,children:l.jsx(Dr,{size:12})})]},`${W.token}-${W.index}`)})})]}):null,l.jsx(lo,{open:le,onClose:()=>R(!1),title:"Alias strength",tokenLabel:b?`${b.displayName}  $${(Ye=b.tokenObj)==null?void 0:Ye.token}$`:"",weight:(b==null?void 0:b.weight)??1,onApply:W=>{b!=null&&b.tokenObj&&(s==null||s(ii(A||"",b.tokenObj,W)))},onRemoveWeight:()=>{b!=null&&b.tokenObj&&(s==null||s(ii(A||"",b.tokenObj,null)))},onDeleteToken:()=>{b!=null&&b.tokenObj&&Ae(b.tokenObj)}}),w?l.jsx(Up,{open:w,onClose:Ue,isPromptLike:Ie,pickerSearch:E,onSearchChange:P,pickerSearchRef:xe,categories:me,pickerCategory:B,onCategoryChange:_,subcategories:Y,pickerSubcategory:T,onSubcategoryChange:q,filteredAliases:we,visibleAliases:Re,visibleCount:de,onShowMore:()=>Te(W=>Math.min(W+30,we.length)),listItemVisibilityStyles:Vp,onInsertAlias:_e}):null]}):l.jsxs("div",{className:"relative space-y-2",ref:g,children:[l.jsx("input",{...Fe,type:"text",inputMode:"text",autoComplete:"off",onKeyDown:ce,className:Fe.className+" min-h-[44px]",ref:v}),D.length?l.jsxs("div",{className:"stringinput-tokens",children:[l.jsxs("div",{className:"stringinput-tokens-label",children:["Active aliases ",l.jsx("span",{className:"stringinput-tokens-hint",children:"(drag to reorder)"})]}),l.jsx("div",{className:"stringinput-tokens-list",children:D.map((W,ee)=>{var qe;const je=Q.get(W.token.toLowerCase()),ze=(je==null?void 0:je.displayName)||W.token,$e=j===ee,Qe=f===ee&&j!==null&&j!==ee,De=((qe=zs(A||"",W))==null?void 0:qe.weight)??1;return l.jsxs("div",{className:`ui-chip is-clickable token-chip token-chip-draggable ${$e?"is-dragging":""} ${Qe?"is-drop-target":""}`,title:`$${W.token}$`,onClick:()=>{j===null&&Ze(W)},role:"button",tabIndex:0,draggable:!0,onDragStart:O=>ot(O,ee),onDragEnd:ve,onDragEnter:()=>Ge(ee),onDragOver:O=>ne(O,ee),onDrop:O=>fe(O,ee),onTouchStart:O=>F(O,ee),onTouchMove:Ne,onTouchEnd:ge,onKeyDown:O=>{(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),Ze(W))},children:[l.jsx("span",{className:"token-chip-drag-handle","aria-hidden":"true",children:l.jsx(to,{size:14})}),l.jsx("span",{className:"token-chip-label",children:ze}),Math.abs(De-1)>1e-6?l.jsxs("span",{className:"token-chip-weight","aria-label":`Strength ${gn(De)}x`,children:["",gn(De)]}):null,l.jsx(G,{size:"mini",variant:"danger",onClick:O=>{O.stopPropagation(),Ae(W)},"aria-label":`Remove ${W.token}`,children:l.jsx(Dr,{size:12})})]},`${W.token}-${W.index}`)})})]}):null,l.jsx(lo,{open:le,onClose:()=>R(!1),title:"Alias strength",tokenLabel:b?`${b.displayName}  $${(Ct=b.tokenObj)==null?void 0:Ct.token}$`:"",weight:(b==null?void 0:b.weight)??1,onApply:W=>{b!=null&&b.tokenObj&&(s==null||s(ii(A||"",b.tokenObj,W)))},onRemoveWeight:()=>{b!=null&&b.tokenObj&&(s==null||s(ii(A||"",b.tokenObj,null)))},onDeleteToken:()=>{b!=null&&b.tokenObj&&Ae(b.tokenObj)}}),H.length?l.jsx(G,{size:"sm",variant:"ghost",className:"stringinput-trailing",onClick:()=>p?p(e):K(),title:p?"Open prompt composer":"Insert alias","aria-label":p?"Open prompt composer":"Insert alias",children:p?l.jsx(Ro,{size:16}):l.jsx(Ao,{size:16})}):null,l.jsx(Up,{open:w,onClose:Ue,isPromptLike:Ie,pickerSearch:E,onSearchChange:P,pickerSearchRef:xe,categories:me,pickerCategory:B,onCategoryChange:_,subcategories:Y,pickerSubcategory:T,onSubcategoryChange:q,filteredAliases:we,visibleAliases:Re,visibleCount:de,onShowMore:()=>Te(W=>Math.min(W+30,we.length)),listItemVisibilityStyles:Vp,onInsertAlias:_e})]})}const ry=o.memo(HS),Wp=e=>e==null?void 0:String(e).trim().replace(/[^A-Za-z0-9_-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||void 0;function KS({name:e,label:t,description:n,value:r,onChange:s,disabled:a=!1,min:i,max:c,step:u,isFloat:d=!1,inputId:p}){const v=u??(d?.01:1),g=p??Wp(e),x=j=>{if(j===""||j===null||j===void 0)return"";const h=d?parseFloat(j):parseInt(j,10);return Number.isNaN(h)?"":h},S=j=>{const h=j.target.value,f=x(h);s==null||s(f)},k=j=>{if(j.key!=="ArrowUp"&&j.key!=="ArrowDown")return;j.preventDefault();const h=typeof r=="number"?r:x(String(r??""))||0,f=j.key==="ArrowUp"?v:-v;let m=h+f;if(typeof i=="number"&&(m=Math.max(i,m)),typeof c=="number"&&(m=Math.min(c,m)),d){const w=typeof v=="number"?(String(v).split(".")[1]||"").length:2;m=parseFloat(m.toFixed(Math.max(w,2)))}s==null||s(m)};return l.jsxs("div",{className:"w-full flex items-center gap-2",children:[l.jsx("input",{id:g,name:e,type:"number",inputMode:d?"decimal":"numeric",value:r??"",onChange:S,onKeyDown:k,disabled:a,min:i,max:c,step:v,"aria-label":t||e,"aria-describedby":n?`${g||Wp(e)||e}-description`:void 0,className:"ui-control ui-input"}),typeof i=="number"||typeof c=="number"?l.jsxs("div",{className:"hidden sm:flex flex-col text-[10px] text-[#6A6FA8] text-right leading-tight",children:[typeof i=="number"&&l.jsxs("span",{children:["min ",i]}),typeof c=="number"&&l.jsxs("span",{children:["max ",c]})]}):null]})}const na=o.memo(KS);function GS({name:e,label:t,description:n,value:r,onChange:s,disabled:a=!1}){const i=!!r,c=()=>{a||s==null||s(!i)},u=d=>{(d.key===" "||d.key==="Enter")&&(d.preventDefault(),c())};return l.jsxs("button",{id:e,type:"button",role:"switch","aria-checked":i,"aria-label":t||e,"aria-describedby":n?`${e}-description`:void 0,onClick:c,onKeyDown:u,disabled:a,className:`ui-switch ${i?"is-on":""}`,children:[l.jsx("span",{className:"ui-switch-track",children:l.jsx("span",{className:"ui-switch-knob"})}),l.jsx("span",{className:"ui-switch-state",children:i?"On":"Off"})]})}const sy=o.memo(GS);function YS(e,t){try{if(typeof window>"u"||!e)return null;const n=e.getItem(t);return n?JSON.parse(n):null}catch{return null}}function Fo(e,t,n){try{if(typeof window>"u"||!e)return;e.setItem(t,JSON.stringify(n))}catch{}}function $n(){try{return typeof window>"u"?null:window.sessionStorage||null}catch{return null}}function hl(){try{return typeof window>"u"?null:window.localStorage||null}catch{return null}}const ly=750,lr=new Map,Vn=new Map,Wn=new Map,Js=new Map,Hn=new Map,Kn=new Map;function ay(e){var t;if(Vn.has(e)&&(clearTimeout(Vn.get(e)),Vn.delete(e)),Wn.has(e)){try{(t=window.cancelIdleCallback)==null||t.call(window,Wn.get(e))}catch{}Wn.delete(e)}lr.has(e)&&(Fo($n(),e,lr.get(e)),lr.delete(e))}function QS(e){var r;if(Vn.has(e)&&(clearTimeout(Vn.get(e)),Vn.delete(e)),Wn.has(e)){try{(r=window.cancelIdleCallback)==null||r.call(window,Wn.get(e))}catch{}Wn.delete(e)}const t=()=>{lr.has(e)&&(Fo($n(),e,lr.get(e)),lr.delete(e))},n=setTimeout(()=>{Vn.delete(e);try{if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const s=window.requestIdleCallback(()=>{Wn.delete(e),t()},{timeout:2500});Wn.set(e,s);return}}catch{}t()},ly);Vn.set(e,n)}function qS(){Array.from(Vn.values()).forEach(e=>clearTimeout(e)),Vn.clear(),Array.from(Wn.values()).forEach(e=>{var t;try{(t=window.cancelIdleCallback)==null||t.call(window,e)}catch{}}),Wn.clear(),Array.from(lr.entries()).forEach(([e,t])=>{Fo($n(),e,t)}),lr.clear(),Array.from(Hn.values()).forEach(e=>clearTimeout(e)),Hn.clear(),Array.from(Kn.values()).forEach(e=>{var t;try{(t=window.cancelIdleCallback)==null||t.call(window,e)}catch{}}),Kn.clear(),Array.from(Js.entries()).forEach(([e,t])=>{try{const n=$n();n&&n.setItem(e,t)}catch{}}),Js.clear()}if(typeof window<"u"&&!window.__cozygenFormStateFlush){const e=()=>qS();window.addEventListener("beforeunload",e),window.addEventListener("pagehide",e),window.__cozygenFormStateFlush=!0}function XS(e){var r;if(!e)return{};const t=`${e}_formData`,n=YS($n(),t);if(n&&typeof n=="object")return n;try{const s=hl();(r=s==null?void 0:s.removeItem)==null||r.call(s,t)}catch{}return{}}function ao(e,t,n={}){var a;if(!e)return;const{immediate:r=!1}=n||{},s=`${e}_formData`;if(r){ay(s),Fo($n(),s,t||{});try{const i=hl();(a=i==null?void 0:i.removeItem)==null||a.call(i,s)}catch{}return}lr.set(s,t||{}),QS(s)}function JS(e){e&&ay(`${e}_formData`)}function ZS(e,t,n=ly){var a;if(Js.set(e,t),Hn.has(e)&&(clearTimeout(Hn.get(e)),Hn.delete(e)),Kn.has(e)){try{(a=window.cancelIdleCallback)==null||a.call(window,Kn.get(e))}catch{}Kn.delete(e)}const r=()=>{const i=Js.get(e);Js.delete(e);try{const c=$n();c&&c.setItem(e,i)}catch{}},s=setTimeout(()=>{Hn.delete(e);try{if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const i=window.requestIdleCallback(()=>{Kn.delete(e),r()},{timeout:2e3});Kn.set(e,i);return}}catch{}r()},n);Hn.set(e,s)}function e1(e,t={}){var s,a;const{immediate:n=!1}=t||{},r="cozygen_last_param";if(n){if(Hn.has(r)&&(clearTimeout(Hn.get(r)),Hn.delete(r)),Kn.has(r)){try{(s=window.cancelIdleCallback)==null||s.call(window,Kn.get(r))}catch{}Kn.delete(r)}Js.delete(r);try{const i=$n();i&&i.setItem(r,e||"");const c=hl();(a=c==null?void 0:c.removeItem)==null||a.call(c,r)}catch{}return}ZS(r,e||"")}function t1(){var t,n;const e="cozygen_last_param";try{const r=$n(),s=((t=r==null?void 0:r.getItem)==null?void 0:t.call(r,e))||"";if(s)return s;const a=hl();(n=a==null?void 0:a.removeItem)==null||n.call(a,e)}catch{}return""}function iy(e,t){const n=e?String(e):"global",r=t?String(t):"";return`cozygen_dropdown_folder:${n}:${r}`}function Hp(e,t){var r,s;const n=iy(e,t);try{const a=$n(),i=((r=a==null?void 0:a.getItem)==null?void 0:r.call(a,n))||"";if(i)return i;const c=hl();(s=c==null?void 0:c.removeItem)==null||s.call(c,n)}catch{}return""}function n1(e,t,n){var s;const r=iy(e,t);try{const a=$n();a&&a.setItem(r,String(n||""));const i=hl();(s=i==null?void 0:i.removeItem)==null||s.call(i,r)}catch{}}function r1({workflowName:e,name:t,label:n,description:r,value:s,onChange:a,disabled:i=!1,options:c=[]}){const u=s??"",[d,p]=o.useState(()=>Hp(e,t)||"All");o.useEffect(()=>{const w=Hp(e,t);p(w||"All")},[e,t]);const v=o.useMemo(()=>(c||[]).map(w=>typeof w=="string"?{value:w,label:w}:{value:w.value??w.name??"",label:w.label??w.name??String(w.value??"")}),[c]),g=w=>{const C=typeof(w==null?void 0:w.value)=="string"||typeof(w==null?void 0:w.value)=="number"?String(w.value):"",E=typeof(w==null?void 0:w.label)=="string"||typeof(w==null?void 0:w.label)=="number"?String(w.label):"";return ol(C)?C:ol(E)?E:""},x=o.useMemo(()=>v.map(w=>{const C=g(w);if(!C)return{opt:w,path:"",base:"",folderPath:""};const{folderPath:E,base:P}=Mo(C);return{opt:w,path:C,base:P,folderPath:E||"root"}}),[v]),S=o.useMemo(()=>{const w=new Set(["All"]);return x.forEach(({path:C,folderPath:E})=>{C&&w.add(E||"root")}),Array.from(w).sort((C,E)=>C.localeCompare(E))},[x]),k=S.length>2;o.useEffect(()=>{if(!k){d!=="All"&&p("All");return}S.includes(d)||p("All")},[S,d,k]),o.useEffect(()=>{n1(e,t,d)},[e,t,d]);const j=o.useMemo(()=>{const w=new Map;return x.forEach(({base:C})=>{if(!C)return;const E=C.toLowerCase();w.set(E,(w.get(E)||0)+1)}),w},[x]),h=o.useMemo(()=>{const w=[],C=k&&d==="All";return x.forEach(({opt:E,path:P,base:M,folderPath:B})=>{if(!P){w.push(E);return}const _=B||"root";if(k&&d!=="All"&&_!==d)return;let T=M||Bn(P)||E.label;if(C&&M){const q=M.toLowerCase();if(j.get(q)>1){const X=_==="root"?"root":_.split("/").pop()||_;T=`${T} (${X})`}}w.push({...E,label:T})}),w.sort((E,P)=>String(E.label||"").localeCompare(String(P.label||"")))},[x,j,d,k]),f=o.useMemo(()=>u===""||u===null||u===void 0?!0:h.some(w=>String(w.value)===String(u)),[h,u]),m=w=>{const C=w&&w.target?w.target.value:w;a==null||a(C)};return l.jsxs("div",{className:"w-full space-y-2",children:[k?l.jsx("div",{className:"relative w-full",children:l.jsx(nt,{value:d,onChange:p,disabled:i,"aria-label":`Choose folder for ${n||t}`,size:"sm",options:S.map(w=>({value:w,label:w}))})}):null,l.jsx("div",{className:"relative w-full",children:l.jsx(nt,{id:t,name:t,value:u,onChange:m,disabled:i,"aria-label":n||t,"aria-describedby":r?`${t}-description`:void 0,placeholder:h.length>0&&(u===void 0||u==="")?"Select...":void 0,emptyLabel:"No matches",options:[...!f&&u!==""?[{value:u,label:Bn(String(u))}]:[],...h]},`${t||"field"}:${d}`)})]})}const Dd=o.memo(r1);function Kp(e=[]){return e.map(t=>typeof t=="string"?{value:t,label:t}:{value:t.value??t.name??"",label:t.label??t.name??String(t.value??"")})}function Gp(e,t){if(!e)return null;const n=String(e);if(t==="high"){const r=n.match(/(.+)-high(\.[^.]*)?$/i);return r?r[1]:null}if(t==="low"){const r=n.match(/(.+)-low(\.[^.]*)?$/i);return r?r[1]:null}return null}function s1(e){return e?e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/^./,t=>t.toUpperCase()):""}const l1=(...e)=>e.flat().map(n=>String(n??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")).filter(Boolean).join("-")||"field";function a1({name:e,label:t,description:n,highParam:r,lowParam:s,highChoices:a=[],lowChoices:i=[],formData:c={},onChangeParam:u,highStrengthParam:d,lowStrengthParam:p,strengthValue:v,onChangeStrength:g,highStrengthValue:x,lowStrengthValue:S,onChangeHighStrength:k,onChangeLowStrength:j,disabled:h=!1}){const f=o.useMemo(()=>Kp(a),[a]),m=o.useMemo(()=>Kp(i),[i]),w=o.useMemo(()=>{const Q=new Map;m.forEach(Y=>{const D=Gp(Y.value,"low");D&&(Q.has(D)||Q.set(D,Y))});const me=[];return f.forEach(Y=>{const D=Gp(Y.value,"high");if(!D)return;const K=Q.get(D);K&&me.push({base:D,label:s1(D),highValue:Y.value,lowValue:K.value})}),me.sort((Y,D)=>Y.label.localeCompare(D.label)),me},[f,m]),C=o.useMemo(()=>{const Q=c[r],me=c[s];if(!Q||!me)return"";const Y=w.find(D=>D.highValue===Q&&D.lowValue===me);return Y?Y.base:""},[c,r,s,w]),E=d||p||`${e}_strength`,P=o.useMemo(()=>l1(e||"lora",E||"strength"),[e,E]),M=!!(d||p),B=!!(d&&p),_=(Q,me=1)=>typeof Q=="number"?Q:me,T=_(typeof v=="number"?v:typeof x=="number"?x:typeof S=="number"?S:void 0,1),q=_(typeof x=="number"?x:void 0,T),X=_(typeof S=="number"?S:void 0,B?T:q),xe=B&&Math.abs(q-X)>1e-4,[Le,ke]=o.useState(xe);o.useEffect(()=>{ke(xe)},[xe,r,s]);const le=Q=>{if(!u)return;const me=w.find(Y=>Y.base===Q);me&&(u(r,me.highValue),u(s,me.lowValue))};if(w.length===0)return l.jsxs("div",{className:"text-[11px] text-[#9DA3FFCC]",children:["No matching ",l.jsx("span",{className:"font-semibold",children:"-high"})," /"," ",l.jsx("span",{className:"font-semibold",children:"-low"})," LoRA pairs found."]});const R=`${P}-linked`,b=`${P}-high`,I=`${P}-low`,A=B?"Linked":"Strength",H=B?"Applies to high + low":d||p||"",J=(Q,me)=>{const Y=Array.isArray(Q)?Q:[Q];let D=!1;Y.forEach(K=>{if(K==="high"&&typeof k=="function"){k(me);return}if(K==="low"&&typeof j=="function"){j(me);return}typeof g=="function"&&!D&&(g(me),D=!0)})},ue=Q=>{(d||!d&&!p)&&J("high",Q),p&&J("low",Q)},ce=()=>{B&&ke(Q=>{const me=!Q;return me||ue(typeof q=="number"?q:typeof X=="number"?X:T),me})};return l.jsxs("div",{className:"space-y-2",children:[l.jsx(Dd,{name:`${e}_pair`,label:t,description:n,value:C||"",onChange:le,disabled:h,options:w.map(Q=>({value:Q.base,label:Q.label}))}),M&&l.jsxs("div",{className:"space-y-1.5",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-[10px] uppercase tracking-[0.16em] text-[#9DA3FFCC]",children:"Strength"}),B&&l.jsx("button",{type:"button",className:"text-[10px] font-semibold tracking-[0.12em] uppercase text-[#E5E7FF]",onClick:ce,disabled:h,children:Le?"Link values":"Split values"})]}),Le&&B?l.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-3",children:[l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:b,className:"lora-strength-label is-high",children:[l.jsx("span",{className:"lora-strength-label-pill",children:"High"}),l.jsxs("span",{className:"lora-strength-label-text",children:["High strength",d&&l.jsx("span",{className:"lora-strength-label-hint",children:d})]})]}),l.jsx(na,{name:`${E}_high`,label:"High strength",description:"",value:q,onChange:Q=>J("high",Q),disabled:h,isFloat:!0,min:0,max:2,step:.05,inputId:b})]}),l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:I,className:"lora-strength-label is-low",children:[l.jsx("span",{className:"lora-strength-label-pill",children:"Low"}),l.jsxs("span",{className:"lora-strength-label-text",children:["Low strength",p&&l.jsx("span",{className:"lora-strength-label-hint",children:p})]})]}),l.jsx(na,{name:`${E}_low`,label:"Low strength",description:"",value:X,onChange:Q=>J("low",Q),disabled:h,isFloat:!0,min:0,max:2,step:.05,inputId:I})]})]}):l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:R,className:"lora-strength-label is-linked",children:[l.jsx("span",{className:"lora-strength-label-pill",children:A}),l.jsxs("span",{className:"lora-strength-label-text",children:["LoRA strength",H&&l.jsx("span",{className:"lora-strength-label-hint",children:H})]})]}),l.jsx(na,{name:E,label:"LoRA strength",description:"",value:T,onChange:ue,disabled:h,isFloat:!0,min:0,max:2,step:.05,inputId:R})]})]})]})}function i1(e,t){if(e.disabled!==t.disabled||e.name!==t.name||e.label!==t.label||e.description!==t.description||e.highParam!==t.highParam||e.lowParam!==t.lowParam||e.highStrengthParam!==t.highStrengthParam||e.lowStrengthParam!==t.lowStrengthParam||e.strengthValue!==t.strengthValue||e.highStrengthValue!==t.highStrengthValue||e.lowStrengthValue!==t.lowStrengthValue||e.highChoices!==t.highChoices||e.lowChoices!==t.lowChoices||e.onChangeParam!==t.onChangeParam||e.onChangeStrength!==t.onChangeStrength||e.onChangeHighStrength!==t.onChangeHighStrength||e.onChangeLowStrength!==t.onChangeLowStrength)return!1;const n=e.formData||{},r=t.formData||{};return!(n[e.highParam]!==r[t.highParam]||n[e.lowParam]!==r[t.lowParam])}const oy=o.memo(a1,i1),o1=16,c1=[" - "," ","-","_"],cy=e=>[...new Set(e.filter(Boolean))],io=(e,t)=>{const n=String(e||"").trim(),r=c1.map(s=>`${n}${s}${t}`);return r.push(`${n}${t}`),cy(r)},Yp=(e,t)=>{const n=io(`${e} Strength`,t),r=io(e,t).map(s=>`${s} Strength`);return cy([...n,...r])},Qp=e=>String(e||"").toLowerCase().replace(/[\s_-]+/g,""),ci=(e,t=[])=>{if(!e)return null;const n=Array.isArray(t)?t:[t];for(const s of n){if(!s)continue;const a=e.get(s);if(a)return{name:s,input:a}}const r=new Map;n.forEach(s=>{s&&r.set(Qp(s),s)});for(const[s,a]of e.entries()){const i=Qp(s);if(r.has(i))return{name:s,input:a}}return null},u1=Array.from({length:o1},(e,t)=>{const n=t+1,r=io("Lora High",n),s=io("Lora Low",n),a=Yp("Lora High",n),i=Yp("Lora Low",n);return{id:`video_lora_${n}`,label:`Video LoRA ${n}`,highParam:r[0],lowParam:s[0],highParamAliases:r,lowParamAliases:s,highStrengthParam:a[0],lowStrengthParam:i[0],highStrengthParamAliases:a,lowStrengthParamAliases:i}}),d1=e=>{var r,s;const t=((r=e==null?void 0:e.inputs)==null?void 0:r.param_type)||((s=e==null?void 0:e.inputs)==null?void 0:s.Param_type),n=String(t||"STRING").toUpperCase();return["NUMBER","FLOAT","INT"].includes(n)?"NUMBER":["BOOLEAN","BOOL"].includes(n)?"BOOLEAN":["DROPDOWN","CHOICE","SELECT"].includes(n)?"DROPDOWN":"STRING"},f1=e=>{const t=(e==null?void 0:e.inputs)||{};return t.label||t.display_name||t.title||t.param_name||(e==null?void 0:e.title)||(e==null?void 0:e.class_type)||"Parameter"},p1=e=>{const t=(e==null?void 0:e.inputs)||{};return t.description||t.help||t.tooltip||t.doc||""},_s=e=>{const t=(e==null?void 0:e.inputs)||{};return t.param_name||t.name||t.key||t.id||`param_${(e==null?void 0:e.id)||"unknown"}`},Hl=e=>{const t=(e==null?void 0:e.inputs)||{},n=t.choices||t.options||[],r=t.default_value??t.value??t.default_choice??(n&&n.length?n[0]:"")??"";return{paramName:_s(e),label:f1(e),description:p1(e),paramType:d1(e),multiline:!!t.multiline,min:typeof t.min=="number"?t.min:void 0,max:typeof t.max=="number"?t.max:void 0,step:typeof t.step=="number"?t.step:void 0,choices:n,defaultValue:r}},h1=(e,t)=>{if((e==null?void 0:e.paramType)==="BOOLEAN")return t?"On":"Off";if(t==null||t==="")return"Empty";if(typeof t=="string"){const n=t.trim();if(!n)return"Empty";const r=240,s=140,a=n.length>r?n.slice(0,r):n,c=/[\r\n\t]/.test(a)||/\s{2,}/u.test(a)?a.replace(/\s+/gu," ").trim():a;if(c.length>s)return`${c.slice(0,s)}`;const u=MS(c);return n.length>r?`${u}`:u}return String(t)};function m1({id:e,label:t,description:n,preview:r,expanded:s=!1,onToggle:a,children:i,trailing:c,className:u=""}){const d=typeof a=="function",p=e?`${e}-description`:void 0,v=e?`${e}-panel`:void 0,g=typeof t=="string"?t.trim().replace(/\s+/gu," ").replace(/:\s*$/u,""):t,x=typeof n=="string"?n.trim().replace(/\s+/gu," "):n,S=typeof r=="string"||typeof r=="number"?String(r):void 0,k=d?"button":"div",j=d?{type:"button",onClick:a,"aria-expanded":s,"aria-controls":v,"aria-describedby":x?p:void 0}:{};return l.jsxs("div",{className:["field-row",u].filter(Boolean).join(" "),children:[l.jsxs(k,{...j,className:["field-row-head",d?"is-collapsible":"is-static",s?"is-expanded":""].filter(Boolean).join(" "),children:[l.jsxs("div",{className:"field-row-main",children:[l.jsx("div",{className:"field-row-label",children:g}),x?l.jsx("div",{id:p,className:"field-row-description",children:x}):null]}),l.jsxs("div",{className:"field-row-trailing",children:[c?l.jsx("div",{className:"field-row-trailing-control",children:c}):null,r?l.jsx("div",{className:"field-row-preview",title:S,children:r}):null,d?l.jsx("div",{className:"field-row-chevron","aria-hidden":"true",children:l.jsx(To,{size:16})}):null]})]}),d&&s?l.jsx("div",{id:v,className:"field-row-body",children:i}):null]})}const Au=o.memo(m1);function g1({paramName:e,cfg:t,formData:n,loraPair:r,collapsed:s,onToggle:a,formatPreview:i,onChangeParam:c,changeHandlers:u}){const{id:d,label:p,highParam:v,lowParam:g,highStrengthParam:x,lowStrengthParam:S,highCfg:k,lowCfg:j}=r,h=x?n[x]:void 0,f=S?n[S]:void 0,m=h??f??1,w=s?i(t,[n[v],n[g]].filter(Boolean).join("  ")):null,C=e?`param-${e}`:void 0;return l.jsx("div",{id:C,"data-param-name":e,"data-param-label":p||t.label,"data-param-type":"lora_pair",className:"settings-row",children:l.jsx(Au,{id:e,label:p||t.label,description:t.description,preview:w,expanded:!s,onToggle:a,children:s?null:l.jsx(oy,{name:d||v,label:p||t.label,highParam:v,lowParam:g,highChoices:k.choices,lowChoices:j.choices,formData:n,onChangeParam:c,highStrengthParam:x,lowStrengthParam:S,strengthValue:m,highStrengthValue:h,lowStrengthValue:f,onChangeHighStrength:x?u.get(x):void 0,onChangeLowStrength:S?u.get(S):void 0,disabled:!1},`lora-${e}`)})})}function y1({paramName:e,cfg:t,formData:n,workflowName:r,spotlightName:s,spotlightRenderKey:a,aliasOptions:i,aliasCatalog:c,onOpenComposer:u,changeHandlers:d,enterHandlers:p,collapsed:v,previewValue:g,onToggle:x}){const S=n[e],k={name:e,label:t.label,description:t.description,value:S,disabled:!1,defaultValue:t.defaultValue},j=(f=n,m=!1)=>{const w={...k,value:f==null?void 0:f[e]};return t.paramType==="NUMBER"?l.jsx(na,{...w,inputId:e,onChange:d.get(e),min:t.min,max:t.max,step:t.step,isFloat:!0},`field-${e}-number-${a}`):t.paramType==="BOOLEAN"?l.jsx(sy,{...w,onChange:d.get(e)},`field-${e}-bool-${a}`):t.paramType==="DROPDOWN"?l.jsx(Dd,{...w,workflowName:r,onChange:d.get(e),options:t.choices||[]},`field-${e}-dropdown-${a}`):l.jsx(ry,{...w,aliasOptions:i,aliasCatalog:c,onOpenComposer:u,onChange:d.get(e),onEnter:p.get(e),multiline:t.multiline||s===e||m},`field-${e}-string-${a}`)},h=e?`param-${e}`:void 0;return t.paramType==="BOOLEAN"?l.jsx("div",{id:h,"data-param-name":e,"data-param-label":t.label,"data-param-type":"single",className:"settings-row",children:l.jsx(Au,{id:e,label:t.label,description:t.description,trailing:j(n,!0)})}):l.jsx("div",{id:h,"data-param-name":e,"data-param-label":t.label,"data-param-type":"single",className:"settings-row",children:l.jsx(Au,{id:e,label:t.label,description:t.description,preview:g,expanded:!v,onToggle:x,children:v?null:j(n,!0)})})}function v1({inputs:e=[],formData:t={},onFormChange:n,workflowName:r,onParamEdited:s,onSpotlight:a,compactControls:i=!0,collapseAllKey:c=0,collapseAllCollapsed:u=!0,lastEditedParam:d="",spotlightName:p="",onCloseSpotlight:v=()=>{},onVisibleParamsChange:g=()=>{},aliasOptions:x=[],aliasCatalog:S=[],onOpenComposer:k}){const[j,h]=o.useState({}),[f,m]=o.useState(0),w=o.useRef(t);o.useEffect(()=>{w.current=t},[t]);const C=o.useCallback((b,I)=>h1(b,I),[]),E=o.useCallback((b,I)=>{!n||!b||(n(b,I),s==null||s(b),h(A=>(A==null?void 0:A[b])===!1?A:{...A,[b]:!1}))},[n,s]),P=o.useCallback(b=>{b&&h(I=>({...I,[b]:!(I!=null&&I[b])}))},[]),M=o.useMemo(()=>e||[],[e]),B=o.useMemo(()=>{const b=new Map;return(M||[]).forEach(I=>{const A=_s(I);A&&b.set(A,H=>E(A,H))}),b},[E,M]),_=o.useMemo(()=>{const b=new Map;return(M||[]).forEach(I=>{const A=_s(I);A&&b.set(A,(H,J)=>{var ue,ce;E(A,H),(ce=(ue=J==null?void 0:J.target)==null?void 0:ue.blur)==null||ce.call(ue),p===A&&(v==null||v())})}),b},[E,v,p,M]),T=o.useMemo(()=>{const b=new Map;return(M||[]).forEach(I=>{const A=_s(I);A&&b.set(A,()=>P(A))}),b},[P,M]);o.useEffect(()=>{const b={};(e||[]).forEach(I=>{const A=_s(I);A&&(b[A]=u)}),d&&(b[d]=!1),h(b)},[c,u,e,d]);const q=o.useMemo(()=>{const b=new Map;return(e||[]).forEach(I=>{const A=_s(I);A&&b.set(A,I)}),b},[e]),X=o.useMemo(()=>{const b=[];return u1.forEach(I=>{const A=ci(q,I.highParamAliases||I.highParam),H=ci(q,I.lowParamAliases||I.lowParam);if(!A||!H)return;const J=A.input,ue=H.input,ce=Hl(J),Q=Hl(ue);if(ce.paramType!=="DROPDOWN"||Q.paramType!=="DROPDOWN")return;const me=ce.choices||[],Y=Q.choices||[];if(!me.length||!Y.length)return;const D=ci(q,I.highStrengthParamAliases||I.highStrengthParam),K=ci(q,I.lowStrengthParamAliases||I.lowStrengthParam);b.push({...I,highParam:A.name,lowParam:H.name,highStrengthParam:D==null?void 0:D.name,lowStrengthParam:K==null?void 0:K.name,highInput:J,lowInput:ue,highCfg:ce,lowCfg:Q})}),b},[q]),xe=o.useMemo(()=>{const b=new Map;return X.forEach(I=>{b.set(I.highParam,I)}),b},[X]),Le=o.useMemo(()=>{const b=new Set;return X.forEach(I=>{b.add(I.highParam),b.add(I.lowParam),I.highStrengthParam&&b.add(I.highStrengthParam),I.lowStrengthParam&&b.add(I.lowStrengthParam)}),b},[X]),ke=o.useMemo(()=>{const b=[];return(M||[]).forEach(I=>{const A=Hl(I),H=A.paramName,J=xe.get(H);if(J){b.push({name:H,label:J.label||A.label,description:A.description,render:ue=>{const ce=ue||w.current||{},Q=J.highStrengthParam?ce[J.highStrengthParam]:void 0,me=J.lowStrengthParam?ce[J.lowStrengthParam]:void 0,Y=Q??me??1;return l.jsx(oy,{name:J.id||J.highParam,label:J.label||A.label,highParam:J.highParam,lowParam:J.lowParam,highChoices:J.highCfg.choices,lowChoices:J.lowCfg.choices,formData:ce,onChangeParam:E,highStrengthParam:J.highStrengthParam,lowStrengthParam:J.lowStrengthParam,strengthValue:Y,highStrengthValue:Q,lowStrengthValue:me,onChangeHighStrength:J.highStrengthParam?B.get(J.highStrengthParam):void 0,onChangeLowStrength:J.lowStrengthParam?B.get(J.lowStrengthParam):void 0,disabled:!1},`lora-${H}-${f}`)}});return}Le.has(H)||b.push({name:H,label:A.label,description:A.description,render:ue=>{const ce=ue||w.current||{},Q={name:H,label:A.label,description:A.description,value:ce[H],defaultValue:A.defaultValue,disabled:!1};return A.paramType==="NUMBER"?l.jsx(na,{...Q,onChange:B.get(H),min:A.min,max:A.max,step:A.step,isFloat:!0},`field-${H}-number-${f}`):A.paramType==="BOOLEAN"?l.jsx(sy,{...Q,onChange:B.get(H)},`field-${H}-bool-${f}`):A.paramType==="DROPDOWN"?l.jsx(Dd,{...Q,workflowName:r,onChange:B.get(H),options:A.choices||[]},`field-${H}-dropdown-${f}`):l.jsx(ry,{...Q,aliasOptions:x,aliasCatalog:S,onOpenComposer:k,onChange:B.get(H),onEnter:_.get(H),multiline:A.multiline},`field-${H}-string-${f}`)}})}),b},[M,xe,Le,f,r,x,S,k,E,B,_,p,v]),le=o.useMemo(()=>{const b=new Map;return ke.forEach(I=>b.set(I.name,I)),b},[ke]);o.useEffect(()=>{g==null||g(ke.map(b=>b.name))},[ke,g]);const R=o.useCallback(b=>{const I=ke.map(ce=>ce.name),A=le.get(b);if(!A)return;const H=I.indexOf(b),J=H>0?I[H-1]:null,ue=H>=0&&H<I.length-1?I[H+1]:null;m(ce=>ce+1),a==null||a({name:b,label:A.label,description:A.description,render:ce=>A.render(ce||w.current),order:I,index:H>=0?H:0,total:I.length,onPrev:J?()=>R(J):null,onNext:ue?()=>R(ue):null})},[le,a,ke]);return l.jsx("div",{className:"settings-list",children:M.map(b=>{const I=Hl(b),A=I.paramName,H=xe.get(A);if(H){const ce=i?j[A]??!0:!!j[A];return l.jsx(g1,{paramName:A,cfg:I,formData:t,loraPair:H,collapsed:ce,onToggle:T.get(A),formatPreview:C,onChangeParam:E,changeHandlers:B},`lora_pair_${H.id||H.highParam}`)}if(Le.has(A))return null;const J=i?j[A]??!0:!!j[A],ue=J?C(I,t[A]):null;return l.jsx(y1,{paramName:A,cfg:I,formData:t,workflowName:r,spotlightName:p,spotlightRenderKey:f,aliasOptions:x,aliasCatalog:S,onOpenComposer:k,changeHandlers:B,enterHandlers:_,collapsed:J,previewValue:ue,onToggle:T.get(A)},A)})})}function x1(e){return(e||[]).map(t=>{var n;if(["CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput","CozyGenChoiceInput"].includes(t.class_type)){let r=t.class_type.replace("CozyGen","").replace("Input","").toUpperCase();return r==="CHOICE"&&(r="DROPDOWN"),{...t,inputs:{...t.inputs,param_type:r,Multiline:((n=t.inputs)==null?void 0:n.display_multiline)||!1}}}return t})}function w1({workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,sectionRef:s,compactControls:a=!1,collapseAllState:i=null,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:p,aliasOptions:v=[],aliasCatalog:g=[],onOpenComposer:x}){const S=o.useMemo(()=>x1((t||[]).filter(k=>k.class_type!=="CozyGenImageInput")),[t]);return l.jsx("section",{className:"settings-surface scroll-mt-24",ref:s,children:l.jsx(v1,{workflowName:e,inputs:S,formData:n,onFormChange:r,compactControls:a,collapseAllKey:(i==null?void 0:i.key)??0,collapseAllCollapsed:(i==null?void 0:i.collapsed)??!0,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:p,aliasOptions:v,aliasCatalog:g,onOpenComposer:x})})}function S1({workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,parameterSectionRef:s,compactControls:a=!0,collapseAllState:i=null,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:p,aliasOptions:v=[],aliasCatalog:g=[],onOpenComposer:x}){return l.jsx(w1,{workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,sectionRef:s,compactControls:a,collapseAllState:i,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:p,aliasOptions:v,aliasCatalog:g,onOpenComposer:x})}function qp(e){try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return""}}function j1({open:e,onClose:t,logs:n=[],onClear:r}){const s=o.useMemo(()=>(n||[]).map(a=>`[${qp(a.ts)}] ${String(a.level||"info").toUpperCase()} ${a.message}`).join(`
`),[n]);return l.jsx(Ft,{open:e,onClose:t,title:"Run logs",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(G,{variant:"muted",className:"w-full",onClick:()=>{var a,i;try{(i=(a=navigator.clipboard)==null?void 0:a.writeText)==null||i.call(a,s||"")}catch{}},children:"Copy"}),l.jsx(G,{variant:"ghost",className:"w-full",onClick:r,children:"Clear"}),l.jsx(G,{variant:"primary",className:"w-full",onClick:t,children:"Close"})]}),children:l.jsx("pre",{className:"runlog-pre",children:n!=null&&n.length?n.map((a,i)=>l.jsxs("div",{className:`runlog-line is-${a.level||"info"}`,children:[l.jsx("span",{className:"runlog-ts",children:qp(a.ts)}),l.jsx("span",{className:"runlog-msg",children:a.message})]},`${a.ts}-${i}`)):"No logs yet."})})}const k1="cozygen_field_order_v1";function N1(e,t){if(!e)return t;try{const n=JSON.parse(e);return n&&typeof n=="object"?n:t}catch{return t}}function C1(){if(typeof window>"u")return{};try{return N1(window.localStorage.getItem(k1),{})}catch{return{}}}function b1(e){if(Array.isArray(e))return{order:e.filter(Boolean),hidden:{}};if(!e||typeof e!="object")return{order:[],hidden:{}};const t=Array.isArray(e.order)?e.order.filter(Boolean):[],n=e.hidden&&typeof e.hidden=="object"?e.hidden:{};return{order:t,hidden:n}}function E1(e){if(!e)return{order:[],hidden:{}};const n=C1()[e];return b1(n)}function L1(e,t){let n=Array.isArray(t)?t:[];if(!e||n.length===0)return n;const{order:r,hidden:s}=E1(e);if(r&&r.length){const a=new Map;n.forEach(c=>{var d;const u=(d=c==null?void 0:c.inputs)==null?void 0:d.param_name;u&&!a.has(u)&&a.set(u,c)});const i=[];r.forEach(c=>{const u=a.get(c);u&&(i.push(u),a.delete(c))}),n.forEach(c=>{var d;const u=(d=c==null?void 0:c.inputs)==null?void 0:d.param_name;if(!u){i.push(c);return}a.has(u)&&(i.push(c),a.delete(u))}),n=i}return n=n.filter(a=>{var c;const i=(c=a==null?void 0:a.inputs)==null?void 0:c.param_name;return i?!s[i]:!0}),n}function P1(){const[e,t]=o.useState([]),[n,r]=o.useState(null),[s,a]=o.useState(!0),[i,c]=o.useState(null);o.useEffect(()=>{let d=!1;async function p(){a(!0),c(null);try{const v=await H0();if(d)return;const g=(v==null?void 0:v.workflows)||[];t(g);let x=null;try{if(x=typeof window<"u"?sessionStorage.getItem("selectedWorkflow"):null,typeof window<"u")try{localStorage.removeItem("selectedWorkflow")}catch{}}catch{x=null}if(x&&g.includes(x))r(x);else if(g.length>0){r(g[0]);try{typeof window<"u"&&sessionStorage.setItem("selectedWorkflow",g[0])}catch{}}else r(null)}catch(v){if(d)return;console.error("Failed to load workflows",v),c(v)}finally{d||a(!1)}}return p(),()=>{d=!0}},[]);const u=o.useCallback(d=>{r(d);try{if(typeof window<"u"&&sessionStorage.setItem("selectedWorkflow",d),typeof window<"u")try{localStorage.removeItem("selectedWorkflow")}catch{}}catch{}},[]);return{workflows:e,selectedWorkflow:n,selectWorkflow:u,loading:s,error:i}}const z1={clip_name1:"clip",clip_name2:"clip",unet_name:"unet",vae_name:"vae",sampler_name:"sampler",scheduler:"scheduler"},_1=["CozyGenDynamicInput","CozyGenImageInput","CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput","CozyGenChoiceInput"];function A1(e){const[t,n]=o.useState(null),[r,s]=o.useState([]),[a,i]=o.useState({}),[c,u]=o.useState(!1),[d,p]=o.useState(null);o.useEffect(()=>{if(!e){n(null),s([]),i({});return}let S=!1;const k=new AbortController;async function j(){u(!0),p(null);try{typeof performance<"u"&&performance.mark&&performance.mark("cozygen:workflow:load")}catch{}try{const h=await K0(e,{signal:k.signal});if(S)return;for(const E in h){const P=h[E];P.class_type==="CozyGenImageInput"&&!P.inputs.param_name&&(P.inputs.param_name="Image Input"),h[E].id=E}n(h);const f=Object.values(h).filter(E=>_1.includes(E.class_type)),m=await Promise.all(f.map(async E=>{const P=E.class_type==="CozyGenDynamicInput"&&E.inputs.param_type==="DROPDOWN",M=E.class_type==="CozyGenChoiceInput";if(P||M){const B=E.inputs.param_name;let _=E.inputs.choice_type||E.properties&&E.properties.choice_type;if(!_&&P&&(_=z1[B]),_)try{const T=await Nu(_,{signal:k.signal,refresh:_==="loras"});E.inputs.choices=T.choices||[]}catch(T){(T==null?void 0:T.name)!=="AbortError"&&console.error(`Choices for ${B} failed`,T),E.inputs.choices=[]}}return E}));if(S)return;s(m);const w=XS(e),C={};m.forEach(E=>{const P=E.inputs.param_name;if(!P)return;if(w[P]!==void 0){C[P]=w[P];return}let M;if(["CozyGenDynamicInput","CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput"].includes(E.class_type)){if(M=E.inputs.default_value,E.class_type==="CozyGenIntInput"){const B=parseInt(M,10);M=Number.isNaN(B)?0:B}else if(E.class_type==="CozyGenFloatInput"){const B=parseFloat(M);M=Number.isNaN(B)?0:B}}else if(E.class_type==="CozyGenChoiceInput"){const B=E.inputs.choices||[];M=B.length?B[0]:""}else E.class_type,M="";C[P]=M}),i(C);try{typeof performance<"u"&&performance.measure&&(performance.mark("cozygen:workflow:ready"),performance.measure(`cozygen:workflow:ready:${e||"unknown"}`,"cozygen:workflow:load","cozygen:workflow:ready"))}catch{}}catch(h){if(S)return;console.error("Failed to load workflow",h),p(h),n(null),s([])}finally{S||u(!1)}}return j(),()=>{JS(e),S=!0,k.abort()}},[e]);const v=o.useMemo(()=>r.filter(S=>S.class_type==="CozyGenImageInput"),[r]),g=v[0]||null,x=o.useCallback((S,k)=>{i(j=>{const h={...j,[S]:k};return e&&ao(e,h),h})},[e]);return{workflowData:t,dynamicInputs:r,imageInputs:v,primaryImageInput:g,formData:a,setFormData:i,handleFormChange:x,loading:c,error:d}}function Bd(){const[e,t]=o.useState(()=>typeof document>"u"?!0:document.visibilityState!=="hidden");return o.useEffect(()=>{if(typeof document>"u")return;const n=()=>{t(document.visibilityState!=="hidden")};return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)},[]),e}const Xp="::";function ra(e){const t={};return Object.entries(e||{}).forEach(([n,r])=>{const s=String(n||"").trim();if(!s||typeof r!="string")return;const a=r.trim();a&&(t[s]=a)}),t}function Ud(e){const t=new Map;return Object.entries(ra(e)).forEach(([n,r])=>{const s=n.toLowerCase();t.set(s,r),s.includes(Xp)&&t.set(s.replace(Xp,":"),r)}),t}function sa(e,t){if(typeof e!="string"||!e.includes("$"))return e;const n=t instanceof Map?t:Ud(t);return n.size?e.replace(/\$([a-z0-9_:-]+)\$/gi,(r,s)=>{const a=n.get(s.toLowerCase());return typeof a=="string"?a:r}):e}function R1(e,t){const n=t instanceof Map?t:Ud(t);if(!n.size||!e||typeof e!="object")return e;let r=!1;const s={};return Object.entries(e).forEach(([a,i])=>{if(typeof i=="string"){const c=sa(i,n);s[a]=c,c!==i&&(r=!0)}else s[a]=i}),r?s:e}function Vd(e){return e?JSON.parse(JSON.stringify(e)):{}}function T1(e,t,n){const r=Vd(e),s={...n||{}};if(!t||!Array.isArray(t))return{workflow:r,formData:s};for(const a of t){if(!a||!a.id||!a.inputs||!r[a.id])continue;const i=a.inputs.param_name;if(!i||a.class_type==="CozyGenImageInput")continue;let c=s[i];const u=r[a.id];if(!u||!u.inputs)continue;const d=a.class_type;c===void 0&&(d==="CozyGenChoiceInput"?c=a.inputs.value??a.inputs.default_choice??(a.inputs.choices&&a.inputs.choices[0])??"":c=a.inputs.default_value),c===void 0&&(c=""),s[i]=c,d==="CozyGenFloatInput"||d==="CozyGenIntInput"||d==="CozyGenStringInput"||d==="CozyGenDynamicInput"?u.inputs.default_value=c:d==="CozyGenChoiceInput"&&(u.inputs.value=c)}return{workflow:r,formData:s}}const Wd=["seed","noise_seed"],uy=["ckpt_name","checkpoint","ckpt","model_name"],Ru=["lora_name"],dy=["width","image_width"],fy=["height","image_height"],I1=/(prompt|positive|text)/i,$1=/(negative|neg)/i,ml=e=>String(e||"").toLowerCase(),Na=e=>(e==null?void 0:e.class_type)==="CozyGenDynamicInput"||(e==null?void 0:e.class_type)==="CozyGenChoiceInput",Ca=e=>{var t;return ml((t=e==null?void 0:e.inputs)==null?void 0:t.choice_type)},oo=(e,t)=>{e!=null&&e.inputs&&("default_value"in e.inputs&&(e.inputs.default_value=t),"value"in e.inputs&&(e.inputs.value=t))},py=e=>ml(e==null?void 0:e.class_type).includes("checkpoint"),hy=e=>ml(e==null?void 0:e.class_type).includes("lora"),my=e=>ml(e==null?void 0:e.class_type).includes("seed"),Hd=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;const t=parseInt(String(e),10);return Number.isFinite(t)?t:null},qn=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;const t=parseInt(String(e),10);return Number.isFinite(t)?t:null},ui=e=>e!=null&&e.inputs?"default_value"in e.inputs?qn(e.inputs.default_value):"value"in e.inputs?qn(e.inputs.value):null:null,co=e=>{var t;return ml((t=e==null?void 0:e.inputs)==null?void 0:t.param_name)},M1=e=>{var t;return String(((t=e==null?void 0:e.inputs)==null?void 0:t.param_name)||"").trim()},di=(e,t)=>{if(!(e!=null&&e.inputs))return!1;let n=!1;return"default_value"in e.inputs&&qn(e.inputs.default_value)!==null&&(e.inputs.default_value=t,n=!0),"value"in e.inputs&&qn(e.inputs.value)!==null&&(e.inputs.value=t,n=!0),n},F1=e=>{const t=String(e||"").trim();return!t||$1.test(t)?!1:I1.test(t)},O1=e=>{if(!e)return[];const t=[];return typeof e.default_value=="string"&&t.push("default_value"),typeof e.value=="string"&&e.value!==e.default_value&&t.push("value"),t},D1=e=>ml(e==null?void 0:e.class_type).includes("textencode"),Jp=(e,t)=>{if(!(e!=null&&e.inputs))return!1;let n=!1;return Wd.forEach(r=>{if(!(r in e.inputs))return;const s=e.inputs[r];Array.isArray(s)||Hd(s)!==null&&(e.inputs[r]=t,n=!0)}),n},B1=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(Wd.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}Hd(a)!==null&&(r.inputs[s]=t)}),my(r)&&Jp(r,t))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Jp(s,t)})},U1=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(Na(r)&&Ca(r)==="checkpoints"&&oo(r,t),py(r)&&uy.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}(typeof a=="string"||typeof a=="number")&&(r.inputs[s]=t)}))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Na(s)&&Ca(s)==="checkpoints"&&oo(s,t)})},V1=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(Na(r)&&Ca(r)==="loras"&&oo(r,t),(hy(r)||Ru.some(s=>s in r.inputs))&&Ru.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}(typeof a=="string"||typeof a=="number")&&(r.inputs[s]=t)}))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Na(s)&&Ca(s)==="loras"&&oo(s,t)})},W1=(e,t,n)=>{if(t===null&&n===null)return;const r=new Set,s=new Set;Object.values(e||{}).forEach(a=>{if(!(a!=null&&a.inputs))return;const i=a.inputs,c=co(a);t!==null&&c==="width"&&di(a,t),n!==null&&c==="height"&&di(a,n),t!==null&&dy.forEach(u=>{if(!(u in i))return;const d=i[u];if(Array.isArray(d)&&d.length){r.add(d[0]);return}qn(d)!==null&&(i[u]=t)}),n!==null&&fy.forEach(u=>{if(!(u in i))return;const d=i[u];if(Array.isArray(d)&&d.length){s.add(d[0]);return}qn(d)!==null&&(i[u]=n)})}),r.forEach(a=>{const i=e==null?void 0:e[a];i&&di(i,t)}),s.forEach(a=>{const i=e==null?void 0:e[a];i&&di(i,n)})};function gy(e){if(!e)return[];const t=Object.entries(e||{}).sort((r,s)=>{const a=Number(r[0]),i=Number(s[0]);return Number.isFinite(a)&&Number.isFinite(i)?a-i:String(r[0]).localeCompare(String(s[0]))}),n=[];return t.forEach(([r,s])=>{if(!(s!=null&&s.inputs))return;const a=s.inputs,i=String((s==null?void 0:s.class_type)||""),c=M1(s),u=co(s);if(u&&F1(u)){const d=O1(a);if(d.length){const p=a[d[0]];typeof p=="string"&&n.push({id:String(r),key:`${r}:${d[0]}`,label:c||`Prompt ${r}`,text:p,fields:d,classType:i})}return}D1(s)&&typeof a.text=="string"&&n.push({id:String(r),key:`${r}:text`,label:`${i||"Text Encode"} ${r}`,text:a.text,fields:["text"],classType:i})}),n}function H1(e,t=[],n={},r={}){if(!e||!t.length)return e;const{mutate:s=!1}=r||{},a=s?e:Vd(e);return t.forEach(i=>{var d;if(!(i!=null&&i.id)||!((d=i==null?void 0:i.fields)!=null&&d.length))return;const c=typeof(n==null?void 0:n[i.key])=="string"?n[i.key]:i.text;if(typeof c!="string")return;const u=a==null?void 0:a[i.id];u!=null&&u.inputs&&i.fields.forEach(p=>{typeof u.inputs[p]=="string"&&(u.inputs[p]=c)})}),a}function K1(e){const t={hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null},n=new Set,r=new Set;return Object.values(e||{}).forEach(s=>{const a=(s==null?void 0:s.inputs)||{};if(a){if(Wd.forEach(i=>{i in a&&(t.hasSeed=!0)}),py(s)&&(t.hasCheckpoint=!0,uy.forEach(i=>{const c=a[i];typeof c=="string"&&c&&n.add(c)})),hy(s)||Ru.some(i=>i in a)){t.hasLora=!0;const i=a.lora_name;typeof i=="string"&&i&&r.add(i)}if(Na(s)){const i=Ca(s),c=a.default_value??a.value;i==="checkpoints"&&(t.hasCheckpoint=!0,typeof c=="string"&&c&&n.add(c)),i==="loras"&&(t.hasLora=!0,typeof c=="string"&&c&&r.add(c))}if(my(s)&&"seed"in a&&(t.hasSeed=!0),t.width===null&&co(s)==="width"){const i=ui(s);i!==null&&(t.width=i)}if(t.height===null&&co(s)==="height"){const i=ui(s);i!==null&&(t.height=i)}t.width===null&&dy.forEach(i=>{if(!(i in a)||t.width!==null)return;const c=a[i];if(Array.isArray(c)&&c.length){const d=e==null?void 0:e[c[0]],p=ui(d);p!==null&&(t.width=p);return}const u=qn(c);u!==null&&(t.width=u)}),t.height===null&&fy.forEach(i=>{if(!(i in a)||t.height!==null)return;const c=a[i];if(Array.isArray(c)&&c.length){const d=e==null?void 0:e[c[0]],p=ui(d);p!==null&&(t.height=p);return}const u=qn(c);u!==null&&(t.height=u)})}}),t.checkpoint=n.values().next().value||"",t.loras=Array.from(r),t.hasSize=t.width!==null||t.height!==null,t}function G1(e,t={}){if(!e)return e;const n=Vd(e),{seedMode:r="keep",seedValue:s=null,checkpoint:a=null,lora:i=null,width:c=null,height:u=null}=t;if(r&&r!=="keep"){const v=r==="random"?Math.floor(Math.random()*4294967295):Hd(s);v!==null&&B1(n,v)}a&&U1(n,a),i&&V1(n,i);const d=qn(c),p=qn(u);return(d!==null||p!==null)&&W1(n,d,p),n}const Y1=/\$[a-z0-9_:-]+\$/i;function Q1({selectedWorkflow:e,workflowData:t,dynamicInputs:n,imageInputs:r,formData:s,setFormData:a,promptAliases:i=null}){const c=Bd(),[u,d]=o.useState(!1),[p,v]=o.useState(!1),[g,x]=o.useState(0),[S,k]=o.useState(0),[j,h]=o.useState("Idle"),[f,m]=o.useState("idle"),[w,C]=o.useState([]),E=o.useRef({ts:0,value:0,max:0}),P=o.useRef(null),M=o.useRef({value:0,max:0}),B=o.useRef(null),_=o.useRef(null),T=o.useRef(t),q=o.useRef(s),X=o.useRef(!1),xe=o.useRef(0),Le=o.useRef(0),ke=o.useRef("idle"),le=o.useRef(null),R=o.useRef(null);o.useEffect(()=>{T.current=t},[t]),o.useEffect(()=>{X.current=p},[p]),o.useEffect(()=>{xe.current=g},[g]),o.useEffect(()=>{Le.current=S},[S]),o.useEffect(()=>{ke.current=f},[f]),o.useEffect(()=>{q.current=s},[s]);const b=()=>{le.current&&(clearTimeout(le.current),le.current=null)},I=()=>{R.current&&(clearTimeout(R.current),R.current=null)},A=()=>{_.current&&(clearTimeout(_.current),_.current=null)},H=()=>{P.current&&(cancelAnimationFrame(P.current),P.current=null)},J=o.useCallback((K,we,de=null)=>{const Te={ts:Date.now(),level:K||"info",message:String(we||""),extra:de||null};C(Re=>{const _e=[...Re||[],Te];return _e.length>250?_e.slice(_e.length-250):_e})},[]),ue=o.useCallback(()=>C([]),[]),ce=()=>{if(!(typeof window>"u"||typeof window.dispatchEvent!="function"))try{window.dispatchEvent(new CustomEvent("cozygen:queue-finished"))}catch{}},Q=()=>{I(),R.current=setTimeout(()=>{X.current||(m("idle"),h("Idle"),x(0),k(0))},8e3)},me=o.useCallback(()=>{b(),d(!1),v(!1),x(0),k(0),h("Finished"),m("finished"),J("success","Finished"),Q(),ce()},[J]),Y=o.useCallback((K="Error")=>{b(),d(!1),v(!1),h(K),m("error"),J("error",K||"Error"),Q()},[J]);o.useEffect(()=>{b(),!(!p||!S||S<=0||g<S)&&(le.current=setTimeout(()=>{const K=X.current,we=xe.current,de=Le.current,Te=ke.current;K&&de>0&&we>=de&&Te!=="finished"&&Te!=="error"&&me()},800))},[p,g,S,me]),o.useEffect(()=>{if(typeof window>"u"||!c&&!p)return;let K=!1,we=1e3;const de=()=>{if(K||!c&&!X.current)return;const Te=window.location.protocol==="https:"?"wss":"ws",Re=window.location.host,_e=Rd(),Ae=`${Te}://${Re}/ws${_e?`?token=${encodeURIComponent(_e)}`:""}`,Ze=new WebSocket(Ae);B.current=Ze,Ze.onopen=()=>{we=1e3},Ze.onmessage=Oe=>{var Ge,ae,ve;if(typeof Oe.data!="string")return;let ot;try{ot=JSON.parse(Oe.data)}catch{return}const ne=ot.type;if(ne==="cozygen_batch_ready"){me();return}if(ne==="execution_success"||ne==="execution_finished"){X.current&&me();return}if(ne==="execution_error"||ne==="execution_interrupted"){J("error","Execution error"),Y("Execution error");return}if(ne==="status"){const fe=ot.data||{},F=fe.status||fe,Ne=F.exec_info||fe.exec_info||F;if(Ne&&X.current){const ge=Ne.queue_remaining??Ne.queue_pending??Ne.queue_remaining_items??0;(Ne.queue_running??Ne.running??0)===0&&ge===0&&me()}return}if(ne==="executing"){I(),m("running");const fe=(Ge=ot.data)==null?void 0:Ge.node,F=T.current;if(fe&&F&&F[fe]){const Ne=F[fe],ge=Ne.title||Ne.class_type||"Node";J("info",`Executing: ${ge}`,{nodeId:fe}),h(`Executing: ${ge}`)}else J("info","Executing"),h("Executing");return}if(ne==="progress"){const fe=((ae=ot.data)==null?void 0:ae.value)??0,F=((ve=ot.data)==null?void 0:ve.max)??0;M.current={value:fe,max:F},P.current||(P.current=window.requestAnimationFrame(()=>{P.current=null;const Ue=M.current;x(Ue.value),k(Ue.max)}));const Ne=Date.now(),ge=E.current;Ne-ge.ts>2500&&(fe!==ge.value||F!==ge.max)&&F>0&&(E.current={ts:Ne,value:fe,max:F},J("info",`Progress: ${fe}/${F}`));return}},Ze.onclose=()=>{K||!c&&!X.current||(A(),_.current=setTimeout(de,we),we=Math.min(Math.ceil(we*1.6),15e3))}};return de(),()=>{K=!0,b(),I(),A(),H(),B.current&&(B.current.onclose=null,B.current.close())}},[J,Y,me,c,p]);const D=o.useCallback(async(K={})=>{if(!t)return;const{overrides:we=null,persistFormState:de=!0}=K||{};b(),I(),d(!0),v(!0),h("Queuing prompt"),m("queued"),x(0),k(0),J("info","Queuing prompt",{workflow:e||""});const Te=q.current||{},Re=we?{...Te,...we||{}}:Te,_e=R1(Re,i||{}),{workflow:Ae,formData:Ze}=T1(t,n||[],_e||{}),Oe={...Ze,...Re};de&&e&&ao(e,Oe),de&&a(Oe);const ot=r||[];for(const ne of ot){if(!ne||!ne.id||!ne.inputs)continue;const Ge=ne.inputs.param_name;if(!Ge)continue;const ae=Oe[Ge];if(!ae){alert(`Please upload or select an image for "${Ge}" before generating.`),Y("Missing image input");return}Ae[ne.id]&&Ae[ne.id].inputs&&(Ae[ne.id].inputs.image_filename=ae)}try{const ne=gy(Ae),Ge={};ne.length&&ne.forEach(fe=>{const F=Re==null?void 0:Re[fe.label],Ne=typeof F=="string"?F:fe.text;typeof Ne=="string"&&Y1.test(Ne)&&(Ge[fe.key]=Ne)});const ae=Md();if(Object.keys(Ge).length)try{await Id({promptId:ae,promptRaw:Ge})}catch{}let ve=Ae;if(i){const fe=F=>{if(typeof F=="string")return sa(F,i);if(Array.isArray(F))return F.map(Ne=>fe(Ne));if(F&&typeof F=="object"){const Ne=Array.isArray(F)?[]:{};return Object.entries(F).forEach(([ge,Fe])=>{Ne[ge]=fe(Fe)}),Ne}return F};try{ve=fe(Ae)}catch{ve=Ae}}Gg({workflowName:e,workflow:ve,timestamp:Date.now(),promptRaw:Object.keys(Ge).length?Ge:null}),await Td({prompt:ve,prompt_id:ae}),J("info","Prompt queued")}catch(ne){console.error("Failed to queue prompt",ne),ne!=null&&ne.unauthorized?(J("error","Session expired. Please sign in again."),Y("Session expired. Please sign in again."),window.location.hash="#/login"):(J("error","Error queuing prompt"),Y("Error queuing prompt"))}},[t,n,r,i,e,a,Y,J]);return{isLoading:u,progressValue:g,progressMax:S,statusText:j,statusPhase:f,handleGenerate:D,logEntries:w,clearLogs:ue}}const yy="cozygen_prompt_aliases",vy="cozygen_alias_categories",xy="cozygen_alias_category_list";function Zp(){if(typeof window>"u")return{};try{const e=window.localStorage.getItem(yy);return e?JSON.parse(e)||{}:{}}catch{return{}}}function Sc(e){if(!(typeof window>"u"))try{window.localStorage.setItem(yy,JSON.stringify(e||{}))}catch{}}function eh(){if(typeof window>"u")return{};try{const e=window.localStorage.getItem(vy);return e?JSON.parse(e)||{}:{}}catch{return{}}}function jc(e){if(!(typeof window>"u"))try{window.localStorage.setItem(vy,JSON.stringify(e||{}))}catch{}}function th(){if(typeof window>"u")return[];try{const e=window.localStorage.getItem(xy);return Array.isArray(JSON.parse(e))?JSON.parse(e):[]}catch{return[]}}function kc(e){if(!(typeof window>"u"))try{window.localStorage.setItem(xy,JSON.stringify(e||[]))}catch{}}function wy(){const[e,t]=o.useState(()=>Zp()),[n,r]=o.useState(()=>eh()),[s,a]=o.useState(()=>th()),[i,c]=o.useState(!1),[u,d]=o.useState(!1),[p,v]=o.useState(null),g=o.useCallback(async()=>{c(!0),v(null);try{const j=await Q0(),h=ra((j==null?void 0:j.items)||j||{}),f=(j==null?void 0:j.categories)||{},m=Array.isArray(j==null?void 0:j.categoryList)?j.categoryList:[];t(h),r(f),a(m),Sc(h),jc(f),kc(m)}catch(j){console.error("Failed to load prompt aliases",j),v(j);const h=ra(Zp()),f=eh(),m=th();t(h),r(f),a(m)}finally{c(!1)}},[]),x=o.useCallback(async j=>{const h=(j==null?void 0:j.items)||j||{},f=(j==null?void 0:j.categories)||n||{},m=Array.isArray(j==null?void 0:j.categoryList)&&j.categoryList.length?j.categoryList:s.length?s:Array.from(new Set(Object.values(f).filter(Boolean))),w=ra(h||{});d(!0),v(null);try{await q0({items:w,categories:f,categoryList:m}),t(w),r(f),a(m),Sc(w),jc(f),kc(m)}catch(C){throw console.error("Failed to save prompt aliases",C),v(C),Sc(w),jc(f),kc(m),C}finally{d(!1)}},[n,s]);o.useEffect(()=>{g()},[g]);const S=o.useMemo(()=>{const j=Ud(e),h=new Map(j);return Object.entries(n||{}).forEach(([f,m])=>{const w=String(m||"").trim();w&&(e!=null&&e[f])&&h.set(`${w}:${f}`,e[f])}),h},[e,n]),k=o.useMemo(()=>{const j=new Set,h=[];return S.forEach((f,m)=>{let w=m.includes("::")?m.replace("::",":"):m;const C=w.split(":");C.length>=3&&C[0]&&C[1]&&C[0].toLowerCase()===C[1].toLowerCase()&&(w=[C[0],...C.slice(2)].join(":"));const E=w.toLowerCase();j.has(E)||(j.add(E),h.push(w))}),h},[S]);return{aliases:e,aliasCategories:n,categoryList:s,aliasLookup:S,aliasOptions:k,loading:i,saving:u,error:p,refreshAliases:g,persistAliases:x}}const Sy=o.createContext(null);function Kd(){const e=o.useContext(Sy);if(!e)throw new Error("useStudioContext must be used within a StudioProvider");return e}function q1({children:e}){const{workflows:t,selectedWorkflow:n,selectWorkflow:r,loading:s,error:a}=P1(),{workflowData:i,dynamicInputs:c,imageInputs:u,primaryImageInput:d,formData:p,setFormData:v,handleFormChange:g,loading:x,error:S}=A1(n),k=wy(),j=o.useMemo(()=>{const q=[];return Object.entries(k.aliases||{}).forEach(([X,xe])=>{const Le=String(X).split("::"),ke=Le.length>1,le=k.aliasCategories&&k.aliasCategories[X]||(ke?Le[0]:""),R=ke?Le.slice(1).join("::"):X,b={key:X,name:R,category:le,text:xe,token:le?`${le}:${R}`:R};q.push({...b,...Od(b)})}),q},[k.aliases,k.aliasCategories]),h=o.useMemo(()=>L1(n,c),[n,c]),f=o.useMemo(()=>{const q=(h||c||[]).filter(R=>(R==null?void 0:R.class_type)!=="CozyGenImageInput"),X=/\b(checkpoint|ckpt|lora|model|vae|embedding|clip|sampler|scheduler|seed)\b/i,xe=R=>{const b=String((R==null?void 0:R.paramName)||"").toLowerCase(),I=String((R==null?void 0:R.label)||"").toLowerCase(),A=`${b} ${I}`,H=p==null?void 0:p[R==null?void 0:R.paramName],J=typeof H=="string"?H:"";let ue=0;return A.includes("prompt")&&(ue+=100),A.includes("negative")&&A.includes("prompt")&&(ue-=15),R!=null&&R.multiline&&(ue+=10),J.includes("$")&&(ue+=20),X.test(A)&&(ue-=200),Zg(J)&&(ue-=200),ue};if(typeof(p==null?void 0:p.prompt)=="string")return"prompt";const Le=q.map(R=>Hl(R)).filter(R=>(R==null?void 0:R.paramType)==="STRING"&&(R==null?void 0:R.paramName));if(!Le.length)return"prompt";let ke=Le[0],le=xe(ke);for(let R=1;R<Le.length;R+=1){const b=Le[R],I=xe(b);I>le&&(ke=b,le=I)}return(ke==null?void 0:ke.paramName)||"prompt"},[c,p,h]),{isLoading:m,progressValue:w,progressMax:C,statusText:E,statusPhase:P,handleGenerate:M,logEntries:B,clearLogs:_}=Q1({selectedWorkflow:n,workflowData:i,dynamicInputs:c,imageInputs:u,formData:p,setFormData:v,promptAliases:k.aliasLookup});o.useEffect(()=>{if(P==="finished"&&!(typeof window>"u")){try{window.localStorage.setItem("cozygen_gallery_pending","1")}catch{}window.dispatchEvent(new Event("cozygen:gallery-pending"))}},[P]),o.useEffect(()=>{if(typeof window>"u")return;const q=P==="queued"||P==="running"||m;try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:q}}))}catch{}},[P,m]);const T=o.useMemo(()=>({workflows:t,selectedWorkflow:n,selectWorkflow:r,workflowsLoading:s,workflowsError:a,workflowData:i,dynamicInputs:c,orderedDynamicInputs:h,imageInputs:u,primaryImageInput:d,formData:p,setFormData:v,handleFormChange:g,workflowLoading:x,workflowError:S,promptFieldName:f,aliasOptions:k.aliasOptions,aliasCatalog:j,aliasLookup:k.aliasLookup,aliasCategories:k.aliasCategories,aliasLoading:k.loading,aliasSaving:k.saving,aliasError:k.error,refreshAliases:k.refreshAliases,persistAliases:k.persistAliases,isLoading:m,progressValue:w,progressMax:C,statusText:E,statusPhase:P,handleGenerate:M,logEntries:B,clearLogs:_}),[t,n,r,s,a,i,c,h,u,d,p,v,g,x,S,f,k.aliasOptions,k.aliasLookup,k.aliasCategories,j,k.loading,k.saving,k.error,k.refreshAliases,k.persistAliases,m,w,C,E,P,M,B,_]);return l.jsx(Sy.Provider,{value:T,children:e})}function X1(){const e=pr(),{workflows:t=[],selectedWorkflow:n,selectWorkflow:r,workflowData:s,dynamicInputs:a=[],imageInputs:i=[],formData:c,setFormData:u,handleFormChange:d,aliasOptions:p,aliasCatalog:v,isLoading:g,progressValue:x,progressMax:S,statusText:k,statusPhase:j,handleGenerate:h,logEntries:f,clearLogs:m,promptFieldName:w,orderedDynamicInputs:C}=Kd(),E=o.useRef(null),P=o.useRef(null),[M,B]=o.useState(()=>t1()),[_,T]=o.useState(null),q=(_==null?void 0:_.name)||"",X=o.useCallback(()=>T(null),[]),[xe,Le]=o.useState(!1),[ke,le]=o.useState([]),[R,b]=o.useState([]),[I,A]=o.useState(""),[H,J]=o.useState(""),[ue,ce]=o.useState(""),Q=o.useRef(new Map),me=o.useCallback((ae="")=>{const fe=`?field=${encodeURIComponent(ae||w||"prompt")}`;e(`/compose${fe}`)},[e,w]),Y=o.useCallback(ae=>{!ae||ae===n||(n&&ao(n,c||{},{immediate:!0}),A(""),J(""),ce(""),r(ae))},[c,n,r]),D=o.useMemo(()=>{const ve=[...C||[],...i||[]].map(fe=>{var F;return(F=fe==null?void 0:fe.inputs)==null?void 0:F.param_name}).filter(fe=>fe&&typeof fe=="string");return new Set(ve)},[C,i]),K=o.useCallback(ae=>{J(ae);const ve=R.find(Ne=>Ne.id===ae);if(A((ve==null?void 0:ve.name)||""),!ae||!(ve!=null&&ve.values)||!n){ae||ce("");return}const fe=D,F={};Object.entries(ve.values).forEach(([Ne,ge])=>{(!fe.size||fe.has(Ne))&&(F[Ne]=ge)}),u(Ne=>{const ge={...Ne,...F};return ao(n,ge,{immediate:!0}),ge}),ce(`Applied "${ve.name}".`)},[D,R,n,u]),we=i||[],de=!!(s&&n),Te=we.length>0,Re=o.useCallback((ae,ve)=>{const fe=Q.current;ve&&ae&&fe.set(ae,ve);const F=ke.length?ke:(ve==null?void 0:ve.order)||[],Ne=F.length,ge=Ne>0?F.indexOf(ae):-1,Fe=ge>0?F[ge-1]:null,Ue=ge>=0&&ge<Ne-1?F[ge+1]:null,Ie=Fe?fe.get(Fe):null,Ye=Ue?fe.get(Ue):null;return{...ve,index:ge>=0?ge:0,total:Ne,onPrev:Ie?()=>T(Re(Fe,Ie)):null,onNext:Ye?()=>T(Re(Ue,Ye)):null,onRender:h}},[ke,h]),_e=o.useCallback(ae=>{const ve=ae||[];le(fe=>fe.length===ve.length&&fe.every((F,Ne)=>F===ve[Ne])?fe:ve)},[]),Ae=o.useCallback(ae=>{const ve=ae||"";B(ve),e1(ve)},[]),Ze=o.useCallback(ae=>{ae!=null&&ae.name&&T(Re(ae.name,ae))},[Re]),Oe=o.useCallback(async ae=>{if(!ae){b([]),J("");return}try{const ve=await X0(ae),fe=Array.isArray(ve==null?void 0:ve.presets)?ve.presets:[];b(fe),J(F=>F&&fe.some(Ne=>Ne.id===F)?F:"")}catch(ve){console.error("Failed to load workflow presets",ve),b([]),ce("Presets unavailable.")}},[]);o.useEffect(()=>{Oe(n)},[n,Oe]);const ot=o.useCallback(async()=>{if(!n)return;const ae=I.trim();if(!ae){ce("Name a preset to save.");return}const ve={},fe=D;Object.entries(c||{}).forEach(([ge,Fe])=>{(!fe.size||fe.has(ge))&&(ve[ge]=Fe)});const F=R.find(ge=>ge.id===H),Ne=F&&F.name.toLowerCase()===ae.toLowerCase()?F.id:void 0;try{const ge=await J0(n,{id:Ne,name:ae,values:ve}),Fe=Array.isArray(ge==null?void 0:ge.presets)?ge.presets:[],Ue=ge==null?void 0:ge.preset;b(Fe),Ue!=null&&Ue.id&&J(Ue.id),ce(`Saved "${ae}".`)}catch(ge){console.error("Failed to save preset",ge),ce("Save failed.")}},[D,c,I,R,H,n]),ne=o.useCallback(async()=>{if(!(!n||!H))try{const ae=await Z0(n,H),ve=Array.isArray(ae==null?void 0:ae.presets)?ae.presets:[];b(ve),J(""),ce("Preset deleted.")}catch(ae){console.error("Failed to delete preset",ae),ce("Delete failed.")}},[H,n]),Ge=o.useCallback(()=>{var ae;return(ae=_==null?void 0:_.render)==null?void 0:ae.call(_,c)},[_,c]);return o.useEffect(()=>{const ae=()=>{!de||g||h()};return window.addEventListener("cozygen:request-render",ae),()=>window.removeEventListener("cozygen:request-render",ae)},[h,de,g]),!t||t.length===0?l.jsx("div",{className:"page-shell",children:l.jsx("div",{className:"ui-card px-3 py-3 sm:px-4 sm:py-4",children:l.jsx("p",{className:"text-sm text-[#9DA3FFCC]",children:"No workflows found. Drop a workflow file in CozyGen and refresh."})})}):l.jsxs("div",{className:"page-shell page-stack has-dock controls-page",children:[l.jsxs("div",{className:"page-bar controls-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Controls"}),l.jsx("div",{className:"page-bar-actions",children:M?l.jsxs("span",{className:"controls-meta",children:["Last: ",M]}):null})]}),l.jsxs("section",{className:"controls-board",children:[l.jsx(DS,{workflows:t,selectedWorkflow:n,onWorkflowChange:Y,workflowData:s,presets:R,presetName:I,onPresetNameChange:A,selectedPresetId:H,onPresetSelect:K,onPresetSave:ot,onPresetDelete:ne,presetStatus:ue}),Te?l.jsx(so,{ref:P,className:"controls-panel",title:l.jsxs(l.Fragment,{children:[l.jsx(oS,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Images"]}),bodyClassName:"control-shell controls-body",defaultOpen:!1,children:s?l.jsx("div",{className:"grid grid-cols-1 gap-3 lg:grid-cols-2",children:we.map(ae=>l.jsx(_S,{input:ae,value:c[ae.inputs.param_name]||"",onFormChange:d},ae.id))}):null}):null,l.jsx(so,{title:l.jsxs(l.Fragment,{children:[l.jsx(Wg,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Parameters"]}),bodyClassName:"control-shell controls-body",defaultOpen:!0,className:"controls-panel",children:s?l.jsx(S1,{workflowName:n,dynamicInputs:C,formData:c,onFormChange:d,parameterSectionRef:E,compactControls:!0,lastEditedParam:M,spotlightName:q,onCloseSpotlight:X,onVisibleParamsChange:_e,aliasOptions:p,aliasCatalog:v,onOpenComposer:me,onParamEdited:Ae,onSpotlight:Ze}):l.jsxs("div",{className:"empty-state-inline",children:[l.jsx("span",{className:"empty-state-arrow",children:l.jsx(cS,{size:20})}),l.jsx("span",{children:"Select a workflow above to get started"})]})})]}),l.jsxs("div",{className:"controls-status-strip",children:[l.jsxs("div",{className:"controls-status-left",children:[l.jsx("span",{className:`controls-status-dot is-${j||"idle"}`,"aria-hidden":"true"}),l.jsxs("div",{className:"controls-status-text",children:[l.jsx("span",{className:"controls-status-phase",children:j||"idle"}),l.jsx("span",{className:"controls-status-msg",children:k||"Idle"})]})]}),l.jsxs("div",{className:"controls-status-right",children:[g&&S>0?l.jsx("div",{className:"controls-status-meter","aria-label":"Progress",children:l.jsx("div",{className:"controls-status-meter-fill",style:{width:`${Math.max(0,Math.min(100,Math.round((x||0)/S*100)))}%`}})}):null,l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>Le(!0),children:"Logs"})]})]}),l.jsx("section",{className:"dock-panel ui-card",children:l.jsx(wS,{busy:g,progressValue:x,progressMax:S,statusText:k,statusPhase:j,primaryLabel:"Render",onPrimary:h,primaryDisabled:!de,onLogs:()=>Le(!0)})}),l.jsx(AS,{open:!!_,onClose:X,title:_==null?void 0:_.label,description:_==null?void 0:_.description,render:Ge,index:(_==null?void 0:_.index)??0,total:(_==null?void 0:_.total)??0,onPrev:(_==null?void 0:_.onPrev)||null,onNext:(_==null?void 0:_.onNext)||null,onRender:(_==null?void 0:_.onRender)||null,children:null}),l.jsx(j1,{open:xe,onClose:()=>Le(!1),logs:f,onClear:m})]})}function J1(){return l.jsx("div",{className:"page-shell page-stack",children:l.jsxs("section",{className:"home-hero",children:[l.jsx("span",{className:"home-hero-orb is-warm","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-orb is-cool","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-spark","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-beam","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-ring","aria-hidden":"true"}),l.jsxs("div",{className:"home-hero-inner home-hero-full",children:[l.jsx("div",{className:"home-hero-kicker",children:"CozyGen Studio"}),l.jsx("h1",{className:"home-hero-title",children:"Creative studio for prompt-first storytelling"}),l.jsx("p",{className:"home-hero-description",children:"CozyGen is a quiet, cinematic workspace for people who sketch with wordsshape the mood, stage the scene, then send it down the render runway without losing your flow."}),l.jsxs("div",{className:"home-info-grid",children:[l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Control as composition"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Dial the palette, tempo, and texture in one place. The controls read like a creative brief, not a checklist."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Alias & tag storyboards"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Save characters, atmospheres, and motifs as building blocks, then arrange them like panels in a storyboard."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Gallery inspiration"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Pin your strongest frames, compare variations, and carry the aesthetic through to your next scene."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Render runway"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Stack iterations like takes on a set. Keep composing while the queue runs in the background."})]})]})]})]})})}const Z1=e=>l.jsxs("svg",{viewBox:"0 0 24 24",width:"14",height:"14","aria-hidden":"true",...e,children:[l.jsx("rect",{x:"3",y:"5",width:"10",height:"14",rx:"2.5",ry:"2.5",fill:"none",stroke:"currentColor",strokeWidth:"1.3"}),l.jsx("rect",{x:"7",y:"3",width:"10",height:"14",rx:"2.5",ry:"2.5",fill:"none",stroke:"currentColor",strokeWidth:"1.3",opacity:"0.8"}),l.jsx("circle",{cx:"12",cy:"11",r:"2.3",fill:"currentColor",opacity:"0.9"})]});function ej({subfolder:e,crumbs:t=[],dirChips:n=[],onBack:r,onRoot:s,onCrumb:a,onSelectDir:i}){const c=!e;return l.jsxs("div",{className:"gallery-nav",children:[l.jsx("div",{className:"gallery-crumbs",role:"navigation","aria-label":"Gallery path",children:t.map((u,d)=>l.jsxs(o.Fragment,{children:[l.jsx("span",{className:"text-[#6A6FA8]",children:"/"}),l.jsx(G,{size:"xs",variant:"chip",onClick:()=>a==null?void 0:a(u.path),"aria-current":d===t.length-1?"page":void 0,children:u.name})]},u.path||u.name||d))}),l.jsxs("div",{className:"gallery-dir-chips",children:[l.jsxs(G,{size:"xs",variant:"chip",onClick:()=>s==null?void 0:s(),disabled:c,"aria-label":"Go to output root",title:"Output root",children:[l.jsx(Z1,{}),"Output"]}),n.map(u=>l.jsx(G,{size:"xs",variant:"chip",onClick:()=>i==null?void 0:i(u.subfolder),children:u.filename||u.subfolder||"Collection"},u.subfolder||u.filename))]})]})}const tj=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e),nj=({src:e,poster:t,autoPlay:n})=>{const r=o.useRef(null),s=Bd();return o.useEffect(()=>{const a=r.current;a&&(a.pause(),a.currentTime=0,a.load())},[e]),o.useEffect(()=>{const a=r.current;if(!a)return;let i;const c=()=>{const d=a.play();d&&typeof d.catch=="function"&&d.catch(()=>{})},u=()=>{a.pause()};return n?s?typeof window<"u"&&"IntersectionObserver"in window?(i=new IntersectionObserver(p=>{p.forEach(v=>{v.isIntersecting?c():u()})},{threshold:.65}),i.observe(a)):c():u():(u(),a.currentTime=0),()=>{i&&i.disconnect(),u()}},[n,e,s]),e?l.jsx("video",{ref:r,src:e,poster:t||void 0,muted:!0,playsInline:!0,loop:!0,preload:n?"metadata":"none",className:"w-full h-auto max-h-[80vh] rounded-2xl object-contain bg-black/40"}):l.jsx("div",{className:"flex items-center justify-center py-16 text-[11px] text-[#9DA3FFCC]",children:"No preview available"})},nh={contentVisibility:"auto",containIntrinsicSize:"260px 320px"};function rj({item:e,onSelect:t,onDelete:n,onRerun:r,isDeleting:s=!1,variant:a="grid",autoPlay:i=!1}){if(!e)return null;const c=e.type==="directory",u=e.filename||"",d=e.subfolder||"",p=u||d||"Unknown",v=e.mtime??e.modified??e.updated_at??e.created_at,g=v?`&v=${encodeURIComponent(String(v))}`:"",x=()=>{t&&t(e)},S=a==="feed"?768:384,k=!c&&u?`/cozygen/thumb?type=output&subfolder=${encodeURIComponent(d)}&filename=${encodeURIComponent(u)}${g}&w=`:null,j=k?`${k}${S}`:null,h=k?a==="feed"?`${k}384 384w, ${k}768 768w`:`${k}192 192w, ${k}384 384w`:null,f=a==="feed"?"(max-width: 768px) 92vw, 768px":"(max-width: 640px) 45vw, (max-width: 1024px) 30vw, 240px",m=!c&&u?(()=>{const q=e.type&&e.type!=="directory"?e.type:"output",X=e.mtime?`&v=${encodeURIComponent(String(e.mtime))}`:"";return`/view?filename=${encodeURIComponent(u)}&subfolder=${encodeURIComponent(d)}&type=${encodeURIComponent(q)}${X}`})():null,w=tj(u),C=!!n&&!c,E=(e==null?void 0:e.meta)||{},P=!!(E!=null&&E.has_prompt||E!=null&&E.prompt||E!=null&&E.model||Array.isArray(E==null?void 0:E.loras)&&E.loras.length),M=typeof u=="string"&&u.toLowerCase().endsWith(".png"),B=!!r&&!c&&P&&M,_=q=>{q.stopPropagation(),n==null||n(e)},T=q=>{q.stopPropagation(),r==null||r(e)};if(c)return l.jsx("button",{type:"button",onClick:x,className:"gallery-dir-tile",style:nh,children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"h-7 w-7 rounded-lg bg-gradient-to-br from-[#6B5BFF] to-[#FF4F9A] opacity-80 group-hover:opacity-100 flex items-center justify-center text-[11px] text-white",children:""}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("div",{className:"text-[11px] font-medium text-[#E5E7FF] truncate",children:p}),l.jsx("div",{className:"text-[10px] text-[#9DA3FFCC] truncate",children:"Collection"})]})]})});if(a==="feed"){const q={contentVisibility:"auto",containIntrinsicSize:"520px 720px"};return l.jsxs("div",{className:"gallery-feed-item",style:q,children:[l.jsxs("button",{type:"button",onClick:x,className:"gallery-feed-media",children:[l.jsx("div",{className:"relative w-full flex items-center justify-center bg-[#020312]",children:w?l.jsx(nj,{src:m,poster:j,autoPlay:i}):j?l.jsx("img",{src:j,srcSet:h||void 0,sizes:f,alt:p,className:"w-full h-auto max-h-[80vh] rounded-2xl object-contain bg-black/40",loading:"lazy",decoding:"async"}):l.jsx("div",{className:"flex items-center justify-center py-16 text-[11px] text-[#9DA3FFCC]",children:"No preview available"})}),l.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[#05071680] opacity-0 group-hover:opacity-100 transition-opacity"}),w&&l.jsx("div",{className:"pointer-events-none absolute left-2 top-2 rounded-md bg-[#050716CC] px-2 py-[1px] text-[10px] text-[#CFFAFE] border border-[#3EF0FF80]",children:"Video"})]}),C?l.jsx(G,{size:"mini",variant:"muted",iconOnly:!0,className:"gallery-tile-delete",onClick:_,disabled:s,"aria-label":"Delete item",title:s?"Deleting":"Delete item",children:l.jsx(bu,{size:12})}):null,B?l.jsx(G,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-rerun",onClick:T,"aria-label":"Tweak",title:"Tweak",children:l.jsx(Cu,{size:12})}):null]})}return l.jsxs("div",{className:"gallery-tile",style:nh,children:[l.jsx("button",{type:"button",onClick:x,className:"gallery-tile-button",children:l.jsxs("div",{className:"gallery-tile-media",children:[j?l.jsx("img",{src:j,srcSet:h||void 0,sizes:f,alt:p,className:"gallery-tile-img",loading:"lazy",decoding:"async"}):l.jsx("div",{className:"gallery-tile-empty",children:"No preview"}),w&&l.jsx("div",{className:"gallery-badge",children:"Video"})]})}),C?l.jsx(G,{size:"mini",variant:"muted",iconOnly:!0,className:"gallery-tile-delete",onClick:_,disabled:s,"aria-label":"Delete item",title:s?"Deleting":"Delete item",children:l.jsx(bu,{size:12})}):null,B?l.jsx(G,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-rerun",onClick:T,"aria-label":"Tweak",title:"Tweak",children:l.jsx(Cu,{size:12})}):null]})}const rh=o.memo(rj),jy=o.memo(function({id:t,name:n,category:r,text:s,isSelected:a,onOpen:i,visibilityStyle:c}){const u=o.useCallback(()=>{i(t)},[t,i]),d=Hs({name:n})||n||"Untitled",p=r?`${r}:${n}`:n,v=`${(s||"").slice(0,140)}${(s||"").length>140?"":""}`;return l.jsxs("button",{type:"button",role:"listitem",className:`composer-alias-item ${a?"is-selected":""}`,onClick:u,style:c,"data-virtual-row":"true",children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:d}),r?l.jsx("span",{className:"composer-alias-category",children:Gn(r)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",p||"alias","$"]}),l.jsx("div",{className:"composer-alias-text",children:v||""})]})}),ky=o.memo(function({tag:t,category:n,count:r,isCollected:s,onToggle:a,visibilityStyle:i}){const c=o.useCallback(u=>{u.stopPropagation(),a(t)},[a,t]);return l.jsxs("button",{type:"button",className:`composer-alias-item composer-tag-item ${s?"is-collected":""}`,onClick:c,style:i,"data-virtual-row":"true",children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name composer-tag-name",children:l.jsx("code",{className:"composer-tag-code",children:t})}),n?l.jsx("span",{className:"composer-alias-category",children:Tn(n)}):null]}),l.jsx("div",{className:"composer-alias-token composer-tag-count",children:Number(r||0).toLocaleString()})]})});function sj({filename:e,locationLabel:t,isClip:n,url:r,canRerun:s,rerunOpen:a,canDelete:i,deleteBusy:c,metaRows:u,metaOpen:d,onToggleMeta:p,onToggleRerun:v,onDelete:g,onClose:x,closeButtonRef:S}){return l.jsxs("header",{className:"media-viewer-head",children:[l.jsxs("div",{className:"media-viewer-head-bar bottom-sheet-head",children:[l.jsxs("div",{className:"media-viewer-meta",children:[l.jsx("div",{className:"media-viewer-title",title:e,children:e}),l.jsxs("div",{className:"media-viewer-sub",children:[l.jsx("span",{className:"media-chip",children:t}),l.jsx("span",{className:`media-chip ${n?"is-clip":"is-still"}`,children:n?"Video":"Image"})]})]}),l.jsx("button",{ref:S,type:"button",className:"bottom-sheet-close media-viewer-close",onClick:x,"aria-label":"Close",children:l.jsx(Dr,{size:16})})]}),l.jsxs("div",{className:"media-viewer-actions",children:[l.jsx(G,{as:"a",href:r,target:"_blank",rel:"noreferrer",variant:"ghost",size:"sm",children:"Open"}),u.length?l.jsx(G,{variant:"ghost",size:"sm",onClick:p,"aria-expanded":d,children:"Meta"}):null,s?l.jsx(G,{variant:"ghost",size:"sm",onClick:v,"aria-expanded":a,"aria-label":"Tweak generation",children:"Tweak"}):null,i?l.jsx(G,{variant:"ghost",size:"sm",iconOnly:!0,className:"media-viewer-action-icon media-viewer-action-delete",onClick:g,disabled:c,"aria-label":"Delete item",title:"Delete item",children:c?l.jsx("span",{className:"loading-spinner","aria-hidden":"true"}):l.jsx(bu,{size:16})}):null]})]})}function lj({metaRows:e=[]}){return e.length?l.jsx("div",{className:"media-viewer-info","aria-label":"Generation metadata",children:e.map(t=>l.jsxs("div",{className:"media-info-row",children:[l.jsx("span",{className:"media-info-label",children:t.label}),l.jsx("span",{className:`media-info-value ${t.isPrompt?"is-prompt":""}`,children:t.value})]},t.label))}):null}function aj({showNav:e,canPrev:t,canNext:n,onPrev:r,onNext:s,isClip:a,url:i,filename:c}){return l.jsxs("div",{className:"media-viewer-stage",children:[e?l.jsx("button",{type:"button",className:`media-stage-nav is-left ${t?"":"is-disabled"}`,onClick:r,"aria-label":"Previous",disabled:!t,children:l.jsx(Hg,{size:18})}):null,l.jsx("div",{className:"media-viewer-frame",children:a?l.jsx("video",{src:i,controls:!0,className:"media-viewer-media",autoPlay:!0,muted:!0,playsInline:!0}):l.jsx("img",{src:i,alt:c,className:"media-viewer-media",decoding:"async"})}),e?l.jsx("button",{type:"button",className:`media-stage-nav is-right ${n?"":"is-disabled"}`,onClick:s,"aria-label":"Next",disabled:!n,children:l.jsx(To,{size:18})}):null]})}const ij=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e),sh={contentVisibility:"auto",containIntrinsicSize:"240px 120px"},oj=e=>{if(!e)return"";const t=e.filename||"",n=e.subfolder||"",r=e.type||"output",s=e.mtime?`&v=${encodeURIComponent(String(e.mtime))}`:"";return`/view?filename=${encodeURIComponent(t)}&subfolder=${encodeURIComponent(n)}&type=${encodeURIComponent(r)}${s}`},lh=e=>{if(!ol(e))return null;const{folderPath:t,base:n}=Mo(e);return{folderPath:t||"root",base:n||""}},ah=(e="")=>{if(!e||e==="root")return"root";const t=e.split("/").filter(Boolean);return t[t.length-1]||e};function cj({isOpen:e,media:t,onClose:n,onPrev:r,onNext:s,onDeleted:a,total:i=0,canPrev:c=!1,canNext:u=!1,autoOpenRerunKey:d="",onRerunAutoOpen:p}){var hf,mf,gf,yf;const{aliasCatalog:v=[],aliasLookup:g,aliasLoading:x,aliasError:S}=Kd(),k=o.useRef(!1),j=o.useRef(null),[h,f]=o.useState(!1),[m,w]=o.useState(!1),[C,E]=o.useState(!1),[P,M]=o.useState(!1),B=o.useRef(null),_=o.useRef(null),T=o.useRef(!1),q=o.useRef(null),[X,xe]=o.useState(!1),[Le,ke]=o.useState(null),[le,R]=o.useState(!1),[b,I]=o.useState(null),A=o.useRef("rerun"),[H,J]=o.useState("random"),[ue,ce]=o.useState(""),[Q,me]=o.useState(""),[Y,D]=o.useState(""),[K,we]=o.useState(""),[de,Te]=o.useState(""),[Re,_e]=o.useState("All"),[Ae,Ze]=o.useState("All"),[Oe,ot]=o.useState({hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null}),[ne,Ge]=o.useState([]),[ae,ve]=o.useState(null),[fe,F]=o.useState({}),[Ne,ge]=o.useState(""),[Fe,Ue]=o.useState(""),[Ie,Ye]=o.useState("elements"),[Ct,W]=o.useState("replace"),[ee,je]=o.useState("alias"),[ze,$e]=o.useState(""),Qe=o.useDeferredValue(ze),[De,qe]=o.useState("All"),[O,se]=o.useState("All"),[Ee,Pe]=o.useState(30),[z,U]=o.useState(""),[re,ie]=o.useState(""),oe=o.useDeferredValue(re),[Ce,et]=o.useState(""),[tt,Ht]=o.useState("count"),[wn,jt]=o.useState(""),[wt,ms]=o.useState([]),[Xn,en]=o.useState([]),[Kr,gs]=o.useState(0),[tn,Sn]=o.useState(0),[hr,Gr]=o.useState(!1),[Yr,gl]=o.useState(!1),[Aa,ys]=o.useState(""),[vs,Qr]=o.useState(""),jn=o.useRef(null),pt=o.useRef(null),[mr,gr]=o.useState(!1),[at,yr]=o.useState(null),[Lt,cn]=o.useState(null),[un,dn]=o.useState(null),yl=o.useRef(null),ct=o.useRef(null),[Mn,vr]=o.useState(!1),[kn,vl]=o.useState(""),[Ra,xl]=o.useState(!1),[xs,wl]=o.useState(""),[ws,Ta]=o.useState([]),[Ss,Sl]=o.useState([]),qr=o.useRef(null),Nn=o.useRef(null),jl=o.useRef(""),kl=y=>y?Array.from(y.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(N=>!N.hasAttribute("disabled")&&N.getAttribute("aria-hidden")!=="true"):[];o.useEffect(()=>{if(!e)return;const y=N=>{N.key==="Escape"&&(n==null||n()),N.key==="ArrowLeft"&&c&&(r==null||r()),N.key==="ArrowRight"&&u&&(s==null||s())};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[e,n,s,r,c,u]),o.useEffect(()=>{var y;e&&(f(!1),xe(!1),ke(null),R(!1),I(null),A.current="rerun",E(!1),M(!1),J("random"),ce(""),me(""),D(""),we(""),Te(""),_e("All"),Ze("All"),ot({hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null}),Ge([]),ve(null),F({}),ge(""),Ue(""),Ye("elements"),W("replace"),je("alias"),$e(""),qe("All"),se("All"),Pe(30),U(""),ie(""),et(""),Ht("count"),jt(""),ms([]),en([]),gs(0),Sn(0),Gr(!1),gl(!1),ys(""),Qr(""),gr(!1),yr(null),vr(!1),vl(""),xl(!1),wl(""),Ta([]),Sl([]),qr.current=null,Nn.current&&(Nn.current.abort(),Nn.current=null),(y=ct.current)!=null&&y.timer&&(clearTimeout(ct.current.timer),ct.current=null),jn.current&&(jn.current.abort(),jn.current=null),pt.current&&(pt.current.abort(),pt.current=null),T.current=!0,q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{T.current=!1,q.current=null},250))},[e,t]),o.useEffect(()=>()=>{var y;q.current&&(clearTimeout(q.current),q.current=null),(y=ct.current)!=null&&y.timer&&(clearTimeout(ct.current.timer),ct.current=null),jn.current&&(jn.current.abort(),jn.current=null),pt.current&&(pt.current.abort(),pt.current=null)},[]),o.useEffect(()=>{if(!e||typeof document>"u")return;const y=B.current;_.current=document.activeElement;const N=()=>{var Me;const Z=kl(y),he=j.current||Z[0]||y;(Me=he==null?void 0:he.focus)==null||Me.call(he)},V=Z=>{if(Z.key!=="Tab"||!y)return;const he=kl(y);if(!he.length){Z.preventDefault(),y.focus();return}const Me=he[0],ut=he[he.length-1],We=document.activeElement;Z.shiftKey&&We===Me?(Z.preventDefault(),ut.focus()):!Z.shiftKey&&We===ut&&(Z.preventDefault(),Me.focus())};return requestAnimationFrame(N),y==null||y.addEventListener("keydown",V),()=>{var he;y==null||y.removeEventListener("keydown",V);const Z=_.current;Z&&document.contains(Z)&&((he=Z.focus)==null||he.call(Z))}},[e]);const Nl=!!t,Cl=t?oj(t):"",L=(t==null?void 0:t.subfolder)||"Gallery",$=ij((t==null?void 0:t.filename)||""),ye=i>1,pe=(t==null?void 0:t.meta)||{},Ve=[pe!=null&&pe.model?{label:"Model",value:pe.model}:null,pe!=null&&pe.prompt?{label:"Prompt",value:pe.prompt,isPrompt:!0}:null,Array.isArray(pe==null?void 0:pe.loras)&&pe.loras.length?{label:"LoRAs",value:pe.loras.join(", ")}:null].filter(Boolean),Be=!!((hf=t==null?void 0:t.meta)!=null&&hf.has_prompt||Ve.length),rt=typeof(t==null?void 0:t.filename)=="string"&&t.filename.toLowerCase().endsWith(".png"),be=Nl&&Be&&rt,Ke=Nl,Fn=o.useMemo(()=>[{key:"random",label:"Random"},{key:"keep",label:"Keep"},{key:"custom",label:"Custom"}],[]),Cn=o.useMemo(()=>{if(H!=="custom")return null;const y=parseInt(String(ue),10);return Number.isFinite(y)?y:null},[ue,H]),bl=H!=="custom"||Cn!==null,js=o.useMemo(()=>{if(!String(Q||"").trim())return null;const y=parseInt(String(Q),10);return Number.isFinite(y)&&y>0?y:null},[Q]),ks=o.useMemo(()=>{if(!String(Y||"").trim())return null;const y=parseInt(String(Y),10);return Number.isFinite(y)&&y>0?y:null},[Y]),_t=(!String(Q||"").trim()||js!==null)&&(!String(Y||"").trim()||ks!==null),Kt=!!String(Q||"").trim()&&js===null,by=!!String(Y||"").trim()&&ks===null,Do=Oe.checkpoint||(pe==null?void 0:pe.model)||"",Ia=Array.isArray(Oe.loras)?Oe.loras:[],Yd=Do?Bn(Do):"",Qd=Ia.length?Ia.map(y=>Bn(y)).join(", "):"",Ns=o.useMemo(()=>(ws||[]).map(y=>{const N=String(y||"");return{value:N,meta:lh(N)}}),[ws]),Cs=o.useMemo(()=>(Ss||[]).map(y=>{const N=String(y||"");return{value:N,meta:lh(N)}}),[Ss]),$a=o.useMemo(()=>{const y=new Set(["All"]);return Ns.forEach(({meta:N})=>{N!=null&&N.folderPath&&y.add(N.folderPath)}),Array.from(y).sort((N,V)=>N.localeCompare(V))},[Ns]),Ma=o.useMemo(()=>{const y=new Set(["All"]);return Cs.forEach(({meta:N})=>{N!=null&&N.folderPath&&y.add(N.folderPath)}),Array.from(y).sort((N,V)=>N.localeCompare(V))},[Cs]),bs=$a.length>2,Es=Ma.length>2;o.useEffect(()=>{if(!bs){Re!=="All"&&_e("All");return}$a.includes(Re)||_e("All")},[Re,$a,bs]),o.useEffect(()=>{if(!Es){Ae!=="All"&&Ze("All");return}Ma.includes(Ae)||Ze("All")},[Ae,Ma,Es]);const qd=o.useMemo(()=>{const y=new Map;return Ns.forEach(({meta:N})=>{if(!(N!=null&&N.base))return;const V=N.base.toLowerCase();y.set(V,(y.get(V)||0)+1)}),y},[Ns]),Xd=o.useMemo(()=>{const y=new Map;return Cs.forEach(({meta:N})=>{if(!(N!=null&&N.base))return;const V=N.base.toLowerCase();y.set(V,(y.get(V)||0)+1)}),y},[Cs]),El=o.useMemo(()=>{const y=[],N=bs&&Re==="All";return Ns.forEach(({value:V,meta:Z})=>{if(!Z){y.push({value:V,label:V});return}if(bs&&Re!=="All"&&Z.folderPath!==Re)return;let he=Z.base||Bn(V)||V;if(N&&Z.base){const Me=Z.base.toLowerCase();qd.get(Me)>1&&(he=`${he} (${ah(Z.folderPath)})`)}y.push({value:V,label:he})}),y},[Ns,Re,qd,bs]),Ll=o.useMemo(()=>{const y=[],N=Es&&Ae==="All";return Cs.forEach(({value:V,meta:Z})=>{if(!Z){y.push({value:V,label:V});return}if(Es&&Ae!=="All"&&Z.folderPath!==Ae)return;let he=Z.base||Bn(V)||V;if(N&&Z.base){const Me=Z.base.toLowerCase();Xd.get(Me)>1&&(he=`${he} (${ah(Z.folderPath)})`)}y.push({value:V,label:he})}),y},[Cs,Ae,Xd,Es]),Jd=o.useMemo(()=>K?El.some(y=>String(y.value)===String(K)):!0,[El,K]),Zd=o.useMemo(()=>de?Ll.some(y=>String(y.value)===String(de)):!0,[Ll,de]),Ey=o.useMemo(()=>!K||Jd?El:[{value:K,label:Bn(String(K))},...El],[K,Jd,El]),Ly=o.useMemo(()=>!de||Zd?Ll:[{value:de,label:Bn(String(de))},...Ll],[de,Zd,Ll]),ef=o.useCallback(async y=>{const N=y==null?void 0:y.hasCheckpoint,V=y==null?void 0:y.hasLora;if(!N&&!V)return;Nn.current&&Nn.current.abort();const Z=new AbortController;Nn.current=Z,xl(!0),wl("");try{const[he,Me]=await Promise.all([N&&!ws.length?Nu("checkpoints",{signal:Z.signal}):null,V&&!Ss.length?Nu("loras",{signal:Z.signal}):null]);he!=null&&he.choices&&Ta(he.choices),Me!=null&&Me.choices&&Sl(Me.choices)}catch(he){if((he==null?void 0:he.name)==="AbortError")return;wl("Unable to load model choices right now.")}finally{Nn.current===Z&&(Nn.current=null),xl(!1)}},[ws.length,Ss.length]),Bo=o.useCallback(async()=>{var y;if(!t)throw new Error("media_missing");if(qr.current)return{prompt:qr.current,info:Oe};vr(!0),vl("");try{const N=await Y0({filename:t.filename,subfolder:t.subfolder||""}),V=N==null?void 0:N.prompt;if(!V)throw new Error("prompt_missing");const Z=K1(V),he=gy(V),Me=N==null?void 0:N.cozygen_prompt_raw,ut=Me&&typeof Me=="object"?Me:null;if(Ge(he),ve(ut),he.length){const We={};he.forEach(Xe=>{const Dt=ut&&typeof ut[Xe.key]=="string"?ut[Xe.key]:Xe.text;We[Xe.key]=Dt}),F(We),ge(Xe=>Xe&&We[Xe]?Xe:he[0].key)}else F({}),ge("");return qr.current=V,ot(Z),{prompt:V,info:Z}}catch(N){const V=((y=N==null?void 0:N.payload)==null?void 0:y.error)||(N==null?void 0:N.message)||"Unable to load prompt metadata.";throw vl(V),N}finally{vr(!1)}},[t==null?void 0:t.filename,t==null?void 0:t.subfolder,Oe]),Fa=o.useCallback(async()=>{if(be){R(!1),xe(!0),f(!1),I(null),ke(null),E(!1),_e("All"),Ze("All");try{const y=await Bo(),N=y==null?void 0:y.info;me(V=>String(V||"").trim()?V:(N==null?void 0:N.width)!==null&&(N==null?void 0:N.width)!==void 0?String(N.width):""),D(V=>String(V||"").trim()?V:(N==null?void 0:N.height)!==null&&(N==null?void 0:N.height)!==void 0?String(N.height):""),await ef(y==null?void 0:y.info)}catch{}}},[be,ef,Bo]),tf=o.useCallback(()=>{if(be){if(X){xe(!1),ke(null);return}Fa()}},[be,Fa,X]),Py=o.useCallback(()=>{xe(!1),ke(null),f(y=>!y)},[]),nf=o.useCallback(y=>{y&&ke(y)},[]),rf=o.useCallback(()=>{ke(null)},[]);o.useEffect(()=>{if(!e){jl.current="";return}if(!d||!(t!=null&&t.filename))return;const y=`${t.subfolder||""}|${t.filename}`;y===d&&jl.current!==y&&(jl.current=y,Fa(),p==null||p())},[d,e,t==null?void 0:t.filename,t==null?void 0:t.subfolder,p,Fa]),o.useCallback(()=>{I(null),A.current="rerun",xe(!1),ke(null),W("replace"),R(!0)},[]);const zy=o.useCallback(()=>{I(null),A.current=le?"editor":"rerun",Ye("tags"),W("replace"),xe(!1),ke(null),R(!0)},[le]),Oa=o.useCallback((y,N)=>{y&&(A.current=le?"editor":"rerun",Ye(y.type==="alias"?"aliases":"tags"),I({element:y,displayName:N||y.text||""}),W("replace"),xe(!1),ke(null),R(!0))},[le]),_y=o.useCallback(()=>{R(!1),I(null),Ye("elements"),A.current="rerun"},[]),Ay=o.useCallback(()=>{R(!1),I(null),Ye("elements"),f(!1),xe(!0),ke(null),A.current="rerun"},[]),sf=X||le,Da=ee==="raw"&&(g==null?void 0:g.size),lf=o.useMemo(()=>!sf||!ne.length?[]:ne.map(y=>{const N=fe==null?void 0:fe[y.key],V=typeof N=="string"?N:y.text||"",Z=Da?sa(V,g):V,he=ey(Z||"");return{...y,text:Z,rawText:V,elements:he}}),[ne,fe,sf,Da,g]),bn=o.useMemo(()=>lf.filter(y=>String(y.text||"").trim().length>0),[lf]);o.useEffect(()=>{if(!bn.length){ge("");return}bn.some(N=>N.key===Ne)||ge(bn[0].key)},[bn,Ne]);const st=o.useMemo(()=>bn.length?bn.find(N=>N.key===Ne)||bn[0]:null,[bn,Ne]),Ba=(st==null?void 0:st.text)||"",Pl=o.useMemo(()=>(bn||[]).map(y=>({value:y.key,label:y.label})),[bn]),Gt=(st==null?void 0:st.elements)||[],af=o.useMemo(()=>Gt.some(y=>(y==null?void 0:y.type)==="alias"),[Gt]),of=o.useMemo(()=>{if(af)return!0;const y=st==null?void 0:st.key;if(!y||!ae)return!1;const N=ae[y];return typeof N=="string"&&N.includes("$")},[st==null?void 0:st.key,af,ae]),Ry=o.useMemo(()=>[{key:"elements",label:"Elements",icon:l.jsx(Ro,{size:14})},{key:"aliases",label:"Aliases",icon:l.jsx(Vg,{size:14})},{key:"tags",label:"Tags",icon:l.jsx(Ao,{size:14})}],[]),Ty=o.useMemo(()=>[{key:"replace",label:"Replace"},{key:"strength",label:"Strength"}],[]),Iy=o.useMemo(()=>[{key:"alias",label:"Alias"},{key:"raw",label:"Raw"}],[]),xr=le,$y=o.useMemo(()=>{if(!(b!=null&&b.element))return"";const y=b.element,N=b.displayName||y.text||"";return y.type==="alias"?`${N}  $${y.text}$`:N||y.text},[b]),cf=b?"Replace prompt element":"Add prompt element",My=b?"Replace with tag or $alias$":"Add tag or $alias$",Fy=Ct==="strength"?"Tap an element to adjust strength":"Tap an element to replace it",Ua=bn.length>0,Oy=Pl.length>1||of,Dy=!Mn&&!kn&&Ua,Uo=o.useMemo(()=>{const y=new Set;return Gt.forEach(N=>{if((N==null?void 0:N.type)!=="tag")return;const V=String(N.text||"").trim().toLowerCase();V&&y.add(V)}),y},[Gt]),Vo=o.useMemo(()=>{const y=new Set;return Gt.forEach(N=>{if((N==null?void 0:N.type)!=="alias")return;const V=String(N.text||"").trim().toLowerCase();V&&y.add(V)}),y},[Gt]),wr=o.useMemo(()=>Array.isArray(v)?v.map(y=>{if(!y)return null;const N=String(y.token||y.name||"").trim();if(!N)return null;const V=y.displayName||Hs({token:N,name:y.name});return{...y,key:y.key||N,token:N,displayName:V,subcategory:y.subcategory||""}}).filter(Boolean):[],[v]),By=o.useMemo(()=>{const y=new Map;return wr.forEach(N=>{if(!(N!=null&&N.token))return;const V=String(N.token||"").trim().toLowerCase();if(!V)return;const Z=N.displayName||Hs({token:N.token,name:N.name});Z&&y.set(V,Z)}),y},[wr]),Uy=o.useMemo(()=>{const y=new Set;return wr.forEach(V=>{const Z=String(V.category||"").trim();Z&&y.add(Z)}),["All",...Array.from(y).sort((V,Z)=>V.localeCompare(Z))]},[wr]),uf=o.useMemo(()=>{const y=new Set;return wr.forEach(V=>{if(De!=="All"&&V.category!==De)return;const Z=String(V.subcategory||"").trim();Z&&y.add(Z)}),["All",...Array.from(y).sort((V,Z)=>V.localeCompare(Z))]},[wr,De]),zl=o.useMemo(()=>{const y=String(Qe||"").trim().toLowerCase();return wr.filter(N=>{if(De!=="All"&&(N.category||"")!==De||O!=="All"&&(N.subcategory||"")!==O)return!1;if(!y)return!0;const V=String(N.displayName||"").toLowerCase(),Z=String(N.token||"").toLowerCase(),he=String(N.text||"").toLowerCase();return V.includes(y)||Z.includes(y)||he.includes(y)})},[wr,De,O,Qe]),Vy=o.useMemo(()=>zl.slice(0,Ee),[zl,Ee]),_l=o.useMemo(()=>{const y=Number.parseInt(String(wn||""),10);return Number.isFinite(y)&&y>0?y:0},[wn]),Wy=o.useMemo(()=>Array.isArray(wt)?wt.map(y=>{if(!y)return null;if(typeof y=="string"){const Z=y.trim();return Z?{value:Z,label:Tn(Z)}:null}const N=String(y.key||"").trim();if(!N)return null;const V=Number(y.actual||y.count||0);return{value:N,label:`${Tn(N)} (${V.toLocaleString()})`}}).filter(Boolean):[],[wt]);o.useEffect(()=>{se("All")},[De]),o.useEffect(()=>{Pe(30)},[De,O,Qe]),o.useEffect(()=>{if(!xr||Ie!=="tags"||wt.length>0)return;let y=!1;return $d().then(N=>{y||ms(Array.isArray(N==null?void 0:N.categories)?N.categories:[])}).catch(()=>{y||ms([])}),()=>{y=!0}},[xr,Ie,wt.length]);const df=o.useCallback(async()=>{if(!xr||Ie!=="tags")return;jn.current&&jn.current.abort(),pt.current&&(pt.current.abort(),pt.current=null);const y=new AbortController;jn.current=y;try{Gr(!0),ys("");const N=await il({q:oe,category:Ce,sort:tt,minCount:_l,limit:40,offset:0},{signal:y.signal}),V=Array.isArray(N==null?void 0:N.items)?N.items:[];en(V),gs(Number((N==null?void 0:N.total)||0)),Sn(V.length)}catch(N){if((N==null?void 0:N.name)==="AbortError")return;ys("Unable to load tags right now."),en([]),gs(0),Sn(0)}finally{Gr(!1)}},[oe,xr,Ie,Ce,_l,tt]),Hy=o.useCallback(async()=>{if(!xr||Ie!=="tags"||hr||Yr||Xn.length>=Kr)return;pt.current&&pt.current.abort();const y=new AbortController;pt.current=y;try{gl(!0);const N=await il({q:oe,category:Ce,sort:tt,minCount:_l,limit:40,offset:tn},{signal:y.signal}),V=Array.isArray(N==null?void 0:N.items)?N.items:[];en(Z=>[...Z,...V]),gs(Number((N==null?void 0:N.total)||0)),Sn(tn+V.length)}catch(N){if((N==null?void 0:N.name)==="AbortError")return;ys("Unable to load more tags.")}finally{gl(!1)}},[oe,xr,Ie,Ce,Xn.length,hr,Yr,_l,tn,tt,Kr]);o.useEffect(()=>{if(!xr||Ie!=="tags")return;const y=window.setTimeout(()=>{df()},250);return()=>window.clearTimeout(y)},[xr,Ie,oe,Ce,tt,_l,df]),o.useEffect(()=>{Ie!=="elements"&&(cn(null),dn(null))},[Ie]);const Jn=o.useCallback(y=>{st!=null&&st.key&&F(N=>{const V=typeof(N==null?void 0:N[st.key])=="string"?N[st.key]:st.rawText||st.text||"",Z=Da?sa(V,g):V,he=typeof y=="function"?y(Z):String(y||"");return he===Z?N:{...N,[st.key]:he}})},[st,g,Da]),ff=o.useCallback((y,N,V)=>{if(!y)return!1;const Z=String(V||"").trim();return Z?(Jn(he=>{const Me=typeof he=="string"?he:"";if(!Me||typeof y.start!="number"||typeof y.end!="number")return Me;const ut=Ws(Me,y),We=Z.replace(/^\$|\$$/g,""),Xe=N==="alias"?`$${We}$`:We,Dt=ut?`(${Xe}:${gn(ut.weight)})`:Xe;return Me.slice(0,y.start)+Dt+Me.slice(y.end)}),!0):!1},[Jn]),Xr=o.useCallback((y,N,V)=>{const Z=b==null?void 0:b.element;if(!Z)return!1;const he=String(N||"").trim();return!he||!ff(Z,y,he)?!1:(I(null),gr(!1),yr(null),y==="alias"?U(`Replaced with ${V||he.replace(/^\$|\$$/g,"")}`):Qr(`Replaced with ${V||he.replace(/^\$|\$$/g,"")}`),Ye("elements"),A.current==="editor"?(R(!0),xe(!1)):(R(!1),xe(!0)),A.current="rerun",!0)},[b,ff,gr,yr,Ye,R,xe]),Ls=o.useCallback(y=>{const N=String(y||"").trim();N&&Jn(V=>{const Z=V.trim();return Z?`${Z.replace(/[\s,]*$/,"")}, ${N}`.trim():N})},[Jn]),pf=o.useCallback(()=>{const y=String(Fe||"").trim();if(!y)return;const N=y.split(",").map(he=>he.trim()).filter(Boolean),V=N[0];if(!V)return;if(b!=null&&b.element){const he=V.match(/^\$([a-z0-9_:-]+)\$$/i);he?Xr("alias",he[1],he[1]):Xr("tag",V,V),Ue("");return}const Z=N.join(", ");Z&&(Ls(Z),Ue(""))},[Fe,Ls,Xr,b]),Ky=o.useCallback((y,N)=>{const V=String(y||"").trim();if(!V)return;if(b!=null&&b.element){Xr("alias",V,N||V);return}const Z=V.toLowerCase();if(Vo.has(Z)){U(`Already added: ${N||V}`);return}Ls(`$${V}$`),U(`Added: ${N||V}`)},[Ls,Vo,Xr,b]),Gy=o.useCallback(y=>{const N=String(y||"").trim();if(!N)return;if(b!=null&&b.element){Xr("tag",N,N);return}const V=N.toLowerCase();if(Uo.has(V)){Qr(`Already added: ${N}`);return}Ls(N),Qr(`Added: ${N}`)},[Ls,Uo,Xr,b]);o.useEffect(()=>{if(!z)return;const y=window.setTimeout(()=>U(""),1600);return()=>window.clearTimeout(y)},[z]),o.useEffect(()=>{if(!vs)return;const y=window.setTimeout(()=>Qr(""),1600);return()=>window.clearTimeout(y)},[vs]);const Wo=o.useCallback((y,N)=>{if(!y)return;const V=Ws(Ba||"",y),Z=(V==null?void 0:V.weight)??1;yr({element:y,displayName:N,weight:Z}),gr(!0)},[Ba]),Yy=o.useCallback(y=>{y&&(Jn(N=>ty(N||"",y)),gr(!1),yr(null))},[Jn]),Va=o.useCallback((y,N)=>{y===null||N===null||y===N||Jn(V=>_u(V||"",Gt,y,N))},[Gt,Jn]),Qy=(y,N)=>{cn(N),dn(N),y!=null&&y.dataTransfer&&(y.dataTransfer.effectAllowed="move",y.dataTransfer.setData("text/plain",String(N)))},qy=(y,N)=>{y.preventDefault(),!(Lt===null||N===un)&&(dn(N),y!=null&&y.dataTransfer&&(y.dataTransfer.dropEffect="move"))},Xy=()=>{Lt!==null&&un!==null&&Lt!==un&&Va(Lt,un),cn(null),dn(null)},Jy=()=>{un!==null&&dn(null)},Zy=(y,N)=>{y.preventDefault(),Lt!==null&&Lt!==N&&Va(Lt,N),cn(null),dn(null)},ev=o.useCallback((y,N)=>{var Me,ut;if(!((ut=(Me=y.target)==null?void 0:Me.closest)==null?void 0:ut.call(Me,".composer-token-drag-handle")))return;const Z=y.touches[0],he=window.setTimeout(()=>{ct.current&&(ct.current.active=!0,cn(N),dn(N))},240);ct.current={idx:N,startX:Z.clientX,startY:Z.clientY,active:!1,timer:he}},[]),tv=o.useCallback(y=>{if(!ct.current)return;const N=y.touches[0],V=Math.abs(N.clientX-ct.current.startX),Z=Math.abs(N.clientY-ct.current.startY);if(!ct.current.active){(V>8||Z>8)&&(window.clearTimeout(ct.current.timer),ct.current=null);return}y.preventDefault();const he=yl.current,Me=he?he.querySelectorAll(".composer-token-draggable"):[],ut=N.clientX,We=N.clientY;for(let Xe=0;Xe<Me.length;Xe+=1){const Dt=Me[Xe].getBoundingClientRect();if(ut>=Dt.left&&ut<=Dt.right&&We>=Dt.top&&We<=Dt.bottom){dn(Xe);break}}},[]),nv=o.useCallback(()=>{var y,N;(y=ct.current)!=null&&y.timer&&window.clearTimeout(ct.current.timer),(N=ct.current)!=null&&N.active&&Lt!==null&&un!==null&&Lt!==un&&Va(Lt,un),ct.current=null,cn(null),dn(null)},[Lt,un,Va]),rv=o.useCallback(()=>{var y;(y=ct.current)!=null&&y.timer&&window.clearTimeout(ct.current.timer),ct.current=null,cn(null),dn(null)},[]),Ho=y=>{if(!(typeof window>"u"))try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:y}}))}catch{}},sv=async()=>{var y;if(!(!t||m||!be)){if(!bl){alert("Enter a valid seed value.");return}if(!_t){alert("Enter valid width and height values.");return}w(!0),Ho(!0);try{const{prompt:N}=await Bo();let Z=G1(N,{seedMode:H,seedValue:H==="custom"?Cn:null,checkpoint:K||null,lora:de||null,width:js,height:ks});ne.length&&(Z=H1(Z,ne,fe,{mutate:!0}));const he={};ne.length&&ne.forEach(We=>{const Xe=fe==null?void 0:fe[We.key];typeof Xe=="string"&&/\$[a-z0-9_:-]+\$/i.test(Xe)&&(he[We.key]=Xe)});const Me=Md();if(Object.keys(he).length)try{await Id({promptId:Me,promptRaw:he})}catch{}let ut=Z;if(g&&g.size){const We=Xe=>{if(typeof Xe=="string")return sa(Xe,g);if(Array.isArray(Xe))return Xe.map(Dt=>We(Dt));if(Xe&&typeof Xe=="object"){const Dt=Array.isArray(Xe)?[]:{};return Object.entries(Xe).forEach(([iv,ov])=>{Dt[iv]=We(ov)}),Dt}return Xe};try{ut=We(Z)}catch{ut=Z}}Gg({workflowName:t.filename||"gallery",workflow:ut,timestamp:Date.now(),promptRaw:Object.keys(he).length?he:null}),await Td({prompt:ut,prompt_id:Me}),Ho(!1),E(!0),setTimeout(()=>{E(!1)},1500)}catch(N){if(Ho(!1),N!=null&&N.unauthorized){window.location.hash="#/login";return}const V=((y=N==null?void 0:N.payload)==null?void 0:y.error)||(N==null?void 0:N.message)||"Unable to tweak this item.";alert(V)}finally{w(!1)}}},lv=async()=>{var N;if(!(!(t!=null&&t.filename)||!window.confirm("Delete this item? This cannot be undone."))){M(!0);try{await Dg({filename:t.filename,subfolder:t.subfolder||""}),a==null||a(),n==null||n()}catch(V){if(V!=null&&V.unauthorized){window.location.hash="#/login";return}const Z=((N=V==null?void 0:V.payload)==null?void 0:N.error)||(V==null?void 0:V.message)||"Unable to delete this item.";alert(Z)}finally{M(!1)}}},av=l.jsx(lo,{open:mr,onClose:()=>gr(!1),title:((mf=at==null?void 0:at.element)==null?void 0:mf.type)==="alias"?"Alias strength":"Tag strength",tokenLabel:at?((gf=at.element)==null?void 0:gf.type)==="alias"?`${at.displayName}  $${(yf=at.element)==null?void 0:yf.text}$`:at.displayName:"",weight:(at==null?void 0:at.weight)??1,onApply:y=>{at!=null&&at.element&&Jn(N=>zu(N||"",at.element,y))},onDeleteToken:()=>{at!=null&&at.element&&Yy(at.element)},onReplace:()=>{at!=null&&at.element&&Oa(at.element,at.displayName)}});return!t||!e||typeof document>"u"?null:Ld.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"react-modal-overlay",role:"presentation",onPointerDown:y=>{k.current=y.target===y.currentTarget},onClick:y=>{k.current&&y.target===y.currentTarget&&(T.current||n==null||n())},children:l.jsx("div",{className:"react-modal-content media-viewer-dialog",ref:B,role:"dialog","aria-modal":"true","aria-label":"Preview",onClick:y=>y.stopPropagation(),tabIndex:-1,children:l.jsxs("div",{className:"media-viewer-panel",children:[l.jsx(sj,{filename:t.filename,locationLabel:L,isClip:$,url:Cl,canRerun:be,rerunOpen:X,canDelete:Ke,deleteBusy:P,metaRows:Ve,metaOpen:h,onToggleMeta:Py,onToggleRerun:tf,onDelete:lv,onClose:n,closeButtonRef:j}),h?l.jsx(lj,{metaRows:Ve}):null,X?l.jsxs("div",{className:"media-viewer-info rerun-info","aria-label":"Tweak options",children:[l.jsxs("div",{className:"media-info-row rerun-info-row rerun-controls-row",children:[l.jsx("span",{className:"media-info-label",children:"Seed & Size"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(so,{title:"Adjust",defaultOpen:!1,variant:"bare",className:"rerun-collapsible",bodyClassName:"rerun-collapsible-body",children:l.jsxs("div",{className:"rerun-control-stack",children:[l.jsxs("div",{className:"rerun-control-group",children:[l.jsx(_n,{ariaLabel:"Seed mode",value:H,onChange:J,size:"sm",layout:"auto",wrap:!0,items:Fn}),H==="custom"?l.jsx("input",{type:"number",inputMode:"numeric",className:"ui-control ui-input",placeholder:"Enter seed",value:ue,onChange:y=>ce(y.target.value)}):null,l.jsx("div",{className:"sheet-hint text-xs text-[#9DA3FFCC]",children:H==="random"?"Randomize each run":"Keep or customize the seed used in the prompt."})]}),Oe.hasSize?l.jsx("div",{className:"rerun-control-group",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"number",inputMode:"numeric",min:1,step:1,className:"ui-control ui-input flex-1",placeholder:"Width",value:Q,onChange:y=>me(y.target.value),"aria-label":"Width","aria-invalid":Kt}),l.jsx("span",{className:"text-xs text-[#9DA3FF99]","aria-hidden":"true",children:""}),l.jsx("input",{type:"number",inputMode:"numeric",min:1,step:1,className:"ui-control ui-input flex-1",placeholder:"Height",value:Y,onChange:y=>D(y.target.value),"aria-label":"Height","aria-invalid":by})]})}):null]})})})]}),Oe.hasCheckpoint?l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"Model"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(G,{variant:"bare",className:"w-full justify-start text-left text-[0.8rem] whitespace-normal break-words",onClick:()=>nf("model"),"aria-label":"Change model","aria-haspopup":"dialog","aria-expanded":Le==="model",children:K||Do||""})})]}):null,l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"Prompt"}),l.jsxs("div",{className:"media-info-value rerun-info-value",children:[Mn?l.jsx("div",{className:"rerun-info-empty",children:"Loading prompt"}):null,kn?l.jsx("div",{className:"rerun-info-empty rerun-info-error",children:kn}):null,!Mn&&!kn&&!Ua?l.jsx("div",{className:"rerun-info-empty",children:"No prompt text found for this image."}):null,Dy?l.jsxs(l.Fragment,{children:[Oy?l.jsxs("div",{className:"rerun-prompt-controls",children:[Pl.length>1?l.jsx(nt,{value:(st==null?void 0:st.key)||"",onChange:ge,"aria-label":"Prompt source",size:"sm",wrapperClassName:"rerun-select",options:Pl}):null,of?l.jsx(_n,{ariaLabel:"Alias display",value:ee,onChange:je,items:Iy,size:"sm",layout:"auto",className:"rerun-alias-toggle"}):null]}):null,l.jsx("div",{className:"media-info-value is-prompt rerun-prompt-box",role:"list",children:l.jsxs("div",{className:"ui-chip-row",children:[Gt.length?Gt.map(y=>{const N=String(y.text||"").trim().toLowerCase(),V=By.get(N)||`$${y.text}$`,Z=g==null?void 0:g.get(N),he=typeof Z=="string"&&Z.trim()?Z:`$${y.text}$`,Me=y.type==="alias"?ee==="alias"?V:he:y.text,ut=y.type==="alias"&&Hs({token:y.text})||y.text,We=Ws(Ba||"",y),Xe=(We==null?void 0:We.weight)??1,Dt=Math.abs(Xe-1)>1e-6;return l.jsxs("button",{type:"button",className:`ui-chip is-clickable rerun-token max-w-full whitespace-normal leading-snug ${y.type==="alias"?"is-accent":""}`,onClick:()=>Oa(y,ut),title:y.type==="alias"?`Alias: $${y.text}$`:`Tag: ${y.text}`,children:[l.jsx("span",{className:"break-words",children:Me}),Dt?l.jsxs("span",{className:"rerun-chip-weight",children:[gn(Xe),""]}):null]},`${y.type}-${y.text}-${y.start}`)}):null,l.jsx("button",{type:"button",className:"ui-chip is-clickable rerun-token rerun-token-add",onClick:zy,"aria-label":"Add tag",title:"Add tag",children:"+"})]})})]}):null]})]}),Oe.hasLora?l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"LoRAs"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(G,{variant:"bare",className:"w-full justify-start text-left text-[0.8rem] whitespace-normal break-words",onClick:()=>nf("lora"),"aria-label":"Change LoRA","aria-haspopup":"dialog","aria-expanded":Le==="lora",children:de||(Ia.length?Ia.join(", "):"")})})]}):null,l.jsxs("div",{className:"media-info-row rerun-info-row rerun-actions-row",children:[l.jsx("span",{className:"media-info-label",children:"Run"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:C?l.jsxs("div",{className:"rerun-success",children:[l.jsx("svg",{className:"rerun-success-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Render queued successfully!"]}):l.jsxs("div",{className:"rerun-actions",children:[l.jsx(G,{variant:"muted",size:"sm",onClick:tf,children:"Close"}),l.jsx(G,{variant:"primary",size:"sm",onClick:sv,disabled:m||Mn||!!kn||!bl||!_t,children:m?"Tweaking":"Run"})]})})]})]}):null,l.jsx(aj,{showNav:ye,canPrev:c,canNext:u,onPrev:r,onNext:s,isClip:$,url:Cl,filename:t.filename})]})})}),l.jsx(Ft,{open:le,onClose:_y,title:"Edit prompt",variant:"fullscreen",footer:l.jsx("div",{className:"flex gap-2",children:l.jsx(G,{variant:"muted",className:"w-full",onClick:Ay,children:"Back to tweak"})}),children:l.jsxs("div",{className:"sheet-stack",children:[Mn?l.jsx("div",{className:"composer-alias-empty",children:"Loading prompt"}):null,kn?l.jsx("div",{className:"text-xs text-[#FF8F70]",children:kn}):null,b?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Replacing"}),l.jsx("div",{className:"sheet-hint",children:$y||""}),l.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>{I(null),Ye("elements")},children:"Cancel replace"}),l.jsx(G,{size:"xs",variant:"muted",onClick:()=>Wo(b.element,b.displayName),children:"Adjust strength"}),l.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:"Choose a replacement from Aliases or Tags. Selection returns to elements."})]})]}):null,!Mn&&!kn&&Ua?l.jsxs(l.Fragment,{children:[Pl.length>1?l.jsx(nt,{value:(st==null?void 0:st.key)||"",onChange:ge,"aria-label":"Prompt source",size:"sm",options:Pl}):null,l.jsx(_n,{ariaLabel:"Prompt element view",value:Ie,onChange:Ye,items:Ry,size:"sm"}),Ie==="elements"?l.jsxs("div",{className:"composer-panel composer-panel-compose is-visible",children:[l.jsx("div",{className:"composer-editor",children:l.jsxs("div",{className:"composer-input-row",children:[l.jsx("input",{type:"text",value:Fe,onChange:y=>Ue(y.target.value),onKeyDown:y=>{y.key==="Enter"&&(y.preventDefault(),pf())},className:"composer-input ui-control ui-input is-compact",placeholder:My,"aria-label":cf,disabled:!st}),l.jsx(G,{size:"icon",variant:"ghost",onClick:pf,disabled:!Fe.trim()||!st,"aria-label":cf,children:"+"})]})}),l.jsxs("div",{className:"composer-tokens",children:[l.jsxs("div",{className:"composer-tokens-header",children:[l.jsxs("span",{className:"composer-tokens-label",children:["Elements",l.jsx("span",{className:"composer-tokens-count",children:Gt.length})]}),l.jsx(_n,{ariaLabel:"Element edit mode",value:Ct,onChange:W,items:Ty,size:"sm",layout:"auto",wrap:!0})]}),l.jsxs("span",{className:"composer-tokens-hint",children:["Drag handle to reorder  ",Fy]}),Gt.length?l.jsx("div",{ref:yl,className:`composer-tokens-list ${Lt!==null?"is-dragging":""}`,style:{"--composer-elements":Gt.length},children:Gt.map((y,N)=>{const V=y.type==="alias"&&Hs({token:y.text})||y.text,Z=Ws(Ba||"",y),he=(Z==null?void 0:Z.weight)??1,Me=Lt===N,ut=un===N&&Lt!==null&&Lt!==N;return l.jsxs("span",{className:`composer-token composer-token-draggable ${y.type==="alias"?"is-alias":"is-tag"} ${Me?"is-dragging":""} ${ut?"is-drop-target":""}`,role:"button",tabIndex:0,draggable:!0,title:y.type==="alias"?`Alias: $${y.text}$`:`Tag: ${y.text}`,onDragStart:We=>Qy(We,N),onDragEnd:Xy,onDragOver:We=>qy(We,N),onDragLeave:Jy,onDrop:We=>Zy(We,N),onTouchStart:We=>ev(We,N),onTouchMove:tv,onTouchEnd:nv,onTouchCancel:rv,onClick:()=>{Lt===null&&(Ct==="strength"?Wo(y,V):Oa(y,V))},onKeyDown:We=>{We.target===We.currentTarget&&(We.key==="Enter"||We.key===" ")&&(We.preventDefault(),Ct==="strength"?Wo(y,V):Oa(y,V))},children:[l.jsx("span",{className:"composer-token-order",children:N+1}),l.jsx("span",{className:"composer-token-drag-handle","aria-hidden":"true",children:l.jsx(to,{size:10})}),l.jsx("span",{className:"composer-token-name",children:V}),y.type==="alias"&&l.jsx("span",{className:"composer-token-type",children:"$"}),Math.abs(he-1)>1e-6&&l.jsxs("span",{className:"composer-token-weight",children:[gn(he),""]})]},`${y.type}-${y.text}-${y.start}`)})}):l.jsx("div",{className:"composer-empty",children:"No elements yet."})]})]}):null,Ie==="aliases"?l.jsxs("div",{className:"composer-panel composer-panel-aliases is-visible",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{type:"text",value:ze,onChange:y=>$e(y.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>$e(""),disabled:!ze,children:"Clear"})]}),l.jsx(nt,{value:De,onChange:qe,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:Uy.map(y=>({value:y,label:y==="All"?"Category: All":Gn(y)}))}),uf.length>2?l.jsx(nt,{value:O,onChange:se,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:uf.map(y=>({value:y,label:y==="All"?"All subcategories":Tn(y)}))}):null]}),z?l.jsx("div",{className:"composer-tag-collection-status",role:"status",children:z}):null,l.jsx("div",{className:"composer-alias-list",role:"list",children:x?l.jsx("div",{className:"composer-alias-empty",children:"Loading aliases"}):S?l.jsx("div",{className:"composer-alias-empty",children:"Unable to load aliases."}):zl.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[Vy.map(y=>l.jsx(jy,{id:y.key,name:y.name||y.token,category:y.category,text:y.text,isSelected:Vo.has(String(y.token||"").toLowerCase()),onOpen:()=>Ky(y.token,y.displayName),visibilityStyle:sh},y.key)),Ee<zl.length?l.jsxs(G,{variant:"muted",className:"w-full",onClick:()=>Pe(y=>y+30),children:["Show more (",zl.length-Ee," left)"]}):null]})})]}):null,Ie==="tags"?l.jsxs("div",{className:"composer-panel composer-panel-tags is-visible",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{type:"search",value:re,onChange:y=>ie(y.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>ie(""),disabled:!re,children:"Clear"})]}),l.jsx(nt,{value:Ce,onChange:et,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...Wy]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(nt,{value:tt,onChange:Ht,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"rerun-min-count",children:"Minimum count"}),l.jsx("input",{id:"rerun-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:wn,onChange:y=>{const N=y.target.value;(N===""||Number(N)>=0)&&jt(N)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),Aa?l.jsx("div",{className:"composer-tags-error",children:Aa}):null,vs?l.jsx("div",{className:"composer-tag-collection-status",role:"status",children:vs}):null,l.jsx("div",{className:"composer-alias-list composer-tags-grid",role:"list",children:hr?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):Xn.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[Xn.map(y=>l.jsx(ky,{tag:y.tag,category:y.category,count:y.count,isCollected:Uo.has(String(y.tag||"").toLowerCase()),onToggle:Gy,visibilityStyle:sh},`${y.tag}-${y.category}`)),Xn.length<Kr?l.jsx(G,{variant:"muted",className:"w-full",onClick:Hy,disabled:Yr,children:Yr?"Loading more":`Show more (${Kr-Xn.length} left)`}):null]})})]}):null]}):null,!Mn&&!kn&&!Ua?l.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:"No prompt text found for this image."}):null]})}),l.jsx(Ft,{open:Le==="model",onClose:rf,title:"Select model",children:l.jsxs("div",{className:"sheet-stack",children:[Ra?l.jsx("div",{className:"rerun-info-empty",children:"Loading model choices"}):null,xs?l.jsx("div",{className:"rerun-info-empty rerun-info-error",children:xs}):null,bs?l.jsx(nt,{value:Re,onChange:_e,"aria-label":"Model folder filter",size:"sm",searchThreshold:0,options:$a.map(y=>({value:y,label:y}))}):null,l.jsx(nt,{value:K,onChange:we,"aria-label":"Model selection",size:"sm",searchThreshold:0,options:[{value:"",label:Yd?`Keep current (${Yd})`:"Keep current"},...Ey]})]})}),l.jsx(Ft,{open:Le==="lora",onClose:rf,title:"Select LoRA",children:l.jsxs("div",{className:"sheet-stack",children:[Ra?l.jsx("div",{className:"rerun-info-empty",children:"Loading LoRA choices"}):null,xs?l.jsx("div",{className:"rerun-info-empty rerun-info-error",children:xs}):null,Es?l.jsx(nt,{value:Ae,onChange:Ze,"aria-label":"LoRA folder filter",size:"sm",searchThreshold:0,options:Ma.map(y=>({value:y,label:y}))}):null,l.jsx(nt,{value:de,onChange:Te,"aria-label":"LoRA selection",size:"sm",searchThreshold:0,options:[{value:"",label:Qd?`Keep current (${Qd})`:"Keep current"},...Ly]})]})}),av]}),document.body)}const uj=(e="")=>e.startsWith("."),dj=(e="")=>/\.(png|jpe?g|gif|webp|bmp|tif?f)$/i.test(e),fj=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e);function pj(){const e=Bd(),t=(Y,D="")=>{try{return typeof window<"u"&&localStorage.getItem(Y)||D}catch{return D}},n=(Y,D)=>{try{typeof window<"u"&&localStorage.setItem(Y,D)}catch{}},[r,s]=o.useState(t("galleryPath","")),[a,i]=o.useState([]),[c,u]=o.useState(!1),[d,p]=o.useState(!1),[v,g]=o.useState(""),[x,S]=o.useState(1),[k,j]=o.useState(1),[h,f]=o.useState(()=>{const Y=t("galleryPageSize","30"),D=parseInt(Y,10);return Number.isFinite(D)?D:30}),[m,w]=o.useState("all"),[C,E]=o.useState(!1),[P,M]=o.useState(""),[B,_]=o.useState(()=>t("galleryRecursive","0")==="1"),[T,q]=o.useState(0);o.useEffect(()=>{let Y=!1;const D=new AbortController;return(async()=>{u(!0),g("");try{typeof performance<"u"&&performance.mark&&performance.mark("cozygen:gallery:fetch")}catch{}try{const we=await Og(r,x,h,C,B,m,T,{signal:D.signal,includeMeta:!0});if(Y)return;we&&we.items?(i(we.items),j(we.total_pages||1),g("")):(i([]),j(1));try{typeof performance<"u"&&performance.measure&&(performance.mark("cozygen:gallery:ready"),performance.measure("cozygen:gallery:first-paint","cozygen:gallery:fetch","cozygen:gallery:ready"))}catch{}}catch(we){if((we==null?void 0:we.name)==="AbortError")return;console.error("Failed to load gallery",we),Y||g("Unable to load gallery right now."),Y||(i([]),j(1))}finally{!Y&&!D.signal.aborted&&(u(!1),p(!0))}})(),n("galleryPath",r),n("galleryPageSize",String(h)),()=>{Y=!0,D.abort()}},[r,x,h,T,C,B,m]);const X=o.useMemo(()=>{if(!r)return[];const Y=r.replace(/\\/g,"/").split("/").filter(Boolean),D=[];for(let K=0;K<Y.length;K++)D.push({name:Y[K],path:Y.slice(0,K+1).join("/")});return D},[r]),xe=o.useMemo(()=>a.filter(Y=>Y.type==="directory").map(Y=>({filename:Y.filename,subfolder:Y.subfolder})),[a]),Le=o.useMemo(()=>{const Y=(P||"").trim().toLowerCase();return a.filter(D=>{const K=(D.filename||"").toLowerCase();return!(!C&&uj(K)||D.type!=="directory"&&(m==="image"&&!dj(K)||m==="video"&&!fj(K))||Y&&!K.includes(Y))})},[a,C,m,P]),ke=o.useMemo(()=>Le.filter(Y=>Y.type!=="directory"),[Le]),le=o.useCallback(()=>{if(!r)return;const Y=r.replace(/\\/g,"/").lastIndexOf("/"),D=Y===-1?"":r.slice(0,Y);s(D),S(1)},[r]),R=o.useCallback(()=>{s(""),S(1)},[]),b=o.useCallback(Y=>{s(Y||""),S(1)},[]),I=o.useCallback(Y=>{s(Y),S(1)},[]),A=o.useCallback(Y=>{const D=parseInt(String(Y),10)||30;f(D),S(1)},[]),H=o.useCallback(Y=>{w(Y),S(1)},[]),J=o.useCallback(Y=>{const D=!!Y;_(D),S(1),n("galleryRecursive",D?"1":"0")},[]),ue=o.useCallback(Y=>{M(Y),S(1)},[]),ce=o.useCallback(()=>{q(Y=>Y+1)},[]),Q=o.useRef(null),me=o.useCallback(()=>{Q.current||(Q.current=window.setTimeout(()=>{Q.current=null,ce()},400))},[ce]);return o.useEffect(()=>{const Y=()=>ce();return typeof window<"u"&&window.addEventListener&&window.addEventListener("cozygen:queue-finished",Y),()=>{typeof window<"u"&&window.removeEventListener&&window.removeEventListener("cozygen:queue-finished",Y)}},[ce]),o.useEffect(()=>{if(typeof window>"u"||!e)return;let Y=!1,D,K,we=8e3;const de=()=>{K&&(clearTimeout(K),K=null)},Te=(_e=8e3)=>{de(),K=window.setTimeout(()=>{Y||(me(),Te(we))},_e)};return(()=>{if(!("EventSource"in window)){Te();return}const _e=new URLSearchParams({subfolder:r||"",recursive:B?"1":"0",show_hidden:C?"1":"0"});D=new EventSource(`/cozygen/api/gallery/stream?${_e.toString()}`),D.onmessage=()=>{Y||me()},D.onerror=()=>{D&&(D.close(),D=null),we=Math.min(Math.ceil(we*1.4),2e4),Te()}})(),()=>{Y=!0,de(),Q.current&&(clearTimeout(Q.current),Q.current=null),D&&(D.close(),D=null)}},[r,B,C,me,e]),o.useEffect(()=>{e&&ce()},[e,ce]),{path:r,items:a,loading:c,hasLoaded:d,error:v,page:x,totalPages:k,perPage:h,kind:m,showHidden:C,query:P,recursive:B,crumbs:X,dirChips:xe,filtered:Le,mediaItems:ke,setPage:S,setPerPage:A,setShowHidden:E,setQuery:ue,setKind:H,setRecursive:J,goBack:le,goRoot:R,goToPath:b,selectDir:I,refresh:ce}}function hj(e){const[t,n]=o.useState(!1),[r,s]=o.useState(null);o.useEffect(()=>{if(!e||e.length===0){s(null),n(!1);return}s(x=>x==null?x:x>=e.length?e.length-1:x)},[e]);const a=o.useCallback(x=>{if(!e||!e.length||!x)return;const S=e.indexOf(x);S!==-1&&(s(S),n(!0))},[e]),i=o.useCallback(()=>{n(!1),s(null)},[]),c=o.useCallback(()=>{!e||!e.length||s(x=>x==null||x>=e.length-1?x:x+1)},[e]),u=o.useCallback(()=>{!e||!e.length||s(x=>x==null||x<=0?x:x-1)},[e]),d=r!=null&&r>=0&&e&&r<e.length?e[r]:null,p=(e==null?void 0:e.length)||0,v=r!==null&&r>0,g=r!==null&&r<p-1;return{viewerOpen:t,viewerIndex:r,currentMedia:d,total:p,canPrev:v,canNext:g,open:a,close:i,next:c,prev:u,setViewerOpen:n}}const ih="cozygen_gallery_view_mode",oh="cozygen_gallery_feed_autoplay";function mj(e,t){const n=o.useRef(null),[r,s]=o.useState(0),[a,i]=o.useState({width:0,cols:0,top:0,viewport:typeof window<"u"&&window.innerHeight||800}),c=g=>{if(!g||typeof window>"u")return null;let x=g.parentElement;for(;x;){const S=window.getComputedStyle(x);if(S.overflowY==="auto"||S.overflowY==="scroll")return x;x=x.parentElement}return window};o.useEffect(()=>{if(!t)return;const g=n.current;if(!g||typeof window>"u"||typeof ResizeObserver>"u")return;const x=c(g)||window,S=()=>{const f=g.getBoundingClientRect(),m=f.width||g.clientWidth||1,w=Math.max(1,Math.floor(m/160)),C=x===window?window.scrollY||0:x.scrollTop||0,E=x===window?{top:0}:x.getBoundingClientRect(),P=x===window?f.top+(window.scrollY||0):f.top-E.top+C,M=x===window?window.innerHeight||800:x.clientHeight||800;i(B=>B.width===m&&B.cols===w&&B.top===P&&B.viewport===M?B:{width:m,cols:w,top:P,viewport:M}),s(C)};S();const k=new ResizeObserver(()=>S());k.observe(g),window.addEventListener("resize",S);let j=!1;const h=()=>{j||(j=!0,window.requestAnimationFrame(()=>{j=!1;const f=x===window?window.scrollY||0:x.scrollTop||0;s(f)}))};return x.addEventListener("scroll",h,{passive:!0}),()=>{k.disconnect(),window.removeEventListener("resize",S),x.removeEventListener("scroll",h)}},[t]);const u=t&&a.cols>0&&e.length>60,{visibleItems:d,topSpacer:p,bottomSpacer:v}=o.useMemo(()=>{if(!u)return{visibleItems:e,topSpacer:0,bottomSpacer:0};const g=a.width/a.cols,x=Math.max(180,Math.ceil(g*1.25)+32),S=Math.ceil(e.length/a.cols),k=Math.max(0,r-a.top),j=Math.max(0,Math.floor(k/x)-2),h=Math.min(S,Math.ceil((k+a.viewport)/x)+2),f=j*a.cols,m=Math.min(e.length,h*a.cols);return{visibleItems:e.slice(f,m),topSpacer:j*x,bottomSpacer:Math.max(0,(S-h)*x)}},[e,a,r,u]);return{containerRef:n,visibleItems:d,topSpacer:p,bottomSpacer:v,virtualized:u}}function gj(){const{path:e,loading:t,hasLoaded:n,page:r,totalPages:s,perPage:a,kind:i,showHidden:c,recursive:u,error:d,crumbs:p,dirChips:v,filtered:g,mediaItems:x,setPage:S,setPerPage:k,setShowHidden:j,setKind:h,setRecursive:f,goBack:m,goRoot:w,goToPath:C,selectDir:E,refresh:P}=pj(),{viewerOpen:M,currentMedia:B,total:_,canPrev:T,canNext:q,open:X,close:xe,next:Le,prev:ke}=hj(x),[le,R]=o.useState(()=>{if(typeof window>"u")return"grid";const F=window.localStorage.getItem(ih);return F==="feed"||F==="grid"?F:"grid"}),[b,I]=o.useState(()=>typeof window>"u"?!1:window.localStorage.getItem(oh)==="true"),[A,H]=o.useState(""),[J,ue]=o.useState("");o.useEffect(()=>{try{window.localStorage.setItem(ih,le)}catch{}},[le]),o.useEffect(()=>{try{window.localStorage.setItem(oh,b?"true":"false")}catch{}},[b]);const ce=o.useCallback(async()=>{try{await nS(),P(),alert("Cache cleared successfully! Thumbnails will be regenerated.")}catch(F){alert("Failed to clear cache: "+(F.message||"Unknown error"))}},[P]),Q=o.useCallback(F=>(F==null?void 0:F.type)==="directory"?`dir:${F.subfolder||F.filename}`:`${F.subfolder||""}|${F.filename}`,[]),me=o.useCallback(F=>{if(F.type==="directory"){E(F.subfolder);return}ue(""),X(F)},[X,E]),Y=o.useCallback(F=>{!F||F.type==="directory"||(ue(Q(F)),X(F))},[Q,X]),D=o.useCallback(async F=>{var Ue;if(!F||F.type==="directory"||!F.filename)return;const Ne=F.filename||"this item";if(!window.confirm(`Delete "${Ne}"? This cannot be undone.`))return;const Fe=Q(F);H(Fe);try{await Dg({filename:F.filename,subfolder:F.subfolder||""}),P()}catch(Ie){if(Ie!=null&&Ie.unauthorized){window.location.hash="#/login";return}const Ye=((Ue=Ie==null?void 0:Ie.payload)==null?void 0:Ue.error)||(Ie==null?void 0:Ie.message)||"Unable to delete this item.";alert(Ye)}finally{H("")}},[Q,P]),K=le==="grid",[we,de]=o.useState(!1),Te=o.useMemo(()=>[{key:"all",label:"All"},{key:"image",label:"Images"},{key:"video",label:"Videos"}],[]),Re=o.useMemo(()=>[{key:"grid",ariaLabel:"Grid view",icon:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[l.jsx("rect",{x:"1",y:"1",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"9",y:"1",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"1",y:"9",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"9",y:"9",width:"6",height:"6",rx:"1"})]})},{key:"feed",ariaLabel:"Feed view",icon:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[l.jsx("rect",{x:"2",y:"1",width:"12",height:"5",rx:"1"}),l.jsx("rect",{x:"2",y:"8",width:"12",height:"5",rx:"1"})]})}],[]);o.useEffect(()=>{try{window.localStorage.setItem("cozygen_gallery_pending","0")}catch{}window.dispatchEvent(new Event("cozygen:gallery-viewed"))},[]);const _e=t&&!n,Ae=t&&n,Ze=`${g.length} items`,Oe=_e?"Loading":Ze,ot=!!d,{containerRef:ne,visibleItems:Ge,topSpacer:ae,bottomSpacer:ve,virtualized:fe}=mj(g,K);return l.jsxs("div",{className:"page-shell gallery-shell",children:[l.jsx("div",{className:"screen-sticky gallery-header",children:l.jsxs("div",{className:"gallery-header-inner",children:[l.jsxs("div",{className:"page-bar gallery-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Gallery"}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx("span",{className:"gallery-status",children:Oe}),l.jsx(_n,{ariaLabel:"View mode",value:le,onChange:R,layout:"icon",size:"sm",items:Re}),l.jsx(G,{size:"xs",className:"mobile-only",onClick:()=>de(!0),children:"Filters"})]})]}),l.jsx("div",{className:"gallery-nav-row",children:l.jsx(ej,{subfolder:e,crumbs:p,dirChips:v,onBack:m,onRoot:w,onCrumb:F=>C(F),onSelectDir:F=>E(F)})}),l.jsxs("div",{className:"gallery-toolbar",children:[l.jsx("div",{className:"gallery-toolbar-left",children:l.jsx(_n,{ariaLabel:"Filter by type",value:i,onChange:h,size:"sm",items:Te})}),l.jsx("div",{className:"gallery-toolbar-right",children:l.jsxs("div",{className:"gallery-options",children:[l.jsx(G,{size:"icon",active:u,pressed:u,onClick:()=>f(F=>!F),title:u?"Showing subfolders":"This folder only","aria-label":"Toggle subfolders",children:u?l.jsx(eo,{size:16}):l.jsx(Ip,{size:16})}),l.jsx(G,{size:"icon",active:c,pressed:c,onClick:()=>j(F=>!F),title:c?"Showing hidden":"Hiding hidden","aria-label":"Toggle hidden items",children:c?l.jsx($p,{size:16}):l.jsx(Mp,{size:16})}),le==="feed"&&l.jsx(G,{size:"icon",active:b,pressed:b,onClick:()=>I(F=>!F),title:b?"Autoplay on":"Autoplay off","aria-label":"Toggle autoplay",children:b?l.jsx(Fp,{size:16}):l.jsx(Op,{size:16})}),l.jsx(G,{size:"icon",onClick:P,title:"Refresh","aria-label":"Refresh gallery",children:l.jsx(Ci,{size:16})}),l.jsx(G,{size:"xs",onClick:ce,title:"Clear thumbnail cache","aria-label":"Clear cache",children:"Clear Cache"})]})})]}),l.jsx("div",{className:"gallery-pagination",children:l.jsxs("div",{className:"gallery-pagination-controls",children:[l.jsx(G,{size:"icon",variant:"ghost",onClick:()=>S(F=>Math.max(1,F-1)),disabled:r<=1||t,"aria-label":"Previous page",children:l.jsx(Hg,{size:16})}),l.jsxs("span",{className:"gallery-page-indicator",children:[r," / ",s]}),l.jsx(G,{size:"icon",variant:"ghost",onClick:()=>S(F=>F<s?F+1:F),disabled:r>=s||t,"aria-label":"Next page",children:l.jsx(To,{size:16})}),l.jsx(nt,{value:a,onChange:F=>k(parseInt(F,10)||30),className:"gallery-page-size","aria-label":"Items per page",size:"sm",options:[15,30,60,120]})]})})]})}),_e&&g.length===0?l.jsx("div",{className:"gallery-grid-responsive",children:Array.from({length:8}).map((F,Ne)=>l.jsxs("div",{className:"gallery-skeleton-item",children:[l.jsx("div",{className:"gallery-skeleton-thumb skeleton"}),l.jsx("div",{className:"gallery-skeleton-label skeleton skeleton-text"})]},Ne))}):ot&&g.length===0?l.jsxs("div",{className:"gallery-empty",role:"alert",children:[l.jsx("div",{className:"gallery-empty-icon",children:l.jsx(Dp,{size:48})}),l.jsx("div",{className:"gallery-empty-title",children:"Gallery unavailable"}),l.jsx("div",{className:"gallery-empty-desc",children:d}),l.jsx(G,{size:"sm",variant:"primary",className:"mt-4",onClick:P,children:"Retry"})]}):g.length===0?l.jsxs("div",{className:"gallery-empty",children:[l.jsx("div",{className:"gallery-empty-icon",children:l.jsx(Dp,{size:48})}),l.jsx("div",{className:"gallery-empty-title",children:"No media found"}),l.jsx("div",{className:"gallery-empty-desc",children:i!=="all"?`No ${i}s match your filters. Try selecting "All" or adjusting your search.`:"This folder is empty. Render something new or navigate to a different folder."})]}):K?l.jsx("div",{className:"w-full overflow-hidden",children:l.jsxs("div",{className:"gallery-grid-responsive",ref:ne,children:[fe&&ae>0?l.jsx("div",{"aria-hidden":!0,style:{gridColumn:"1 / -1",height:`${ae}px`}}):null,Ge.map(F=>l.jsx(rh,{item:F,onSelect:me,onDelete:D,onRerun:Y,isDeleting:Q(F)===A,variant:"grid",autoPlay:!1},Q(F))),fe&&ve>0?l.jsx("div",{"aria-hidden":!0,style:{gridColumn:"1 / -1",height:`${ve}px`}}):null]})}):l.jsx("div",{className:"flex flex-col gap-6 items-center",children:x.map(F=>l.jsx("div",{className:"w-full flex justify-center",children:l.jsx(rh,{item:F,onSelect:me,onDelete:D,onRerun:Y,isDeleting:Q(F)===A,variant:"feed",autoPlay:b})},Q(F)))}),l.jsx(cj,{isOpen:M,media:B,onClose:xe,onPrev:ke,onNext:Le,onDeleted:P,total:_,canPrev:T,canNext:q,autoOpenRerunKey:J,onRerunAutoOpen:()=>ue("")}),l.jsx(Ft,{open:we,onClose:()=>de(!1),title:"Gallery filters",contentClassName:"gallery-filters-sheet",footer:l.jsx(G,{variant:"primary",className:"w-full",onClick:()=>de(!1),children:"Done"}),children:l.jsxs("div",{className:"sheet-stack gallery-filters-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Type"}),l.jsx(_n,{ariaLabel:"Filter by type",value:i,onChange:h,size:"sm",items:Te})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Options"}),l.jsxs("div",{className:"gallery-filter-actions",children:[l.jsx(G,{size:"sm",variant:u?"primary":"muted",onClick:()=>f(F=>!F),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[u?l.jsx(eo,{size:14}):l.jsx(Ip,{size:14}),l.jsx("span",{children:u?"Subfolders":"This folder"})]})}),l.jsx(G,{size:"sm",variant:c?"primary":"muted",onClick:()=>j(F=>!F),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[c?l.jsx($p,{size:14}):l.jsx(Mp,{size:14}),l.jsx("span",{children:c?"Hidden on":"Hidden off"})]})}),le==="feed"?l.jsx(G,{size:"sm",variant:b?"primary":"muted",onClick:()=>I(F=>!F),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[b?l.jsx(Fp,{size:14}):l.jsx(Op,{size:14}),l.jsx("span",{children:b?"Autoplay":"No autoplay"})]})}):null,l.jsx(G,{size:"sm",variant:"ghost",onClick:P,children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[l.jsx(Ci,{size:14}),l.jsx("span",{children:"Refresh"})]})}),l.jsx(G,{size:"sm",variant:"ghost",onClick:ce,title:"Clear thumbnail cache",children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[l.jsx(Ci,{size:14}),l.jsx("span",{children:"Clear cache"})]})})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Page size"}),l.jsxs("div",{className:"gallery-filter-page",children:[l.jsx(nt,{value:a,onChange:F=>k(parseInt(F,10)||30),"aria-label":"Items per page",size:"sm",options:[15,30,60,120]}),l.jsxs("div",{className:"sheet-hint",children:[Ae?l.jsx("span",{className:"loading-spinner","aria-hidden":"true"}):null,l.jsxs("span",{children:[Oe,"  Page ",r," of ",s]})]}),l.jsxs("div",{className:"gallery-filter-pagination",children:[l.jsx(G,{variant:"muted",className:"w-full",onClick:()=>S(F=>Math.max(1,F-1)),disabled:r<=1||t,children:"Prev"}),l.jsx(G,{variant:"muted",className:"w-full",onClick:()=>S(F=>F<s?F+1:F),disabled:r>=s||t,children:"Next"})]})]})]})]})})]})}const yj=()=>typeof window>"u"?800:window.innerHeight||800,vj=e=>{if(!e||typeof window>"u")return null;let t=e.parentElement;for(;t;){const n=window.getComputedStyle(t);if(n.overflowY==="auto"||n.overflowY==="scroll")return t;t=t.parentElement}return window};function Gd({itemCount:e,enabled:t=!0,estimateRowHeight:n=72,overscan:r=6,minItems:s=80}={}){const a=o.useRef(null),i=o.useRef(n),[c,u]=o.useState({top:0,scrollTop:0,viewport:yj(),rowHeight:n});o.useEffect(()=>{if(!t)return;const k=a.current;if(!k||typeof window>"u"||typeof ResizeObserver>"u")return;const j=vj(k)||window,h=()=>{const C=k.getBoundingClientRect(),E=j===window?window.scrollY||0:j.scrollTop||0,P=j===window?{top:0}:j.getBoundingClientRect(),M=j===window?C.top+(window.scrollY||0):C.top-P.top+E,B=j===window?window.innerHeight||800:j.clientHeight||800;u(_=>_.top===M&&_.scrollTop===E&&_.viewport===B&&_.rowHeight===i.current?_:{top:M,scrollTop:E,viewport:B,rowHeight:i.current})};h();const f=new ResizeObserver(()=>h());f.observe(k),window.addEventListener("resize",h);let m=!1;const w=()=>{m||(m=!0,window.requestAnimationFrame(()=>{m=!1;const C=j===window?window.scrollY||0:j.scrollTop||0;u(E=>E.scrollTop===C&&E.rowHeight===i.current?E:{...E,scrollTop:C,rowHeight:i.current})}))};return j.addEventListener("scroll",w,{passive:!0}),()=>{f.disconnect(),window.removeEventListener("resize",h),j.removeEventListener("scroll",w)}},[t]),o.useEffect(()=>{if(!t||typeof window>"u")return;let k=0;const j=()=>{const h=a.current;if(!h)return;const f=h.querySelector('[data-virtual-row="true"]');if(!f)return;const m=f.getBoundingClientRect(),w=Math.max(24,Math.round(m.height||0));w&&Math.abs(w-i.current)>2&&(i.current=w,u(C=>({...C,rowHeight:w})))};return k=window.requestAnimationFrame(j),()=>{k&&window.cancelAnimationFrame(k)}},[t,e,c.scrollTop]);const d=!!(t&&e>s),{startIndex:p,endIndex:v,topSpacer:g,bottomSpacer:x}=o.useMemo(()=>{if(!d)return{startIndex:0,endIndex:e,topSpacer:0,bottomSpacer:0};const k=c.rowHeight||n,j=Math.max(0,c.scrollTop-c.top),h=Math.max(0,Math.floor(j/k)-r),f=Math.min(e,Math.ceil((j+c.viewport)/k)+r);return{startIndex:h,endIndex:f,topSpacer:h*k,bottomSpacer:Math.max(0,(e-f)*k)}},[e,c,r,n,d]),S=v>=e-Math.max(6,r*2);return{containerRef:a,startIndex:p,endIndex:v,topSpacer:g,bottomSpacer:x,virtualized:d,isNearEnd:S}}const xj={contentVisibility:"auto",containIntrinsicSize:"240px 120px"},wj=o.memo(function({tag:t,category:n,count:r,isCollected:s,onSelectTag:a,addToCollection:i,removeFromCollection:c,setStatus:u}){const d=o.useCallback(()=>{const p=String(t||"");if(a){a(p),u(`Added: ${p}`);return}s?(c(p),u(`Removed: ${p}`)):(i(p),u(`Added: ${p}`))},[i,s,a,c,u,t]);return l.jsx("div",{className:"tag-library-row",role:"listitem",style:xj,"data-virtual-row":"true",children:l.jsxs("button",{type:"button",className:`composer-alias-item tag-library-item ${!a&&s?"is-collected":""}`,onClick:d,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name tag-library-name",children:l.jsx("code",{className:"tag-library-code",children:t})}),n?l.jsx("span",{className:"composer-alias-category",children:Tn(n)}):null]}),l.jsx("div",{className:"composer-alias-token",children:Number(r||0).toLocaleString()})]})})});function Sj(e){var n,r;const t=String(e||"");if(!t)return!1;try{return(r=(n=navigator.clipboard)==null?void 0:n.writeText)==null||r.call(n,t),!0}catch{return!1}}function ch({open:e,onClose:t,onSelectTag:n,initialQuery:r="",title:s="Tag library",contextTitle:a="",contextToken:i="",contextText:c="",contextTagCount:u=null,inline:d=!1}){const[p,v]=o.useState(r||""),[g,x]=o.useState(""),[S,k]=o.useState("count"),[j,h]=o.useState(""),[f,m]=o.useState([]),[w,C]=o.useState([]),[E,P]=o.useState(0),[M,B]=o.useState(0),[_,T]=o.useState(!1),[q,X]=o.useState(!1),[xe,Le]=o.useState(""),[ke,le]=o.useState(""),R=o.useRef(null),b=o.useRef(null),I=o.useRef(new Map),A=o.useRef(new Map),[H,J]=o.useState([]),[ue,ce]=o.useState(!1),[Q,me]=o.useState(null),[Y,D]=o.useState(null),K=o.useRef(null),we=o.useRef(null),de=o.useRef(null),Te=o.useRef(null),Re=o.useRef(null),_e=w.length<E,Ae=d||e,{containerRef:Ze,startIndex:Oe,endIndex:ot,topSpacer:ne,bottomSpacer:Ge,virtualized:ae,isNearEnd:ve}=Gd({itemCount:w.length,enabled:Ae,estimateRowHeight:74,overscan:8,minItems:90}),fe=ae?w.slice(Oe,ot):w,F=o.useMemo(()=>H.join(", "),[H]),Ne=o.useMemo(()=>new Set(H.map(O=>O.toLowerCase())),[H]),ge=o.useMemo(()=>{const O=Number.parseInt(String(j||""),10);return Number.isFinite(O)&&O>0?O:0},[j]),Fe=o.useCallback((O,se,Ee,Pe,z,U)=>[O||"",se||"",Ee||"",String(Pe||0),String(z||0),String(U||0)].join("::"),[]),Ue=o.useCallback(()=>{const O=I.current;if(O.size<=50)return;const se=Array.from(O.entries());se.sort((Ee,Pe)=>{var z,U;return(((z=Ee[1])==null?void 0:z.ts)||0)-(((U=Pe[1])==null?void 0:U.ts)||0)}),se.slice(0,Math.max(0,se.length-50)).forEach(([Ee])=>O.delete(Ee))},[]),Ie=o.useCallback(O=>{const se=String(O||"").trim();se&&J(Ee=>new Set(Ee.map(z=>z.toLowerCase())).has(se.toLowerCase())?Ee:[...Ee,se])},[]),Ye=o.useCallback(O=>{const se=String(O||"").trim().toLowerCase();se&&J(Ee=>Ee.filter(Pe=>Pe.toLowerCase()!==se))},[]),Ct=o.useCallback(()=>{J([]),le("Cleared collected tags.")},[]),W=o.useCallback(()=>{var se,Ee;if(!H.length){le("No tags to copy.");return}if(Sj(F)){le(`Copied ${H.length} tag${H.length===1?"":"s"}.`);return}const O=de.current;if(O)try{O.value=F,O.removeAttribute("readonly"),O.select(),O.setSelectionRange(0,F.length);const Pe=document.execCommand&&document.execCommand("copy");if(O.setAttribute("readonly","readonly"),(Ee=(se=window.getSelection())==null?void 0:se.removeAllRanges)==null||Ee.call(se),Pe){le(`Copied ${H.length} tag${H.length===1?"":"s"}.`);return}}catch{}le("Copy not available on this browser.")},[H,F]),ee=o.useCallback((O,se)=>{J(Ee=>{const Pe=[...Ee],[z]=Pe.splice(O,1);return Pe.splice(se,0,z),Pe})},[]);o.useCallback((O,se)=>{me(se),Te.current=O.target,O.dataTransfer.effectAllowed="move",O.dataTransfer.setData("text/plain",se.toString()),requestAnimationFrame(()=>{Te.current&&Te.current.classList.add("is-dragging")})},[]),o.useCallback(()=>{Te.current&&Te.current.classList.remove("is-dragging"),Q!==null&&Y!==null&&Q!==Y&&ee(Q,Y),me(null),D(null),Te.current=null},[Q,Y,ee]),o.useCallback((O,se)=>{O.preventDefault(),O.dataTransfer.dropEffect="move",D(se)},[]),o.useCallback(()=>{},[]),o.useCallback((O,se)=>{const Ee=O.touches[0];Re.current={idx:se,startX:Ee.clientX,startY:Ee.clientY,moved:!1}},[]),o.useCallback(O=>{if(!Re.current)return;const se=O.touches[0],Ee=Math.abs(se.clientX-Re.current.startX),Pe=Math.abs(se.clientY-Re.current.startY);if(Ee>10||Pe>10){Re.current.moved=!0,me(Re.current.idx),O.preventDefault();const z=document.querySelectorAll(".tag-collection-chip"),U=se.clientX,re=se.clientY;for(let ie=0;ie<z.length;ie++){const oe=z[ie].getBoundingClientRect();if(U>=oe.left&&U<=oe.right&&re>=oe.top&&re<=oe.bottom){D(ie);break}}}},[]),o.useCallback(()=>{var O;(O=Re.current)!=null&&O.moved&&Q!==null&&Y!==null&&Q!==Y&&ee(Q,Y),Re.current=null,me(null),D(null)},[Q,Y,ee]);const je=o.useCallback(async({nextQuery:O,nextCategory:se,nextSort:Ee,nextMinCount:Pe}={})=>{var wn;const z=typeof O=="string"?O:p,U=typeof se=="string"?se:g,re=typeof Ee=="string"?Ee:S,ie=typeof Pe=="number"?Pe:ge,oe=Fe(z,U,re,ie,80,0),Ce=Date.now(),et=I.current.get(oe);if(et&&Ce-et.ts<5*60*1e3){C(et.items||[]),P(Number(et.total||0)),B(0),Le(""),le(""),T(!1);return}const tt=A.current.get(oe);if(tt){try{const jt=await tt;C((jt==null?void 0:jt.items)||[]),P(Number((jt==null?void 0:jt.total)||0)),B(0),Le(""),le("")}catch{}return}T(!0),Le(""),le(""),B(0),R.current&&R.current.key!==oe&&R.current.controller.abort();const Ht=new AbortController;R.current={controller:Ht,key:oe};try{const jt=il({q:z,category:U,sort:re,minCount:ie,limit:80,offset:0},{signal:Ht.signal});A.current.set(oe,jt);const wt=await jt;I.current.set(oe,{items:(wt==null?void 0:wt.items)||[],total:Number((wt==null?void 0:wt.total)||0),ts:Date.now()}),Ue(),C((wt==null?void 0:wt.items)||[]),P(Number((wt==null?void 0:wt.total)||0))}catch(jt){if((jt==null?void 0:jt.name)==="AbortError")return;console.error("Failed to search tags",jt),Le("Unable to load tags right now."),C([]),P(0)}finally{A.current.delete(oe),((wn=R.current)==null?void 0:wn.key)===oe&&(R.current=null),T(!1)}},[Fe,g,ge,p,S,Ue]),ze=o.useCallback(async()=>{var re;if(_||q||!_e)return;const O=M+80,se=Fe(p,g,S,ge,80,O),Ee=Date.now(),Pe=I.current.get(se);if(Pe&&Ee-Pe.ts<5*60*1e3){C(ie=>[...ie,...Pe.items||[]]),P(Number(Pe.total||0)),B(O),X(!1);return}const z=A.current.get(se);if(z){try{const ie=await z,oe=(ie==null?void 0:ie.items)||[];C(Ce=>[...Ce,...oe]),P(Number((ie==null?void 0:ie.total)||0)),B(O)}catch{}return}X(!0),Le(""),b.current&&b.current.key!==se&&b.current.controller.abort();const U=new AbortController;b.current={controller:U,key:se};try{const ie=il({q:p,category:g,sort:S,minCount:ge,limit:80,offset:O},{signal:U.signal});A.current.set(se,ie);const oe=await ie,Ce=(oe==null?void 0:oe.items)||[];I.current.set(se,{items:Ce,total:Number((oe==null?void 0:oe.total)||0),ts:Date.now()}),Ue(),C(et=>[...et,...Ce]),P(Number((oe==null?void 0:oe.total)||0)),B(O)}catch(ie){if((ie==null?void 0:ie.name)==="AbortError")return;console.error("Failed to load more tags",ie),Le("Unable to load more tags.")}finally{A.current.delete(se),((re=b.current)==null?void 0:re.key)===se&&(b.current=null),X(!1)}},[Fe,_e,g,_,q,ge,M,p,S,Ue]);o.useEffect(()=>{if(!Ae)return;Le(""),le("");let O=!1;return(async()=>{try{const se=await $d();if(O)return;m(Array.isArray(se==null?void 0:se.categories)?se.categories:[])}catch(se){console.error("Failed to load tag categories",se),O||m([])}})(),()=>{O=!0}},[Ae]),o.useEffect(()=>{Ae&&(v(r||""),x(""),k("count"),h(""),C([]),P(0),B(0),T(!1),X(!1),Le(""),le(""),J([]))},[r,Ae]),o.useEffect(()=>{if(!Ae)return;const O=window.setTimeout(()=>{je()},220);return()=>window.clearTimeout(O)},[g,Ae,ge,p,je,S]),o.useEffect(()=>()=>{var O,se,Ee,Pe;R.current&&((se=(O=R.current.controller)==null?void 0:O.abort)==null||se.call(O)),b.current&&((Pe=(Ee=b.current.controller)==null?void 0:Ee.abort)==null||Pe.call(Ee))},[]),o.useEffect(()=>{if(!Ae||ae)return;const O=K.current;if(!O||typeof IntersectionObserver>"u")return;const se=new IntersectionObserver(Ee=>{const Pe=Ee[0];Pe!=null&&Pe.isIntersecting&&ze()},{threshold:.1});return se.observe(O),()=>se.disconnect()},[Ae,ze]),o.useEffect(()=>{ae&&(!_e||_||q||ve&&ze())},[ae,_e,_,q,ve,ze]);const $e=o.useMemo(()=>d?null:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(G,{variant:"muted",className:"w-full",onClick:t,children:"Done"}),l.jsx(G,{variant:"ghost",className:"w-full",onClick:()=>je(),disabled:_||q,children:l.jsxs("span",{className:"inline-flex items-center gap-2",children:[l.jsx(Ci,{size:14}),"Refresh"]})})]}),[d,_,q,t,je]),Qe=!!(n&&(a||i||c)),De=Number.isFinite(u)?`${u} tags`:"",qe=l.jsxs("div",{className:`sheet-stack ${d?"ui-card":""}`,children:[Qe?l.jsxs("div",{className:"tag-library-context",children:[l.jsxs("div",{className:"tag-library-context-head",children:[l.jsxs("div",{className:"min-w-0",children:[l.jsx("div",{className:"sheet-label",children:"Adding to alias"}),l.jsx("div",{className:"tag-library-context-title",children:a||"Alias"}),i?l.jsx("div",{className:"tag-library-context-token",children:i}):null]}),l.jsx(G,{size:"xs",variant:"muted",onClick:t,children:"Back"})]}),l.jsx("div",{className:"tag-library-context-preview",children:c||""}),De?l.jsx("div",{className:"tag-library-context-meta",children:De}):null]}):null,l.jsxs("div",{className:"sheet-section",children:[d?null:l.jsx("div",{className:"sheet-label",children:"Browse"}),l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:we,type:"search",value:p,onChange:O=>v(O.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>v(""),disabled:!p,children:"Clear"})]}),l.jsx(nt,{value:g,onChange:x,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...f.map(O=>({value:O.key,label:`${Tn(O.key)} (${Number(O.actual||O.count||0).toLocaleString()})`}))]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(nt,{value:S,onChange:k,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"tag-library-min-count",children:"Minimum count"}),l.jsx("input",{id:"tag-library-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:j,onChange:O=>{const se=O.target.value;(se===""||Number(se)>=0)&&h(se)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),ke?l.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:ke}):null,xe?l.jsx("div",{className:"text-xs text-[#FF8F70]",children:xe}):null]}),l.jsx("div",{className:"composer-alias-list tag-library-grid",role:"list",ref:Ze,children:_?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):w.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[ae&&ne>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${ne}px`}}):null,fe.map(O=>l.jsx(wj,{tag:O.tag,category:O.category,count:O.count,isCollected:Ne.has(String(O.tag||"").toLowerCase()),onSelectTag:n,addToCollection:Ie,removeFromCollection:Ye,setStatus:le},`${O.tag}-${O.category}`)),ae&&Ge>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Ge}px`}}):null,ae?null:l.jsx("div",{ref:K,className:"composer-sentinel"}),q?l.jsx("div",{className:"composer-alias-empty",children:"Loading more"}):null]})})]});return Ae?d?l.jsxs("section",{className:"tag-library-surface",children:[s?l.jsx("div",{className:"sheet-label tag-library-page-title",children:s}):null,qe,n?null:l.jsxs("div",{className:"tag-collection-bar","aria-live":"polite",children:[l.jsxs("div",{className:"tag-collection-bar-main",children:[l.jsx("div",{className:"tag-collection-bar-title",children:"Tags"}),l.jsx("div",{className:"tag-collection-bar-count","aria-live":"polite",children:H.length===0?"No tags selected":`${H.length} selected`})]}),l.jsx(G,{size:"icon",variant:"ghost",onClick:()=>ce(!0),"aria-label":"Manage collected tags",children:l.jsx(uS,{size:16})}),l.jsx("textarea",{ref:de,value:F,onChange:O=>{const se=O.target.value.split(",").map(z=>z.trim()).filter(Boolean),Ee=new Set,Pe=[];se.forEach(z=>{const U=z.toLowerCase();Ee.has(U)||(Ee.add(U),Pe.push(z))}),J(Pe)},className:"sr-only","aria-label":"Collected tags text"})]}),n?null:l.jsx(Ft,{open:ue,onClose:()=>ce(!1),title:"Collected tags",variant:"sheet",shouldCloseOnOverlayClick:!0,children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsxs("div",{className:"sheet-label",children:["Tags (",H.length,")"]}),l.jsxs("div",{className:"tag-collection-codeblock",children:[l.jsx("pre",{className:"tag-collection-pre",children:F||""}),l.jsx(G,{size:"icon",variant:"ghost",className:"absolute top-2 right-2",onClick:W,disabled:H.length===0,"aria-label":"Copy collected tags",children:l.jsx(dS,{size:16})}),l.jsx("textarea",{ref:de,value:F,readOnly:!0,className:"sr-only","aria-label":"Collected tags text"})]}),H.length?l.jsx("div",{className:"tag-collection-chips",children:H.map((O,se)=>l.jsxs("span",{className:"ui-chip is-accent is-clickable tag-collection-chip",onClick:()=>Ye(O),role:"button",tabIndex:0,onKeyDown:Ee=>{Ee.target===Ee.currentTarget&&(Ee.key==="Enter"||Ee.key===" ")&&(Ee.preventDefault(),Ye(O))},children:[l.jsx("code",{className:"ui-chip-code",children:O}),l.jsx(G,{size:"mini",variant:"danger","aria-label":`Remove ${O}`,onClick:Ee=>{Ee.stopPropagation(),Ye(O)},children:l.jsx(Dr,{size:12})})]},`${O}-${se}`))}):l.jsx("div",{className:"sheet-hint",children:"No tags collected yet."})]}),l.jsxs("div",{className:"sheet-section flex gap-2",children:[l.jsx(G,{variant:"muted",className:"w-full",onClick:()=>ce(!1),children:"Close"}),l.jsx(G,{variant:"ghost",className:"w-full",onClick:Ct,disabled:H.length===0,children:"Clear"})]})]})})]}):l.jsx(Ft,{open:e,onClose:t,title:s,variant:"fullscreen",contentClassName:"tag-library-sheet",footer:$e,shouldCloseOnOverlayClick:!1,children:qe}):null}function jj({inline:e=!1}){const t=pr(),[n]=Ad(),r=n.get("q")||"",s=o.useMemo(()=>r?`Tag Library  ${r}`:"Tag Library",[r]);return e?l.jsx(ch,{inline:!0,initialQuery:r,title:"",onSelectTag:null}):l.jsxs("div",{className:"page-shell page-stack",children:[l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:s}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx(G,{size:"xs",onClick:()=>t("/library?tab=aliases"),children:"Aliases"}),l.jsx(G,{size:"xs",onClick:()=>t("/compose"),children:"Composer"})]})]}),l.jsx(ch,{inline:!0,initialQuery:r,title:"Browse",onSelectTag:null})]})}function kj(e,t=!1){const n=()=>typeof window>"u"||!window.matchMedia?t:window.matchMedia(e).matches,[r,s]=o.useState(n);return o.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const a=window.matchMedia(e),i=()=>s(a.matches);return i(),typeof a.addEventListener=="function"?(a.addEventListener("change",i),()=>a.removeEventListener("change",i)):(a.addListener(i),()=>a.removeListener(i))},[e]),r}const uo="::",Nj=()=>`alias-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,tr=e=>String(e||"").split(",").map(t=>t.trim()).filter(Boolean),Oo=e=>(e||[]).map(t=>String(t||"").trim()).filter(Boolean).join(", "),Cj=(e,t)=>{const n=String(t||"").trim();if(!n)return String(e||"");const r=tr(e);return new Set(r.map(a=>a.toLowerCase())).has(n.toLowerCase())||r.push(n),Oo(r)},bj=(e,t)=>{const n=String(t||"").trim().toLowerCase();if(!n)return String(e||"");const r=tr(e).filter(s=>s.toLowerCase()!==n);return Oo(r)},Ej=(e,t,n)=>{const r=String(t||"").trim().toLowerCase(),s=String(n||"").trim();if(!r||!s)return String(e||"");const a=tr(e).map(u=>u.toLowerCase()===r?s:u),i=new Set,c=[];return a.forEach(u=>{const d=String(u||"").trim().toLowerCase();!d||i.has(d)||(i.add(d),c.push(u))}),Oo(c)},Nc=(e,t={})=>Object.entries(ra(e)).map(([n,r],s)=>{const[a,i]=String(n).includes(uo)?n.split(uo):["",n],c=i||n,u=t[n]||t[c]||a||"";return{id:`existing-${s}-${n}`,name:c,text:r,category:u}}),uh=e=>{const t={};return e.forEach(n=>{const r=String((n==null?void 0:n.name)||"").trim(),s=typeof(n==null?void 0:n.text)=="string"?n.text.trim():"";if(r&&s){const a=String((n==null?void 0:n.category)||"").trim(),i=a?`${a}${uo}${r}`:r;t[i]=s}}),t},dh=e=>{const t={};return e.forEach(n=>{const r=String((n==null?void 0:n.name)||"").trim(),s=typeof(n==null?void 0:n.category)=="string"?n.category.trim():"";if(r){const a=s?`${s}${uo}${r}`:r;t[a]=s}}),t},Lj={contentVisibility:"auto",containIntrinsicSize:"240px 120px"};function Pj({inline:e=!1}){var Pe;const t=pr(),{aliases:n,aliasCategories:r,categoryList:s,loading:a,saving:i,error:c,persistAliases:u}=wy(),[d,p]=o.useState(()=>Nc(n,r)),[v,g]=o.useState(()=>Array.isArray(s)?s:[]),[x,S]=o.useState("All"),[k,j]=o.useState("All"),[h,f]=o.useState(""),m=o.useDeferredValue(h),[w,C]=o.useState(""),[E,P]=o.useState(!1),[M,B]=o.useState(!1),[_,T]=o.useState({loading:!1,invalid:[],suggestions:{}}),[q,X]=o.useState(!1),[xe,Le]=o.useState(null),[ke,le]=o.useState(""),R=o.useRef(null),b=o.useRef(null),[I,A]=o.useState(!1),[H,J]=o.useState(""),[ue,ce]=o.useState(""),Q=kj("(min-width: 1024px)");o.useEffect(()=>{if(I)return;const z=Nc(n,r||{});p(z),w&&!z.some(U=>U.id===w)&&(C(""),P(!1))},[r,I]),o.useEffect(()=>{I||Array.isArray(s)&&g(s)},[s,I]),o.useEffect(()=>{if(I)return;const z=Nc(n,r||{});p(z),w&&!z.some(U=>U.id===w)&&(C(""),P(!1))},[n,r,w,I]);const me=o.useMemo(()=>uh(d),[d]),Y=()=>{const z={id:Nj(),name:"",text:"",category:""};p(U=>[...U,z]),C(z.id),le(""),A(!0),P(!0)},D=(z,U,re)=>{A(!0),p(ie=>ie.map((oe,Ce)=>Ce===z?{...oe,[U]:re}:oe))},K=z=>{A(!0),p(U=>{var ie;const re=U.filter((oe,Ce)=>Ce!==z);return(re.length===0||w===((ie=U[z])==null?void 0:ie.id))&&(C(""),P(!1)),re})},we=async()=>{le("");try{const z=new Map;if(d.forEach(re=>{tr((re==null?void 0:re.text)||"").forEach(oe=>{const Ce=String(oe).toLowerCase();Ce&&(z.has(Ce)||z.set(Ce,{tag:oe,rows:[]}),z.get(Ce).rows.push(re.id))})}),z.size){const re=Array.from(z.values()).map(ie=>ie.tag);try{const ie=await xc(re),oe=Array.isArray(ie==null?void 0:ie.invalid)?ie.invalid:[],Ce=new Set(oe.map(et=>String(et).toLowerCase()));if(Ce.size){const et=d.map(tt=>{const wn=tr((tt==null?void 0:tt.text)||"").filter(wt=>Ce.has(String(wt).toLowerCase()));if(!wn.length)return null;const jt=tt.category?`${tt.category}:${tt.name}`:tt.name;return{id:tt.id,token:jt,friendlyName:formatAliasFriendlyName({name:tt.name})||tt.name||"Untitled",category:tt.category||"",invalid:wn}}).filter(Boolean);Le({invalid:oe,invalidLower:Array.from(Ce),rows:et,suggestions:(ie==null?void 0:ie.suggestions)||{}}),X(!0),le("Fix invalid tags before saving.");return}}catch(ie){console.error("Unable to validate tags",ie),le("Unable to validate tags right now.");return}}const U=dh(d);await u({items:me,categories:U,categoryList:v}),A(!1),le("Saved.")}catch{le("Unable to save right now.")}},de=o.useMemo(()=>{const z=m.trim().toLowerCase(),re=[...d.filter(ie=>{const oe=(ie.category||"").trim();if(x===""&&oe||x!=="All"&&x!==""&&oe!==x)return!1;const Ce=Wl(ie.name||"",ie.category||"");if(k!=="All"&&Ce!==k)return!1;if(!z)return!0;const et=oe?`${oe}:${ie.name}`:ie.name;return(ie.name||"").toLowerCase().includes(z)||(ie.text||"").toLowerCase().includes(z)||(oe||"").toLowerCase().includes(z)||(et||"").toLowerCase().includes(z)})];return re.sort((ie,oe)=>(ie.name||"").localeCompare(oe.name||"")),re},[d,x,k,m]),{containerRef:Te,startIndex:Re,endIndex:_e,topSpacer:Ae,bottomSpacer:Ze,virtualized:Oe}=Gd({itemCount:de.length,enabled:!0,estimateRowHeight:86,overscan:8,minItems:120}),ot=Oe?de.slice(Re,_e):de,ne=de.find(z=>z.id===w)||d.find(z=>z.id===w)||null,Ge=ne?ne.category?`${ne.category}:${ne.name}`:ne.name||"alias":"",ae=ne&&(formatAliasFriendlyName({name:ne.name})||ne.name)||"Alias",ve=Ge?`$${Ge}$`:"$alias$",fe=de.length?de:d,F=ne?fe.findIndex(z=>z.id===ne.id):-1,Ne=F>0?fe[F-1]:null,ge=F>=0&&F<fe.length-1?fe[F+1]:null,Fe=z=>{z&&(C(z.id),P(!0),le(""))},Ue=o.useMemo(()=>{const z=new Set(v||[]);return d.forEach(U=>{U.category&&z.add(U.category)}),Array.from(z).sort((U,re)=>U.localeCompare(re))},[d,v]),Ie=o.useMemo(()=>{const z=new Set;return d.forEach(U=>{const re=(U.category||"").trim();if(x===""&&re||x!=="All"&&x!==""&&re!==x)return;const ie=Wl(U.name||"",U.category||"");ie&&z.add(ie)}),Array.from(z).sort((U,re)=>U.localeCompare(re))},[d,x]);o.useEffect(()=>{k!=="All"&&(Ie.includes(k)||j("All"))},[Ie,k]),o.useEffect(()=>{ce("")},[w]);const Ye=o.useMemo(()=>tr((ne==null?void 0:ne.text)||""),[ne==null?void 0:ne.text]),Ct=o.useMemo(()=>{const z=Array.isArray(_==null?void 0:_.invalid)?_.invalid:[];return new Set(z.map(U=>String(U).toLowerCase()))},[_]);o.useEffect(()=>{if(!ne||!(E||Q))return;const z=Ye,U=[],re=new Set;if(z.forEach(Ce=>{const et=String(Ce).toLowerCase();!et||re.has(et)||(re.add(et),U.push(Ce))}),!U.length){T({loading:!1,invalid:[],suggestions:{}});return}let ie=!1;const oe=window.setTimeout(async()=>{T(Ce=>({...Ce,loading:!0}));try{const Ce=await xc(U);if(ie)return;T({loading:!1,invalid:Array.isArray(Ce==null?void 0:Ce.invalid)?Ce.invalid:[],suggestions:(Ce==null?void 0:Ce.suggestions)||{}})}catch(Ce){console.error("Failed to validate tags",Ce),ie||T({loading:!1,invalid:[],suggestions:{}})}},260);return()=>{ie=!0,window.clearTimeout(oe)}},[E,Q,ne,Ye]);const W=z=>{var re,ie;const U=String(z||"");if(!U)return!1;try{return(ie=(re=navigator.clipboard)==null?void 0:re.writeText)==null||ie.call(re,U),!0}catch{return!1}},ee=(z="")=>{const U=new URLSearchParams;U.set("tab","tags"),z&&U.set("q",z),t(`/library?${U.toString()}`)},je=()=>{var ie;if(!ne)return;const z=tr(ue);if(!z.length){le("Enter a tag to add.");return}const U=d.findIndex(oe=>oe.id===ne.id);if(U===-1)return;let re=((ie=d[U])==null?void 0:ie.text)||"";z.forEach(oe=>{re=Cj(re,oe)}),D(U,"text",re),ce(""),le(`Added ${z.length} tag${z.length===1?"":"s"}.`)},ze=async()=>{const z=H.trim();if(!z){le("Enter a category name.");return}const U=Array.from(new Set([...v||[],z]));g(U),J(""),le("Category added.");const re=uh(d),ie=dh(d);A(!0);try{await u({items:re,categories:ie,categoryList:U}),A(!1),le("Category saved.")}catch{le("Unable to save right now.")}},$e=o.useCallback(z=>{z&&(C(z.id),P(!0),le(""))},[]),Qe=o.useMemo(()=>{const z=new Map;return d.forEach(U=>{U!=null&&U.id&&z.set(U.id,U)}),z},[d]),De=o.useCallback(z=>{const U=Qe.get(z);U&&$e(U)},[$e,Qe]),qe=()=>{Q&&C(""),P(!1),le("")};o.useMemo(()=>{const z=d.length,U=de.length;return a&&z===0?"Loading":z===U?`${z} aliases`:`${U} of ${z} aliases`},[d.length,de.length,a]),o.useEffect(()=>{const z=U=>{var tt,Ht;if(U.defaultPrevented)return;const re=U.target,ie=(re==null?void 0:re.tagName)||"",oe=["INPUT","TEXTAREA","SELECT"].includes(ie)||(re==null?void 0:re.isContentEditable),Ce=String(U.key||"").toLowerCase(),et=U.metaKey||U.ctrlKey;if(et&&Ce==="s"){U.preventDefault(),I&&!i&&we();return}if(et&&Ce==="n"){U.preventDefault(),Y();return}if(!oe&&Ce==="/"){U.preventDefault(),(Ht=(tt=b.current)==null?void 0:tt.focus)==null||Ht.call(tt);return}Ce==="escape"&&E&&!Q&&(U.preventDefault(),qe())};return window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)},[Y,qe,I,E,we,Q,i]);const O=l.jsxs("div",{className:"flex gap-2",children:[l.jsx(G,{variant:"muted",className:"w-full",onClick:qe,children:Q?"Clear selection":"Close"}),l.jsx(G,{variant:"primary",className:"w-full",onClick:we,disabled:i||!I,children:i?"Saving":I?"Save":"Saved"})]}),se=ne?l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"alias-editor-toolbar",children:[l.jsxs("div",{className:"alias-editor-heading",children:[l.jsx("div",{className:"alias-editor-title",children:ae}),l.jsx("div",{className:"alias-editor-meta",children:ve})]}),l.jsxs("div",{className:"alias-editor-actions",children:[l.jsx(G,{size:"xs",variant:"muted",onClick:()=>Fe(Ne),disabled:!Ne,title:"Previous alias",children:"Prev"}),l.jsx(G,{size:"xs",variant:"muted",onClick:()=>Fe(ge),disabled:!ge,title:"Next alias",children:"Next"}),l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>{Ge&&W(ve)?le("Token copied."):le("Copy not available on this browser.")},title:"Copy token",children:"Copy token"})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Token"}),l.jsx("div",{className:"composer-token",children:ve}),Wl(ne.name||"",ne.category||"")?l.jsxs("div",{className:"sheet-hint",children:["Subcategory: ",Tn(Wl(ne.name||"",ne.category||""))]}):null]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Friendly name"}),l.jsx("div",{className:"composer-field",children:ae})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Alias name"}),l.jsx("input",{ref:R,type:"text",value:ne.name||"",onChange:z=>{const U=d.findIndex(re=>re.id===ne.id);U!==-1&&D(U,"name",z.target.value)},placeholder:"e.g. cherry_fruit",className:"sheet-input ui-control ui-input"})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Category"}),l.jsx(nt,{value:ne.category||"",onChange:z=>{const U=d.findIndex(re=>re.id===ne.id);U!==-1&&D(U,"category",z)},size:"sm",searchThreshold:0,options:[{value:"",label:"Uncategorized"},...Ue.filter(Boolean).map(z=>({value:z,label:Gn(z)}))]}),l.jsx(G,{size:"xs",variant:"muted",onClick:()=>B(!0),children:"Manage categories"})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Expands to"}),l.jsx("textarea",{value:ne.text,onChange:z=>{const U=d.findIndex(re=>re.id===ne.id);U!==-1&&D(U,"text",z.target.value)},placeholder:"Prompt text for this alias",className:"sheet-textarea ui-control ui-textarea is-compact",rows:6}),l.jsxs("div",{className:"tag-quick-add",children:[l.jsx("input",{type:"text",value:ue,onChange:z=>ce(z.target.value),onKeyDown:z=>{z.key==="Enter"&&(z.preventDefault(),je())},placeholder:"Add tags (comma separated)",className:"ui-control ui-input tag-quick-input","aria-label":"Add tags"}),l.jsx(G,{size:"sm",variant:"primary",onClick:je,disabled:!ue.trim(),children:"Add"})]}),l.jsxs("div",{className:"tag-editor-actions",children:[l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>ee(""),children:l.jsxs("span",{className:"inline-flex items-center gap-2",children:[l.jsx(Ao,{size:14}),"Open tag library"]})}),l.jsx(G,{size:"xs",variant:"muted",onClick:()=>{T(U=>({...U,loading:!0}));const z=tr(ne.text||"");xc(z).then(U=>{T({loading:!1,invalid:Array.isArray(U==null?void 0:U.invalid)?U.invalid:[],suggestions:(U==null?void 0:U.suggestions)||{}})}).catch(()=>T({loading:!1,invalid:[],suggestions:{}}))},disabled:_.loading,title:"Validate against danbooru_tags.md",children:_.loading?"Validating":"Validate"})]}),Ye.length?l.jsx("div",{className:"tag-chip-list","aria-label":"Alias tags",children:Ye.map(z=>{const U=Ct.has(String(z).toLowerCase());return l.jsxs("span",{className:`ui-chip ${U?"is-invalid":""}`,children:[l.jsx("code",{className:"ui-chip-code",children:z}),l.jsx(G,{size:"mini",variant:"danger",onClick:()=>{const re=d.findIndex(ie=>ie.id===ne.id);re!==-1&&D(re,"text",bj(ne.text||"",z))},"aria-label":`Remove ${z}`,title:"Remove",children:l.jsx(Dr,{size:12})})]},z)})}):l.jsx("div",{className:"sheet-hint",children:"Tip: Use the Tag library to add validated tags quickly."}),!_.loading&&Array.isArray(_.invalid)&&_.invalid.length?l.jsxs("div",{className:"tag-invalid-panel",role:"alert",children:[l.jsxs("div",{className:"tag-invalid-title",children:["Invalid tags (",_.invalid.length,")"]}),l.jsx("div",{className:"tag-invalid-body",children:_.invalid.map(z=>{var re;const U=((re=_==null?void 0:_.suggestions)==null?void 0:re[z])||[];return l.jsxs("div",{className:"tag-invalid-row",children:[l.jsxs("div",{className:"tag-invalid-tag",children:[l.jsx("code",{children:z}),l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>ee(z),children:"Find"})]}),Array.isArray(U)&&U.length?l.jsx("div",{className:"tag-invalid-suggestions",children:U.slice(0,6).map(ie=>l.jsx(G,{size:"xs",variant:"chip",onClick:()=>{const oe=d.findIndex(Ce=>Ce.id===ne.id);oe!==-1&&D(oe,"text",Ej(ne.text||"",z,ie))},title:`Replace ${z} with ${ie}`,children:ie},`${z}-${ie}`))}):l.jsx("div",{className:"sheet-hint",children:"No suggestions found for this tag."})]},z)})})]}):null]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx(G,{variant:"danger",onClick:()=>{const z=d.findIndex(U=>U.id===ne.id);z!==-1&&(K(z),P(!1))},children:"Delete alias"}),l.jsx("div",{className:"sheet-hint",children:"Deleting removes it from your library. Use Save changes to persist."})]})]}):l.jsx("div",{className:"alias-editor-empty",children:"Select an alias to edit, or create a new one."}),Ee=e?"page-stack alias-page":"page-shell page-stack alias-page";return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Ee,children:[e?null:l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Aliases"}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx(G,{size:"xs",onClick:()=>ee(h||""),title:"Browse danbooru tags",children:"Tags"}),l.jsx(G,{size:"xs",variant:"primary",onClick:Y,children:"Add"})]})]}),l.jsx("div",{className:"library-toolbar screen-sticky",children:l.jsxs("div",{className:"library-toolbar-inner",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:b,type:"search",value:h,onChange:z=>f(z.target.value),className:"composer-search ui-control ui-input",placeholder:"Search aliases","aria-label":"Search aliases"}),l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>f(""),disabled:!h,children:"Clear"})]}),l.jsx(nt,{wrapperClassName:"composer-subcategory-select",value:x,onChange:S,"aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"All",label:"Category: All"},{value:"",label:"Uncategorized"},...Ue.filter(Boolean).map(z=>({value:z,label:Gn(z)}))]}),l.jsx(nt,{wrapperClassName:"composer-subcategory-select",value:k,onChange:j,"aria-label":"Filter by subcategory",size:"sm",searchThreshold:0,options:[{value:"All",label:"Subcategory: All"},...Ie.map(z=>({value:z,label:Tn(z)}))]}),e?l.jsx(G,{size:"sm",variant:"primary",onClick:Y,children:"Add alias"}):null,I?l.jsx(G,{size:"sm",variant:"primary",onClick:we,disabled:i,children:i?"Saving":"Save changes"}):null]}),c?l.jsx("div",{className:"library-toolbar-status is-error",children:"Could not load aliases. Try again later."}):null,ke?l.jsx("div",{className:"library-toolbar-status",children:ke}):null]})}),l.jsxs("div",{className:"alias-layout",children:[l.jsx("div",{className:"alias-list",children:d.length===0&&!a?l.jsx("section",{className:"ui-panel text-center py-16",children:l.jsx("p",{className:"text-base text-[rgba(159,178,215,0.8)]",children:"No aliases yet. Add your first one."})}):l.jsxs("div",{className:"composer-alias-list",role:"list",ref:Te,children:[de.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases match your filters."}):null,Oe&&Ae>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Ae}px`}}):null,ot.map(z=>l.jsx(jy,{id:z.id,name:z.name,category:(z.category||"").trim(),text:z.text||"",isSelected:w===z.id,onOpen:De,visibilityStyle:Lj},z.id)),Oe&&Ze>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Ze}px`}}):null]})}),l.jsx("aside",{className:"alias-editor-panel",children:l.jsxs("div",{className:"alias-editor-card ui-panel",children:[se,ne?l.jsx("div",{className:"alias-editor-footer",children:O}):null]})})]})]}),l.jsx(Ft,{open:E&&!!ne&&!Q,onClose:qe,title:"Alias",variant:"fullscreen",footer:O,children:se}),l.jsx(Ft,{open:M,onClose:()=>{B(!1),J(""),le("")},title:"Categories",variant:"sheet",footer:l.jsx("div",{className:"sheet-hint",children:"Categories help you organize aliases and improve the Insert alias picker."}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Add category"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:H,onChange:z=>J(z.target.value),placeholder:"e.g. styles",className:"sheet-input ui-control ui-input"}),l.jsx(G,{size:"sm",variant:"primary",onClick:ze,children:"Add"})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Existing"}),Ue.length===0?l.jsx("div",{className:"sheet-hint",children:"No categories yet."}):l.jsx(nt,{value:"",onChange:z=>{z&&(S(z),B(!1))},size:"sm",searchThreshold:0,placeholder:"Select a category",options:Ue.filter(Boolean).map(z=>({value:z,label:Gn(z)}))})]})]})}),l.jsx(Ft,{open:q,onClose:()=>X(!1),title:"Fix invalid tags",variant:"fullscreen",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(G,{variant:"muted",className:"w-full",onClick:()=>X(!1),children:"Close"}),l.jsx(G,{variant:"primary",className:"w-full",onClick:()=>{const z=new Set(((xe==null?void 0:xe.invalidLower)||[]).map(U=>String(U).toLowerCase()));if(!z.size){X(!1);return}p(U=>U.map(re=>{const oe=tr((re==null?void 0:re.text)||"").filter(et=>!z.has(String(et).toLowerCase())),Ce=Oo(oe);return Ce===((re==null?void 0:re.text)||"")?re:{...re,text:Ce}})),A(!0),X(!1),le("Removed invalid tags. Review and save again.")},children:"Remove invalid tags"})]}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsx("div",{className:"sheet-section",children:l.jsxs("div",{className:"sheet-hint",children:["These aliases contain tags not found in ",l.jsx("code",{className:"font-mono",children:"danbooru_tags.md"}),". Fix them before saving."]})}),(Pe=xe==null?void 0:xe.rows)!=null&&Pe.length?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Aliases with issues"}),l.jsx("div",{className:"composer-alias-list",role:"list",children:xe.rows.map(z=>l.jsxs("button",{type:"button",role:"listitem",className:"composer-alias-item",onClick:()=>{C(z.id),P(!0),X(!1)},children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:z.friendlyName}),z.category?l.jsx("span",{className:"composer-alias-category",children:Gn(z.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",z.token,"$"]}),l.jsx("div",{className:"tag-invalid-inline",children:z.invalid.map(U=>l.jsx("span",{className:"ui-chip is-invalid",children:l.jsx("code",{className:"ui-chip-code",children:U})},`${z.id}-${U}`))})]},z.id))})]}):null]})})]})}const Ny="cozygen_library_tab",zj=new Set(["tags","aliases"]),Cy=e=>zj.has(e)?e:"",_j=()=>{if(typeof window>"u")return"";try{return Cy(window.localStorage.getItem(Ny)||"")}catch{return""}};function Aj(){const[e,t]=Ad(),n=Cy(e.get("tab")),[r,s]=o.useState(()=>{const i=_j();return n||i||"tags"}),a=o.useMemo(()=>[{key:"tags",label:"Tags"},{key:"aliases",label:"Aliases"}],[]);return o.useEffect(()=>{n&&n!==r&&s(n)},[r,n]),o.useEffect(()=>{try{typeof window<"u"&&window.localStorage.setItem(Ny,r)}catch{}if(n!==r){const i=new URLSearchParams(e);i.set("tab",r),t(i,{replace:!0})}},[r,n,e,t]),l.jsxs("div",{className:"page-shell page-stack",children:[l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Library"}),l.jsx("div",{className:"page-bar-actions",children:l.jsx(_n,{ariaLabel:"Library tabs",value:r,onChange:s,items:a,size:"sm",layout:"auto"})})]}),r==="tags"?l.jsx(jj,{inline:!0}):null,r==="aliases"?l.jsx(Pj,{inline:!0}):null]})}function fh({className:e="",style:t,label:n,status:r,applyLabel:s,onClear:a,onApply:i,disabled:c=!1}){return l.jsxs("div",{className:`composer-tag-collection-bar ${e}`.trim(),style:t,children:[l.jsxs("div",{children:[l.jsx("div",{className:"composer-tag-collection-label",children:n}),r?l.jsx("div",{className:"composer-tag-collection-status",children:r}):null]}),l.jsxs("div",{className:"composer-tag-collection-actions",children:[l.jsx(G,{size:"xs",variant:"muted",onClick:a,disabled:c,children:"Clear"}),l.jsx(G,{size:"xs",variant:"primary",onClick:i,disabled:c,children:s})]})]})}const ph={contentVisibility:"auto",containIntrinsicSize:"260px 140px"};function Rj({open:e=!1,onClose:t,value:n="",onChange:r,aliasOptions:s=[],aliasCatalog:a=[],fieldLabel:i="Prompt",variant:c="sheet"}){var kl,Nl,Cl;const u=o.useRef(null),d=o.useRef(null),p=o.useRef(null),v=o.useRef(null),[g,x]=o.useState(n),[S,k]=o.useState(""),j=o.useDeferredValue(S),[h,f]=o.useState("All"),[m,w]=o.useState("All"),[C,E]=o.useState(30),[P,M]=o.useState("compose"),B=c==="page",_=B||e,[T,q]=o.useState(null),[X,xe]=o.useState(null),[Le,ke]=o.useState(null),le=o.useRef(null),R=o.useRef(null),[b,I]=o.useState(!1),[A,H]=o.useState(null),J=o.useRef(null),ue=o.useRef(null),[ce,Q]=o.useState(""),[me,Y]=o.useState(""),[D,K]=o.useState("count"),[we,de]=o.useState(""),[Te,Re]=o.useState([]),[_e,Ae]=o.useState([]),[Ze,Oe]=o.useState(0),[ot,ne]=o.useState(0),[Ge,ae]=o.useState(!1),[ve,fe]=o.useState(!1),[F,Ne]=o.useState(""),ge=o.useRef(null),Fe=o.useRef(null),Ue=o.useRef(new Map),Ie=o.useRef(new Map),Ye=o.useMemo(()=>{const L=Number.parseInt(String(we||""),10);return Number.isFinite(L)&&L>0?L:0},[we]),[Ct,W]=o.useState([]),[ee,je]=o.useState(""),[ze,$e]=o.useState([]),[Qe,De]=o.useState(""),qe=o.useMemo(()=>{if(!g)return{text:"",parts:[]};const L=new Map;if((a||[]).forEach(rt=>{if(!rt)return;const be=String(rt.token||"").trim().toLowerCase(),Ke=typeof rt.text=="string"?rt.text.trim():"";!be||!Ke||L.set(be,Ke)}),!L.size||!g.includes("$"))return{text:g,parts:[{text:g,isAlias:!1}]};const $=[],ye=/\$([a-z0-9_:-]+)\$/gi;let pe=0,Ve;for(;(Ve=ye.exec(g))!==null;){const rt=Ve.index;rt>pe&&$.push({text:g.slice(pe,rt),isAlias:!1});const be=String(Ve[1]||"").toLowerCase(),Ke=L.get(be);typeof Ke=="string"?$.push({text:Ke,isAlias:!0}):$.push({text:Ve[0],isAlias:!1}),pe=ye.lastIndex}return pe<g.length&&$.push({text:g.slice(pe),isAlias:!1}),{text:$.map(rt=>rt.text).join(""),parts:$}},[a,g]);o.useEffect(()=>{e&&(x(n),M("compose"),k(""),f("All"),w("All"),E(30),q(null),xe(null),ke(null),I(!1),H(null),Gr(""),Q(""),Y(""),K("count"),de(""),Ae([]),Oe(0),ne(0),ae(!1),fe(!1),Ne(""))},[e,n]),o.useEffect(()=>{if(T===null||typeof document>"u")return;const L=document.querySelector("main.app-content"),$={htmlOverscroll:document.documentElement.style.overscrollBehavior,bodyOverscroll:document.body.style.overscrollBehavior,bodyOverflow:document.body.style.overflow,scrollOverflow:L==null?void 0:L.style.overflow,scrollTouch:L==null?void 0:L.style.touchAction,scrollOverscroll:L==null?void 0:L.style.overscrollBehavior};return document.documentElement.style.overscrollBehavior="none",document.body.style.overscrollBehavior="none",document.body.style.overflow="hidden",L&&(L.style.overflow="hidden",L.style.touchAction="none",L.style.overscrollBehavior="none"),()=>{document.documentElement.style.overscrollBehavior=$.htmlOverscroll||"",document.body.style.overscrollBehavior=$.bodyOverscroll||"",document.body.style.overflow=$.bodyOverflow||"",L&&(L.style.overflow=$.scrollOverflow||"",L.style.touchAction=$.scrollTouch||"",L.style.overscrollBehavior=$.scrollOverscroll||"")}},[T]);const O=o.useMemo(()=>(Array.isArray(a)?a.filter(L=>L&&L.name):[]).map(L=>({...L,...Od(L)})),[a]),se=o.useMemo(()=>{const L=new Map;return O.forEach($=>{$!=null&&$.token&&L.set(String($.token).toLowerCase(),$)}),L},[O]),Ee=o.useMemo(()=>{const L=new Set(["All"]);return O.forEach($=>{$.category&&L.add($.category)}),Array.from(L).sort(($,ye)=>$.localeCompare(ye))},[O]),Pe=o.useMemo(()=>{const L=new Set(["All"]);return O.forEach($=>{(!h||h==="All"||$.category===h)&&$.subcategory&&L.add($.subcategory)}),Array.from(L).sort(($,ye)=>$.localeCompare(ye))},[O,h]),z=o.useMemo(()=>["All",...Ee.filter(L=>L!=="All")],[Ee]),U=o.useMemo(()=>["All",...Pe.filter(L=>L!=="All")],[Pe]),re=o.useMemo(()=>{const L=j.trim().toLowerCase();return O.filter($=>{var ye,pe,Ve,Be;return h!=="All"&&($.category||"")!==h||m!=="All"&&($.subcategory||"other")!==m?!1:L?((ye=$.token)==null?void 0:ye.toLowerCase().includes(L))||((pe=$.text)==null?void 0:pe.toLowerCase().includes(L))||((Ve=$.name)==null?void 0:Ve.toLowerCase().includes(L))||((Be=$.displayName)==null?void 0:Be.toLowerCase().includes(L)):!0}).sort(($,ye)=>{const pe=($.subcategory||"").toLowerCase(),Ve=(ye.subcategory||"").toLowerCase();return pe!==Ve?pe.localeCompare(Ve):$.token.localeCompare(ye.token)})},[O,h,m,j]),ie=o.useMemo(()=>re.slice(0,C),[re,C]);o.useEffect(()=>{E(30)},[h,m,S,O]),o.useEffect(()=>{w("All")},[h]),o.useEffect(()=>{const L=p.current;if(!L)return;const $=new IntersectionObserver(ye=>{ye[0].isIntersecting&&C<re.length&&E(Ve=>Math.min(Ve+20,re.length))},{threshold:.1});return $.observe(L),()=>$.disconnect()},[C,re.length]);const oe=o.useMemo(()=>typeof g!="string"?[]:ey(g),[g]);o.useEffect(()=>{if(!e||P!=="tags"||Te.length>0)return;let L=!1;return(async()=>{try{const $=await $d();if(L)return;Re(Array.isArray($==null?void 0:$.categories)?$.categories:[])}catch($){console.error("Failed to load tag categories",$),L||Re([])}})(),()=>{L=!0}},[e,P,Te.length]);const Ce=o.useCallback((L,$,ye,pe,Ve,Be)=>[L||"",$||"",ye||"",String(pe||0),String(Ve||0),String(Be||0)].join("::"),[]),et=o.useCallback(()=>{const L=Ue.current;if(L.size<=50)return;const $=Array.from(L.entries());$.sort((ye,pe)=>{var Ve,Be;return(((Ve=ye[1])==null?void 0:Ve.ts)||0)-(((Be=pe[1])==null?void 0:Be.ts)||0)}),$.slice(0,Math.max(0,$.length-50)).forEach(([ye])=>L.delete(ye))},[]),tt=o.useCallback(async({nextQuery:L,nextCategory:$,nextSort:ye,nextMinCount:pe}={})=>{var ks;const Ve=typeof L=="string"?L:ce,Be=typeof $=="string"?$:me,rt=typeof ye=="string"?ye:D,be=typeof pe=="number"?pe:Ye,Ke=Ce(Ve,Be,rt,be,80,0),Fn=Date.now(),Cn=Ue.current.get(Ke);if(Cn&&Fn-Cn.ts<5*60*1e3){Ae(Cn.items||[]),Oe(Number(Cn.total||0)),ne(0),Ne(""),ae(!1);return}const bl=Ie.current.get(Ke);if(bl){try{const _t=await bl;Ae((_t==null?void 0:_t.items)||[]),Oe(Number((_t==null?void 0:_t.total)||0)),ne(0),Ne("")}catch{}return}ae(!0),Ne(""),ne(0),ge.current&&ge.current.key!==Ke&&ge.current.controller.abort();const js=new AbortController;ge.current={controller:js,key:Ke};try{const _t=il({q:Ve,category:Be,sort:rt,minCount:be,limit:80,offset:0},{signal:js.signal});Ie.current.set(Ke,_t);const Kt=await _t;Ue.current.set(Ke,{items:(Kt==null?void 0:Kt.items)||[],total:Number((Kt==null?void 0:Kt.total)||0),ts:Date.now()}),et(),Ae((Kt==null?void 0:Kt.items)||[]),Oe(Number((Kt==null?void 0:Kt.total)||0))}catch(_t){if((_t==null?void 0:_t.name)==="AbortError")return;console.error("Failed to search tags",_t),Ne("Unable to load tags right now."),Ae([]),Oe(0)}finally{Ie.current.delete(Ke),((ks=ge.current)==null?void 0:ks.key)===Ke&&(ge.current=null),ae(!1)}},[Ce,me,Ye,ce,D,et]),Ht=o.useCallback(async()=>{var rt;if(Ge||ve||_e.length>=Ze)return;const L=ot+80,$=Ce(ce,me,D,Ye,80,L),ye=Date.now(),pe=Ue.current.get($);if(pe&&ye-pe.ts<5*60*1e3){Ae(be=>[...be,...pe.items||[]]),Oe(Number(pe.total||0)),ne(L),fe(!1);return}const Ve=Ie.current.get($);if(Ve){try{const be=await Ve,Ke=(be==null?void 0:be.items)||[];Ae(Fn=>[...Fn,...Ke]),Oe(Number((be==null?void 0:be.total)||0)),ne(L)}catch{}return}fe(!0),Ne(""),Fe.current&&Fe.current.key!==$&&Fe.current.controller.abort();const Be=new AbortController;Fe.current={controller:Be,key:$};try{const be=il({q:ce,category:me,sort:D,minCount:Ye,limit:80,offset:L},{signal:Be.signal});Ie.current.set($,be);const Ke=await be,Fn=(Ke==null?void 0:Ke.items)||[];Ue.current.set($,{items:Fn,total:Number((Ke==null?void 0:Ke.total)||0),ts:Date.now()}),et(),Ae(Cn=>[...Cn,...Fn]),Oe(Number((Ke==null?void 0:Ke.total)||0)),ne(L)}catch(be){if((be==null?void 0:be.name)==="AbortError")return;console.error("Failed to load more tags",be),Ne("Unable to load more tags.")}finally{Ie.current.delete($),((rt=Fe.current)==null?void 0:rt.key)===$&&(Fe.current=null),fe(!1)}},[Ce,me,Ge,ve,Ye,ot,ce,D,_e.length,Ze,et]);o.useEffect(()=>{if(!e||P!=="tags")return;const L=window.setTimeout(()=>{tt()},220);return()=>window.clearTimeout(L)},[e,P,ce,me,D,Ye,tt]),o.useEffect(()=>()=>{var L,$,ye,pe;ge.current&&(($=(L=ge.current.controller)==null?void 0:L.abort)==null||$.call(L)),Fe.current&&((pe=(ye=Fe.current.controller)==null?void 0:ye.abort)==null||pe.call(ye))},[]);const{containerRef:wn,startIndex:jt,endIndex:wt,topSpacer:ms,bottomSpacer:Xn,virtualized:en,isNearEnd:Kr}=Gd({itemCount:_e.length,enabled:e&&P==="tags",estimateRowHeight:70,overscan:8,minItems:90}),gs=en?_e.slice(jt,wt):_e;o.useEffect(()=>{if(!e||P!=="tags"||en)return;const L=ue.current;if(!L||typeof IntersectionObserver>"u")return;const $=new IntersectionObserver(ye=>{const pe=ye[0];pe!=null&&pe.isIntersecting&&Ht()},{threshold:.1});return $.observe(L),()=>$.disconnect()},[e,P,en,Ht]),o.useEffect(()=>{en&&(Ge||ve||_e.length>=Ze||Kr&&Ht())},[en,Ge,ve,_e.length,Ze,Kr,Ht]);const tn=o.useCallback(L=>{x($=>{const pe=typeof L=="function"?L(typeof $=="string"?$:""):String(L||"");return c==="page"&&(r==null||r(pe)),pe})},[r,c]),Sn=o.useCallback(L=>{const $=String(L||"").trim();if($&&(tn(ye=>{const pe=ye.length,Ve=ye.length,Be=ye.slice(0,pe),rt=ye.slice(Ve),be=Be.match(/[^\s]$/),Ke=rt.match(/^[^\s]/),Fn=be&&be[0]!==","?", ":"",Cn=Ke&&Ke[0]!==","?", ":"";return Be+Fn+$+Cn+rt}),u.current))try{u.current.blur()}catch{}},[tn]),[hr,Gr]=o.useState(""),Yr=o.useCallback(()=>{const L=String(hr||"").trim();if(!L)return;const ye=L.split(",").map(pe=>pe.trim()).filter(Boolean).join(", ");ye&&(Sn(ye),Gr(""),M("compose"))},[hr,Sn]),gl=o.useCallback(()=>{W([]),je("Cleared collected tags.")},[]),Aa=o.useCallback(()=>{if(!Ct.length){je("No tags to apply.");return}Sn(Ct.join(", ")),je(`Applied ${Ct.length} tag${Ct.length===1?"":"s"}.`),W([]),M("compose")},[Ct,Sn]),ys=o.useCallback(L=>{const $=String(L||"").trim();$&&W(ye=>{const pe=$.toLowerCase();return ye.some(Be=>Be.toLowerCase()===pe)?(je(`Removed: ${$}`),ye.filter(Be=>Be.toLowerCase()!==pe)):(je(`Selected: ${$}`),[...ye,$])})},[]),vs=o.useCallback(L=>{const $=String(L||"").trim();$&&$e(ye=>{const pe=$.toLowerCase();return ye.some(Be=>Be.toLowerCase()===pe)?(De(`Removed: ${$}`),ye.filter(Be=>Be.toLowerCase()!==pe)):(De(`Selected: ${$}`),[...ye,$])})},[]),Qr=o.useCallback(()=>{$e([]),De("Cleared selected aliases.")},[]),jn=o.useCallback(()=>{if(!ze.length){De("No aliases to apply.");return}const L=ze.map($=>`$${$}$`).join(", ");Sn(L),De(`Applied ${ze.length} alias${ze.length===1?"":"es"}.`),$e([]),M("compose")},[ze,Sn]),pt=P==="tags"?{kind:"tag",count:Ct.length,status:ee,onClear:gl,onApply:Aa}:P==="aliases"?{kind:"alias",count:ze.length,status:Qe,onClear:Qr,onApply:jn}:null,mr=(pt==null?void 0:pt.count)||0,gr=pt?`${mr} ${pt.kind==="alias"?mr===1?"alias":"aliases":mr===1?pt.kind:`${pt.kind}s`} selected`:"",at=!B&&mr>0,yr=B&&mr>0,Lt=yr?{"--composer-selection-offset":"var(--bottom-nav-height, 64px)"}:void 0,cn=pt?{label:gr,status:pt.status,onClear:pt.onClear,onApply:pt.onApply,applyLabel:"Insert",disabled:!mr}:null,un=at&&cn?l.jsx(fh,{...cn,className:"is-footer"}):null,dn=yr&&cn?l.jsx(fh,{...cn,className:"is-floating",style:Lt}):null,yl=L=>{tn($=>ty($||"",L))},ct=o.useCallback((L,$)=>{if(!(oe!=null&&oe.length))return;const ye=L+$;ye<0||ye>=oe.length||(tn(pe=>_u(pe||"",oe,L,ye)),ke(ye))},[oe,tn]),Mn=L=>{if(!L)return;let $=L.text;if(L.type==="alias"){const pe=se.get(L.text.toLowerCase());$=(pe==null?void 0:pe.displayName)||L.text}const ye=Ws(g||"",L);H({element:L,displayName:$,weight:(ye==null?void 0:ye.weight)??1}),I(!0)},vr=o.useCallback((L,$)=>{L===$||L===null||$===null||oe!=null&&oe.length&&tn(ye=>_u(ye||"",oe,L,$))},[oe,tn]),kn=o.useCallback((L,$)=>{q($),le.current=L.target,L.dataTransfer.effectAllowed="move",L.dataTransfer.setData("text/plain",$.toString()),requestAnimationFrame(()=>{le.current&&le.current.classList.add("is-dragging")})},[]),vl=o.useCallback(()=>{le.current&&le.current.classList.remove("is-dragging"),T!==null&&X!==null&&T!==X&&vr(T,X),q(null),xe(null),le.current=null},[T,X,vr]),Ra=o.useCallback((L,$)=>{L.preventDefault(),L.dataTransfer.dropEffect="move",$!==X&&xe($)},[X]),xl=o.useCallback(()=>{},[]),xs=o.useCallback((L,$)=>{var Be,rt;if(!((rt=(Be=L.target)==null?void 0:Be.closest)==null?void 0:rt.call(Be,".composer-token-drag-handle")))return;const pe=L.touches[0],Ve=window.setTimeout(()=>{R.current&&(R.current.active=!0,q($),xe($))},240);R.current={idx:$,startX:pe.clientX,startY:pe.clientY,active:!1,timer:Ve}},[]),wl=o.useCallback(L=>{if(!R.current)return;const $=L.touches[0],ye=Math.abs($.clientX-R.current.startX),pe=Math.abs($.clientY-R.current.startY);if(!R.current.active){(ye>8||pe>8)&&(window.clearTimeout(R.current.timer),R.current=null);return}L.preventDefault();const Ve=document.querySelectorAll(".composer-token-draggable"),Be=$.clientX,rt=$.clientY;for(let be=0;be<Ve.length;be++){const Ke=Ve[be].getBoundingClientRect();if(Be>=Ke.left&&Be<=Ke.right&&rt>=Ke.top&&rt<=Ke.bottom){xe(be);break}}},[]),ws=o.useCallback(()=>{var L,$;(L=R.current)!=null&&L.timer&&window.clearTimeout(R.current.timer),($=R.current)!=null&&$.active&&T!==null&&X!==null&&T!==X&&vr(T,X),R.current=null,q(null),xe(null)},[T,X,vr]),Ta=o.useCallback(()=>{var L;(L=R.current)!=null&&L.timer&&window.clearTimeout(R.current.timer),R.current=null,q(null),xe(null)},[]),Ss=()=>{r==null||r(g),t==null||t()},Sl=()=>{t==null||t()};if(!_)return null;const qr=l.jsxs("div",{className:`composer-shell ${B?"ui-card":""}`,children:[l.jsx(_n,{ariaLabel:"Composer tabs",value:P,onChange:M,items:[{key:"compose",label:"Compose",icon:l.jsx(Ro,{size:14})},{key:"aliases",label:"Aliases",icon:l.jsx(Vg,{size:14})},{key:"tags",label:"Tags",icon:l.jsx(Ao,{size:14})}]}),l.jsxs("div",{className:`composer-panel composer-panel-compose ${P==="compose"?"is-visible":""}`,children:[l.jsx("div",{className:"composer-editor",children:l.jsxs("div",{className:"composer-input-row",children:[l.jsx("input",{ref:u,type:"text",value:hr,onChange:L=>Gr(L.target.value),onKeyDown:L=>{L.key==="Enter"&&(L.preventDefault(),Yr())},className:"composer-input ui-control ui-input is-compact",placeholder:"Add prompt text","aria-label":"Add prompt text"}),l.jsx(G,{size:"icon",variant:"ghost",onClick:Yr,disabled:!hr.trim(),"aria-label":"Add prompt text",children:"+"})]})}),l.jsxs("div",{className:"composer-tokens",children:[l.jsxs("div",{className:"composer-tokens-header",children:[l.jsxs("span",{className:"composer-tokens-label",children:["Elements",l.jsx("span",{className:"composer-tokens-count",children:oe.length})]}),l.jsx("span",{className:"composer-tokens-hint",children:"Drag to reorder  Tap to adjust"})]}),oe.length?l.jsx("div",{ref:v,className:`composer-tokens-list ${T!==null?"is-dragging":""}`,style:{"--composer-elements":oe.length},children:oe.map((L,$)=>{let ye=L.text;if(L.type==="alias"){const be=se.get(L.text.toLowerCase());ye=(be==null?void 0:be.displayName)||L.text}const pe=T===$,Ve=X===$&&T!==null&&T!==$,Be=Ws(g||"",L),rt=(Be==null?void 0:Be.weight)??1;return l.jsxs("span",{className:`composer-token composer-token-draggable ${L.type==="alias"?"is-alias":"is-tag"} ${pe?"is-dragging":""} ${Ve?"is-drop-target":""} ${Le===$?"is-selected":""}`,title:L.type==="alias"?`Alias: $${L.text}$`:`Tag: ${L.text}`,role:"button",tabIndex:0,draggable:!0,onDragStart:be=>kn(be,$),onDragEnd:vl,onDragOver:be=>Ra(be,$),onDragLeave:xl,onTouchStart:be=>xs(be,$),onTouchMove:wl,onTouchEnd:ws,onTouchCancel:Ta,onClick:()=>{T===null&&(ke($),Mn(L))},onKeyDown:be=>{if(be.target===be.currentTarget&&(be.key==="Enter"||be.key===" ")){if(be.preventDefault(),T!==null)return;ke($),Mn(L)}},children:[l.jsx("span",{className:"composer-token-order",children:$+1}),l.jsx("span",{className:"composer-token-drag-handle","aria-hidden":"true",children:l.jsx(to,{size:10})}),l.jsx("span",{className:"composer-token-name",children:ye}),L.type==="alias"&&l.jsx("span",{className:"composer-token-type",children:"$"}),Math.abs(rt-1)>1e-6&&l.jsxs("span",{className:"composer-token-weight",children:[gn(rt),""]}),l.jsxs("div",{className:"composer-token-shift",role:"group","aria-label":"Reorder token",children:[l.jsx(G,{size:"mini",variant:"ghost",onClick:be=>{be.stopPropagation(),ct($,-1)},"aria-label":"Move up",disabled:$===0,children:""}),l.jsx(G,{size:"mini",variant:"ghost",onClick:be=>{be.stopPropagation(),ct($,1)},"aria-label":"Move down",disabled:$===oe.length-1,children:""})]}),l.jsx(G,{size:"mini",variant:"danger",onClick:be=>{be.stopPropagation(),yl(L)},"aria-label":`Remove ${L.text}`,children:l.jsx(Dr,{size:9})})]},`${L.type}-${L.text}-${L.start}`)})}):l.jsx("div",{className:"composer-empty",children:"No elements yet."})]}),l.jsxs("div",{className:"composer-expanded",children:[l.jsxs("div",{className:"composer-expanded-header",children:[l.jsx("span",{className:"composer-expanded-label",children:"Expanded prompt"}),l.jsx("span",{className:"composer-expanded-meta",children:qe.text?`${qe.text.length} chars`:"Empty"})]}),l.jsx("div",{className:"composer-expanded-box","aria-label":"Expanded prompt",children:qe.text?qe.parts.map((L,$)=>L.isAlias?l.jsx("span",{className:"composer-expanded-alias",children:L.text},`alias-${$}`):l.jsx("span",{children:L.text},`text-${$}`)):"No prompt yet."})]})]}),l.jsxs("div",{className:`composer-panel composer-panel-aliases ${P==="aliases"?"is-visible":""}`,children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:d,type:"text",value:S,onChange:L=>k(L.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>k(""),disabled:!S,children:"Clear"})]}),l.jsx(nt,{value:h,onChange:f,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:z.map(L=>({value:L,label:L==="All"?"Category: All":Gn(L)}))}),U.length>2&&l.jsx(nt,{value:m,onChange:w,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:U.map(L=>({value:L,label:L==="All"?"All subcategories":Tn(L)}))})]}),l.jsx("div",{className:"composer-alias-list",children:re.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[ie.map(L=>l.jsxs("button",{type:"button",onClick:()=>vs(L.token),className:`composer-alias-item ${ze.some($=>$.toLowerCase()===L.token.toLowerCase())?"is-collected":""}`,style:ph,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:L.displayName||L.token}),L.category?l.jsx("span",{className:"composer-alias-category",children:Gn(L.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",L.token,"$"]}),l.jsx("div",{className:"composer-alias-text",children:L.text})]},L.key)),C<re.length&&l.jsx("div",{ref:p,className:"composer-sentinel"})]})})]}),l.jsxs("div",{className:`composer-panel composer-panel-tags ${P==="tags"?"is-visible":""}`,onClick:L=>L.stopPropagation(),children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:J,type:"search",value:ce,onChange:L=>Q(L.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(G,{size:"xs",variant:"ghost",onClick:()=>Q(""),disabled:!ce,children:"Clear"})]}),l.jsx(nt,{value:me,onChange:Y,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...Te.map(L=>({value:L.key,label:`${Tn(L.key)} (${Number(L.actual||L.count||0).toLocaleString()})`}))]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(nt,{value:D,onChange:K,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"composer-min-count",children:"Minimum count"}),l.jsx("input",{id:"composer-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:we,onChange:L=>{const $=L.target.value;($===""||Number($)>=0)&&de($)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),F?l.jsx("div",{className:"composer-tags-error",children:F}):null,l.jsx("div",{className:"composer-alias-list composer-tags-grid",role:"list",ref:wn,children:Ge?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):_e.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[en&&ms>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${ms}px`}}):null,gs.map(L=>l.jsx(ky,{tag:L.tag,category:L.category,count:L.count,isCollected:Ct.some($=>$.toLowerCase()===String(L.tag||"").toLowerCase()),onToggle:ys,visibilityStyle:ph},`${L.tag}-${L.category}`)),en&&Xn>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Xn}px`}}):null,_e.length<Ze&&!en?l.jsx("div",{ref:ue,className:"composer-sentinel"}):null,ve?l.jsx("div",{className:"composer-alias-empty",children:"Loading more"}):null]})})]})]}),Nn=l.jsx(lo,{open:b,onClose:()=>I(!1),title:((kl=A==null?void 0:A.element)==null?void 0:kl.type)==="alias"?"Alias strength":"Tag strength",tokenLabel:A?((Nl=A.element)==null?void 0:Nl.type)==="alias"?`${A.displayName}  $${(Cl=A.element)==null?void 0:Cl.text}$`:A.displayName:"",weight:(A==null?void 0:A.weight)??1,onApply:L=>{A!=null&&A.element&&tn($=>zu($||"",A.element,L))},onRemoveWeight:()=>{A!=null&&A.element&&tn(L=>zu(L||"",A.element,null))},onDeleteToken:()=>{A!=null&&A.element&&yl(A.element)}}),jl=l.jsx("div",{className:"page-bar composer-bar",children:l.jsx("h1",{className:"page-bar-title",children:i||"Prompt"})});return B?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"page-shell page-stack",children:[jl,qr]}),dn,Nn]}):l.jsxs(l.Fragment,{children:[l.jsx(Ft,{open:e,onClose:Sl,title:"Composer",variant:"fullscreen",shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,footer:l.jsxs("div",{className:"composer-footer-stack",children:[un,l.jsxs("div",{className:"flex gap-2",children:[l.jsx(G,{variant:"muted",className:"w-full",onClick:Sl,children:"Cancel"}),l.jsx(G,{variant:"primary",className:"w-full",onClick:Ss,children:"Apply"})]})]}),children:qr}),Nn]})}function Tj(){const e=pr(),[t]=Ad(),{formData:n,handleFormChange:r,aliasOptions:s,aliasCatalog:a,promptFieldName:i,handleGenerate:c,workflowData:u,selectedWorkflow:d,isLoading:p}=Kd(),g=t.get("field")||i||"prompt",x=(n==null?void 0:n[g])||"";return o.useEffect(()=>{if(!(typeof document>"u"))return document.body.classList.add("no-pull-refresh"),document.documentElement.classList.add("no-pull-refresh"),()=>{document.body.classList.remove("no-pull-refresh"),document.documentElement.classList.remove("no-pull-refresh")}},[]),o.useEffect(()=>{const S=()=>{!u||!d||p||c()};return window.addEventListener("cozygen:request-render",S),()=>window.removeEventListener("cozygen:request-render",S)},[c,p,d,u]),l.jsx(Rj,{open:!0,onClose:()=>e("/controls"),value:x,onChange:S=>r(g,S),aliasOptions:s,aliasCatalog:a,fieldLabel:g,variant:"page"})}function Ij(){var h,f;const{authed:e,ready:t,login:n}=_o(),r=pr(),a=((f=(h=Zt().state)==null?void 0:h.from)==null?void 0:f.pathname)||"/studio",[i,c]=o.useState(""),[u,d]=o.useState(""),[p,v]=o.useState(""),[g,x]=o.useState(!1),[S,k]=o.useState(!1);o.useEffect(()=>{try{localStorage.getItem("cozygen_idle_logout")&&(k(!0),localStorage.removeItem("cozygen_idle_logout"))}catch{}},[]),o.useEffect(()=>{t&&e&&r(a,{replace:!0})},[t,e,a,r]);const j=async m=>{m.preventDefault(),v(""),x(!0);try{await n(i,u),r(a,{replace:!0})}catch(w){w!=null&&w.unauthorized?v("Invalid username or password."):v("Unable to sign in. Please try again.")}finally{x(!1)}};return l.jsx("div",{className:"login-shell",children:l.jsxs("div",{className:"ui-card w-full max-w-[420px] p-6 sm:p-7",children:[l.jsxs("div",{className:"login-brand",children:[l.jsx(Ug,{size:34}),l.jsxs("div",{className:"min-w-0",children:[l.jsx("div",{className:"login-title",children:"Sign in"}),l.jsx("div",{className:"login-subtitle",children:"Continue to CozyGen Studio"})]})]}),l.jsxs("form",{className:"login-form",onSubmit:j,children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"login-username",className:"login-label",children:"Username"}),l.jsx("input",{id:"login-username",type:"text",className:"ui-control ui-input",value:i,onChange:m=>c(m.target.value),autoComplete:"username",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"login-password",className:"login-label",children:"Password"}),l.jsx("input",{id:"login-password",type:"password",className:"ui-control ui-input",value:u,onChange:m=>d(m.target.value),autoComplete:"current-password",required:!0})]}),p?l.jsx("div",{className:"ui-alert",children:p}):S?l.jsx("div",{className:"ui-alert is-warn",children:"You were signed out due to inactivity. Please sign in again."}):null,l.jsx(G,{type:"submit",disabled:g,variant:"primary",className:"w-full",children:g?"Signing in":"Sign in"})]}),l.jsxs("p",{className:"login-footnote",children:["Access is protected by CozyGen auth. Set ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_USER"})," /"," ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_PASS"})," on the server to enable."]})]})})}function $j({containerRef:e}){const{pathname:t,hash:n}=Zt();return o.useEffect(()=>{if(n)return;const r=e==null?void 0:e.current;if(r&&typeof r.scrollTo=="function"){r.scrollTo({top:0,left:0,behavior:"auto"});return}typeof window<"u"&&window.scrollTo(0,0)},[t,n,e]),null}function Mj({children:e}){const{authed:t,ready:n}=_o(),r=Zt();return n?t?e:l.jsx(Xi,{to:"/login",state:{from:r},replace:!0}):l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 text-slate-200",children:l.jsxs("div",{className:"page-loading",children:[l.jsx("span",{className:"loading-spinner lg","aria-hidden":"true"}),l.jsx("span",{className:"sr-only",children:"Checking session"})]})})}function hh({tab:e}){const t=Zt(),n=new URLSearchParams(t.search||"");n.set("tab",e);const r=n.toString();return l.jsx(Xi,{to:`/library?${r}`,replace:!0})}function Fj(){const{pathname:e}=Zt(),t=pr(),{defaultCreds:n,authed:r}=_o(),s=e==="/login",a=o.useRef(null),i=!s;return o.useEffect(()=>{if(!r)return;const c=u=>{var v;const d=String(((v=u==null?void 0:u.detail)==null?void 0:v.fieldName)||"").trim(),p=d?`?field=${encodeURIComponent(d)}`:"";t(`/compose${p}`)};return window.addEventListener("cozygen:open-composer",c),()=>window.removeEventListener("cozygen:open-composer",c)},[r,t]),l.jsxs("div",{className:"app-shell",children:[!s&&l.jsx(fS,{}),!s&&r&&n&&l.jsxs("div",{className:"flex-shrink-0 bg-amber-500/10 text-amber-200 border-b border-amber-400/50 px-4 py-2 text-sm text-center",children:["Default CozyGen credentials are still in use. Change ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_USER"})," /",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_PASS"})," on the server."]}),l.jsx($j,{containerRef:a}),l.jsxs("div",{className:"app-body",children:[l.jsx("main",{ref:a,className:s?"app-content is-login":"app-content",children:l.jsxs(L0,{children:[l.jsx(fn,{path:"/login",element:l.jsx(Ij,{})}),l.jsxs(fn,{element:l.jsx(Mj,{children:l.jsx(q1,{children:l.jsx(b0,{})})}),children:[l.jsx(fn,{path:"/",element:l.jsx(Xi,{to:"/studio",replace:!0})}),l.jsx(fn,{path:"/studio",element:l.jsx(J1,{})}),l.jsx(fn,{path:"/controls",element:l.jsx(X1,{})}),l.jsx(fn,{path:"/compose",element:l.jsx(Tj,{})}),l.jsx(fn,{path:"/gallery",element:l.jsx(gj,{})}),l.jsx(fn,{path:"/library",element:l.jsx(Aj,{})}),l.jsx(fn,{path:"/aliases",element:l.jsx(hh,{tab:"aliases"})}),l.jsx(fn,{path:"/tags",element:l.jsx(hh,{tab:"tags"})})]}),l.jsx(fn,{path:"*",element:l.jsx(Xi,{to:"/studio",replace:!0})})]})}),i?l.jsx(vS,{}):null]})]})}function Oj(){return l.jsx(M0,{children:l.jsx(lS,{children:l.jsx(Fj,{})})})}Cc.createRoot(document.getElementById("root")).render(l.jsx(Kl.StrictMode,{children:l.jsx(Oj,{})}));

function $v(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in e)){const a=Object.getOwnPropertyDescriptor(r,s);a&&Object.defineProperty(e,s,a.get?a:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function Mv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Zm={exports:{}},Ro={},eh={exports:{}},Qe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Da=Symbol.for("react.element"),Fv=Symbol.for("react.portal"),Ov=Symbol.for("react.fragment"),Dv=Symbol.for("react.strict_mode"),Bv=Symbol.for("react.profiler"),Uv=Symbol.for("react.provider"),Vv=Symbol.for("react.context"),Wv=Symbol.for("react.forward_ref"),Hv=Symbol.for("react.suspense"),Kv=Symbol.for("react.memo"),Gv=Symbol.for("react.lazy"),Jf=Symbol.iterator;function Yv(e){return e===null||typeof e!="object"?null:(e=Jf&&e[Jf]||e["@@iterator"],typeof e=="function"?e:null)}var th={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},nh=Object.assign,rh={};function zl(e,t,n){this.props=e,this.context=t,this.refs=rh,this.updater=n||th}zl.prototype.isReactComponent={};zl.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};zl.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function sh(){}sh.prototype=zl.prototype;function id(e,t,n){this.props=e,this.context=t,this.refs=rh,this.updater=n||th}var od=id.prototype=new sh;od.constructor=id;nh(od,zl.prototype);od.isPureReactComponent=!0;var Zf=Array.isArray,lh=Object.prototype.hasOwnProperty,cd={current:null},ah={key:!0,ref:!0,__self:!0,__source:!0};function ih(e,t,n){var r,s={},a=null,i=null;if(t!=null)for(r in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(a=""+t.key),t)lh.call(t,r)&&!ah.hasOwnProperty(r)&&(s[r]=t[r]);var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];s.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps,c)s[r]===void 0&&(s[r]=c[r]);return{$$typeof:Da,type:e,key:a,ref:i,props:s,_owner:cd.current}}function Qv(e,t){return{$$typeof:Da,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ud(e){return typeof e=="object"&&e!==null&&e.$$typeof===Da}function qv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var ep=/\/+/g;function yc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?qv(""+e.key):t.toString(36)}function Ti(e,t,n,r,s){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(a){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case Da:case Fv:i=!0}}if(i)return i=e,s=s(i),e=r===""?"."+yc(i,0):r,Zf(s)?(n="",e!=null&&(n=e.replace(ep,"$&/")+"/"),Ti(s,t,n,"",function(d){return d})):s!=null&&(ud(s)&&(s=Qv(s,n+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(ep,"$&/")+"/")+e)),t.push(s)),1;if(i=0,r=r===""?".":r+":",Zf(e))for(var c=0;c<e.length;c++){a=e[c];var u=r+yc(a,c);i+=Ti(a,t,n,u,s)}else if(u=Yv(e),typeof u=="function")for(e=u.call(e),c=0;!(a=e.next()).done;)a=a.value,u=r+yc(a,c++),i+=Ti(a,t,n,u,s);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function di(e,t,n){if(e==null)return e;var r=[],s=0;return Ti(e,r,"","",function(a){return t.call(n,a,s++)}),r}function Xv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var on={current:null},Ri={transition:null},Jv={ReactCurrentDispatcher:on,ReactCurrentBatchConfig:Ri,ReactCurrentOwner:cd};function oh(){throw Error("act(...) is not supported in production builds of React.")}Qe.Children={map:di,forEach:function(e,t,n){di(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return di(e,function(){t++}),t},toArray:function(e){return di(e,function(t){return t})||[]},only:function(e){if(!ud(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Qe.Component=zl;Qe.Fragment=Ov;Qe.Profiler=Bv;Qe.PureComponent=id;Qe.StrictMode=Dv;Qe.Suspense=Hv;Qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jv;Qe.act=oh;Qe.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=nh({},e.props),s=e.key,a=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,i=cd.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)lh.call(t,u)&&!ah.hasOwnProperty(u)&&(r[u]=t[u]===void 0&&c!==void 0?c[u]:t[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:Da,type:e.type,key:s,ref:a,props:r,_owner:i}};Qe.createContext=function(e){return e={$$typeof:Vv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Uv,_context:e},e.Consumer=e};Qe.createElement=ih;Qe.createFactory=function(e){var t=ih.bind(null,e);return t.type=e,t};Qe.createRef=function(){return{current:null}};Qe.forwardRef=function(e){return{$$typeof:Wv,render:e}};Qe.isValidElement=ud;Qe.lazy=function(e){return{$$typeof:Gv,_payload:{_status:-1,_result:e},_init:Xv}};Qe.memo=function(e,t){return{$$typeof:Kv,type:e,compare:t===void 0?null:t}};Qe.startTransition=function(e){var t=Ri.transition;Ri.transition={};try{e()}finally{Ri.transition=t}};Qe.unstable_act=oh;Qe.useCallback=function(e,t){return on.current.useCallback(e,t)};Qe.useContext=function(e){return on.current.useContext(e)};Qe.useDebugValue=function(){};Qe.useDeferredValue=function(e){return on.current.useDeferredValue(e)};Qe.useEffect=function(e,t){return on.current.useEffect(e,t)};Qe.useId=function(){return on.current.useId()};Qe.useImperativeHandle=function(e,t,n){return on.current.useImperativeHandle(e,t,n)};Qe.useInsertionEffect=function(e,t){return on.current.useInsertionEffect(e,t)};Qe.useLayoutEffect=function(e,t){return on.current.useLayoutEffect(e,t)};Qe.useMemo=function(e,t){return on.current.useMemo(e,t)};Qe.useReducer=function(e,t,n){return on.current.useReducer(e,t,n)};Qe.useRef=function(e){return on.current.useRef(e)};Qe.useState=function(e){return on.current.useState(e)};Qe.useSyncExternalStore=function(e,t,n){return on.current.useSyncExternalStore(e,t,n)};Qe.useTransition=function(){return on.current.useTransition()};Qe.version="18.3.1";eh.exports=Qe;var o=eh.exports;const aa=Mv(o),Zv=$v({__proto__:null,default:aa},[o]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ex=o,tx=Symbol.for("react.element"),nx=Symbol.for("react.fragment"),rx=Object.prototype.hasOwnProperty,sx=ex.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lx={key:!0,ref:!0,__self:!0,__source:!0};function ch(e,t,n){var r,s={},a=null,i=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(i=t.ref);for(r in t)rx.call(t,r)&&!lx.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)s[r]===void 0&&(s[r]=t[r]);return{$$typeof:tx,type:e,key:a,ref:i,props:s,_owner:sx.current}}Ro.Fragment=nx;Ro.jsx=ch;Ro.jsxs=ch;Zm.exports=Ro;var l=Zm.exports,Xc={},uh={exports:{}},Nn={},dh={exports:{}},fh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(R,P){var M=R.length;R.push(P);e:for(;0<M;){var L=M-1>>>1,W=R[L];if(0<s(W,P))R[L]=P,R[M]=W,M=L;else break e}}function n(R){return R.length===0?null:R[0]}function r(R){if(R.length===0)return null;var P=R[0],M=R.pop();if(M!==P){R[0]=M;e:for(var L=0,W=R.length,q=W>>>1;L<q;){var de=2*(L+1)-1,fe=R[de],ne=de+1,xe=R[ne];if(0>s(fe,M))ne<W&&0>s(xe,fe)?(R[L]=xe,R[ne]=M,L=ne):(R[L]=fe,R[de]=M,L=de);else if(ne<W&&0>s(xe,M))R[L]=xe,R[ne]=M,L=ne;else break e}}return P}function s(R,P){var M=R.sortIndex-P.sortIndex;return M!==0?M:R.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var i=Date,c=i.now();e.unstable_now=function(){return i.now()-c}}var u=[],d=[],h=1,v=null,y=3,x=!1,k=!1,N=!1,j=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(R){for(var P=n(d);P!==null;){if(P.callback===null)r(d);else if(P.startTime<=R)r(d),P.sortIndex=P.expirationTime,t(u,P);else break;P=n(d)}}function w(R){if(N=!1,g(R),!k)if(n(u)!==null)k=!0,me(b);else{var P=n(d);P!==null&&oe(w,P.startTime-R)}}function b(R,P){k=!1,N&&(N=!1,m(I),I=-1),x=!0;var M=y;try{for(g(P),v=n(u);v!==null&&(!(v.expirationTime>P)||R&&!$());){var L=v.callback;if(typeof L=="function"){v.callback=null,y=v.priorityLevel;var W=L(v.expirationTime<=P);P=e.unstable_now(),typeof W=="function"?v.callback=W:v===n(u)&&r(u),g(P)}else r(u);v=n(u)}if(v!==null)var q=!0;else{var de=n(d);de!==null&&oe(w,de.startTime-P),q=!1}return q}finally{v=null,y=M,x=!1}}var E=!1,A=null,I=-1,B=5,T=-1;function $(){return!(e.unstable_now()-T<B)}function ee(){if(A!==null){var R=e.unstable_now();T=R;var P=!0;try{P=A(!0,R)}finally{P?Z():(E=!1,A=null)}}else E=!1}var Z;if(typeof p=="function")Z=function(){p(ee)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,Ce=le.port2;le.port1.onmessage=ee,Z=function(){Ce.postMessage(null)}}else Z=function(){j(ee,0)};function me(R){A=R,E||(E=!0,Z())}function oe(R,P){I=j(function(){R(e.unstable_now())},P)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(R){R.callback=null},e.unstable_continueExecution=function(){k||x||(k=!0,me(b))},e.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<R?Math.floor(1e3/R):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(R){switch(y){case 1:case 2:case 3:var P=3;break;default:P=y}var M=y;y=P;try{return R()}finally{y=M}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(R,P){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var M=y;y=R;try{return P()}finally{y=M}},e.unstable_scheduleCallback=function(R,P,M){var L=e.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?L+M:L):M=L,R){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=M+W,R={id:h++,callback:P,priorityLevel:R,startTime:M,expirationTime:W,sortIndex:-1},M>L?(R.sortIndex=M,t(d,R),n(u)===null&&R===n(d)&&(N?(m(I),I=-1):N=!0,oe(w,M-L))):(R.sortIndex=W,t(u,R),k||x||(k=!0,me(b))),R},e.unstable_shouldYield=$,e.unstable_wrapCallback=function(R){var P=y;return function(){var M=y;y=P;try{return R.apply(this,arguments)}finally{y=M}}}})(fh);dh.exports=fh;var ax=dh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ix=o,jn=ax;function se(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ph=new Set,va={};function Os(e,t){kl(e,t),kl(e+"Capture",t)}function kl(e,t){for(va[e]=t,e=0;e<t.length;e++)ph.add(t[e])}var Lr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jc=Object.prototype.hasOwnProperty,ox=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tp={},np={};function cx(e){return Jc.call(np,e)?!0:Jc.call(tp,e)?!1:ox.test(e)?np[e]=!0:(tp[e]=!0,!1)}function ux(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function dx(e,t,n,r){if(t===null||typeof t>"u"||ux(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function cn(e,t,n,r,s,a,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var Ht={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ht[e]=new cn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ht[t]=new cn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ht[e]=new cn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ht[e]=new cn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ht[e]=new cn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ht[e]=new cn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ht[e]=new cn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ht[e]=new cn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ht[e]=new cn(e,5,!1,e.toLowerCase(),null,!1,!1)});var dd=/[\-:]([a-z])/g;function fd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(dd,fd);Ht[t]=new cn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(dd,fd);Ht[t]=new cn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(dd,fd);Ht[t]=new cn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ht[e]=new cn(e,1,!1,e.toLowerCase(),null,!1,!1)});Ht.xlinkHref=new cn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ht[e]=new cn(e,1,!1,e.toLowerCase(),null,!0,!0)});function pd(e,t,n,r){var s=Ht.hasOwnProperty(t)?Ht[t]:null;(s!==null?s.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(dx(t,n,s,r)&&(n=null),r||s===null?cx(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=n===null?s.type===3?!1:"":n:(t=s.attributeName,r=s.attributeNamespace,n===null?e.removeAttribute(t):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var _r=ix.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,fi=Symbol.for("react.element"),el=Symbol.for("react.portal"),tl=Symbol.for("react.fragment"),md=Symbol.for("react.strict_mode"),Zc=Symbol.for("react.profiler"),mh=Symbol.for("react.provider"),hh=Symbol.for("react.context"),hd=Symbol.for("react.forward_ref"),eu=Symbol.for("react.suspense"),tu=Symbol.for("react.suspense_list"),gd=Symbol.for("react.memo"),Vr=Symbol.for("react.lazy"),gh=Symbol.for("react.offscreen"),rp=Symbol.iterator;function Gl(e){return e===null||typeof e!="object"?null:(e=rp&&e[rp]||e["@@iterator"],typeof e=="function"?e:null)}var kt=Object.assign,vc;function ta(e){if(vc===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);vc=t&&t[1]||""}return`
`+vc+e}var xc=!1;function wc(e,t){if(!e||xc)return"";xc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),a=r.stack.split(`
`),i=s.length-1,c=a.length-1;1<=i&&0<=c&&s[i]!==a[c];)c--;for(;1<=i&&0<=c;i--,c--)if(s[i]!==a[c]){if(i!==1||c!==1)do if(i--,c--,0>c||s[i]!==a[c]){var u=`
`+s[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=i&&0<=c);break}}}finally{xc=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?ta(e):""}function fx(e){switch(e.tag){case 5:return ta(e.type);case 16:return ta("Lazy");case 13:return ta("Suspense");case 19:return ta("SuspenseList");case 0:case 2:case 15:return e=wc(e.type,!1),e;case 11:return e=wc(e.type.render,!1),e;case 1:return e=wc(e.type,!0),e;default:return""}}function nu(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case tl:return"Fragment";case el:return"Portal";case Zc:return"Profiler";case md:return"StrictMode";case eu:return"Suspense";case tu:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case hh:return(e.displayName||"Context")+".Consumer";case mh:return(e._context.displayName||"Context")+".Provider";case hd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case gd:return t=e.displayName||null,t!==null?t:nu(e.type)||"Memo";case Vr:t=e._payload,e=e._init;try{return nu(e(t))}catch{}}return null}function px(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return nu(t);case 8:return t===md?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function as(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function yh(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function mx(e){var t=yh(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(i){r=""+i,a.call(this,i)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(i){r=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function pi(e){e._valueTracker||(e._valueTracker=mx(e))}function vh(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=yh(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Gi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ru(e,t){var n=t.checked;return kt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function sp(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=as(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function xh(e,t){t=t.checked,t!=null&&pd(e,"checked",t,!1)}function su(e,t){xh(e,t);var n=as(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?lu(e,t.type,n):t.hasOwnProperty("defaultValue")&&lu(e,t.type,as(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function lp(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function lu(e,t,n){(t!=="number"||Gi(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var na=Array.isArray;function hl(e,t,n,r){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&r&&(e[n].defaultSelected=!0)}else{for(n=""+as(n),t=null,s=0;s<e.length;s++){if(e[s].value===n){e[s].selected=!0,r&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function au(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(se(91));return kt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ap(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(se(92));if(na(n)){if(1<n.length)throw Error(se(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:as(n)}}function wh(e,t){var n=as(t.value),r=as(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function ip(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Sh(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function iu(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Sh(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mi,kh=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,s){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(mi=mi||document.createElement("div"),mi.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=mi.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function xa(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var ia={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hx=["Webkit","ms","Moz","O"];Object.keys(ia).forEach(function(e){hx.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ia[t]=ia[e]})});function jh(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||ia.hasOwnProperty(e)&&ia[e]?(""+t).trim():t+"px"}function Nh(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=jh(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,s):e[n]=s}}var gx=kt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ou(e,t){if(t){if(gx[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(se(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(se(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(se(61))}if(t.style!=null&&typeof t.style!="object")throw Error(se(62))}}function cu(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uu=null;function yd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var du=null,gl=null,yl=null;function op(e){if(e=Va(e)){if(typeof du!="function")throw Error(se(280));var t=e.stateNode;t&&(t=Oo(t),du(e.stateNode,e.type,t))}}function Ch(e){gl?yl?yl.push(e):yl=[e]:gl=e}function bh(){if(gl){var e=gl,t=yl;if(yl=gl=null,op(e),t)for(e=0;e<t.length;e++)op(t[e])}}function Eh(e,t){return e(t)}function Lh(){}var Sc=!1;function Ah(e,t,n){if(Sc)return e(t,n);Sc=!0;try{return Eh(e,t,n)}finally{Sc=!1,(gl!==null||yl!==null)&&(Lh(),bh())}}function wa(e,t){var n=e.stateNode;if(n===null)return null;var r=Oo(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(se(231,t,typeof n));return n}var fu=!1;if(Lr)try{var Yl={};Object.defineProperty(Yl,"passive",{get:function(){fu=!0}}),window.addEventListener("test",Yl,Yl),window.removeEventListener("test",Yl,Yl)}catch{fu=!1}function yx(e,t,n,r,s,a,i,c,u){var d=Array.prototype.slice.call(arguments,3);try{t.apply(n,d)}catch(h){this.onError(h)}}var oa=!1,Yi=null,Qi=!1,pu=null,vx={onError:function(e){oa=!0,Yi=e}};function xx(e,t,n,r,s,a,i,c,u){oa=!1,Yi=null,yx.apply(vx,arguments)}function wx(e,t,n,r,s,a,i,c,u){if(xx.apply(this,arguments),oa){if(oa){var d=Yi;oa=!1,Yi=null}else throw Error(se(198));Qi||(Qi=!0,pu=d)}}function Ds(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Ph(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function cp(e){if(Ds(e)!==e)throw Error(se(188))}function Sx(e){var t=e.alternate;if(!t){if(t=Ds(e),t===null)throw Error(se(188));return t!==e?null:e}for(var n=e,r=t;;){var s=n.return;if(s===null)break;var a=s.alternate;if(a===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return cp(s),e;if(a===r)return cp(s),t;a=a.sibling}throw Error(se(188))}if(n.return!==r.return)n=s,r=a;else{for(var i=!1,c=s.child;c;){if(c===n){i=!0,n=s,r=a;break}if(c===r){i=!0,r=s,n=a;break}c=c.sibling}if(!i){for(c=a.child;c;){if(c===n){i=!0,n=a,r=s;break}if(c===r){i=!0,r=a,n=s;break}c=c.sibling}if(!i)throw Error(se(189))}}if(n.alternate!==r)throw Error(se(190))}if(n.tag!==3)throw Error(se(188));return n.stateNode.current===n?e:t}function zh(e){return e=Sx(e),e!==null?_h(e):null}function _h(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=_h(e);if(t!==null)return t;e=e.sibling}return null}var Th=jn.unstable_scheduleCallback,up=jn.unstable_cancelCallback,kx=jn.unstable_shouldYield,jx=jn.unstable_requestPaint,Lt=jn.unstable_now,Nx=jn.unstable_getCurrentPriorityLevel,vd=jn.unstable_ImmediatePriority,Rh=jn.unstable_UserBlockingPriority,qi=jn.unstable_NormalPriority,Cx=jn.unstable_LowPriority,Ih=jn.unstable_IdlePriority,Io=null,ur=null;function bx(e){if(ur&&typeof ur.onCommitFiberRoot=="function")try{ur.onCommitFiberRoot(Io,e,void 0,(e.current.flags&128)===128)}catch{}}var Vn=Math.clz32?Math.clz32:Ax,Ex=Math.log,Lx=Math.LN2;function Ax(e){return e>>>=0,e===0?32:31-(Ex(e)/Lx|0)|0}var hi=64,gi=4194304;function ra(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Xi(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,s=e.suspendedLanes,a=e.pingedLanes,i=n&268435455;if(i!==0){var c=i&~s;c!==0?r=ra(c):(a&=i,a!==0&&(r=ra(a)))}else i=n&~s,i!==0?r=ra(i):a!==0&&(r=ra(a));if(r===0)return 0;if(t!==0&&t!==r&&!(t&s)&&(s=r&-r,a=t&-t,s>=a||s===16&&(a&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Vn(t),s=1<<n,r|=e[n],t&=~s;return r}function Px(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zx(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,s=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-Vn(a),c=1<<i,u=s[i];u===-1?(!(c&n)||c&r)&&(s[i]=Px(c,t)):u<=t&&(e.expiredLanes|=c),a&=~c}}function mu(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function $h(){var e=hi;return hi<<=1,!(hi&4194240)&&(hi=64),e}function kc(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ba(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Vn(t),e[t]=n}function _x(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-Vn(n),a=1<<s;t[s]=0,r[s]=-1,e[s]=-1,n&=~a}}function xd(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Vn(n),s=1<<r;s&t|e[r]&t&&(e[r]|=t),n&=~s}}var it=0;function Mh(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Fh,wd,Oh,Dh,Bh,hu=!1,yi=[],Xr=null,Jr=null,Zr=null,Sa=new Map,ka=new Map,Hr=[],Tx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dp(e,t){switch(e){case"focusin":case"focusout":Xr=null;break;case"dragenter":case"dragleave":Jr=null;break;case"mouseover":case"mouseout":Zr=null;break;case"pointerover":case"pointerout":Sa.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ka.delete(t.pointerId)}}function Ql(e,t,n,r,s,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[s]},t!==null&&(t=Va(t),t!==null&&wd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function Rx(e,t,n,r,s){switch(t){case"focusin":return Xr=Ql(Xr,e,t,n,r,s),!0;case"dragenter":return Jr=Ql(Jr,e,t,n,r,s),!0;case"mouseover":return Zr=Ql(Zr,e,t,n,r,s),!0;case"pointerover":var a=s.pointerId;return Sa.set(a,Ql(Sa.get(a)||null,e,t,n,r,s)),!0;case"gotpointercapture":return a=s.pointerId,ka.set(a,Ql(ka.get(a)||null,e,t,n,r,s)),!0}return!1}function Uh(e){var t=As(e.target);if(t!==null){var n=Ds(t);if(n!==null){if(t=n.tag,t===13){if(t=Ph(n),t!==null){e.blockedOn=t,Bh(e.priority,function(){Oh(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ii(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=gu(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);uu=r,n.target.dispatchEvent(r),uu=null}else return t=Va(n),t!==null&&wd(t),e.blockedOn=n,!1;t.shift()}return!0}function fp(e,t,n){Ii(e)&&n.delete(t)}function Ix(){hu=!1,Xr!==null&&Ii(Xr)&&(Xr=null),Jr!==null&&Ii(Jr)&&(Jr=null),Zr!==null&&Ii(Zr)&&(Zr=null),Sa.forEach(fp),ka.forEach(fp)}function ql(e,t){e.blockedOn===t&&(e.blockedOn=null,hu||(hu=!0,jn.unstable_scheduleCallback(jn.unstable_NormalPriority,Ix)))}function ja(e){function t(s){return ql(s,e)}if(0<yi.length){ql(yi[0],e);for(var n=1;n<yi.length;n++){var r=yi[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Xr!==null&&ql(Xr,e),Jr!==null&&ql(Jr,e),Zr!==null&&ql(Zr,e),Sa.forEach(t),ka.forEach(t),n=0;n<Hr.length;n++)r=Hr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Hr.length&&(n=Hr[0],n.blockedOn===null);)Uh(n),n.blockedOn===null&&Hr.shift()}var vl=_r.ReactCurrentBatchConfig,Ji=!0;function $x(e,t,n,r){var s=it,a=vl.transition;vl.transition=null;try{it=1,Sd(e,t,n,r)}finally{it=s,vl.transition=a}}function Mx(e,t,n,r){var s=it,a=vl.transition;vl.transition=null;try{it=4,Sd(e,t,n,r)}finally{it=s,vl.transition=a}}function Sd(e,t,n,r){if(Ji){var s=gu(e,t,n,r);if(s===null)_c(e,t,r,Zi,n),dp(e,r);else if(Rx(s,e,t,n,r))r.stopPropagation();else if(dp(e,r),t&4&&-1<Tx.indexOf(e)){for(;s!==null;){var a=Va(s);if(a!==null&&Fh(a),a=gu(e,t,n,r),a===null&&_c(e,t,r,Zi,n),a===s)break;s=a}s!==null&&r.stopPropagation()}else _c(e,t,r,null,n)}}var Zi=null;function gu(e,t,n,r){if(Zi=null,e=yd(r),e=As(e),e!==null)if(t=Ds(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Ph(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zi=e,null}function Vh(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Nx()){case vd:return 1;case Rh:return 4;case qi:case Cx:return 16;case Ih:return 536870912;default:return 16}default:return 16}}var Yr=null,kd=null,$i=null;function Wh(){if($i)return $i;var e,t=kd,n=t.length,r,s="value"in Yr?Yr.value:Yr.textContent,a=s.length;for(e=0;e<n&&t[e]===s[e];e++);var i=n-e;for(r=1;r<=i&&t[n-r]===s[a-r];r++);return $i=s.slice(e,1<r?1-r:void 0)}function Mi(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function vi(){return!0}function pp(){return!1}function Cn(e){function t(n,r,s,a,i){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=a,this.target=i,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(n=e[c],this[c]=n?n(a):a[c]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?vi:pp,this.isPropagationStopped=pp,this}return kt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=vi)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=vi)},persist:function(){},isPersistent:vi}),t}var _l={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jd=Cn(_l),Ua=kt({},_l,{view:0,detail:0}),Fx=Cn(Ua),jc,Nc,Xl,$o=kt({},Ua,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Xl&&(Xl&&e.type==="mousemove"?(jc=e.screenX-Xl.screenX,Nc=e.screenY-Xl.screenY):Nc=jc=0,Xl=e),jc)},movementY:function(e){return"movementY"in e?e.movementY:Nc}}),mp=Cn($o),Ox=kt({},$o,{dataTransfer:0}),Dx=Cn(Ox),Bx=kt({},Ua,{relatedTarget:0}),Cc=Cn(Bx),Ux=kt({},_l,{animationName:0,elapsedTime:0,pseudoElement:0}),Vx=Cn(Ux),Wx=kt({},_l,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Hx=Cn(Wx),Kx=kt({},_l,{data:0}),hp=Cn(Kx),Gx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Yx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qx(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Qx[e])?!!t[e]:!1}function Nd(){return qx}var Xx=kt({},Ua,{key:function(e){if(e.key){var t=Gx[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Mi(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Yx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nd,charCode:function(e){return e.type==="keypress"?Mi(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Mi(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Jx=Cn(Xx),Zx=kt({},$o,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gp=Cn(Zx),ew=kt({},Ua,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nd}),tw=Cn(ew),nw=kt({},_l,{propertyName:0,elapsedTime:0,pseudoElement:0}),rw=Cn(nw),sw=kt({},$o,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),lw=Cn(sw),aw=[9,13,27,32],Cd=Lr&&"CompositionEvent"in window,ca=null;Lr&&"documentMode"in document&&(ca=document.documentMode);var iw=Lr&&"TextEvent"in window&&!ca,Hh=Lr&&(!Cd||ca&&8<ca&&11>=ca),yp=" ",vp=!1;function Kh(e,t){switch(e){case"keyup":return aw.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gh(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var nl=!1;function ow(e,t){switch(e){case"compositionend":return Gh(t);case"keypress":return t.which!==32?null:(vp=!0,yp);case"textInput":return e=t.data,e===yp&&vp?null:e;default:return null}}function cw(e,t){if(nl)return e==="compositionend"||!Cd&&Kh(e,t)?(e=Wh(),$i=kd=Yr=null,nl=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Hh&&t.locale!=="ko"?null:t.data;default:return null}}var uw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!uw[e.type]:t==="textarea"}function Yh(e,t,n,r){Ch(r),t=eo(t,"onChange"),0<t.length&&(n=new jd("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var ua=null,Na=null;function dw(e){lg(e,0)}function Mo(e){var t=ll(e);if(vh(t))return e}function fw(e,t){if(e==="change")return t}var Qh=!1;if(Lr){var bc;if(Lr){var Ec="oninput"in document;if(!Ec){var wp=document.createElement("div");wp.setAttribute("oninput","return;"),Ec=typeof wp.oninput=="function"}bc=Ec}else bc=!1;Qh=bc&&(!document.documentMode||9<document.documentMode)}function Sp(){ua&&(ua.detachEvent("onpropertychange",qh),Na=ua=null)}function qh(e){if(e.propertyName==="value"&&Mo(Na)){var t=[];Yh(t,Na,e,yd(e)),Ah(dw,t)}}function pw(e,t,n){e==="focusin"?(Sp(),ua=t,Na=n,ua.attachEvent("onpropertychange",qh)):e==="focusout"&&Sp()}function mw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Mo(Na)}function hw(e,t){if(e==="click")return Mo(t)}function gw(e,t){if(e==="input"||e==="change")return Mo(t)}function yw(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Hn=typeof Object.is=="function"?Object.is:yw;function Ca(e,t){if(Hn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Jc.call(t,s)||!Hn(e[s],t[s]))return!1}return!0}function kp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function jp(e,t){var n=kp(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=kp(n)}}function Xh(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Xh(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Jh(){for(var e=window,t=Gi();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Gi(e.document)}return t}function bd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function vw(e){var t=Jh(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Xh(n.ownerDocument.documentElement,n)){if(r!==null&&bd(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=n.textContent.length,a=Math.min(r.start,s);r=r.end===void 0?a:Math.min(r.end,s),!e.extend&&a>r&&(s=r,r=a,a=s),s=jp(n,a);var i=jp(n,r);s&&i&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var xw=Lr&&"documentMode"in document&&11>=document.documentMode,rl=null,yu=null,da=null,vu=!1;function Np(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;vu||rl==null||rl!==Gi(r)||(r=rl,"selectionStart"in r&&bd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),da&&Ca(da,r)||(da=r,r=eo(yu,"onSelect"),0<r.length&&(t=new jd("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=rl)))}function xi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var sl={animationend:xi("Animation","AnimationEnd"),animationiteration:xi("Animation","AnimationIteration"),animationstart:xi("Animation","AnimationStart"),transitionend:xi("Transition","TransitionEnd")},Lc={},Zh={};Lr&&(Zh=document.createElement("div").style,"AnimationEvent"in window||(delete sl.animationend.animation,delete sl.animationiteration.animation,delete sl.animationstart.animation),"TransitionEvent"in window||delete sl.transitionend.transition);function Fo(e){if(Lc[e])return Lc[e];if(!sl[e])return e;var t=sl[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Zh)return Lc[e]=t[n];return e}var eg=Fo("animationend"),tg=Fo("animationiteration"),ng=Fo("animationstart"),rg=Fo("transitionend"),sg=new Map,Cp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function cs(e,t){sg.set(e,t),Os(t,[e])}for(var Ac=0;Ac<Cp.length;Ac++){var Pc=Cp[Ac],ww=Pc.toLowerCase(),Sw=Pc[0].toUpperCase()+Pc.slice(1);cs(ww,"on"+Sw)}cs(eg,"onAnimationEnd");cs(tg,"onAnimationIteration");cs(ng,"onAnimationStart");cs("dblclick","onDoubleClick");cs("focusin","onFocus");cs("focusout","onBlur");cs(rg,"onTransitionEnd");kl("onMouseEnter",["mouseout","mouseover"]);kl("onMouseLeave",["mouseout","mouseover"]);kl("onPointerEnter",["pointerout","pointerover"]);kl("onPointerLeave",["pointerout","pointerover"]);Os("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Os("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Os("onBeforeInput",["compositionend","keypress","textInput","paste"]);Os("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Os("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Os("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kw=new Set("cancel close invalid load scroll toggle".split(" ").concat(sa));function bp(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,wx(r,t,void 0,e),e.currentTarget=null}function lg(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],s=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var c=r[i],u=c.instance,d=c.currentTarget;if(c=c.listener,u!==a&&s.isPropagationStopped())break e;bp(s,c,d),a=u}else for(i=0;i<r.length;i++){if(c=r[i],u=c.instance,d=c.currentTarget,c=c.listener,u!==a&&s.isPropagationStopped())break e;bp(s,c,d),a=u}}}if(Qi)throw e=pu,Qi=!1,pu=null,e}function pt(e,t){var n=t[ju];n===void 0&&(n=t[ju]=new Set);var r=e+"__bubble";n.has(r)||(ag(t,e,2,!1),n.add(r))}function zc(e,t,n){var r=0;t&&(r|=4),ag(n,e,r,t)}var wi="_reactListening"+Math.random().toString(36).slice(2);function ba(e){if(!e[wi]){e[wi]=!0,ph.forEach(function(n){n!=="selectionchange"&&(kw.has(n)||zc(n,!1,e),zc(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[wi]||(t[wi]=!0,zc("selectionchange",!1,t))}}function ag(e,t,n,r){switch(Vh(t)){case 1:var s=$x;break;case 4:s=Mx;break;default:s=Sd}n=s.bind(null,t,n,e),s=void 0,!fu||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),r?s!==void 0?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):s!==void 0?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function _c(e,t,n,r,s){var a=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var i=r.tag;if(i===3||i===4){var c=r.stateNode.containerInfo;if(c===s||c.nodeType===8&&c.parentNode===s)break;if(i===4)for(i=r.return;i!==null;){var u=i.tag;if((u===3||u===4)&&(u=i.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;i=i.return}for(;c!==null;){if(i=As(c),i===null)return;if(u=i.tag,u===5||u===6){r=a=i;continue e}c=c.parentNode}}r=r.return}Ah(function(){var d=a,h=yd(n),v=[];e:{var y=sg.get(e);if(y!==void 0){var x=jd,k=e;switch(e){case"keypress":if(Mi(n)===0)break e;case"keydown":case"keyup":x=Jx;break;case"focusin":k="focus",x=Cc;break;case"focusout":k="blur",x=Cc;break;case"beforeblur":case"afterblur":x=Cc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=mp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Dx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=tw;break;case eg:case tg:case ng:x=Vx;break;case rg:x=rw;break;case"scroll":x=Fx;break;case"wheel":x=lw;break;case"copy":case"cut":case"paste":x=Hx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=gp}var N=(t&4)!==0,j=!N&&e==="scroll",m=N?y!==null?y+"Capture":null:y;N=[];for(var p=d,g;p!==null;){g=p;var w=g.stateNode;if(g.tag===5&&w!==null&&(g=w,m!==null&&(w=wa(p,m),w!=null&&N.push(Ea(p,w,g)))),j)break;p=p.return}0<N.length&&(y=new x(y,k,null,n,h),v.push({event:y,listeners:N}))}}if(!(t&7)){e:{if(y=e==="mouseover"||e==="pointerover",x=e==="mouseout"||e==="pointerout",y&&n!==uu&&(k=n.relatedTarget||n.fromElement)&&(As(k)||k[Ar]))break e;if((x||y)&&(y=h.window===h?h:(y=h.ownerDocument)?y.defaultView||y.parentWindow:window,x?(k=n.relatedTarget||n.toElement,x=d,k=k?As(k):null,k!==null&&(j=Ds(k),k!==j||k.tag!==5&&k.tag!==6)&&(k=null)):(x=null,k=d),x!==k)){if(N=mp,w="onMouseLeave",m="onMouseEnter",p="mouse",(e==="pointerout"||e==="pointerover")&&(N=gp,w="onPointerLeave",m="onPointerEnter",p="pointer"),j=x==null?y:ll(x),g=k==null?y:ll(k),y=new N(w,p+"leave",x,n,h),y.target=j,y.relatedTarget=g,w=null,As(h)===d&&(N=new N(m,p+"enter",k,n,h),N.target=g,N.relatedTarget=j,w=N),j=w,x&&k)t:{for(N=x,m=k,p=0,g=N;g;g=Xs(g))p++;for(g=0,w=m;w;w=Xs(w))g++;for(;0<p-g;)N=Xs(N),p--;for(;0<g-p;)m=Xs(m),g--;for(;p--;){if(N===m||m!==null&&N===m.alternate)break t;N=Xs(N),m=Xs(m)}N=null}else N=null;x!==null&&Ep(v,y,x,N,!1),k!==null&&j!==null&&Ep(v,j,k,N,!0)}}e:{if(y=d?ll(d):window,x=y.nodeName&&y.nodeName.toLowerCase(),x==="select"||x==="input"&&y.type==="file")var b=fw;else if(xp(y))if(Qh)b=gw;else{b=mw;var E=pw}else(x=y.nodeName)&&x.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(b=hw);if(b&&(b=b(e,d))){Yh(v,b,n,h);break e}E&&E(e,y,d),e==="focusout"&&(E=y._wrapperState)&&E.controlled&&y.type==="number"&&lu(y,"number",y.value)}switch(E=d?ll(d):window,e){case"focusin":(xp(E)||E.contentEditable==="true")&&(rl=E,yu=d,da=null);break;case"focusout":da=yu=rl=null;break;case"mousedown":vu=!0;break;case"contextmenu":case"mouseup":case"dragend":vu=!1,Np(v,n,h);break;case"selectionchange":if(xw)break;case"keydown":case"keyup":Np(v,n,h)}var A;if(Cd)e:{switch(e){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else nl?Kh(e,n)&&(I="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(I="onCompositionStart");I&&(Hh&&n.locale!=="ko"&&(nl||I!=="onCompositionStart"?I==="onCompositionEnd"&&nl&&(A=Wh()):(Yr=h,kd="value"in Yr?Yr.value:Yr.textContent,nl=!0)),E=eo(d,I),0<E.length&&(I=new hp(I,e,null,n,h),v.push({event:I,listeners:E}),A?I.data=A:(A=Gh(n),A!==null&&(I.data=A)))),(A=iw?ow(e,n):cw(e,n))&&(d=eo(d,"onBeforeInput"),0<d.length&&(h=new hp("onBeforeInput","beforeinput",null,n,h),v.push({event:h,listeners:d}),h.data=A))}lg(v,t)})}function Ea(e,t,n){return{instance:e,listener:t,currentTarget:n}}function eo(e,t){for(var n=t+"Capture",r=[];e!==null;){var s=e,a=s.stateNode;s.tag===5&&a!==null&&(s=a,a=wa(e,n),a!=null&&r.unshift(Ea(e,a,s)),a=wa(e,t),a!=null&&r.push(Ea(e,a,s))),e=e.return}return r}function Xs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Ep(e,t,n,r,s){for(var a=t._reactName,i=[];n!==null&&n!==r;){var c=n,u=c.alternate,d=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&d!==null&&(c=d,s?(u=wa(n,a),u!=null&&i.unshift(Ea(n,u,c))):s||(u=wa(n,a),u!=null&&i.push(Ea(n,u,c)))),n=n.return}i.length!==0&&e.push({event:t,listeners:i})}var jw=/\r\n?/g,Nw=/\u0000|\uFFFD/g;function Lp(e){return(typeof e=="string"?e:""+e).replace(jw,`
`).replace(Nw,"")}function Si(e,t,n){if(t=Lp(t),Lp(e)!==t&&n)throw Error(se(425))}function to(){}var xu=null,wu=null;function Su(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var ku=typeof setTimeout=="function"?setTimeout:void 0,Cw=typeof clearTimeout=="function"?clearTimeout:void 0,Ap=typeof Promise=="function"?Promise:void 0,bw=typeof queueMicrotask=="function"?queueMicrotask:typeof Ap<"u"?function(e){return Ap.resolve(null).then(e).catch(Ew)}:ku;function Ew(e){setTimeout(function(){throw e})}function Tc(e,t){var n=t,r=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){e.removeChild(s),ja(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);ja(t)}function es(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Pp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Tl=Math.random().toString(36).slice(2),sr="__reactFiber$"+Tl,La="__reactProps$"+Tl,Ar="__reactContainer$"+Tl,ju="__reactEvents$"+Tl,Lw="__reactListeners$"+Tl,Aw="__reactHandles$"+Tl;function As(e){var t=e[sr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ar]||n[sr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Pp(e);e!==null;){if(n=e[sr])return n;e=Pp(e)}return t}e=n,n=e.parentNode}return null}function Va(e){return e=e[sr]||e[Ar],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ll(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(se(33))}function Oo(e){return e[La]||null}var Nu=[],al=-1;function us(e){return{current:e}}function mt(e){0>al||(e.current=Nu[al],Nu[al]=null,al--)}function dt(e,t){al++,Nu[al]=e.current,e.current=t}var is={},Jt=us(is),pn=us(!1),Rs=is;function jl(e,t){var n=e.type.contextTypes;if(!n)return is;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var s={},a;for(a in n)s[a]=t[a];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function mn(e){return e=e.childContextTypes,e!=null}function no(){mt(pn),mt(Jt)}function zp(e,t,n){if(Jt.current!==is)throw Error(se(168));dt(Jt,t),dt(pn,n)}function ig(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in t))throw Error(se(108,px(e)||"Unknown",s));return kt({},n,r)}function ro(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||is,Rs=Jt.current,dt(Jt,e),dt(pn,pn.current),!0}function _p(e,t,n){var r=e.stateNode;if(!r)throw Error(se(169));n?(e=ig(e,t,Rs),r.__reactInternalMemoizedMergedChildContext=e,mt(pn),mt(Jt),dt(Jt,e)):mt(pn),dt(pn,n)}var kr=null,Do=!1,Rc=!1;function og(e){kr===null?kr=[e]:kr.push(e)}function Pw(e){Do=!0,og(e)}function ds(){if(!Rc&&kr!==null){Rc=!0;var e=0,t=it;try{var n=kr;for(it=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}kr=null,Do=!1}catch(s){throw kr!==null&&(kr=kr.slice(e+1)),Th(vd,ds),s}finally{it=t,Rc=!1}}return null}var il=[],ol=0,so=null,lo=0,Ln=[],An=0,Is=null,Nr=1,Cr="";function bs(e,t){il[ol++]=lo,il[ol++]=so,so=e,lo=t}function cg(e,t,n){Ln[An++]=Nr,Ln[An++]=Cr,Ln[An++]=Is,Is=e;var r=Nr;e=Cr;var s=32-Vn(r)-1;r&=~(1<<s),n+=1;var a=32-Vn(t)+s;if(30<a){var i=s-s%5;a=(r&(1<<i)-1).toString(32),r>>=i,s-=i,Nr=1<<32-Vn(t)+s|n<<s|r,Cr=a+e}else Nr=1<<a|n<<s|r,Cr=e}function Ed(e){e.return!==null&&(bs(e,1),cg(e,1,0))}function Ld(e){for(;e===so;)so=il[--ol],il[ol]=null,lo=il[--ol],il[ol]=null;for(;e===Is;)Is=Ln[--An],Ln[An]=null,Cr=Ln[--An],Ln[An]=null,Nr=Ln[--An],Ln[An]=null}var kn=null,Sn=null,gt=!1,Un=null;function ug(e,t){var n=Pn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Tp(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,kn=e,Sn=es(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,kn=e,Sn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Is!==null?{id:Nr,overflow:Cr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Pn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,kn=e,Sn=null,!0):!1;default:return!1}}function Cu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function bu(e){if(gt){var t=Sn;if(t){var n=t;if(!Tp(e,t)){if(Cu(e))throw Error(se(418));t=es(n.nextSibling);var r=kn;t&&Tp(e,t)?ug(r,n):(e.flags=e.flags&-4097|2,gt=!1,kn=e)}}else{if(Cu(e))throw Error(se(418));e.flags=e.flags&-4097|2,gt=!1,kn=e}}}function Rp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;kn=e}function ki(e){if(e!==kn)return!1;if(!gt)return Rp(e),gt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Su(e.type,e.memoizedProps)),t&&(t=Sn)){if(Cu(e))throw dg(),Error(se(418));for(;t;)ug(e,t),t=es(t.nextSibling)}if(Rp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(se(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Sn=es(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Sn=null}}else Sn=kn?es(e.stateNode.nextSibling):null;return!0}function dg(){for(var e=Sn;e;)e=es(e.nextSibling)}function Nl(){Sn=kn=null,gt=!1}function Ad(e){Un===null?Un=[e]:Un.push(e)}var zw=_r.ReactCurrentBatchConfig;function Jl(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(se(309));var r=n.stateNode}if(!r)throw Error(se(147,e));var s=r,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(i){var c=s.refs;i===null?delete c[a]:c[a]=i},t._stringRef=a,t)}if(typeof e!="string")throw Error(se(284));if(!n._owner)throw Error(se(290,e))}return e}function ji(e,t){throw e=Object.prototype.toString.call(t),Error(se(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ip(e){var t=e._init;return t(e._payload)}function fg(e){function t(m,p){if(e){var g=m.deletions;g===null?(m.deletions=[p],m.flags|=16):g.push(p)}}function n(m,p){if(!e)return null;for(;p!==null;)t(m,p),p=p.sibling;return null}function r(m,p){for(m=new Map;p!==null;)p.key!==null?m.set(p.key,p):m.set(p.index,p),p=p.sibling;return m}function s(m,p){return m=ss(m,p),m.index=0,m.sibling=null,m}function a(m,p,g){return m.index=g,e?(g=m.alternate,g!==null?(g=g.index,g<p?(m.flags|=2,p):g):(m.flags|=2,p)):(m.flags|=1048576,p)}function i(m){return e&&m.alternate===null&&(m.flags|=2),m}function c(m,p,g,w){return p===null||p.tag!==6?(p=Bc(g,m.mode,w),p.return=m,p):(p=s(p,g),p.return=m,p)}function u(m,p,g,w){var b=g.type;return b===tl?h(m,p,g.props.children,w,g.key):p!==null&&(p.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Vr&&Ip(b)===p.type)?(w=s(p,g.props),w.ref=Jl(m,p,g),w.return=m,w):(w=Wi(g.type,g.key,g.props,null,m.mode,w),w.ref=Jl(m,p,g),w.return=m,w)}function d(m,p,g,w){return p===null||p.tag!==4||p.stateNode.containerInfo!==g.containerInfo||p.stateNode.implementation!==g.implementation?(p=Uc(g,m.mode,w),p.return=m,p):(p=s(p,g.children||[]),p.return=m,p)}function h(m,p,g,w,b){return p===null||p.tag!==7?(p=Ts(g,m.mode,w,b),p.return=m,p):(p=s(p,g),p.return=m,p)}function v(m,p,g){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Bc(""+p,m.mode,g),p.return=m,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case fi:return g=Wi(p.type,p.key,p.props,null,m.mode,g),g.ref=Jl(m,null,p),g.return=m,g;case el:return p=Uc(p,m.mode,g),p.return=m,p;case Vr:var w=p._init;return v(m,w(p._payload),g)}if(na(p)||Gl(p))return p=Ts(p,m.mode,g,null),p.return=m,p;ji(m,p)}return null}function y(m,p,g,w){var b=p!==null?p.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return b!==null?null:c(m,p,""+g,w);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case fi:return g.key===b?u(m,p,g,w):null;case el:return g.key===b?d(m,p,g,w):null;case Vr:return b=g._init,y(m,p,b(g._payload),w)}if(na(g)||Gl(g))return b!==null?null:h(m,p,g,w,null);ji(m,g)}return null}function x(m,p,g,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return m=m.get(g)||null,c(p,m,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case fi:return m=m.get(w.key===null?g:w.key)||null,u(p,m,w,b);case el:return m=m.get(w.key===null?g:w.key)||null,d(p,m,w,b);case Vr:var E=w._init;return x(m,p,g,E(w._payload),b)}if(na(w)||Gl(w))return m=m.get(g)||null,h(p,m,w,b,null);ji(p,w)}return null}function k(m,p,g,w){for(var b=null,E=null,A=p,I=p=0,B=null;A!==null&&I<g.length;I++){A.index>I?(B=A,A=null):B=A.sibling;var T=y(m,A,g[I],w);if(T===null){A===null&&(A=B);break}e&&A&&T.alternate===null&&t(m,A),p=a(T,p,I),E===null?b=T:E.sibling=T,E=T,A=B}if(I===g.length)return n(m,A),gt&&bs(m,I),b;if(A===null){for(;I<g.length;I++)A=v(m,g[I],w),A!==null&&(p=a(A,p,I),E===null?b=A:E.sibling=A,E=A);return gt&&bs(m,I),b}for(A=r(m,A);I<g.length;I++)B=x(A,m,I,g[I],w),B!==null&&(e&&B.alternate!==null&&A.delete(B.key===null?I:B.key),p=a(B,p,I),E===null?b=B:E.sibling=B,E=B);return e&&A.forEach(function($){return t(m,$)}),gt&&bs(m,I),b}function N(m,p,g,w){var b=Gl(g);if(typeof b!="function")throw Error(se(150));if(g=b.call(g),g==null)throw Error(se(151));for(var E=b=null,A=p,I=p=0,B=null,T=g.next();A!==null&&!T.done;I++,T=g.next()){A.index>I?(B=A,A=null):B=A.sibling;var $=y(m,A,T.value,w);if($===null){A===null&&(A=B);break}e&&A&&$.alternate===null&&t(m,A),p=a($,p,I),E===null?b=$:E.sibling=$,E=$,A=B}if(T.done)return n(m,A),gt&&bs(m,I),b;if(A===null){for(;!T.done;I++,T=g.next())T=v(m,T.value,w),T!==null&&(p=a(T,p,I),E===null?b=T:E.sibling=T,E=T);return gt&&bs(m,I),b}for(A=r(m,A);!T.done;I++,T=g.next())T=x(A,m,I,T.value,w),T!==null&&(e&&T.alternate!==null&&A.delete(T.key===null?I:T.key),p=a(T,p,I),E===null?b=T:E.sibling=T,E=T);return e&&A.forEach(function(ee){return t(m,ee)}),gt&&bs(m,I),b}function j(m,p,g,w){if(typeof g=="object"&&g!==null&&g.type===tl&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case fi:e:{for(var b=g.key,E=p;E!==null;){if(E.key===b){if(b=g.type,b===tl){if(E.tag===7){n(m,E.sibling),p=s(E,g.props.children),p.return=m,m=p;break e}}else if(E.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Vr&&Ip(b)===E.type){n(m,E.sibling),p=s(E,g.props),p.ref=Jl(m,E,g),p.return=m,m=p;break e}n(m,E);break}else t(m,E);E=E.sibling}g.type===tl?(p=Ts(g.props.children,m.mode,w,g.key),p.return=m,m=p):(w=Wi(g.type,g.key,g.props,null,m.mode,w),w.ref=Jl(m,p,g),w.return=m,m=w)}return i(m);case el:e:{for(E=g.key;p!==null;){if(p.key===E)if(p.tag===4&&p.stateNode.containerInfo===g.containerInfo&&p.stateNode.implementation===g.implementation){n(m,p.sibling),p=s(p,g.children||[]),p.return=m,m=p;break e}else{n(m,p);break}else t(m,p);p=p.sibling}p=Uc(g,m.mode,w),p.return=m,m=p}return i(m);case Vr:return E=g._init,j(m,p,E(g._payload),w)}if(na(g))return k(m,p,g,w);if(Gl(g))return N(m,p,g,w);ji(m,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,p!==null&&p.tag===6?(n(m,p.sibling),p=s(p,g),p.return=m,m=p):(n(m,p),p=Bc(g,m.mode,w),p.return=m,m=p),i(m)):n(m,p)}return j}var Cl=fg(!0),pg=fg(!1),ao=us(null),io=null,cl=null,Pd=null;function zd(){Pd=cl=io=null}function _d(e){var t=ao.current;mt(ao),e._currentValue=t}function Eu(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function xl(e,t){io=e,Pd=cl=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(fn=!0),e.firstContext=null)}function _n(e){var t=e._currentValue;if(Pd!==e)if(e={context:e,memoizedValue:t,next:null},cl===null){if(io===null)throw Error(se(308));cl=e,io.dependencies={lanes:0,firstContext:e}}else cl=cl.next=e;return t}var Ps=null;function Td(e){Ps===null?Ps=[e]:Ps.push(e)}function mg(e,t,n,r){var s=t.interleaved;return s===null?(n.next=n,Td(t)):(n.next=s.next,s.next=n),t.interleaved=n,Pr(e,r)}function Pr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Wr=!1;function Rd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function br(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ts(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,tt&2){var s=r.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),r.pending=t,Pr(e,n)}return s=r.interleaved,s===null?(t.next=t,Td(r)):(t.next=s.next,s.next=t),r.interleaved=t,Pr(e,n)}function Fi(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,xd(e,n)}}function $p(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?s=a=i:a=a.next=i,n=n.next}while(n!==null);a===null?s=a=t:a=a.next=t}else s=a=t;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function oo(e,t,n,r){var s=e.updateQueue;Wr=!1;var a=s.firstBaseUpdate,i=s.lastBaseUpdate,c=s.shared.pending;if(c!==null){s.shared.pending=null;var u=c,d=u.next;u.next=null,i===null?a=d:i.next=d,i=u;var h=e.alternate;h!==null&&(h=h.updateQueue,c=h.lastBaseUpdate,c!==i&&(c===null?h.firstBaseUpdate=d:c.next=d,h.lastBaseUpdate=u))}if(a!==null){var v=s.baseState;i=0,h=d=u=null,c=a;do{var y=c.lane,x=c.eventTime;if((r&y)===y){h!==null&&(h=h.next={eventTime:x,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var k=e,N=c;switch(y=t,x=n,N.tag){case 1:if(k=N.payload,typeof k=="function"){v=k.call(x,v,y);break e}v=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=N.payload,y=typeof k=="function"?k.call(x,v,y):k,y==null)break e;v=kt({},v,y);break e;case 2:Wr=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,y=s.effects,y===null?s.effects=[c]:y.push(c))}else x={eventTime:x,lane:y,tag:c.tag,payload:c.payload,callback:c.callback,next:null},h===null?(d=h=x,u=v):h=h.next=x,i|=y;if(c=c.next,c===null){if(c=s.shared.pending,c===null)break;y=c,c=y.next,y.next=null,s.lastBaseUpdate=y,s.shared.pending=null}}while(!0);if(h===null&&(u=v),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=h,t=s.shared.interleaved,t!==null){s=t;do i|=s.lane,s=s.next;while(s!==t)}else a===null&&(s.shared.lanes=0);Ms|=i,e.lanes=i,e.memoizedState=v}}function Mp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(se(191,s));s.call(r)}}}var Wa={},dr=us(Wa),Aa=us(Wa),Pa=us(Wa);function zs(e){if(e===Wa)throw Error(se(174));return e}function Id(e,t){switch(dt(Pa,t),dt(Aa,e),dt(dr,Wa),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:iu(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=iu(t,e)}mt(dr),dt(dr,t)}function bl(){mt(dr),mt(Aa),mt(Pa)}function gg(e){zs(Pa.current);var t=zs(dr.current),n=iu(t,e.type);t!==n&&(dt(Aa,e),dt(dr,n))}function $d(e){Aa.current===e&&(mt(dr),mt(Aa))}var xt=us(0);function co(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ic=[];function Md(){for(var e=0;e<Ic.length;e++)Ic[e]._workInProgressVersionPrimary=null;Ic.length=0}var Oi=_r.ReactCurrentDispatcher,$c=_r.ReactCurrentBatchConfig,$s=0,wt=null,It=null,Ot=null,uo=!1,fa=!1,za=0,_w=0;function Yt(){throw Error(se(321))}function Fd(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Hn(e[n],t[n]))return!1;return!0}function Od(e,t,n,r,s,a){if($s=a,wt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Oi.current=e===null||e.memoizedState===null?$w:Mw,e=n(r,s),fa){a=0;do{if(fa=!1,za=0,25<=a)throw Error(se(301));a+=1,Ot=It=null,t.updateQueue=null,Oi.current=Fw,e=n(r,s)}while(fa)}if(Oi.current=fo,t=It!==null&&It.next!==null,$s=0,Ot=It=wt=null,uo=!1,t)throw Error(se(300));return e}function Dd(){var e=za!==0;return za=0,e}function nr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?wt.memoizedState=Ot=e:Ot=Ot.next=e,Ot}function Tn(){if(It===null){var e=wt.alternate;e=e!==null?e.memoizedState:null}else e=It.next;var t=Ot===null?wt.memoizedState:Ot.next;if(t!==null)Ot=t,It=e;else{if(e===null)throw Error(se(310));It=e,e={memoizedState:It.memoizedState,baseState:It.baseState,baseQueue:It.baseQueue,queue:It.queue,next:null},Ot===null?wt.memoizedState=Ot=e:Ot=Ot.next=e}return Ot}function _a(e,t){return typeof t=="function"?t(e):t}function Mc(e){var t=Tn(),n=t.queue;if(n===null)throw Error(se(311));n.lastRenderedReducer=e;var r=It,s=r.baseQueue,a=n.pending;if(a!==null){if(s!==null){var i=s.next;s.next=a.next,a.next=i}r.baseQueue=s=a,n.pending=null}if(s!==null){a=s.next,r=r.baseState;var c=i=null,u=null,d=a;do{var h=d.lane;if(($s&h)===h)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var v={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(c=u=v,i=r):u=u.next=v,wt.lanes|=h,Ms|=h}d=d.next}while(d!==null&&d!==a);u===null?i=r:u.next=c,Hn(r,t.memoizedState)||(fn=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=u,n.lastRenderedState=r}if(e=n.interleaved,e!==null){s=e;do a=s.lane,wt.lanes|=a,Ms|=a,s=s.next;while(s!==e)}else s===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Fc(e){var t=Tn(),n=t.queue;if(n===null)throw Error(se(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,a=t.memoizedState;if(s!==null){n.pending=null;var i=s=s.next;do a=e(a,i.action),i=i.next;while(i!==s);Hn(a,t.memoizedState)||(fn=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function yg(){}function vg(e,t){var n=wt,r=Tn(),s=t(),a=!Hn(r.memoizedState,s);if(a&&(r.memoizedState=s,fn=!0),r=r.queue,Bd(Sg.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||Ot!==null&&Ot.memoizedState.tag&1){if(n.flags|=2048,Ta(9,wg.bind(null,n,r,s,t),void 0,null),Dt===null)throw Error(se(349));$s&30||xg(n,t,s)}return s}function xg(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=wt.updateQueue,t===null?(t={lastEffect:null,stores:null},wt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function wg(e,t,n,r){t.value=n,t.getSnapshot=r,kg(t)&&jg(e)}function Sg(e,t,n){return n(function(){kg(t)&&jg(e)})}function kg(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Hn(e,n)}catch{return!0}}function jg(e){var t=Pr(e,1);t!==null&&Wn(t,e,1,-1)}function Fp(e){var t=nr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_a,lastRenderedState:e},t.queue=e,e=e.dispatch=Iw.bind(null,wt,e),[t.memoizedState,e]}function Ta(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=wt.updateQueue,t===null?(t={lastEffect:null,stores:null},wt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Ng(){return Tn().memoizedState}function Di(e,t,n,r){var s=nr();wt.flags|=e,s.memoizedState=Ta(1|t,n,void 0,r===void 0?null:r)}function Bo(e,t,n,r){var s=Tn();r=r===void 0?null:r;var a=void 0;if(It!==null){var i=It.memoizedState;if(a=i.destroy,r!==null&&Fd(r,i.deps)){s.memoizedState=Ta(t,n,a,r);return}}wt.flags|=e,s.memoizedState=Ta(1|t,n,a,r)}function Op(e,t){return Di(8390656,8,e,t)}function Bd(e,t){return Bo(2048,8,e,t)}function Cg(e,t){return Bo(4,2,e,t)}function bg(e,t){return Bo(4,4,e,t)}function Eg(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Lg(e,t,n){return n=n!=null?n.concat([e]):null,Bo(4,4,Eg.bind(null,t,e),n)}function Ud(){}function Ag(e,t){var n=Tn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Fd(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Pg(e,t){var n=Tn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Fd(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function zg(e,t,n){return $s&21?(Hn(n,t)||(n=$h(),wt.lanes|=n,Ms|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,fn=!0),e.memoizedState=n)}function Tw(e,t){var n=it;it=n!==0&&4>n?n:4,e(!0);var r=$c.transition;$c.transition={};try{e(!1),t()}finally{it=n,$c.transition=r}}function _g(){return Tn().memoizedState}function Rw(e,t,n){var r=rs(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Tg(e))Rg(t,n);else if(n=mg(e,t,n,r),n!==null){var s=an();Wn(n,e,r,s),Ig(n,t,r)}}function Iw(e,t,n){var r=rs(e),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Tg(e))Rg(t,s);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var i=t.lastRenderedState,c=a(i,n);if(s.hasEagerState=!0,s.eagerState=c,Hn(c,i)){var u=t.interleaved;u===null?(s.next=s,Td(t)):(s.next=u.next,u.next=s),t.interleaved=s;return}}catch{}finally{}n=mg(e,t,s,r),n!==null&&(s=an(),Wn(n,e,r,s),Ig(n,t,r))}}function Tg(e){var t=e.alternate;return e===wt||t!==null&&t===wt}function Rg(e,t){fa=uo=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ig(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,xd(e,n)}}var fo={readContext:_n,useCallback:Yt,useContext:Yt,useEffect:Yt,useImperativeHandle:Yt,useInsertionEffect:Yt,useLayoutEffect:Yt,useMemo:Yt,useReducer:Yt,useRef:Yt,useState:Yt,useDebugValue:Yt,useDeferredValue:Yt,useTransition:Yt,useMutableSource:Yt,useSyncExternalStore:Yt,useId:Yt,unstable_isNewReconciler:!1},$w={readContext:_n,useCallback:function(e,t){return nr().memoizedState=[e,t===void 0?null:t],e},useContext:_n,useEffect:Op,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Di(4194308,4,Eg.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Di(4194308,4,e,t)},useInsertionEffect:function(e,t){return Di(4,2,e,t)},useMemo:function(e,t){var n=nr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=nr();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Rw.bind(null,wt,e),[r.memoizedState,e]},useRef:function(e){var t=nr();return e={current:e},t.memoizedState=e},useState:Fp,useDebugValue:Ud,useDeferredValue:function(e){return nr().memoizedState=e},useTransition:function(){var e=Fp(!1),t=e[0];return e=Tw.bind(null,e[1]),nr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=wt,s=nr();if(gt){if(n===void 0)throw Error(se(407));n=n()}else{if(n=t(),Dt===null)throw Error(se(349));$s&30||xg(r,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,Op(Sg.bind(null,r,a,e),[e]),r.flags|=2048,Ta(9,wg.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=nr(),t=Dt.identifierPrefix;if(gt){var n=Cr,r=Nr;n=(r&~(1<<32-Vn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=za++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=_w++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Mw={readContext:_n,useCallback:Ag,useContext:_n,useEffect:Bd,useImperativeHandle:Lg,useInsertionEffect:Cg,useLayoutEffect:bg,useMemo:Pg,useReducer:Mc,useRef:Ng,useState:function(){return Mc(_a)},useDebugValue:Ud,useDeferredValue:function(e){var t=Tn();return zg(t,It.memoizedState,e)},useTransition:function(){var e=Mc(_a)[0],t=Tn().memoizedState;return[e,t]},useMutableSource:yg,useSyncExternalStore:vg,useId:_g,unstable_isNewReconciler:!1},Fw={readContext:_n,useCallback:Ag,useContext:_n,useEffect:Bd,useImperativeHandle:Lg,useInsertionEffect:Cg,useLayoutEffect:bg,useMemo:Pg,useReducer:Fc,useRef:Ng,useState:function(){return Fc(_a)},useDebugValue:Ud,useDeferredValue:function(e){var t=Tn();return It===null?t.memoizedState=e:zg(t,It.memoizedState,e)},useTransition:function(){var e=Fc(_a)[0],t=Tn().memoizedState;return[e,t]},useMutableSource:yg,useSyncExternalStore:vg,useId:_g,unstable_isNewReconciler:!1};function Dn(e,t){if(e&&e.defaultProps){t=kt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Lu(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:kt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Uo={isMounted:function(e){return(e=e._reactInternals)?Ds(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=an(),s=rs(e),a=br(r,s);a.payload=t,n!=null&&(a.callback=n),t=ts(e,a,s),t!==null&&(Wn(t,e,s,r),Fi(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=an(),s=rs(e),a=br(r,s);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=ts(e,a,s),t!==null&&(Wn(t,e,s,r),Fi(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=an(),r=rs(e),s=br(n,r);s.tag=2,t!=null&&(s.callback=t),t=ts(e,s,r),t!==null&&(Wn(t,e,r,n),Fi(t,e,r))}};function Dp(e,t,n,r,s,a,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,a,i):t.prototype&&t.prototype.isPureReactComponent?!Ca(n,r)||!Ca(s,a):!0}function $g(e,t,n){var r=!1,s=is,a=t.contextType;return typeof a=="object"&&a!==null?a=_n(a):(s=mn(t)?Rs:Jt.current,r=t.contextTypes,a=(r=r!=null)?jl(e,s):is),t=new t(n,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Uo,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=a),t}function Bp(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Uo.enqueueReplaceState(t,t.state,null)}function Au(e,t,n,r){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},Rd(e);var a=t.contextType;typeof a=="object"&&a!==null?s.context=_n(a):(a=mn(t)?Rs:Jt.current,s.context=jl(e,a)),s.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(Lu(e,t,a,n),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&Uo.enqueueReplaceState(s,s.state,null),oo(e,n,s,r),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function El(e,t){try{var n="",r=t;do n+=fx(r),r=r.return;while(r);var s=n}catch(a){s=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:s,digest:null}}function Oc(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Pu(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Ow=typeof WeakMap=="function"?WeakMap:Map;function Mg(e,t,n){n=br(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){mo||(mo=!0,Du=r),Pu(e,t)},n}function Fg(e,t,n){n=br(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var s=t.value;n.payload=function(){return r(s)},n.callback=function(){Pu(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Pu(e,t),typeof r!="function"&&(ns===null?ns=new Set([this]):ns.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),n}function Up(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Ow;var s=new Set;r.set(t,s)}else s=r.get(t),s===void 0&&(s=new Set,r.set(t,s));s.has(n)||(s.add(n),e=Zw.bind(null,e,t,n),t.then(e,e))}function Vp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Wp(e,t,n,r,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=br(-1,1),t.tag=2,ts(n,t,1))),n.lanes|=1),e)}var Dw=_r.ReactCurrentOwner,fn=!1;function sn(e,t,n,r){t.child=e===null?pg(t,null,n,r):Cl(t,e.child,n,r)}function Hp(e,t,n,r,s){n=n.render;var a=t.ref;return xl(t,s),r=Od(e,t,n,r,a,s),n=Dd(),e!==null&&!fn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,zr(e,t,s)):(gt&&n&&Ed(t),t.flags|=1,sn(e,t,r,s),t.child)}function Kp(e,t,n,r,s){if(e===null){var a=n.type;return typeof a=="function"&&!qd(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=a,Og(e,t,a,r,s)):(e=Wi(n.type,null,r,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&s)){var i=a.memoizedProps;if(n=n.compare,n=n!==null?n:Ca,n(i,r)&&e.ref===t.ref)return zr(e,t,s)}return t.flags|=1,e=ss(a,r),e.ref=t.ref,e.return=t,t.child=e}function Og(e,t,n,r,s){if(e!==null){var a=e.memoizedProps;if(Ca(a,r)&&e.ref===t.ref)if(fn=!1,t.pendingProps=r=a,(e.lanes&s)!==0)e.flags&131072&&(fn=!0);else return t.lanes=e.lanes,zr(e,t,s)}return zu(e,t,n,r,s)}function Dg(e,t,n){var r=t.pendingProps,s=r.children,a=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},dt(dl,wn),wn|=n;else{if(!(n&1073741824))return e=a!==null?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,dt(dl,wn),wn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,dt(dl,wn),wn|=r}else a!==null?(r=a.baseLanes|n,t.memoizedState=null):r=n,dt(dl,wn),wn|=r;return sn(e,t,s,n),t.child}function Bg(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function zu(e,t,n,r,s){var a=mn(n)?Rs:Jt.current;return a=jl(t,a),xl(t,s),n=Od(e,t,n,r,a,s),r=Dd(),e!==null&&!fn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,zr(e,t,s)):(gt&&r&&Ed(t),t.flags|=1,sn(e,t,n,s),t.child)}function Gp(e,t,n,r,s){if(mn(n)){var a=!0;ro(t)}else a=!1;if(xl(t,s),t.stateNode===null)Bi(e,t),$g(t,n,r),Au(t,n,r,s),r=!0;else if(e===null){var i=t.stateNode,c=t.memoizedProps;i.props=c;var u=i.context,d=n.contextType;typeof d=="object"&&d!==null?d=_n(d):(d=mn(n)?Rs:Jt.current,d=jl(t,d));var h=n.getDerivedStateFromProps,v=typeof h=="function"||typeof i.getSnapshotBeforeUpdate=="function";v||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(c!==r||u!==d)&&Bp(t,i,r,d),Wr=!1;var y=t.memoizedState;i.state=y,oo(t,r,i,s),u=t.memoizedState,c!==r||y!==u||pn.current||Wr?(typeof h=="function"&&(Lu(t,n,h,r),u=t.memoizedState),(c=Wr||Dp(t,n,c,r,y,u,d))?(v||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),i.props=r,i.state=u,i.context=d,r=c):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,hg(e,t),c=t.memoizedProps,d=t.type===t.elementType?c:Dn(t.type,c),i.props=d,v=t.pendingProps,y=i.context,u=n.contextType,typeof u=="object"&&u!==null?u=_n(u):(u=mn(n)?Rs:Jt.current,u=jl(t,u));var x=n.getDerivedStateFromProps;(h=typeof x=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(c!==v||y!==u)&&Bp(t,i,r,u),Wr=!1,y=t.memoizedState,i.state=y,oo(t,r,i,s);var k=t.memoizedState;c!==v||y!==k||pn.current||Wr?(typeof x=="function"&&(Lu(t,n,x,r),k=t.memoizedState),(d=Wr||Dp(t,n,d,r,y,k,u)||!1)?(h||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(r,k,u),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(r,k,u)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=k),i.props=r,i.state=k,i.context=u,r=d):(typeof i.componentDidUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&y===e.memoizedState||(t.flags|=1024),r=!1)}return _u(e,t,n,r,a,s)}function _u(e,t,n,r,s,a){Bg(e,t);var i=(t.flags&128)!==0;if(!r&&!i)return s&&_p(t,n,!1),zr(e,t,a);r=t.stateNode,Dw.current=t;var c=i&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&i?(t.child=Cl(t,e.child,null,a),t.child=Cl(t,null,c,a)):sn(e,t,c,a),t.memoizedState=r.state,s&&_p(t,n,!0),t.child}function Ug(e){var t=e.stateNode;t.pendingContext?zp(e,t.pendingContext,t.pendingContext!==t.context):t.context&&zp(e,t.context,!1),Id(e,t.containerInfo)}function Yp(e,t,n,r,s){return Nl(),Ad(s),t.flags|=256,sn(e,t,n,r),t.child}var Tu={dehydrated:null,treeContext:null,retryLane:0};function Ru(e){return{baseLanes:e,cachePool:null,transitions:null}}function Vg(e,t,n){var r=t.pendingProps,s=xt.current,a=!1,i=(t.flags&128)!==0,c;if((c=i)||(c=e!==null&&e.memoizedState===null?!1:(s&2)!==0),c?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),dt(xt,s&1),e===null)return bu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=r.children,e=r.fallback,a?(r=t.mode,a=t.child,i={mode:"hidden",children:i},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=i):a=Ho(i,r,0,null),e=Ts(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ru(n),t.memoizedState=Tu,e):Vd(t,i));if(s=e.memoizedState,s!==null&&(c=s.dehydrated,c!==null))return Bw(e,t,i,r,c,s,n);if(a){a=r.fallback,i=t.mode,s=e.child,c=s.sibling;var u={mode:"hidden",children:r.children};return!(i&1)&&t.child!==s?(r=t.child,r.childLanes=0,r.pendingProps=u,t.deletions=null):(r=ss(s,u),r.subtreeFlags=s.subtreeFlags&14680064),c!==null?a=ss(c,a):(a=Ts(a,i,n,null),a.flags|=2),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,i=e.child.memoizedState,i=i===null?Ru(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},a.memoizedState=i,a.childLanes=e.childLanes&~n,t.memoizedState=Tu,r}return a=e.child,e=a.sibling,r=ss(a,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Vd(e,t){return t=Ho({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ni(e,t,n,r){return r!==null&&Ad(r),Cl(t,e.child,null,n),e=Vd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Bw(e,t,n,r,s,a,i){if(n)return t.flags&256?(t.flags&=-257,r=Oc(Error(se(422))),Ni(e,t,i,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=r.fallback,s=t.mode,r=Ho({mode:"visible",children:r.children},s,0,null),a=Ts(a,s,i,null),a.flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,t.mode&1&&Cl(t,e.child,null,i),t.child.memoizedState=Ru(i),t.memoizedState=Tu,a);if(!(t.mode&1))return Ni(e,t,i,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var c=r.dgst;return r=c,a=Error(se(419)),r=Oc(a,r,void 0),Ni(e,t,i,r)}if(c=(i&e.childLanes)!==0,fn||c){if(r=Dt,r!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|i)?0:s,s!==0&&s!==a.retryLane&&(a.retryLane=s,Pr(e,s),Wn(r,e,s,-1))}return Qd(),r=Oc(Error(se(421))),Ni(e,t,i,r)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=e0.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,Sn=es(s.nextSibling),kn=t,gt=!0,Un=null,e!==null&&(Ln[An++]=Nr,Ln[An++]=Cr,Ln[An++]=Is,Nr=e.id,Cr=e.overflow,Is=t),t=Vd(t,r.children),t.flags|=4096,t)}function Qp(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Eu(e.return,t,n)}function Dc(e,t,n,r,s){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=s)}function Wg(e,t,n){var r=t.pendingProps,s=r.revealOrder,a=r.tail;if(sn(e,t,r.children,n),r=xt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Qp(e,n,t);else if(e.tag===19)Qp(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(dt(xt,r),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;n!==null;)e=n.alternate,e!==null&&co(e)===null&&(s=n),n=n.sibling;n=s,n===null?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Dc(t,!1,s,n,a);break;case"backwards":for(n=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&co(e)===null){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Dc(t,!0,n,null,a);break;case"together":Dc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Bi(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function zr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Ms|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(se(153));if(t.child!==null){for(e=t.child,n=ss(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ss(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Uw(e,t,n){switch(t.tag){case 3:Ug(t),Nl();break;case 5:gg(t);break;case 1:mn(t.type)&&ro(t);break;case 4:Id(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,s=t.memoizedProps.value;dt(ao,r._currentValue),r._currentValue=s;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(dt(xt,xt.current&1),t.flags|=128,null):n&t.child.childLanes?Vg(e,t,n):(dt(xt,xt.current&1),e=zr(e,t,n),e!==null?e.sibling:null);dt(xt,xt.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Wg(e,t,n);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),dt(xt,xt.current),r)break;return null;case 22:case 23:return t.lanes=0,Dg(e,t,n)}return zr(e,t,n)}var Hg,Iu,Kg,Gg;Hg=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Iu=function(){};Kg=function(e,t,n,r){var s=e.memoizedProps;if(s!==r){e=t.stateNode,zs(dr.current);var a=null;switch(n){case"input":s=ru(e,s),r=ru(e,r),a=[];break;case"select":s=kt({},s,{value:void 0}),r=kt({},r,{value:void 0}),a=[];break;case"textarea":s=au(e,s),r=au(e,r),a=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=to)}ou(n,r);var i;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var c=s[d];for(i in c)c.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(va.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var u=r[d];if(c=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==c&&(u!=null||c!=null))if(d==="style")if(c){for(i in c)!c.hasOwnProperty(i)||u&&u.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in u)u.hasOwnProperty(i)&&c[i]!==u[i]&&(n||(n={}),n[i]=u[i])}else n||(a||(a=[]),a.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(a=a||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(a=a||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(va.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&pt("scroll",e),a||c===u||(a=[])):(a=a||[]).push(d,u))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}};Gg=function(e,t,n,r){n!==r&&(t.flags|=4)};function Zl(e,t){if(!gt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Qt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var s=e.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Vw(e,t,n){var r=t.pendingProps;switch(Ld(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qt(t),null;case 1:return mn(t.type)&&no(),Qt(t),null;case 3:return r=t.stateNode,bl(),mt(pn),mt(Jt),Md(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(ki(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Un!==null&&(Vu(Un),Un=null))),Iu(e,t),Qt(t),null;case 5:$d(t);var s=zs(Pa.current);if(n=t.type,e!==null&&t.stateNode!=null)Kg(e,t,n,r,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(se(166));return Qt(t),null}if(e=zs(dr.current),ki(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[sr]=t,r[La]=a,e=(t.mode&1)!==0,n){case"dialog":pt("cancel",r),pt("close",r);break;case"iframe":case"object":case"embed":pt("load",r);break;case"video":case"audio":for(s=0;s<sa.length;s++)pt(sa[s],r);break;case"source":pt("error",r);break;case"img":case"image":case"link":pt("error",r),pt("load",r);break;case"details":pt("toggle",r);break;case"input":sp(r,a),pt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},pt("invalid",r);break;case"textarea":ap(r,a),pt("invalid",r)}ou(n,a),s=null;for(var i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="children"?typeof c=="string"?r.textContent!==c&&(a.suppressHydrationWarning!==!0&&Si(r.textContent,c,e),s=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(a.suppressHydrationWarning!==!0&&Si(r.textContent,c,e),s=["children",""+c]):va.hasOwnProperty(i)&&c!=null&&i==="onScroll"&&pt("scroll",r)}switch(n){case"input":pi(r),lp(r,a,!0);break;case"textarea":pi(r),ip(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=to)}r=s,t.updateQueue=r,r!==null&&(t.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Sh(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=i.createElement(n,{is:r.is}):(e=i.createElement(n),n==="select"&&(i=e,r.multiple?i.multiple=!0:r.size&&(i.size=r.size))):e=i.createElementNS(e,n),e[sr]=t,e[La]=r,Hg(e,t,!1,!1),t.stateNode=e;e:{switch(i=cu(n,r),n){case"dialog":pt("cancel",e),pt("close",e),s=r;break;case"iframe":case"object":case"embed":pt("load",e),s=r;break;case"video":case"audio":for(s=0;s<sa.length;s++)pt(sa[s],e);s=r;break;case"source":pt("error",e),s=r;break;case"img":case"image":case"link":pt("error",e),pt("load",e),s=r;break;case"details":pt("toggle",e),s=r;break;case"input":sp(e,r),s=ru(e,r),pt("invalid",e);break;case"option":s=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},s=kt({},r,{value:void 0}),pt("invalid",e);break;case"textarea":ap(e,r),s=au(e,r),pt("invalid",e);break;default:s=r}ou(n,s),c=s;for(a in c)if(c.hasOwnProperty(a)){var u=c[a];a==="style"?Nh(e,u):a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&kh(e,u)):a==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&xa(e,u):typeof u=="number"&&xa(e,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(va.hasOwnProperty(a)?u!=null&&a==="onScroll"&&pt("scroll",e):u!=null&&pd(e,a,u,i))}switch(n){case"input":pi(e),lp(e,r,!1);break;case"textarea":pi(e),ip(e);break;case"option":r.value!=null&&e.setAttribute("value",""+as(r.value));break;case"select":e.multiple=!!r.multiple,a=r.value,a!=null?hl(e,!!r.multiple,a,!1):r.defaultValue!=null&&hl(e,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=to)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Qt(t),null;case 6:if(e&&t.stateNode!=null)Gg(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(se(166));if(n=zs(Pa.current),zs(dr.current),ki(t)){if(r=t.stateNode,n=t.memoizedProps,r[sr]=t,(a=r.nodeValue!==n)&&(e=kn,e!==null))switch(e.tag){case 3:Si(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Si(r.nodeValue,n,(e.mode&1)!==0)}a&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[sr]=t,t.stateNode=r}return Qt(t),null;case 13:if(mt(xt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(gt&&Sn!==null&&t.mode&1&&!(t.flags&128))dg(),Nl(),t.flags|=98560,a=!1;else if(a=ki(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(se(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(se(317));a[sr]=t}else Nl(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Qt(t),a=!1}else Un!==null&&(Vu(Un),Un=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||xt.current&1?$t===0&&($t=3):Qd())),t.updateQueue!==null&&(t.flags|=4),Qt(t),null);case 4:return bl(),Iu(e,t),e===null&&ba(t.stateNode.containerInfo),Qt(t),null;case 10:return _d(t.type._context),Qt(t),null;case 17:return mn(t.type)&&no(),Qt(t),null;case 19:if(mt(xt),a=t.memoizedState,a===null)return Qt(t),null;if(r=(t.flags&128)!==0,i=a.rendering,i===null)if(r)Zl(a,!1);else{if($t!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=co(e),i!==null){for(t.flags|=128,Zl(a,!1),r=i.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)a=n,e=r,a.flags&=14680066,i=a.alternate,i===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,a.type=i.type,e=i.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return dt(xt,xt.current&1|2),t.child}e=e.sibling}a.tail!==null&&Lt()>Ll&&(t.flags|=128,r=!0,Zl(a,!1),t.lanes=4194304)}else{if(!r)if(e=co(i),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Zl(a,!0),a.tail===null&&a.tailMode==="hidden"&&!i.alternate&&!gt)return Qt(t),null}else 2*Lt()-a.renderingStartTime>Ll&&n!==1073741824&&(t.flags|=128,r=!0,Zl(a,!1),t.lanes=4194304);a.isBackwards?(i.sibling=t.child,t.child=i):(n=a.last,n!==null?n.sibling=i:t.child=i,a.last=i)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Lt(),t.sibling=null,n=xt.current,dt(xt,r?n&1|2:n&1),t):(Qt(t),null);case 22:case 23:return Yd(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?wn&1073741824&&(Qt(t),t.subtreeFlags&6&&(t.flags|=8192)):Qt(t),null;case 24:return null;case 25:return null}throw Error(se(156,t.tag))}function Ww(e,t){switch(Ld(t),t.tag){case 1:return mn(t.type)&&no(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return bl(),mt(pn),mt(Jt),Md(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return $d(t),null;case 13:if(mt(xt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(se(340));Nl()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return mt(xt),null;case 4:return bl(),null;case 10:return _d(t.type._context),null;case 22:case 23:return Yd(),null;case 24:return null;default:return null}}var Ci=!1,qt=!1,Hw=typeof WeakSet=="function"?WeakSet:Set,be=null;function ul(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ct(e,t,r)}else n.current=null}function $u(e,t,n){try{n()}catch(r){Ct(e,t,r)}}var qp=!1;function Kw(e,t){if(xu=Ji,e=Jh(),bd(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var i=0,c=-1,u=-1,d=0,h=0,v=e,y=null;t:for(;;){for(var x;v!==n||s!==0&&v.nodeType!==3||(c=i+s),v!==a||r!==0&&v.nodeType!==3||(u=i+r),v.nodeType===3&&(i+=v.nodeValue.length),(x=v.firstChild)!==null;)y=v,v=x;for(;;){if(v===e)break t;if(y===n&&++d===s&&(c=i),y===a&&++h===r&&(u=i),(x=v.nextSibling)!==null)break;v=y,y=v.parentNode}v=x}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(wu={focusedElem:e,selectionRange:n},Ji=!1,be=t;be!==null;)if(t=be,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,be=e;else for(;be!==null;){t=be;try{var k=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var N=k.memoizedProps,j=k.memoizedState,m=t.stateNode,p=m.getSnapshotBeforeUpdate(t.elementType===t.type?N:Dn(t.type,N),j);m.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var g=t.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(se(163))}}catch(w){Ct(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,be=e;break}be=t.return}return k=qp,qp=!1,k}function pa(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&e)===e){var a=s.destroy;s.destroy=void 0,a!==void 0&&$u(t,n,a)}s=s.next}while(s!==r)}}function Vo(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Mu(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Yg(e){var t=e.alternate;t!==null&&(e.alternate=null,Yg(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[sr],delete t[La],delete t[ju],delete t[Lw],delete t[Aw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Qg(e){return e.tag===5||e.tag===3||e.tag===4}function Xp(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Qg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Fu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=to));else if(r!==4&&(e=e.child,e!==null))for(Fu(e,t,n),e=e.sibling;e!==null;)Fu(e,t,n),e=e.sibling}function Ou(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Ou(e,t,n),e=e.sibling;e!==null;)Ou(e,t,n),e=e.sibling}var Ut=null,Bn=!1;function Ur(e,t,n){for(n=n.child;n!==null;)qg(e,t,n),n=n.sibling}function qg(e,t,n){if(ur&&typeof ur.onCommitFiberUnmount=="function")try{ur.onCommitFiberUnmount(Io,n)}catch{}switch(n.tag){case 5:qt||ul(n,t);case 6:var r=Ut,s=Bn;Ut=null,Ur(e,t,n),Ut=r,Bn=s,Ut!==null&&(Bn?(e=Ut,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Ut.removeChild(n.stateNode));break;case 18:Ut!==null&&(Bn?(e=Ut,n=n.stateNode,e.nodeType===8?Tc(e.parentNode,n):e.nodeType===1&&Tc(e,n),ja(e)):Tc(Ut,n.stateNode));break;case 4:r=Ut,s=Bn,Ut=n.stateNode.containerInfo,Bn=!0,Ur(e,t,n),Ut=r,Bn=s;break;case 0:case 11:case 14:case 15:if(!qt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var a=s,i=a.destroy;a=a.tag,i!==void 0&&(a&2||a&4)&&$u(n,t,i),s=s.next}while(s!==r)}Ur(e,t,n);break;case 1:if(!qt&&(ul(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){Ct(n,t,c)}Ur(e,t,n);break;case 21:Ur(e,t,n);break;case 22:n.mode&1?(qt=(r=qt)||n.memoizedState!==null,Ur(e,t,n),qt=r):Ur(e,t,n);break;default:Ur(e,t,n)}}function Jp(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Hw),t.forEach(function(r){var s=t0.bind(null,e,r);n.has(r)||(n.add(r),r.then(s,s))})}}function On(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var a=e,i=t,c=i;e:for(;c!==null;){switch(c.tag){case 5:Ut=c.stateNode,Bn=!1;break e;case 3:Ut=c.stateNode.containerInfo,Bn=!0;break e;case 4:Ut=c.stateNode.containerInfo,Bn=!0;break e}c=c.return}if(Ut===null)throw Error(se(160));qg(a,i,s),Ut=null,Bn=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){Ct(s,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Xg(t,e),t=t.sibling}function Xg(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(On(t,e),tr(e),r&4){try{pa(3,e,e.return),Vo(3,e)}catch(N){Ct(e,e.return,N)}try{pa(5,e,e.return)}catch(N){Ct(e,e.return,N)}}break;case 1:On(t,e),tr(e),r&512&&n!==null&&ul(n,n.return);break;case 5:if(On(t,e),tr(e),r&512&&n!==null&&ul(n,n.return),e.flags&32){var s=e.stateNode;try{xa(s,"")}catch(N){Ct(e,e.return,N)}}if(r&4&&(s=e.stateNode,s!=null)){var a=e.memoizedProps,i=n!==null?n.memoizedProps:a,c=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{c==="input"&&a.type==="radio"&&a.name!=null&&xh(s,a),cu(c,i);var d=cu(c,a);for(i=0;i<u.length;i+=2){var h=u[i],v=u[i+1];h==="style"?Nh(s,v):h==="dangerouslySetInnerHTML"?kh(s,v):h==="children"?xa(s,v):pd(s,h,v,d)}switch(c){case"input":su(s,a);break;case"textarea":wh(s,a);break;case"select":var y=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var x=a.value;x!=null?hl(s,!!a.multiple,x,!1):y!==!!a.multiple&&(a.defaultValue!=null?hl(s,!!a.multiple,a.defaultValue,!0):hl(s,!!a.multiple,a.multiple?[]:"",!1))}s[La]=a}catch(N){Ct(e,e.return,N)}}break;case 6:if(On(t,e),tr(e),r&4){if(e.stateNode===null)throw Error(se(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(N){Ct(e,e.return,N)}}break;case 3:if(On(t,e),tr(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ja(t.containerInfo)}catch(N){Ct(e,e.return,N)}break;case 4:On(t,e),tr(e);break;case 13:On(t,e),tr(e),s=e.child,s.flags&8192&&(a=s.memoizedState!==null,s.stateNode.isHidden=a,!a||s.alternate!==null&&s.alternate.memoizedState!==null||(Kd=Lt())),r&4&&Jp(e);break;case 22:if(h=n!==null&&n.memoizedState!==null,e.mode&1?(qt=(d=qt)||h,On(t,e),qt=d):On(t,e),tr(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!h&&e.mode&1)for(be=e,h=e.child;h!==null;){for(v=be=h;be!==null;){switch(y=be,x=y.child,y.tag){case 0:case 11:case 14:case 15:pa(4,y,y.return);break;case 1:ul(y,y.return);var k=y.stateNode;if(typeof k.componentWillUnmount=="function"){r=y,n=y.return;try{t=r,k.props=t.memoizedProps,k.state=t.memoizedState,k.componentWillUnmount()}catch(N){Ct(r,n,N)}}break;case 5:ul(y,y.return);break;case 22:if(y.memoizedState!==null){em(v);continue}}x!==null?(x.return=y,be=x):em(v)}h=h.sibling}e:for(h=null,v=e;;){if(v.tag===5){if(h===null){h=v;try{s=v.stateNode,d?(a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(c=v.stateNode,u=v.memoizedProps.style,i=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=jh("display",i))}catch(N){Ct(e,e.return,N)}}}else if(v.tag===6){if(h===null)try{v.stateNode.nodeValue=d?"":v.memoizedProps}catch(N){Ct(e,e.return,N)}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===e)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===e)break e;for(;v.sibling===null;){if(v.return===null||v.return===e)break e;h===v&&(h=null),v=v.return}h===v&&(h=null),v.sibling.return=v.return,v=v.sibling}}break;case 19:On(t,e),tr(e),r&4&&Jp(e);break;case 21:break;default:On(t,e),tr(e)}}function tr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Qg(n)){var r=n;break e}n=n.return}throw Error(se(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(xa(s,""),r.flags&=-33);var a=Xp(e);Ou(e,a,s);break;case 3:case 4:var i=r.stateNode.containerInfo,c=Xp(e);Fu(e,c,i);break;default:throw Error(se(161))}}catch(u){Ct(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Gw(e,t,n){be=e,Jg(e)}function Jg(e,t,n){for(var r=(e.mode&1)!==0;be!==null;){var s=be,a=s.child;if(s.tag===22&&r){var i=s.memoizedState!==null||Ci;if(!i){var c=s.alternate,u=c!==null&&c.memoizedState!==null||qt;c=Ci;var d=qt;if(Ci=i,(qt=u)&&!d)for(be=s;be!==null;)i=be,u=i.child,i.tag===22&&i.memoizedState!==null?tm(s):u!==null?(u.return=i,be=u):tm(s);for(;a!==null;)be=a,Jg(a),a=a.sibling;be=s,Ci=c,qt=d}Zp(e)}else s.subtreeFlags&8772&&a!==null?(a.return=s,be=a):Zp(e)}}function Zp(e){for(;be!==null;){var t=be;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:qt||Vo(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!qt)if(n===null)r.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:Dn(t.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&Mp(t,a,r);break;case 3:var i=t.updateQueue;if(i!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Mp(t,i,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var v=h.dehydrated;v!==null&&ja(v)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(se(163))}qt||t.flags&512&&Mu(t)}catch(y){Ct(t,t.return,y)}}if(t===e){be=null;break}if(n=t.sibling,n!==null){n.return=t.return,be=n;break}be=t.return}}function em(e){for(;be!==null;){var t=be;if(t===e){be=null;break}var n=t.sibling;if(n!==null){n.return=t.return,be=n;break}be=t.return}}function tm(e){for(;be!==null;){var t=be;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Vo(4,t)}catch(u){Ct(t,n,u)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var s=t.return;try{r.componentDidMount()}catch(u){Ct(t,s,u)}}var a=t.return;try{Mu(t)}catch(u){Ct(t,a,u)}break;case 5:var i=t.return;try{Mu(t)}catch(u){Ct(t,i,u)}}}catch(u){Ct(t,t.return,u)}if(t===e){be=null;break}var c=t.sibling;if(c!==null){c.return=t.return,be=c;break}be=t.return}}var Yw=Math.ceil,po=_r.ReactCurrentDispatcher,Wd=_r.ReactCurrentOwner,zn=_r.ReactCurrentBatchConfig,tt=0,Dt=null,Tt=null,Vt=0,wn=0,dl=us(0),$t=0,Ra=null,Ms=0,Wo=0,Hd=0,ma=null,dn=null,Kd=0,Ll=1/0,Sr=null,mo=!1,Du=null,ns=null,bi=!1,Qr=null,ho=0,ha=0,Bu=null,Ui=-1,Vi=0;function an(){return tt&6?Lt():Ui!==-1?Ui:Ui=Lt()}function rs(e){return e.mode&1?tt&2&&Vt!==0?Vt&-Vt:zw.transition!==null?(Vi===0&&(Vi=$h()),Vi):(e=it,e!==0||(e=window.event,e=e===void 0?16:Vh(e.type)),e):1}function Wn(e,t,n,r){if(50<ha)throw ha=0,Bu=null,Error(se(185));Ba(e,n,r),(!(tt&2)||e!==Dt)&&(e===Dt&&(!(tt&2)&&(Wo|=n),$t===4&&Kr(e,Vt)),hn(e,r),n===1&&tt===0&&!(t.mode&1)&&(Ll=Lt()+500,Do&&ds()))}function hn(e,t){var n=e.callbackNode;zx(e,t);var r=Xi(e,e===Dt?Vt:0);if(r===0)n!==null&&up(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&up(n),t===1)e.tag===0?Pw(nm.bind(null,e)):og(nm.bind(null,e)),bw(function(){!(tt&6)&&ds()}),n=null;else{switch(Mh(r)){case 1:n=vd;break;case 4:n=Rh;break;case 16:n=qi;break;case 536870912:n=Ih;break;default:n=qi}n=ay(n,Zg.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Zg(e,t){if(Ui=-1,Vi=0,tt&6)throw Error(se(327));var n=e.callbackNode;if(wl()&&e.callbackNode!==n)return null;var r=Xi(e,e===Dt?Vt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=go(e,r);else{t=r;var s=tt;tt|=2;var a=ty();(Dt!==e||Vt!==t)&&(Sr=null,Ll=Lt()+500,_s(e,t));do try{Xw();break}catch(c){ey(e,c)}while(!0);zd(),po.current=a,tt=s,Tt!==null?t=0:(Dt=null,Vt=0,t=$t)}if(t!==0){if(t===2&&(s=mu(e),s!==0&&(r=s,t=Uu(e,s))),t===1)throw n=Ra,_s(e,0),Kr(e,r),hn(e,Lt()),n;if(t===6)Kr(e,r);else{if(s=e.current.alternate,!(r&30)&&!Qw(s)&&(t=go(e,r),t===2&&(a=mu(e),a!==0&&(r=a,t=Uu(e,a))),t===1))throw n=Ra,_s(e,0),Kr(e,r),hn(e,Lt()),n;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(se(345));case 2:Es(e,dn,Sr);break;case 3:if(Kr(e,r),(r&130023424)===r&&(t=Kd+500-Lt(),10<t)){if(Xi(e,0)!==0)break;if(s=e.suspendedLanes,(s&r)!==r){an(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=ku(Es.bind(null,e,dn,Sr),t);break}Es(e,dn,Sr);break;case 4:if(Kr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,s=-1;0<r;){var i=31-Vn(r);a=1<<i,i=t[i],i>s&&(s=i),r&=~a}if(r=s,r=Lt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Yw(r/1960))-r,10<r){e.timeoutHandle=ku(Es.bind(null,e,dn,Sr),r);break}Es(e,dn,Sr);break;case 5:Es(e,dn,Sr);break;default:throw Error(se(329))}}}return hn(e,Lt()),e.callbackNode===n?Zg.bind(null,e):null}function Uu(e,t){var n=ma;return e.current.memoizedState.isDehydrated&&(_s(e,t).flags|=256),e=go(e,t),e!==2&&(t=dn,dn=n,t!==null&&Vu(t)),e}function Vu(e){dn===null?dn=e:dn.push.apply(dn,e)}function Qw(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],a=s.getSnapshot;s=s.value;try{if(!Hn(a(),s))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kr(e,t){for(t&=~Hd,t&=~Wo,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Vn(t),r=1<<n;e[n]=-1,t&=~r}}function nm(e){if(tt&6)throw Error(se(327));wl();var t=Xi(e,0);if(!(t&1))return hn(e,Lt()),null;var n=go(e,t);if(e.tag!==0&&n===2){var r=mu(e);r!==0&&(t=r,n=Uu(e,r))}if(n===1)throw n=Ra,_s(e,0),Kr(e,t),hn(e,Lt()),n;if(n===6)throw Error(se(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Es(e,dn,Sr),hn(e,Lt()),null}function Gd(e,t){var n=tt;tt|=1;try{return e(t)}finally{tt=n,tt===0&&(Ll=Lt()+500,Do&&ds())}}function Fs(e){Qr!==null&&Qr.tag===0&&!(tt&6)&&wl();var t=tt;tt|=1;var n=zn.transition,r=it;try{if(zn.transition=null,it=1,e)return e()}finally{it=r,zn.transition=n,tt=t,!(tt&6)&&ds()}}function Yd(){wn=dl.current,mt(dl)}function _s(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Cw(n)),Tt!==null)for(n=Tt.return;n!==null;){var r=n;switch(Ld(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&no();break;case 3:bl(),mt(pn),mt(Jt),Md();break;case 5:$d(r);break;case 4:bl();break;case 13:mt(xt);break;case 19:mt(xt);break;case 10:_d(r.type._context);break;case 22:case 23:Yd()}n=n.return}if(Dt=e,Tt=e=ss(e.current,null),Vt=wn=t,$t=0,Ra=null,Hd=Wo=Ms=0,dn=ma=null,Ps!==null){for(t=0;t<Ps.length;t++)if(n=Ps[t],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,a=n.pending;if(a!==null){var i=a.next;a.next=s,r.next=i}n.pending=r}Ps=null}return e}function ey(e,t){do{var n=Tt;try{if(zd(),Oi.current=fo,uo){for(var r=wt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}uo=!1}if($s=0,Ot=It=wt=null,fa=!1,za=0,Wd.current=null,n===null||n.return===null){$t=1,Ra=t,Tt=null;break}e:{var a=e,i=n.return,c=n,u=t;if(t=Vt,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,h=c,v=h.tag;if(!(h.mode&1)&&(v===0||v===11||v===15)){var y=h.alternate;y?(h.updateQueue=y.updateQueue,h.memoizedState=y.memoizedState,h.lanes=y.lanes):(h.updateQueue=null,h.memoizedState=null)}var x=Vp(i);if(x!==null){x.flags&=-257,Wp(x,i,c,a,t),x.mode&1&&Up(a,d,t),t=x,u=d;var k=t.updateQueue;if(k===null){var N=new Set;N.add(u),t.updateQueue=N}else k.add(u);break e}else{if(!(t&1)){Up(a,d,t),Qd();break e}u=Error(se(426))}}else if(gt&&c.mode&1){var j=Vp(i);if(j!==null){!(j.flags&65536)&&(j.flags|=256),Wp(j,i,c,a,t),Ad(El(u,c));break e}}a=u=El(u,c),$t!==4&&($t=2),ma===null?ma=[a]:ma.push(a),a=i;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var m=Mg(a,u,t);$p(a,m);break e;case 1:c=u;var p=a.type,g=a.stateNode;if(!(a.flags&128)&&(typeof p.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ns===null||!ns.has(g)))){a.flags|=65536,t&=-t,a.lanes|=t;var w=Fg(a,c,t);$p(a,w);break e}}a=a.return}while(a!==null)}ry(n)}catch(b){t=b,Tt===n&&n!==null&&(Tt=n=n.return);continue}break}while(!0)}function ty(){var e=po.current;return po.current=fo,e===null?fo:e}function Qd(){($t===0||$t===3||$t===2)&&($t=4),Dt===null||!(Ms&268435455)&&!(Wo&268435455)||Kr(Dt,Vt)}function go(e,t){var n=tt;tt|=2;var r=ty();(Dt!==e||Vt!==t)&&(Sr=null,_s(e,t));do try{qw();break}catch(s){ey(e,s)}while(!0);if(zd(),tt=n,po.current=r,Tt!==null)throw Error(se(261));return Dt=null,Vt=0,$t}function qw(){for(;Tt!==null;)ny(Tt)}function Xw(){for(;Tt!==null&&!kx();)ny(Tt)}function ny(e){var t=ly(e.alternate,e,wn);e.memoizedProps=e.pendingProps,t===null?ry(e):Tt=t,Wd.current=null}function ry(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Ww(n,t),n!==null){n.flags&=32767,Tt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{$t=6,Tt=null;return}}else if(n=Vw(n,t,wn),n!==null){Tt=n;return}if(t=t.sibling,t!==null){Tt=t;return}Tt=t=e}while(t!==null);$t===0&&($t=5)}function Es(e,t,n){var r=it,s=zn.transition;try{zn.transition=null,it=1,Jw(e,t,n,r)}finally{zn.transition=s,it=r}return null}function Jw(e,t,n,r){do wl();while(Qr!==null);if(tt&6)throw Error(se(327));n=e.finishedWork;var s=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(se(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(_x(e,a),e===Dt&&(Tt=Dt=null,Vt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||bi||(bi=!0,ay(qi,function(){return wl(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=zn.transition,zn.transition=null;var i=it;it=1;var c=tt;tt|=4,Wd.current=null,Kw(e,n),Xg(n,e),vw(wu),Ji=!!xu,wu=xu=null,e.current=n,Gw(n),jx(),tt=c,it=i,zn.transition=a}else e.current=n;if(bi&&(bi=!1,Qr=e,ho=s),a=e.pendingLanes,a===0&&(ns=null),bx(n.stateNode),hn(e,Lt()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(mo)throw mo=!1,e=Du,Du=null,e;return ho&1&&e.tag!==0&&wl(),a=e.pendingLanes,a&1?e===Bu?ha++:(ha=0,Bu=e):ha=0,ds(),null}function wl(){if(Qr!==null){var e=Mh(ho),t=zn.transition,n=it;try{if(zn.transition=null,it=16>e?16:e,Qr===null)var r=!1;else{if(e=Qr,Qr=null,ho=0,tt&6)throw Error(se(331));var s=tt;for(tt|=4,be=e.current;be!==null;){var a=be,i=a.child;if(be.flags&16){var c=a.deletions;if(c!==null){for(var u=0;u<c.length;u++){var d=c[u];for(be=d;be!==null;){var h=be;switch(h.tag){case 0:case 11:case 15:pa(8,h,a)}var v=h.child;if(v!==null)v.return=h,be=v;else for(;be!==null;){h=be;var y=h.sibling,x=h.return;if(Yg(h),h===d){be=null;break}if(y!==null){y.return=x,be=y;break}be=x}}}var k=a.alternate;if(k!==null){var N=k.child;if(N!==null){k.child=null;do{var j=N.sibling;N.sibling=null,N=j}while(N!==null)}}be=a}}if(a.subtreeFlags&2064&&i!==null)i.return=a,be=i;else e:for(;be!==null;){if(a=be,a.flags&2048)switch(a.tag){case 0:case 11:case 15:pa(9,a,a.return)}var m=a.sibling;if(m!==null){m.return=a.return,be=m;break e}be=a.return}}var p=e.current;for(be=p;be!==null;){i=be;var g=i.child;if(i.subtreeFlags&2064&&g!==null)g.return=i,be=g;else e:for(i=p;be!==null;){if(c=be,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Vo(9,c)}}catch(b){Ct(c,c.return,b)}if(c===i){be=null;break e}var w=c.sibling;if(w!==null){w.return=c.return,be=w;break e}be=c.return}}if(tt=s,ds(),ur&&typeof ur.onPostCommitFiberRoot=="function")try{ur.onPostCommitFiberRoot(Io,e)}catch{}r=!0}return r}finally{it=n,zn.transition=t}}return!1}function rm(e,t,n){t=El(n,t),t=Mg(e,t,1),e=ts(e,t,1),t=an(),e!==null&&(Ba(e,1,t),hn(e,t))}function Ct(e,t,n){if(e.tag===3)rm(e,e,n);else for(;t!==null;){if(t.tag===3){rm(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ns===null||!ns.has(r))){e=El(n,e),e=Fg(t,e,1),t=ts(t,e,1),e=an(),t!==null&&(Ba(t,1,e),hn(t,e));break}}t=t.return}}function Zw(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=an(),e.pingedLanes|=e.suspendedLanes&n,Dt===e&&(Vt&n)===n&&($t===4||$t===3&&(Vt&130023424)===Vt&&500>Lt()-Kd?_s(e,0):Hd|=n),hn(e,t)}function sy(e,t){t===0&&(e.mode&1?(t=gi,gi<<=1,!(gi&130023424)&&(gi=4194304)):t=1);var n=an();e=Pr(e,t),e!==null&&(Ba(e,t,n),hn(e,n))}function e0(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),sy(e,n)}function t0(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(se(314))}r!==null&&r.delete(t),sy(e,n)}var ly;ly=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||pn.current)fn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return fn=!1,Uw(e,t,n);fn=!!(e.flags&131072)}else fn=!1,gt&&t.flags&1048576&&cg(t,lo,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Bi(e,t),e=t.pendingProps;var s=jl(t,Jt.current);xl(t,n),s=Od(null,t,r,e,s,n);var a=Dd();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,mn(r)?(a=!0,ro(t)):a=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Rd(t),s.updater=Uo,t.stateNode=s,s._reactInternals=t,Au(t,r,e,n),t=_u(null,t,r,!0,a,n)):(t.tag=0,gt&&a&&Ed(t),sn(null,t,s,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Bi(e,t),e=t.pendingProps,s=r._init,r=s(r._payload),t.type=r,s=t.tag=r0(r),e=Dn(r,e),s){case 0:t=zu(null,t,r,e,n);break e;case 1:t=Gp(null,t,r,e,n);break e;case 11:t=Hp(null,t,r,e,n);break e;case 14:t=Kp(null,t,r,Dn(r.type,e),n);break e}throw Error(se(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Dn(r,s),zu(e,t,r,s,n);case 1:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Dn(r,s),Gp(e,t,r,s,n);case 3:e:{if(Ug(t),e===null)throw Error(se(387));r=t.pendingProps,a=t.memoizedState,s=a.element,hg(e,t),oo(t,r,null,n);var i=t.memoizedState;if(r=i.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){s=El(Error(se(423)),t),t=Yp(e,t,r,n,s);break e}else if(r!==s){s=El(Error(se(424)),t),t=Yp(e,t,r,n,s);break e}else for(Sn=es(t.stateNode.containerInfo.firstChild),kn=t,gt=!0,Un=null,n=pg(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Nl(),r===s){t=zr(e,t,n);break e}sn(e,t,r,n)}t=t.child}return t;case 5:return gg(t),e===null&&bu(t),r=t.type,s=t.pendingProps,a=e!==null?e.memoizedProps:null,i=s.children,Su(r,s)?i=null:a!==null&&Su(r,a)&&(t.flags|=32),Bg(e,t),sn(e,t,i,n),t.child;case 6:return e===null&&bu(t),null;case 13:return Vg(e,t,n);case 4:return Id(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Cl(t,null,r,n):sn(e,t,r,n),t.child;case 11:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Dn(r,s),Hp(e,t,r,s,n);case 7:return sn(e,t,t.pendingProps,n),t.child;case 8:return sn(e,t,t.pendingProps.children,n),t.child;case 12:return sn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,a=t.memoizedProps,i=s.value,dt(ao,r._currentValue),r._currentValue=i,a!==null)if(Hn(a.value,i)){if(a.children===s.children&&!pn.current){t=zr(e,t,n);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var c=a.dependencies;if(c!==null){i=a.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(a.tag===1){u=br(-1,n&-n),u.tag=2;var d=a.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?u.next=u:(u.next=h.next,h.next=u),d.pending=u}}a.lanes|=n,u=a.alternate,u!==null&&(u.lanes|=n),Eu(a.return,n,t),c.lanes|=n;break}u=u.next}}else if(a.tag===10)i=a.type===t.type?null:a.child;else if(a.tag===18){if(i=a.return,i===null)throw Error(se(341));i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Eu(i,n,t),i=a.sibling}else i=a.child;if(i!==null)i.return=a;else for(i=a;i!==null;){if(i===t){i=null;break}if(a=i.sibling,a!==null){a.return=i.return,i=a;break}i=i.return}a=i}sn(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,xl(t,n),s=_n(s),r=r(s),t.flags|=1,sn(e,t,r,n),t.child;case 14:return r=t.type,s=Dn(r,t.pendingProps),s=Dn(r.type,s),Kp(e,t,r,s,n);case 15:return Og(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:Dn(r,s),Bi(e,t),t.tag=1,mn(r)?(e=!0,ro(t)):e=!1,xl(t,n),$g(t,r,s),Au(t,r,s,n),_u(null,t,r,!0,e,n);case 19:return Wg(e,t,n);case 22:return Dg(e,t,n)}throw Error(se(156,t.tag))};function ay(e,t){return Th(e,t)}function n0(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pn(e,t,n,r){return new n0(e,t,n,r)}function qd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function r0(e){if(typeof e=="function")return qd(e)?1:0;if(e!=null){if(e=e.$$typeof,e===hd)return 11;if(e===gd)return 14}return 2}function ss(e,t){var n=e.alternate;return n===null?(n=Pn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Wi(e,t,n,r,s,a){var i=2;if(r=e,typeof e=="function")qd(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case tl:return Ts(n.children,s,a,t);case md:i=8,s|=8;break;case Zc:return e=Pn(12,n,t,s|2),e.elementType=Zc,e.lanes=a,e;case eu:return e=Pn(13,n,t,s),e.elementType=eu,e.lanes=a,e;case tu:return e=Pn(19,n,t,s),e.elementType=tu,e.lanes=a,e;case gh:return Ho(n,s,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case mh:i=10;break e;case hh:i=9;break e;case hd:i=11;break e;case gd:i=14;break e;case Vr:i=16,r=null;break e}throw Error(se(130,e==null?e:typeof e,""))}return t=Pn(i,n,t,s),t.elementType=e,t.type=r,t.lanes=a,t}function Ts(e,t,n,r){return e=Pn(7,e,r,t),e.lanes=n,e}function Ho(e,t,n,r){return e=Pn(22,e,r,t),e.elementType=gh,e.lanes=n,e.stateNode={isHidden:!1},e}function Bc(e,t,n){return e=Pn(6,e,null,t),e.lanes=n,e}function Uc(e,t,n){return t=Pn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function s0(e,t,n,r,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kc(0),this.expirationTimes=kc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kc(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Xd(e,t,n,r,s,a,i,c,u){return e=new s0(e,t,n,c,u),t===1?(t=1,a===!0&&(t|=8)):t=0,a=Pn(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rd(a),e}function l0(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:el,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function iy(e){if(!e)return is;e=e._reactInternals;e:{if(Ds(e)!==e||e.tag!==1)throw Error(se(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(mn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(se(171))}if(e.tag===1){var n=e.type;if(mn(n))return ig(e,n,t)}return t}function oy(e,t,n,r,s,a,i,c,u){return e=Xd(n,r,!0,e,s,a,i,c,u),e.context=iy(null),n=e.current,r=an(),s=rs(n),a=br(r,s),a.callback=t??null,ts(n,a,s),e.current.lanes=s,Ba(e,s,r),hn(e,r),e}function Ko(e,t,n,r){var s=t.current,a=an(),i=rs(s);return n=iy(n),t.context===null?t.context=n:t.pendingContext=n,t=br(a,i),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=ts(s,t,i),e!==null&&(Wn(e,s,i,a),Fi(e,s,i)),i}function yo(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function sm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Jd(e,t){sm(e,t),(e=e.alternate)&&sm(e,t)}function a0(){return null}var cy=typeof reportError=="function"?reportError:function(e){console.error(e)};function Zd(e){this._internalRoot=e}Go.prototype.render=Zd.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(se(409));Ko(e,t,null,null)};Go.prototype.unmount=Zd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Fs(function(){Ko(null,e,null,null)}),t[Ar]=null}};function Go(e){this._internalRoot=e}Go.prototype.unstable_scheduleHydration=function(e){if(e){var t=Dh();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Hr.length&&t!==0&&t<Hr[n].priority;n++);Hr.splice(n,0,e),n===0&&Uh(e)}};function ef(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Yo(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function lm(){}function i0(e,t,n,r,s){if(s){if(typeof r=="function"){var a=r;r=function(){var d=yo(i);a.call(d)}}var i=oy(t,r,e,0,null,!1,!1,"",lm);return e._reactRootContainer=i,e[Ar]=i.current,ba(e.nodeType===8?e.parentNode:e),Fs(),i}for(;s=e.lastChild;)e.removeChild(s);if(typeof r=="function"){var c=r;r=function(){var d=yo(u);c.call(d)}}var u=Xd(e,0,!1,null,null,!1,!1,"",lm);return e._reactRootContainer=u,e[Ar]=u.current,ba(e.nodeType===8?e.parentNode:e),Fs(function(){Ko(t,u,n,r)}),u}function Qo(e,t,n,r,s){var a=n._reactRootContainer;if(a){var i=a;if(typeof s=="function"){var c=s;s=function(){var u=yo(i);c.call(u)}}Ko(t,i,e,s)}else i=i0(n,t,e,s,r);return yo(i)}Fh=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ra(t.pendingLanes);n!==0&&(xd(t,n|1),hn(t,Lt()),!(tt&6)&&(Ll=Lt()+500,ds()))}break;case 13:Fs(function(){var r=Pr(e,1);if(r!==null){var s=an();Wn(r,e,1,s)}}),Jd(e,1)}};wd=function(e){if(e.tag===13){var t=Pr(e,134217728);if(t!==null){var n=an();Wn(t,e,134217728,n)}Jd(e,134217728)}};Oh=function(e){if(e.tag===13){var t=rs(e),n=Pr(e,t);if(n!==null){var r=an();Wn(n,e,t,r)}Jd(e,t)}};Dh=function(){return it};Bh=function(e,t){var n=it;try{return it=e,t()}finally{it=n}};du=function(e,t,n){switch(t){case"input":if(su(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=Oo(r);if(!s)throw Error(se(90));vh(r),su(r,s)}}}break;case"textarea":wh(e,n);break;case"select":t=n.value,t!=null&&hl(e,!!n.multiple,t,!1)}};Eh=Gd;Lh=Fs;var o0={usingClientEntryPoint:!1,Events:[Va,ll,Oo,Ch,bh,Gd]},ea={findFiberByHostInstance:As,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},c0={bundleType:ea.bundleType,version:ea.version,rendererPackageName:ea.rendererPackageName,rendererConfig:ea.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_r.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=zh(e),e===null?null:e.stateNode},findFiberByHostInstance:ea.findFiberByHostInstance||a0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ei=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ei.isDisabled&&Ei.supportsFiber)try{Io=Ei.inject(c0),ur=Ei}catch{}}Nn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=o0;Nn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ef(t))throw Error(se(200));return l0(e,t,null,n)};Nn.createRoot=function(e,t){if(!ef(e))throw Error(se(299));var n=!1,r="",s=cy;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=Xd(e,1,!1,null,null,n,!1,r,s),e[Ar]=t.current,ba(e.nodeType===8?e.parentNode:e),new Zd(t)};Nn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(se(188)):(e=Object.keys(e).join(","),Error(se(268,e)));return e=zh(t),e=e===null?null:e.stateNode,e};Nn.flushSync=function(e){return Fs(e)};Nn.hydrate=function(e,t,n){if(!Yo(t))throw Error(se(200));return Qo(null,e,t,!0,n)};Nn.hydrateRoot=function(e,t,n){if(!ef(e))throw Error(se(405));var r=n!=null&&n.hydratedSources||null,s=!1,a="",i=cy;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),t=oy(t,null,e,1,n??null,s,!1,a,i),e[Ar]=t.current,ba(e),r)for(e=0;e<r.length;e++)n=r[e],s=n._getVersion,s=s(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Go(t)};Nn.render=function(e,t,n){if(!Yo(t))throw Error(se(200));return Qo(null,e,t,!1,n)};Nn.unmountComponentAtNode=function(e){if(!Yo(e))throw Error(se(40));return e._reactRootContainer?(Fs(function(){Qo(null,null,e,!1,function(){e._reactRootContainer=null,e[Ar]=null})}),!0):!1};Nn.unstable_batchedUpdates=Gd;Nn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Yo(n))throw Error(se(200));if(e==null||e._reactInternals===void 0)throw Error(se(38));return Qo(e,t,n,!1,r)};Nn.version="18.3.1-next-f1338f8080-20240426";function uy(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(uy)}catch(e){console.error(e)}}uy(),uh.exports=Nn;var tf=uh.exports,am=tf;Xc.createRoot=am.createRoot,Xc.hydrateRoot=am.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ia(){return Ia=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ia.apply(this,arguments)}var qr;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(qr||(qr={}));const im="popstate";function u0(e){e===void 0&&(e={});function t(s,a){let{pathname:i="/",search:c="",hash:u=""}=Bs(s.location.hash.substr(1));return!i.startsWith("/")&&!i.startsWith(".")&&(i="/"+i),Wu("",{pathname:i,search:c,hash:u},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(s,a){let i=s.document.querySelector("base"),c="";if(i&&i.getAttribute("href")){let u=s.location.href,d=u.indexOf("#");c=d===-1?u:u.slice(0,d)}return c+"#"+(typeof a=="string"?a:vo(a))}function r(s,a){nf(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")}return f0(t,n,r,e)}function St(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function nf(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function d0(){return Math.random().toString(36).substr(2,8)}function om(e,t){return{usr:e.state,key:e.key,idx:t}}function Wu(e,t,n,r){return n===void 0&&(n=null),Ia({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Bs(t):t,{state:n,key:t&&t.key||r||d0()})}function vo(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Bs(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function f0(e,t,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:a=!1}=r,i=s.history,c=qr.Pop,u=null,d=h();d==null&&(d=0,i.replaceState(Ia({},i.state,{idx:d}),""));function h(){return(i.state||{idx:null}).idx}function v(){c=qr.Pop;let j=h(),m=j==null?null:j-d;d=j,u&&u({action:c,location:N.location,delta:m})}function y(j,m){c=qr.Push;let p=Wu(N.location,j,m);n&&n(p,j),d=h()+1;let g=om(p,d),w=N.createHref(p);try{i.pushState(g,"",w)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;s.location.assign(w)}a&&u&&u({action:c,location:N.location,delta:1})}function x(j,m){c=qr.Replace;let p=Wu(N.location,j,m);n&&n(p,j),d=h();let g=om(p,d),w=N.createHref(p);i.replaceState(g,"",w),a&&u&&u({action:c,location:N.location,delta:0})}function k(j){let m=s.location.origin!=="null"?s.location.origin:s.location.href,p=typeof j=="string"?j:vo(j);return p=p.replace(/ $/,"%20"),St(m,"No window.location.(origin|href) available to create URL for href: "+p),new URL(p,m)}let N={get action(){return c},get location(){return e(s,i)},listen(j){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(im,v),u=j,()=>{s.removeEventListener(im,v),u=null}},createHref(j){return t(s,j)},createURL:k,encodeLocation(j){let m=k(j);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:y,replace:x,go(j){return i.go(j)}};return N}var cm;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(cm||(cm={}));function p0(e,t,n){return n===void 0&&(n="/"),m0(e,t,n)}function m0(e,t,n,r){let s=typeof t=="string"?Bs(t):t,a=Al(s.pathname||"/",n);if(a==null)return null;let i=dy(e);h0(i);let c=null;for(let u=0;c==null&&u<i.length;++u){let d=b0(a);c=N0(i[u],d)}return c}function dy(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(a,i,c)=>{let u={relativePath:c===void 0?a.path||"":c,caseSensitive:a.caseSensitive===!0,childrenIndex:i,route:a};u.relativePath.startsWith("/")&&(St(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=ls([r,u.relativePath]),h=n.concat(u);a.children&&a.children.length>0&&(St(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),dy(a.children,t,h,d)),!(a.path==null&&!a.index)&&t.push({path:d,score:k0(d,a.index),routesMeta:h})};return e.forEach((a,i)=>{var c;if(a.path===""||!((c=a.path)!=null&&c.includes("?")))s(a,i);else for(let u of fy(a.path))s(a,i,u)}),t}function fy(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,s=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return s?[a,""]:[a];let i=fy(r.join("/")),c=[];return c.push(...i.map(u=>u===""?a:[a,u].join("/"))),s&&c.push(...i),c.map(u=>e.startsWith("/")&&u===""?"/":u)}function h0(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:j0(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const g0=/^:[\w-]+$/,y0=3,v0=2,x0=1,w0=10,S0=-2,um=e=>e==="*";function k0(e,t){let n=e.split("/"),r=n.length;return n.some(um)&&(r+=S0),t&&(r+=v0),n.filter(s=>!um(s)).reduce((s,a)=>s+(g0.test(a)?y0:a===""?x0:w0),r)}function j0(e,t){return e.length===t.length&&e.slice(0,-1).every((r,s)=>r===t[s])?e[e.length-1]-t[t.length-1]:0}function N0(e,t,n){let{routesMeta:r}=e,s={},a="/",i=[];for(let c=0;c<r.length;++c){let u=r[c],d=c===r.length-1,h=a==="/"?t:t.slice(a.length)||"/",v=Hu({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),y=u.route;if(!v)return null;Object.assign(s,v.params),i.push({params:s,pathname:ls([a,v.pathname]),pathnameBase:P0(ls([a,v.pathnameBase])),route:y}),v.pathnameBase!=="/"&&(a=ls([a,v.pathnameBase]))}return i}function Hu(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=C0(e.path,e.caseSensitive,e.end),s=t.match(n);if(!s)return null;let a=s[0],i=a.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:r.reduce((d,h,v)=>{let{paramName:y,isOptional:x}=h;if(y==="*"){let N=c[v]||"";i=a.slice(0,a.length-N.length).replace(/(.)\/+$/,"$1")}const k=c[v];return x&&!k?d[y]=void 0:d[y]=(k||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:i,pattern:e}}function C0(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),nf(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,c,u)=>(r.push({paramName:c,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),r]}function b0(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return nf(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Al(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function E0(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:s=""}=typeof e=="string"?Bs(e):e;return{pathname:n?n.startsWith("/")?n:L0(n,t):t,search:z0(r),hash:_0(s)}}function L0(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Vc(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function A0(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function rf(e,t){let n=A0(e);return t?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function sf(e,t,n,r){r===void 0&&(r=!1);let s;typeof e=="string"?s=Bs(e):(s=Ia({},e),St(!s.pathname||!s.pathname.includes("?"),Vc("?","pathname","search",s)),St(!s.pathname||!s.pathname.includes("#"),Vc("#","pathname","hash",s)),St(!s.search||!s.search.includes("#"),Vc("#","search","hash",s)));let a=e===""||s.pathname==="",i=a?"/":s.pathname,c;if(i==null)c=n;else{let v=t.length-1;if(!r&&i.startsWith("..")){let y=i.split("/");for(;y[0]==="..";)y.shift(),v-=1;s.pathname=y.join("/")}c=v>=0?t[v]:"/"}let u=E0(s,c),d=i&&i!=="/"&&i.endsWith("/"),h=(a||i===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const ls=e=>e.join("/").replace(/\/\/+/g,"/"),P0=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),z0=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,_0=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function T0(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const py=["post","put","patch","delete"];new Set(py);const R0=["get",...py];new Set(R0);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $a(){return $a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$a.apply(this,arguments)}const qo=o.createContext(null),my=o.createContext(null),Tr=o.createContext(null),Xo=o.createContext(null),Rr=o.createContext({outlet:null,matches:[],isDataRoute:!1}),hy=o.createContext(null);function I0(e,t){let{relative:n}=t===void 0?{}:t;Rl()||St(!1);let{basename:r,navigator:s}=o.useContext(Tr),{hash:a,pathname:i,search:c}=Jo(e,{relative:n}),u=i;return r!=="/"&&(u=i==="/"?r:ls([r,i])),s.createHref({pathname:u,search:c,hash:a})}function Rl(){return o.useContext(Xo)!=null}function yn(){return Rl()||St(!1),o.useContext(Xo).location}function gy(e){o.useContext(Tr).static||o.useLayoutEffect(e)}function Ir(){let{isDataRoute:e}=o.useContext(Rr);return e?q0():$0()}function $0(){Rl()||St(!1);let e=o.useContext(qo),{basename:t,future:n,navigator:r}=o.useContext(Tr),{matches:s}=o.useContext(Rr),{pathname:a}=yn(),i=JSON.stringify(rf(s,n.v7_relativeSplatPath)),c=o.useRef(!1);return gy(()=>{c.current=!0}),o.useCallback(function(d,h){if(h===void 0&&(h={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let v=sf(d,JSON.parse(i),a,h.relative==="path");e==null&&t!=="/"&&(v.pathname=v.pathname==="/"?t:ls([t,v.pathname])),(h.replace?r.replace:r.push)(v,h.state,h)},[t,r,i,a,e])}const M0=o.createContext(null);function F0(e){let t=o.useContext(Rr).outlet;return t&&o.createElement(M0.Provider,{value:e},t)}function Jo(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=o.useContext(Tr),{matches:s}=o.useContext(Rr),{pathname:a}=yn(),i=JSON.stringify(rf(s,r.v7_relativeSplatPath));return o.useMemo(()=>sf(e,JSON.parse(i),a,n==="path"),[e,i,a,n])}function O0(e,t){return D0(e,t)}function D0(e,t,n,r){Rl()||St(!1);let{navigator:s}=o.useContext(Tr),{matches:a}=o.useContext(Rr),i=a[a.length-1],c=i?i.params:{};i&&i.pathname;let u=i?i.pathnameBase:"/";i&&i.route;let d=yn(),h;if(t){var v;let j=typeof t=="string"?Bs(t):t;u==="/"||(v=j.pathname)!=null&&v.startsWith(u)||St(!1),h=j}else h=d;let y=h.pathname||"/",x=y;if(u!=="/"){let j=u.replace(/^\//,"").split("/");x="/"+y.replace(/^\//,"").split("/").slice(j.length).join("/")}let k=p0(e,{pathname:x}),N=H0(k&&k.map(j=>Object.assign({},j,{params:Object.assign({},c,j.params),pathname:ls([u,s.encodeLocation?s.encodeLocation(j.pathname).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?u:ls([u,s.encodeLocation?s.encodeLocation(j.pathnameBase).pathname:j.pathnameBase])})),a,n,r);return t&&N?o.createElement(Xo.Provider,{value:{location:$a({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:qr.Pop}},N):N}function B0(){let e=Q0(),t=T0(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return o.createElement(o.Fragment,null,o.createElement("h2",null,"Unexpected Application Error!"),o.createElement("h3",{style:{fontStyle:"italic"}},t),n?o.createElement("pre",{style:s},n):null,null)}const U0=o.createElement(B0,null);class V0 extends o.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?o.createElement(Rr.Provider,{value:this.props.routeContext},o.createElement(hy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function W0(e){let{routeContext:t,match:n,children:r}=e,s=o.useContext(qo);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),o.createElement(Rr.Provider,{value:t},r)}function H0(e,t,n,r){var s;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var a;if(!n)return null;if(n.errors)e=n.matches;else if((a=r)!=null&&a.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let i=e,c=(s=n)==null?void 0:s.errors;if(c!=null){let h=i.findIndex(v=>v.route.id&&(c==null?void 0:c[v.route.id])!==void 0);h>=0||St(!1),i=i.slice(0,Math.min(i.length,h+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<i.length;h++){let v=i[h];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(d=h),v.route.id){let{loaderData:y,errors:x}=n,k=v.route.loader&&y[v.route.id]===void 0&&(!x||x[v.route.id]===void 0);if(v.route.lazy||k){u=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}return i.reduceRight((h,v,y)=>{let x,k=!1,N=null,j=null;n&&(x=c&&v.route.id?c[v.route.id]:void 0,N=v.route.errorElement||U0,u&&(d<0&&y===0?(X0("route-fallback"),k=!0,j=null):d===y&&(k=!0,j=v.route.hydrateFallbackElement||null)));let m=t.concat(i.slice(0,y+1)),p=()=>{let g;return x?g=N:k?g=j:v.route.Component?g=o.createElement(v.route.Component,null):v.route.element?g=v.route.element:g=h,o.createElement(W0,{match:v,routeContext:{outlet:h,matches:m,isDataRoute:n!=null},children:g})};return n&&(v.route.ErrorBoundary||v.route.errorElement||y===0)?o.createElement(V0,{location:n.location,revalidation:n.revalidation,component:N,error:x,children:p(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):p()},null)}var yy=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(yy||{}),vy=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(vy||{});function K0(e){let t=o.useContext(qo);return t||St(!1),t}function G0(e){let t=o.useContext(my);return t||St(!1),t}function Y0(e){let t=o.useContext(Rr);return t||St(!1),t}function xy(e){let t=Y0(),n=t.matches[t.matches.length-1];return n.route.id||St(!1),n.route.id}function Q0(){var e;let t=o.useContext(hy),n=G0(),r=xy();return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function q0(){let{router:e}=K0(yy.UseNavigateStable),t=xy(vy.UseNavigateStable),n=o.useRef(!1);return gy(()=>{n.current=!0}),o.useCallback(function(s,a){a===void 0&&(a={}),n.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,$a({fromRouteId:t},a)))},[e,t])}const dm={};function X0(e,t,n){dm[e]||(dm[e]=!0)}function J0(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function xo(e){let{to:t,replace:n,state:r,relative:s}=e;Rl()||St(!1);let{future:a,static:i}=o.useContext(Tr),{matches:c}=o.useContext(Rr),{pathname:u}=yn(),d=Ir(),h=sf(t,rf(c,a.v7_relativeSplatPath),u,s==="path"),v=JSON.stringify(h);return o.useEffect(()=>d(JSON.parse(v),{replace:n,state:r,relative:s}),[d,v,s,n,r]),null}function Z0(e){return F0(e.context)}function En(e){St(!1)}function eS(e){let{basename:t="/",children:n=null,location:r,navigationType:s=qr.Pop,navigator:a,static:i=!1,future:c}=e;Rl()&&St(!1);let u=t.replace(/^\/*/,"/"),d=o.useMemo(()=>({basename:u,navigator:a,static:i,future:$a({v7_relativeSplatPath:!1},c)}),[u,c,a,i]);typeof r=="string"&&(r=Bs(r));let{pathname:h="/",search:v="",hash:y="",state:x=null,key:k="default"}=r,N=o.useMemo(()=>{let j=Al(h,u);return j==null?null:{location:{pathname:j,search:v,hash:y,state:x,key:k},navigationType:s}},[u,h,v,y,x,k,s]);return N==null?null:o.createElement(Tr.Provider,{value:d},o.createElement(Xo.Provider,{children:n,value:N}))}function tS(e){let{children:t,location:n}=e;return O0(Ku(t),n)}new Promise(()=>{});function Ku(e,t){t===void 0&&(t=[]);let n=[];return o.Children.forEach(e,(r,s)=>{if(!o.isValidElement(r))return;let a=[...t,s];if(r.type===o.Fragment){n.push.apply(n,Ku(r.props.children,a));return}r.type!==En&&St(!1),!r.props.index||!r.props.children||St(!1);let i={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=Ku(r.props.children,a)),n.push(i)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wo(){return wo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wo.apply(this,arguments)}function wy(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,a;for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function nS(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function rS(e,t){return e.button===0&&(!t||t==="_self")&&!nS(e)}function Gu(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(s=>[n,s]):[[n,r]])},[]))}function sS(e,t){let n=Gu(e);return t&&t.forEach((r,s)=>{n.has(s)||t.getAll(s).forEach(a=>{n.append(s,a)})}),n}const lS=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],aS=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],iS="6";try{window.__reactRouterVersion=iS}catch{}const oS=o.createContext({isTransitioning:!1}),cS="startTransition",fm=Zv[cS];function uS(e){let{basename:t,children:n,future:r,window:s}=e,a=o.useRef();a.current==null&&(a.current=u0({window:s,v5Compat:!0}));let i=a.current,[c,u]=o.useState({action:i.action,location:i.location}),{v7_startTransition:d}=r||{},h=o.useCallback(v=>{d&&fm?fm(()=>u(v)):u(v)},[u,d]);return o.useLayoutEffect(()=>i.listen(h),[i,h]),o.useEffect(()=>J0(r),[r]),o.createElement(eS,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:i,future:r})}const dS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",fS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Sy=o.forwardRef(function(t,n){let{onClick:r,relative:s,reloadDocument:a,replace:i,state:c,target:u,to:d,preventScrollReset:h,viewTransition:v}=t,y=wy(t,lS),{basename:x}=o.useContext(Tr),k,N=!1;if(typeof d=="string"&&fS.test(d)&&(k=d,dS))try{let g=new URL(window.location.href),w=d.startsWith("//")?new URL(g.protocol+d):new URL(d),b=Al(w.pathname,x);w.origin===g.origin&&b!=null?d=b+w.search+w.hash:N=!0}catch{}let j=I0(d,{relative:s}),m=hS(d,{replace:i,state:c,target:u,preventScrollReset:h,relative:s,viewTransition:v});function p(g){r&&r(g),g.defaultPrevented||m(g)}return o.createElement("a",wo({},y,{href:k||j,onClick:N||a?r:p,ref:n,target:u}))}),pS=o.forwardRef(function(t,n){let{"aria-current":r="page",caseSensitive:s=!1,className:a="",end:i=!1,style:c,to:u,viewTransition:d,children:h}=t,v=wy(t,aS),y=Jo(u,{relative:v.relative}),x=yn(),k=o.useContext(my),{navigator:N,basename:j}=o.useContext(Tr),m=k!=null&&gS(y)&&d===!0,p=N.encodeLocation?N.encodeLocation(y).pathname:y.pathname,g=x.pathname,w=k&&k.navigation&&k.navigation.location?k.navigation.location.pathname:null;s||(g=g.toLowerCase(),w=w?w.toLowerCase():null,p=p.toLowerCase()),w&&j&&(w=Al(w,j)||w);const b=p!=="/"&&p.endsWith("/")?p.length-1:p.length;let E=g===p||!i&&g.startsWith(p)&&g.charAt(b)==="/",A=w!=null&&(w===p||!i&&w.startsWith(p)&&w.charAt(p.length)==="/"),I={isActive:E,isPending:A,isTransitioning:m},B=E?r:void 0,T;typeof a=="function"?T=a(I):T=[a,E?"active":null,A?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let $=typeof c=="function"?c(I):c;return o.createElement(Sy,wo({},v,{"aria-current":B,className:T,ref:n,style:$,to:u,viewTransition:d}),typeof h=="function"?h(I):h)});var Yu;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Yu||(Yu={}));var pm;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(pm||(pm={}));function mS(e){let t=o.useContext(qo);return t||St(!1),t}function hS(e,t){let{target:n,replace:r,state:s,preventScrollReset:a,relative:i,viewTransition:c}=t===void 0?{}:t,u=Ir(),d=yn(),h=Jo(e,{relative:i});return o.useCallback(v=>{if(rS(v,n)){v.preventDefault();let y=r!==void 0?r:vo(d)===vo(h);u(e,{replace:y,state:s,preventScrollReset:a,relative:i,viewTransition:c})}},[d,u,h,r,s,n,e,a,i,c])}function lf(e){let t=o.useRef(Gu(e)),n=o.useRef(!1),r=yn(),s=o.useMemo(()=>sS(r.search,n.current?null:t.current),[r.search]),a=Ir(),i=o.useCallback((c,u)=>{const d=Gu(typeof c=="function"?c(s):c);n.current=!0,a("?"+d,u)},[a,s]);return[s,i]}function gS(e,t){t===void 0&&(t={});let n=o.useContext(oS);n==null&&St(!1);let{basename:r}=mS(Yu.useViewTransitionState),s=Jo(e,{relative:t.relative});if(!n.isTransitioning)return!1;let a=Al(n.currentLocation.pathname,r)||n.currentLocation.pathname,i=Al(n.nextLocation.pathname,r)||n.nextLocation.pathname;return Hu(s.pathname,i)!=null||Hu(s.pathname,a)!=null}const Qu="cozygen_token",So="cozygen:auth-expired";function af(){try{return typeof window>"u"?null:localStorage.getItem(Qu)}catch{return null}}function ky(e){try{if(typeof window>"u")return;e?localStorage.setItem(Qu,e):localStorage.removeItem(Qu)}catch{}}function Hi(){ky(null)}function Il(){const e=af();return e?{Authorization:`Bearer ${e}`}:{}}function yS(e={}){if(Hi(),!(typeof window>"u"||typeof window.dispatchEvent!="function"))try{window.dispatchEvent(new CustomEvent(So,{detail:e}))}catch{window.dispatchEvent(new Event(So))}}const Ha=async(e,t)=>{if(t.status===401){yS({url:e,status:t.status});const r=new Error("unauthorized");throw r.unauthorized=!0,r.status=401,r}if(!t.ok)throw new Error(`${e} failed`);return(t.headers.get("content-type")||"").includes("application/json")?t.json():t.text()},fs=async(e,t={})=>{const{signal:n}=t,r=await fetch(e,{headers:{...Il()},credentials:"include",signal:n});return Ha(e,r)},$r=async(e,t,n={})=>{const{signal:r}=n,s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",...Il()},body:JSON.stringify(t),credentials:"include",signal:r});return Ha(e,s)};async function vS(e={}){return fs("/cozygen/workflows",e)}async function xS(e,t={}){return fs(`/cozygen/workflows/${encodeURIComponent(e)}`,t)}async function qu(e,t={}){const{refresh:n=!1,cacheBust:r="",...s}=t||{},a=new URLSearchParams({type:String(e||"")});return n&&a.set("refresh","1"),r&&a.set("cache_bust",String(r)),fs(`/cozygen/get_choices?${a.toString()}`,s)}async function ko(e){const t=await fetch("/prompt",{method:"POST",headers:{"Content-Type":"application/json",...Il()},body:JSON.stringify(e),credentials:"include"});return Ha("/prompt",t)}async function wS(e){const t=new FormData;t.append("image",e);const n=await fetch("/cozygen/upload_image",{method:"POST",headers:{...Il()},body:t,credentials:"include"});return Ha("/cozygen/upload_image",n)}async function jy(e="",t=1,n=50,r=!1,s=!1,a="all",i="",c={}){const{includeMeta:u=!1,...d}=c||{},h=new URLSearchParams({subfolder:e,page:String(t),per_page:String(n),show_hidden:r?"1":"0",recursive:s?"1":"0",kind:a});return u&&h.set("include_meta","1"),i&&h.set("cache_bust",String(i)),fs(`/cozygen/api/gallery?${h.toString()}`,d)}async function SS({filename:e="",subfolder:t=""}={},n={}){const r=new URLSearchParams({filename:String(e||""),subfolder:String(t||"")}),s=await fetch(`/cozygen/api/gallery/prompt?${r.toString()}`,{headers:{...Il()},credentials:"include",signal:n==null?void 0:n.signal}),i=(s.headers.get("content-type")||"").includes("application/json")?await s.json():await s.text();if(!s.ok){const c=new Error((i==null?void 0:i.error)||"Prompt metadata not found");throw c.status=s.status,c.payload=i,c}return i}async function jo({promptId:e="",promptRaw:t=null}={},n={}){return!e||!t?{ok:!1}:typeof t!="object"?{ok:!1}:$r("/cozygen/api/prompt_raw",{prompt_id:String(e),prompt_raw:t},n)}async function Ny({filename:e="",subfolder:t=""}={},n={}){return $r("/cozygen/api/gallery/delete",{filename:e,subfolder:t},n)}async function kS({subfolder:e="",recursive:t=!0,confirm:n="delete-all"}={},r={}){return $r("/cozygen/api/gallery/delete_all",{subfolder:e,recursive:t,confirm:n},r)}async function jS(){return fs("/cozygen/api/aliases")}async function NS(e){return $r("/cozygen/api/aliases",e||{})}async function of(e={}){return fs("/cozygen/api/tags/categories",e)}async function cr({q:e="",category:t="",sort:n="count",minCount:r=0,limit:s=80,offset:a=0}={},i={}){const c=Number.isFinite(Number(r))?Math.max(0,Number(r)):0,u=new URLSearchParams({q:String(e||""),category:String(t||""),sort:String(n||"count"),limit:String(s||80),offset:String(a||0)});return c>0&&u.set("min_count",String(c)),fs(`/cozygen/api/tags/search?${u.toString()}`,i)}async function Wc(e=[],t={}){return $r("/cozygen/api/tags/validate",{tags:Array.isArray(e)?e:[]},t)}async function CS(e,t={}){const n=new URLSearchParams;return e&&n.set("workflow",e),fs(`/cozygen/api/workflow_presets?${n.toString()}`,t)}async function bS(e,t,n={}){return $r("/cozygen/api/workflow_presets",{workflow:e,preset:t},n)}async function ES(e,t,n={}){return $r("/cozygen/api/workflow_presets",{workflow:e,delete:t},n)}async function LS(e,t){return $r("/cozygen/api/login",{username:e,password:t})}async function AS(){return fetch("/cozygen/api/auth_status",{headers:{...Il()},credentials:"include"}).then(e=>Ha("/cozygen/api/auth_status",e))}async function PS(){return $r("/cozygen/api/clear_cache",{})}const zS=30*60*1e3,mm="cozygen_idle_logout",Cy=o.createContext(null);function _S({children:e}){const[t,n]=o.useState(!1),[r,s]=o.useState(null),[a,i]=o.useState(!1),c=o.useRef(null),u=o.useCallback(async()=>{if(!af()){s(null),i(!1),n(!0);return}try{const x=await AS();s((x==null?void 0:x.user)||null),i(!!(x!=null&&x.default_credentials))}catch{Hi(),s(null),i(!1)}finally{n(!0)}},[]);o.useEffect(()=>{u()},[u]);const d=o.useCallback(async(y,x)=>{const k=await LS(y,x);ky((k==null?void 0:k.token)||""),s((k==null?void 0:k.user)||y),i(!!(k!=null&&k.default_credentials));try{localStorage.removeItem(mm)}catch{}return k},[]),h=o.useCallback(()=>{Hi(),s(null),i(!1)},[]);o.useEffect(()=>{if(typeof window>"u")return;const y=()=>{h(),n(!0)};return window.addEventListener(So,y),()=>window.removeEventListener(So,y)},[h]),o.useEffect(()=>{if(!t)return;const y=()=>{c.current&&clearTimeout(c.current);const k=setTimeout(()=>{Hi(),s(null),i(!1);try{localStorage.setItem(mm,"1")}catch{}window.location.hash="#/login"},zS);c.current=k};y();const x=["pointerdown","keydown","visibilitychange"];return x.forEach(k=>window.addEventListener(k,y,{passive:!0})),()=>{c.current&&(clearTimeout(c.current),c.current=null),x.forEach(k=>window.removeEventListener(k,y))}},[t]);const v=o.useMemo(()=>({ready:t,user:r,authed:!!r,defaultCreds:a,login:d,logout:h,refresh:u}),[t,r,a,d,h,u]);return l.jsx(Cy.Provider,{value:v,children:e})}function Zo(){const e=o.useContext(Cy);if(!e)throw new Error("useAuth must be used within AuthProvider");return e}function TS({children:e}){return l.jsx(_S,{children:e})}const K=o.forwardRef(function({as:t,href:n,variant:r,size:s="md",iconOnly:a=!1,active:i=!1,pressed:c,className:u="",type:d,...h},v){const y=t||(n?"a":"button"),x=s==="lg"?"is-lg":s==="sm"?"is-compact":s==="xs"?"is-tiny":s==="mini"?"is-mini":s==="icon"?"is-icon":"",k=r?`is-${r}`:"",m=["ui-button",x,k,a?"is-icon":"",i?"is-active":"",u].filter(Boolean).join(" "),p={ref:v,className:m,"aria-pressed":c,...h};return y==="button"?l.jsx("button",{...p,type:d||"button"}):l.jsx(y,{...p,href:n})}),by=({size:e=32,className:t=""})=>l.jsxs("svg",{width:e,height:e,viewBox:"0 0 32 32",fill:"none",className:t,"aria-hidden":"true",children:[l.jsx("path",{d:"M8 24L20 4",stroke:"url(#logo-gradient)",strokeWidth:"3",strokeLinecap:"round"}),l.jsx("path",{d:"M6 26C6 26 7 24 8 24C9 24 10 25 8 27C6 29 4 28 6 26Z",fill:"url(#logo-warm)"}),l.jsx("circle",{cx:"22",cy:"8",r:"2",fill:"url(#logo-spark)"}),l.jsx("circle",{cx:"26",cy:"12",r:"1.5",fill:"url(#logo-spark)",opacity:"0.8"}),l.jsx("circle",{cx:"24",cy:"16",r:"1",fill:"url(#logo-spark)",opacity:"0.6"}),l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"logo-gradient",x1:"8",y1:"24",x2:"20",y2:"4",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{stopColor:"#FF9F7A"}),l.jsx("stop",{offset:"0.5",stopColor:"#9F8CFF"}),l.jsx("stop",{offset:"1",stopColor:"#44E1C5"})]}),l.jsxs("linearGradient",{id:"logo-warm",x1:"4",y1:"24",x2:"10",y2:"28",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{stopColor:"#FF9F7A"}),l.jsx("stop",{offset:"1",stopColor:"#FFD666"})]}),l.jsxs("radialGradient",{id:"logo-spark",cx:"0.3",cy:"0.3",r:"0.7",children:[l.jsx("stop",{stopColor:"#FFFFFF"}),l.jsx("stop",{offset:"0.5",stopColor:"#44E1C5"}),l.jsx("stop",{offset:"1",stopColor:"#9F8CFF"})]})]})]}),ft=({children:e,size:t=16,className:n="",...r})=>l.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,"aria-hidden":"true",...r,children:e}),RS=e=>l.jsxs(ft,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),l.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("path",{d:"M21 15l-5-5L5 21"})]}),ec=e=>l.jsxs(ft,{...e,children:[l.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"}),l.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7",strokeWidth:"3"})]}),Ey=e=>l.jsxs(ft,{...e,children:[l.jsx("path",{d:"M14 3H4a2 2 0 00-2 2v10l6 6h10a2 2 0 002-2V9l-6-6z"}),l.jsx("path",{d:"M14 3v6h6"}),l.jsx("path",{d:"M7 7h5"}),l.jsx("path",{d:"M7 11h7"})]}),tc=e=>l.jsx(ft,{...e,children:l.jsx("path",{d:"M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"})}),IS=e=>l.jsx(ft,{...e,children:l.jsx("polygon",{points:"5 3 19 12 5 21 5 3",fill:"currentColor",stroke:"none"})}),hm=e=>l.jsxs(ft,{...e,children:[l.jsx("path",{d:"M15 4l2 2-10 10-3 1 1-3L15 4z",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"19",cy:"5",r:"1.5",fill:"currentColor",stroke:"none",opacity:"0.8"}),l.jsx("circle",{cx:"20",cy:"9",r:"1",fill:"currentColor",stroke:"none",opacity:"0.5"})]}),$S=e=>l.jsxs(ft,{...e,children:[l.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"}),l.jsx("polyline",{points:"16 17 21 12 16 7"}),l.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),Ly=e=>l.jsxs(ft,{...e,children:[l.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),l.jsx("line",{x1:"9",y1:"9",x2:"9",y2:"15"}),l.jsx("line",{x1:"15",y1:"9",x2:"15",y2:"15"}),l.jsx("circle",{cx:"9",cy:"12",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"10",r:"1.5",fill:"currentColor",stroke:"none"})]}),MS=e=>l.jsxs(ft,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),l.jsx("circle",{cx:"12",cy:"12",r:"4"}),l.jsx("line",{x1:"3",y1:"9",x2:"6",y2:"9"})]}),No=e=>l.jsxs(ft,{...e,children:[l.jsx("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"}),l.jsx("path",{d:"M2 10h20"})]}),gm=e=>l.jsx(ft,{...e,children:l.jsx("path",{d:"M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"})}),ym=e=>l.jsxs(ft,{...e,children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),vm=e=>l.jsxs(ft,{...e,children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"}),l.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),xm=e=>l.jsx(ft,{...e,children:l.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),Xu=e=>l.jsxs(ft,{...e,children:[l.jsx("path",{d:"M4 6h16"}),l.jsx("path",{d:"M6 6v12a2 2 0 002 2h8a2 2 0 002-2V6"}),l.jsx("path",{d:"M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2"})]}),wm=e=>l.jsxs(ft,{...e,children:[l.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),l.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]}),Ki=e=>l.jsxs(ft,{...e,children:[l.jsx("polyline",{points:"23 4 23 10 17 10"}),l.jsx("path",{d:"M20.49 15a9 9 0 11-2.12-9.36L23 10"})]}),Ay=e=>l.jsx(ft,{...e,children:l.jsx("polyline",{points:"15 18 9 12 15 6"})}),nc=e=>l.jsx(ft,{...e,children:l.jsx("polyline",{points:"9 18 15 12 9 6"})}),Ma=e=>l.jsxs(ft,{...e,children:[l.jsx("circle",{cx:"9",cy:"6",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"6",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"9",cy:"12",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"12",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"9",cy:"18",r:"1",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"15",cy:"18",r:"1",fill:"currentColor",stroke:"none"})]}),os=e=>l.jsxs(ft,{...e,children:[l.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Sm=e=>l.jsxs(ft,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",strokeDasharray:"4 2"}),l.jsx("line",{x1:"9",y1:"12",x2:"15",y2:"12"})]}),FS=e=>l.jsxs(ft,{...e,children:[l.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),l.jsx("polyline",{points:"5 12 12 5 19 12"})]}),OS=e=>l.jsxs(ft,{...e,children:[l.jsx("circle",{cx:"6",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"12",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"18",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"})]}),DS=e=>l.jsxs(ft,{...e,children:[l.jsx("rect",{x:"9",y:"9",width:"10",height:"10",rx:"2"}),l.jsx("path",{d:"M7 15H6a2 2 0 01-2-2V6a2 2 0 012-2h7"})]}),Ju=e=>l.jsxs(ft,{...e,children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"3"}),l.jsx("circle",{cx:"8",cy:"8",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor",stroke:"none"}),l.jsx("circle",{cx:"16",cy:"16",r:"1.5",fill:"currentColor",stroke:"none"})]});function BS(){const{pathname:e}=yn(),{logout:t,user:n}=Zo(),r=e==="/login",s=()=>{try{t()}catch{}window.location.hash="#/login"};return l.jsx("header",{className:"top-bar",children:l.jsx("div",{className:"top-bar-shell",children:l.jsxs("div",{className:"brand-row",children:[l.jsxs(Sy,{to:"/studio",className:"brand-mark",children:[l.jsx(by,{size:28,className:"brand-logo"}),l.jsx("span",{className:"brand-text",children:"CozyGen"})]}),l.jsx("div",{className:"flex-1"}),r?null:l.jsxs(K,{variant:"muted",size:"sm",onClick:s,title:"Sign out",children:[l.jsx("span",{className:"inline-flex items-center justify-center",children:l.jsx($S,{size:16})}),l.jsx("span",{children:"Logout"}),n?l.jsxs("span",{className:"text-xs text-[#9DA3FFB3] hidden sm:inline",children:["@",n]}):null]})]})})})}function US(){const[e,t]=o.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("cozygen_gallery_pending")==="1"}catch{return!1}});return o.useEffect(()=>{const n=()=>t(!0),r=()=>t(!1),s=a=>{a.key==="cozygen_gallery_pending"&&t(a.newValue==="1")};return window.addEventListener("cozygen:gallery-pending",n),window.addEventListener("cozygen:gallery-viewed",r),window.addEventListener("storage",s),()=>{window.removeEventListener("cozygen:gallery-pending",n),window.removeEventListener("cozygen:gallery-viewed",r),window.removeEventListener("storage",s)}},[]),e}function Co(){if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const e=Math.random().toString(16).slice(2);return`cozy-${Date.now().toString(16)}-${e}`}const Py="cozygen_last_render_payload";function Zu(e){if(e)try{if(typeof window>"u")return;window.localStorage.setItem(Py,JSON.stringify(e))}catch{}}function zy(){try{if(typeof window>"u")return null;const e=window.localStorage.getItem(Py);return e?JSON.parse(e):null}catch{return null}}async function VS(){var t,n;const e=zy();if(!e||!e.workflow)return{success:!1,error:"No previous render to repeat"};try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!0}}));const r=Co(),s=e.promptRaw||((n=(t=e==null?void 0:e.extraData)==null?void 0:t.extra_pnginfo)==null?void 0:n.cozygen_prompt_raw);if(s&&typeof s=="object")try{await jo({promptId:r,promptRaw:s})}catch{}return await ko({prompt:e.workflow,prompt_id:r}),window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!1}})),{success:!0}}catch(r){return console.error("Failed to requeue prompt",r),window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:!1}})),r!=null&&r.unauthorized?(window.location.hash="#/login",{success:!1,error:"Session expired"}):{success:!1,error:"Failed to queue prompt"}}}function WS(){const e=zy();return!!(e&&e.workflow)}const HS=[{to:"/controls",label:"Controls",Icon:Ly},{to:"/compose",label:"Compose",Icon:tc},{to:"/gallery",label:"Gallery",Icon:RS},{to:"/library",label:"Library",Icon:No}],KS=({isActive:e})=>["bottom-nav-link",e?"is-active":""].filter(Boolean).join(" ");function GS(){const e=yn(),t=US(),[n,r]=aa.useState(!1),[s,a]=aa.useState(!1),i=e.pathname==="/controls",c=e.pathname==="/compose",u=async()=>{if(!(typeof window>"u")&&!s)if(r(!0),setTimeout(()=>r(!1),400),i||c)try{window.dispatchEvent(new CustomEvent("cozygen:request-render"))}catch{}else{if(!WS())return;const d=await VS();d.success||console.warn("Requeue failed:",d.error)}};return aa.useEffect(()=>{const d=h=>{var y;const v=!!((y=h==null?void 0:h.detail)!=null&&y.active);a(v),v&&(r(!0),setTimeout(()=>r(!1),400))};return window.addEventListener("cozygen:render-state",d),()=>window.removeEventListener("cozygen:render-state",d)},[]),l.jsxs("nav",{className:"bottom-nav","aria-label":"Bottom navigation",children:[HS.map(d=>l.jsxs(pS,{to:d.to,end:d.end,className:KS,children:[l.jsx("span",{className:"bottom-nav-icon","aria-hidden":"true",children:l.jsx(d.Icon,{size:20})}),l.jsxs("span",{className:"bottom-nav-label",children:[d.label,d.to==="/gallery"&&t?l.jsx("span",{className:"badge-dot pulse","aria-hidden":"true"}):null]})]},d.to)),l.jsxs("button",{type:"button",className:`bottom-nav-link is-action ${n?"is-flash":""} ${s?"is-rendering":""}`,onClick:u,"aria-label":"Render","aria-busy":s,"aria-disabled":s,disabled:s,children:[l.jsx("span",{className:"bottom-nav-icon","aria-hidden":"true",children:l.jsx(IS,{size:20})}),l.jsx("span",{className:"bottom-nav-label",children:"Render"})]},"render")]})}function YS(e,t){if(!t||t<=0)return null;const n=Number(e)||0,r=Number(t)||0,s=Math.round(n/r*100);return Number.isFinite(s)?Math.max(0,Math.min(100,s)):null}function QS({busy:e=!1,progressValue:t=0,progressMax:n=0,statusText:r="Idle",statusPhase:s="idle",primaryLabel:a="Render",onPrimary:i,primaryDisabled:c=!1,onLogs:u,logsLabel:d="Logs"}){const h=YS(t,n),v=s==="queued"?"rgba(255, 143, 112, 0.95)":s==="running"?"rgba(68, 225, 197, 0.95)":s==="finished"?"rgba(92, 255, 154, 0.95)":s==="error"?"rgba(255, 143, 112, 0.95)":"rgba(159, 178, 215, 0.55)",x={idle:"Idle",queued:"Queued",running:"Running",finished:"Finished",error:"Error"}[s]||"Status",k=e||c;return l.jsxs("div",{className:"dock-bar-inner",children:[l.jsx(K,{variant:"primary",size:"lg",className:"w-full",onClick:i,disabled:k,children:e?"Rendering":a}),l.jsxs("div",{className:"dock-status-row",children:[l.jsxs("span",{className:"dock-status-left",children:[l.jsx("span",{className:"dock-status-dot",style:{background:v}}),l.jsx("span",{className:"dock-status-label",children:x})]}),l.jsxs("span",{className:"dock-status-right",children:[h!=null&&e?l.jsxs("span",{className:"dock-progress",children:[l.jsx("span",{className:"dock-progress-bar","aria-hidden":"true",children:l.jsx("span",{className:"dock-progress-fill",style:{width:`${h}%`}})}),l.jsxs("span",{children:[h,"%"]})]}):null,l.jsx("span",{className:"dock-status-text",children:r||(e?"Working":"Idle")}),u?l.jsx(K,{size:"xs",variant:"ghost",onClick:u,children:d}):null]})]})]})}const _y="jpg,jpeg,png,webp,gif,bmp,tif,tiff",cf=(e="")=>/\.(png|jpe?g|gif|webp|bmp|tif?f)$/i.test(e),Ty=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e);async function Hc({subfolder:e="",page:t=1,perPage:n=50,exts:r=_y,signal:s}={}){const a=new URLSearchParams({subfolder:e,page:String(t),per_page:String(n),exts:r}),i=await fetch(`/cozygen/input?${a.toString()}`,{signal:s});if(!i.ok)throw new Error(`Input list failed: ${i.status}`);return i.json()}const bo=e=>`/cozygen/input/file?path=${encodeURIComponent(e)}`,ed="output::",rc=(e="")=>e.replace(/\\/g,"/").replace(/^\/+/,"").replace(/\/+$/,""),Ry=(e="")=>{const t=e.replace(/\\/g,"/").split("/").filter(Boolean);return t[t.length-1]||""},qS=({subfolder:e="",filename:t=""}={})=>{const n=Ry(t);if(!n)return"";const r=rc(e);return`${ed}${r}::${n}`},td=(e="")=>{if(typeof e!="string"||!e.startsWith(ed))return null;const t=e.slice(ed.length);if(!t)return null;const n=t.lastIndexOf("::"),r=n===-1?t:t.slice(n+2);return r?{subfolder:n===-1?"":t.slice(0,n),filename:r}:null},Eo=({filename:e="",subfolder:t="",type:n="output"}={})=>{const r=Ry(e);return r?`/view?${new URLSearchParams({filename:r,subfolder:rc(t),type:n||"output"}).toString()}`:""},nd=(e="")=>e.split("/").slice(0,-1).join("/"),XS=e=>{if(typeof e!="string"||!e)return e!=null&&e.path?nd(e.path):"";const t=td(e);return t?rc(t.subfolder):nd(e)},km=(e=[])=>e.map(t=>{const n=t.rel_path||t.name||"",r=t.name||n||"Untitled",s=!!t.is_dir,a=s?"":bo(n);return{...t,name:r,rel_path:n,is_dir:s,is_image:!s&&cf(r),is_video:!s&&Ty(r),source:"input",preview_url:a}}),JS=(e=[])=>e.map(t=>{const n=t.filename||"",r=t.subfolder||"",s=t.type==="directory",a=s?r||n:[r,n].filter(Boolean).join("/"),i=n||r||a||"Untitled",c=s?"":Eo({filename:n,subfolder:r,type:t.type});return{...t,name:i,rel_path:a,is_dir:s,is_image:!s&&cf(n),is_video:!s&&Ty(n),source:"output",preview_url:c}}),Cs={get(e,t){try{return(typeof window<"u"?JSON.parse(localStorage.getItem(e)):null)??t}catch{return t}},set(e,t){try{typeof window<"u"&&localStorage.setItem(e,JSON.stringify(t))}catch{}}};function ZS({input:e,value:t,onFormChange:n}){var G;const r=((G=e==null?void 0:e.inputs)==null?void 0:G.param_name)||"Image Input",s=(e==null?void 0:e.class_type)||"CozyGenImageInput",a=`cg_last_input_cwd::${r}`,i=`cg_last_picker_source::${r}`,[c,u]=o.useState(""),[d,h]=o.useState(!1),[v,y]=o.useState(!1),[x,k]=o.useState(Cs.get(a,"")),[N,j]=o.useState(1),[m,p]=o.useState(50),[g,w]=o.useState([]),[b,E]=o.useState(1),[A,I]=o.useState(!1),[B,T]=o.useState(""),[$,ee]=o.useState([]),[Z,le]=o.useState(!0),Ce=o.useRef(null),[me,oe]=o.useState(()=>Cs.get(i,"inputs")==="outputs"?"outputs":"inputs"),R=me,P=o.useCallback(O=>{const H=O==="outputs"?"outputs":"inputs";oe(H),Cs.set(i,H),k(""),j(1)},[]),M=o.useMemo(()=>{if(c)try{const O=new URL(c,window.location.origin);return(O.searchParams.get("path")||O.searchParams.get("filename")||O.pathname.split("/").pop()||"").split("/").pop()||"No file selected."}catch{}if(!t)return"No file selected.";if(typeof t=="string"){const O=td(t);return O!=null&&O.filename?O.filename.split("/").pop():t.split("/").pop()}return t!=null&&t.path?t.path.split("/").pop():"No file selected."},[c,t]);o.useEffect(()=>{if(typeof t=="string"&&t){const O=td(t);O!=null&&O.filename?u(Eo({filename:O.filename,subfolder:O.subfolder,type:"output"})):u(bo(t)),h(!1)}else t!=null&&t.url?(u(t.url),h(!1)):(u(""),h(!1))},[t]);const L=o.useCallback(async O=>{const H=await wS(O),we=`/view?filename=${H.filename}&type=input`;u(we),h(!1),Cs.set(a,""),s==="CozyGenImageInput"?n(r,H.filename):n(r,{source:"Upload",path:H.filename,url:we})},[s,n,r]),W=o.useCallback(()=>{u(""),h(!1),s==="CozyGenImageInput"?n(r,""):n(r,{source:"Upload",path:"",url:""})},[s,n,r]),q=o.useCallback(()=>{const H=XS(t)||Cs.get(a,"");k(H),j(1),y(!0)},[t]),de=o.useCallback(()=>{y(!1)},[]);o.useEffect(()=>{if(v){if(R!=="inputs"){ee([]);return}(async()=>{try{const O=await Hc({subfolder:"",page:1,perPage:0,exts:""});ee((O.items||[]).filter(H=>H.is_dir))}catch{}})()}},[v,R]),o.useEffect(()=>{if(!v)return;let O=!1;Ce.current&&Ce.current.abort();const H=new AbortController;Ce.current=H;async function we(){I(!0);try{if(R==="outputs"){const he=await jy(x,N,m,!1,!1,"all","",{signal:H.signal});if(O)return;const Me=JS(he&&he.items||[]);O||(w(Me),E(he&&he.total_pages||1))}else{const Me=await Hc({subfolder:x,page:N,perPage:m,exts:Z?_y:"",signal:H.signal}),Re=(Me.items||[]).some(Fe=>!Fe.is_dir);if(Z&&!Re){const Fe=await Hc({subfolder:x,page:N,perPage:m,exts:"",signal:H.signal});O||(w(km(Fe.items||[])),E(Fe.total_pages||1),le(!1));return}O||(w(km(Me.items||[])),E(Me.total_pages||1))}}catch(he){if((he==null?void 0:he.name)==="AbortError")return;console.error(R==="outputs"?"Failed to load output directory":"Failed to load input directory",he),O||(w([]),E(1))}finally{O||I(!1)}}return we(),()=>{O=!0,Ce.current===H&&(Ce.current=null),H.abort()}},[v,x,N,m,Z,R]);const fe=o.useDeferredValue(B),ne=o.useMemo(()=>{const O=fe.trim().toLowerCase();let H=g;return Z&&(H=H.filter(we=>{if(we.is_dir)return!0;const he=we.name||we.filename||we.rel_path||"";return cf(String(he))})),O?H.filter(we=>(we.name||we.filename||we.rel_path||"").toLowerCase().includes(O)):H},[g,fe,Z]),xe=o.useCallback(O=>{if(!O)return;const H=typeof O=="object"?O:null;if(((H==null?void 0:H.source)||"inputs")==="output"){const Re=qS({subfolder:(H==null?void 0:H.subfolder)||"",filename:(H==null?void 0:H.filename)||(H==null?void 0:H.name)||""});if(!Re)return;const Fe=(H==null?void 0:H.preview_url)||Eo({filename:H==null?void 0:H.filename,subfolder:H==null?void 0:H.subfolder,type:H==null?void 0:H.type});u(Fe),h(!1),Cs.set(a,rc((H==null?void 0:H.subfolder)||"")),s==="CozyGenImageInput"?n(r,Re):n(r,{source:"OutputGallery",path:Re,url:Fe}),y(!1);return}const he=typeof O=="string"?O:(H==null?void 0:H.rel_path)||(H==null?void 0:H.path)||"";if(!he)return;const Me=(H==null?void 0:H.preview_url)||bo(he);u(Me),h(!1),Cs.set(a,nd(he)),s==="CozyGenImageInput"?n(r,he):n(r,{source:"Server",path:he,url:Me}),y(!1)},[s,n,r]);return{param:r,previewUrl:c,imgReady:d,setImgReady:h,displayName:M,serverOpen:v,openServer:q,closeServer:de,cwd:x,setCwd:k,page:N,setPage:j,perPage:m,setPerPage:p,totalPages:b,loading:A,search:B,setSearch:T,topDirs:$,imagesOnly:Z,setImagesOnly:le,shownEntries:ne,pickerSource:R,setPickerSource:P,handleUpload:L,clearImage:W,selectServer:xe}}function Wt({open:e,onClose:t,title:n,children:r,footer:s,variant:a="sheet",className:i="",contentClassName:c="",shouldCloseOnOverlayClick:u=!0,shouldCloseOnEsc:d=!0}){const h=o.useRef(!1),v=o.useRef(null),y=o.useRef(null),x=j=>j?Array.from(j.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(m=>!m.hasAttribute("disabled")&&m.getAttribute("aria-hidden")!=="true"):[],k=o.useMemo(()=>["bottom-sheet-content",a==="fullscreen"?"is-fullscreen":"is-sheet",c].filter(Boolean).join(" "),[c,a]),N=o.useMemo(()=>["bottom-sheet-overlay",i].filter(Boolean).join(" "),[i]);return o.useEffect(()=>{if(!e||!d)return;const j=m=>{m.key==="Escape"&&(t==null||t())};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[e,t,d]),o.useEffect(()=>{if(!e||typeof document>"u")return;const j=v.current;y.current=document.activeElement;const m=()=>{var b;const w=x(j)[0]||j;(b=w==null?void 0:w.focus)==null||b.call(w)},p=g=>{if(g.key!=="Tab"||!j)return;const w=x(j);if(!w.length){g.preventDefault(),j.focus();return}const b=w[0],E=w[w.length-1],A=document.activeElement;g.shiftKey&&A===b?(g.preventDefault(),E.focus()):!g.shiftKey&&A===E&&(g.preventDefault(),b.focus())};return requestAnimationFrame(m),j==null||j.addEventListener("keydown",p),()=>{var w;j==null||j.removeEventListener("keydown",p);const g=y.current;g&&document.contains(g)&&((w=g.focus)==null||w.call(g))}},[e]),!e||typeof document>"u"?null:tf.createPortal(l.jsx("div",{className:N,role:"presentation",onPointerDown:j=>{h.current=j.target===j.currentTarget},onClick:j=>{u&&h.current&&j.target===j.currentTarget&&(t==null||t())},children:l.jsx("div",{ref:v,className:k,role:"dialog","aria-modal":"true","aria-label":n||"Sheet",onClick:j=>j.stopPropagation(),tabIndex:-1,children:l.jsxs("div",{className:"bottom-sheet-panel",children:[l.jsxs("header",{className:"bottom-sheet-head",children:[l.jsx("div",{className:"bottom-sheet-title",children:n||""}),l.jsx("button",{type:"button",className:"bottom-sheet-close",onClick:t,"aria-label":"Close",children:l.jsx(os,{size:16})})]}),l.jsx("div",{className:"bottom-sheet-body",children:r}),s?l.jsx("footer",{className:"bottom-sheet-foot",children:s}):null]})})}),document.body)}function ek({items:e=[],value:t,onChange:n,ariaLabel:r,role:s="tablist",className:a="",tabClassName:i="",size:c="md",layout:u="equal",wrap:d=!1}){const h=["segmented-tabs",c==="sm"?"is-compact":"",u==="auto"?"is-auto":"",u==="icon"?"is-icon":"",d?"is-wrap":"",a].filter(Boolean).join(" "),v=s==="tablist"?"tab":"button",y=o.useRef([]);o.useEffect(()=>{y.current=y.current.slice(0,e.length)},[e.length]);const x=o.useMemo(()=>e.map((g,w)=>g.disabled?null:w).filter(g=>g!==null),[e]),k=o.useMemo(()=>e.findIndex(g=>g.key===t&&!g.disabled),[e,t]),N=x.length?x[0]:-1,j=k>=0?k:N,m=g=>{var b;const w=y.current[g];(b=w==null?void 0:w.focus)==null||b.call(w)},p=(g,w)=>{var E;if(!e.length)return g;let b=g;for(let A=0;A<e.length;A+=1)if(b=(b+w+e.length)%e.length,!((E=e[b])!=null&&E.disabled))return b;return g};return l.jsx("div",{className:h,role:s,"aria-label":r,children:e.map((g,w)=>{const b=g.key===t,E=g.label?String(g.label):"";return l.jsxs("button",{type:"button",ref:A=>{y.current[w]=A},role:v,"aria-selected":s==="tablist"?b:void 0,"aria-pressed":s!=="tablist"?b:void 0,"aria-controls":s==="tablist"?g.controls:void 0,className:["segmented-tab",b?"is-active":"",g.icon&&!E?"is-icon":"",g.className||"",i].filter(Boolean).join(" "),onClick:()=>{g.disabled||n==null||n(g.key)},onKeyDown:A=>{if(s!=="tablist"||!["ArrowRight","ArrowLeft","Home","End"].includes(A.key)||(A.preventDefault(),!e.length))return;let I=w;A.key==="Home"?I=x.length?x[0]:I:A.key==="End"?I=x.length?x[x.length-1]:I:A.key==="ArrowRight"?I=p(I,1):A.key==="ArrowLeft"&&(I=p(I,-1));const B=e[I];!B||B.disabled||(n==null||n(B.key),m(I))},disabled:g.disabled,title:g.title||E||g.ariaLabel,"aria-label":g.ariaLabel,tabIndex:s==="tablist"?w===j?0:-1:void 0,children:[g.icon?l.jsx("span",{className:"segmented-tab-icon",children:g.icon}):null,E?l.jsx("span",{className:"segmented-tab-label",children:E}):null,g.badge?l.jsx("span",{className:"segmented-tab-badge",children:g.badge}):null]},g.key)})})}const fr=o.memo(ek),tk=(e=[])=>(e||[]).map(t=>typeof t=="string"||typeof t=="number"?{value:t,label:String(t)}:{value:(t==null?void 0:t.value)??(t==null?void 0:t.id)??"",label:(t==null?void 0:t.label)??(t==null?void 0:t.name)??String((t==null?void 0:t.value)??""),disabled:!!(t!=null&&t.disabled)}),nk=(e,t)=>{if(!t)return e;const n=t.trim().toLowerCase();return n?e.filter(r=>{const s=String(r.label||"").toLowerCase(),a=String(r.value||"").toLowerCase();return s.includes(n)||a.includes(n)}):e};function rk({value:e,onChange:t,options:n,children:r,placeholder:s,emptyLabel:a="No matches",disabled:i=!1,size:c="md",className:u="",wrapperClassName:d="",searchable:h=!1,searchThreshold:v=0,searchPlaceholder:y="Search options...",searchValue:x,onSearchChange:k,searchAriaLabel:N="Search options",...j}){const[m,p]=o.useState(""),g=typeof x=="string"?x:m,w=k||p,b=o.useMemo(()=>tk(n),[n]),E=h||typeof v=="number"&&v>0&&b.length>v,A=o.useMemo(()=>E?nk(b,g):b,[b,g,E]),I=["ui-control","ui-select",c==="sm"?"is-compact":"",u,E?"":d].filter(Boolean).join(" "),B=()=>r||(A.length?A.map($=>l.jsx("option",{value:$.value,disabled:$.disabled,children:$.label},String($.value))):l.jsx("option",{value:"",disabled:!0,children:a})),T=l.jsxs("select",{...j,className:I,value:e??"",onChange:$=>t==null?void 0:t($.target.value),disabled:i,children:[s?l.jsx("option",{value:"",children:s}):null,B()]});return E?l.jsxs("div",{className:["ui-select-stack",d].filter(Boolean).join(" "),children:[l.jsx("input",{type:"search",value:g,onChange:$=>w($.target.value),placeholder:y,className:"ui-control ui-input is-compact","aria-label":N,disabled:i}),T]}):T}const ct=o.memo(rk);function sk({open:e,cwd:t,setCwd:n,page:r,setPage:s,perPage:a,setPerPage:i,totalPages:c,topDirs:u,loading:d,imagesOnly:h,setImagesOnly:v,search:y,setSearch:x,shownEntries:k,onSelect:N,onClose:j,pickerSource:m,setPickerSource:p}){if(!e)return null;const g=m||"inputs",w=typeof p=="function",b=()=>{n(""),s(1)},E=$=>{w&&$!==g&&(p($),n(""),s(1))},A=t.split("/").filter(Boolean),I=g==="outputs"?"Choose output":"Choose input",B=[{key:"",label:"Root"},...u.map($=>({key:$.rel_path,label:$.name}))],T=$=>{n($),s(1)};return l.jsx(Wt,{open:e,onClose:j,title:I,variant:"fullscreen",footer:l.jsxs("div",{className:"flex items-center gap-2 w-full",children:[l.jsx(K,{variant:"muted",className:"w-full",disabled:r<=1||d,onClick:()=>s($=>Math.max(1,$-1)),children:"Prev"}),l.jsxs("div",{className:"text-xs text-center text-[rgba(159,178,215,0.75)] min-w-[92px]",children:[r," / ",c]}),l.jsx(K,{variant:"muted",className:"w-full",disabled:r>=c||d,onClick:()=>s($=>$<c?$+1:$),children:"Next"})]}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Location"}),l.jsxs("div",{className:"imagepicker-breadcrumb",children:[l.jsx("button",{type:"button",className:"imagepicker-crumb",onClick:b,children:"Root"}),A.map(($,ee)=>{const Z=A.slice(0,ee+1).join("/");return l.jsx("button",{type:"button",className:"imagepicker-crumb",onClick:()=>{n(Z),s(1)},children:$},Z)})]})]}),w?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Source"}),l.jsx(fr,{ariaLabel:"Source",value:g,onChange:E,size:"sm",items:[{key:"inputs",label:"Inputs"},{key:"outputs",label:"Outputs"}]})]}):null,l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Filters"}),l.jsxs("div",{className:"composer-filters",children:[l.jsxs("label",{className:"inline-flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:h,onChange:$=>{v($.target.checked),s(1)}}),l.jsx("span",{className:"text-sm text-[rgba(159,178,215,0.85)]",children:"Images only"})]}),l.jsx("input",{type:"search",value:y,onChange:$=>x($.target.value),placeholder:"Search files",className:"sheet-input ui-control ui-input","aria-label":"Search files"}),l.jsx(ct,{value:a,onChange:$=>{const ee=parseInt($,10)||50;i(ee),s(1)},"aria-label":"Items per page",size:"sm",options:[25,50,100]})]})]}),u.length>0?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Quick folders"}),l.jsx(fr,{ariaLabel:"Quick folders",value:t,onChange:T,size:"sm",layout:"auto",wrap:!0,className:"imagepicker-chips",items:B})]}):null,l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Results"}),d?l.jsxs("div",{className:"sheet-hint",children:["Scanning ",g==="outputs"?"output":"input"," folders"]}):k.length===0?l.jsx("div",{className:"sheet-hint",children:"Nothing here yet. Try a different folder or turn off Images only."}):null,l.jsx("div",{className:"imagepicker-grid",children:!d&&k.map($=>{const ee=`${$.source||"input"}::${$.rel_path||$.name}`,Z=$.is_dir?"":$.preview_url||($.source==="output"?Eo({filename:$.filename,subfolder:$.subfolder,type:$.type}):bo($.rel_path||""));return l.jsx("button",{type:"button",className:`imagepicker-item ${$.is_dir?"is-dir":""}`,onClick:()=>{$.is_dir?(n($.rel_path||""),s(1)):N($)},children:$.is_dir?l.jsxs("div",{className:"imagepicker-dir-row",children:[l.jsx("div",{className:"imagepicker-dir-dot","aria-hidden":"true"}),l.jsx("div",{className:"imagepicker-name",children:$.name})]}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"imagepicker-thumb",children:Z?l.jsx("img",{className:"imagepicker-img",alt:$.name,src:Z}):l.jsx("div",{className:"imagepicker-img is-placeholder"})}),l.jsx("div",{className:"imagepicker-name",children:$.name})]})},ee)})})]})]})})}function lk({open:e,onClose:t,title:n,url:r,kind:s="image"}){return r?l.jsx(Wt,{open:e,onClose:t,title:n||"Preview",variant:"fullscreen",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(K,{href:r,target:"_blank",rel:"noreferrer",variant:"muted",className:"w-full text-center",children:"Open"}),l.jsx(K,{variant:"primary",className:"w-full",onClick:t,children:"Close"})]}),children:l.jsx("div",{className:"url-viewer-stage",children:s==="video"?l.jsx("video",{src:r,controls:!0,className:"url-viewer-media",autoPlay:!0}):l.jsx("img",{src:r,alt:n||"Preview",className:"url-viewer-media"})})}):null}function ak({input:e,value:t,onFormChange:n}){const{previewUrl:r,imgReady:s,setImgReady:a,displayName:i,serverOpen:c,openServer:u,closeServer:d,cwd:h,setCwd:v,page:y,setPage:x,perPage:k,setPerPage:N,totalPages:j,topDirs:m,loading:p,search:g,setSearch:w,imagesOnly:b,setImagesOnly:E,shownEntries:A,pickerSource:I,setPickerSource:B,handleUpload:T,clearImage:$,selectServer:ee}=ZS({input:e,value:t,onFormChange:n}),Z=o.useRef(null),le=o.useRef(null),[Ce,me]=o.useState(0),[oe,R]=o.useState(!1);o.useEffect(()=>{const L=le.current;if(!L)return;const W=de=>{de.preventDefault(),de.stopPropagation()},q=async de=>{var ne,xe;W(de);const fe=(xe=(ne=de.dataTransfer)==null?void 0:ne.files)==null?void 0:xe[0];fe&&(await T(fe),Z.current&&(Z.current.value=""),me(G=>G+1))};return["dragenter","dragover","dragleave","drop"].forEach(de=>L.addEventListener(de,de==="drop"?q:W)),()=>{["dragenter","dragover","dragleave","drop"].forEach(de=>L.removeEventListener(de,de==="drop"?q:W))}},[T]);const P=async L=>{var q;const W=(q=L.target.files)==null?void 0:q[0];W&&(await T(W),Z.current&&(Z.current.value=""),me(de=>de+1))},M=()=>{Z.current&&Z.current.click()};return l.jsxs("div",{className:"ui-card",children:[l.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[l.jsx("h3",{className:"text-sm font-semibold text-[#F8F4FF] truncate",children:i}),l.jsx("span",{className:"text-[11px] text-[#C3C7FFB3] truncate",children:"Image"})]}),l.jsx("div",{ref:le,className:"mb-3 rounded-xl border border-dashed border-[rgba(255,255,255,0.14)] bg-[rgba(255,255,255,0.02)] flex items-center justify-center min-h-[140px] sm:min-h-[180px] overflow-hidden",children:r?l.jsx(K,{variant:"bare",className:"w-full h-full",onClick:()=>R(!0),"aria-label":`Preview ${i}`,title:"Open preview",children:l.jsx("img",{src:r,alt:i,className:`max-h-64 max-w-full object-contain transition-opacity ${s?"opacity-100":"opacity-0"}`,onLoad:()=>a(!0)})}):l.jsx("div",{className:"text-[11px] text-[#9DA3FFCC] text-center px-6",children:"Drop an image here, upload from your device, or choose one from your server."})}),l.jsx("input",{ref:Z,type:"file",accept:"image/*",className:"hidden",onChange:P},Ce),l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[l.jsx(K,{size:"sm",variant:"primary",onClick:u,children:"Choose"}),l.jsx(K,{size:"sm",variant:"muted",onClick:M,children:"Upload"}),l.jsx(K,{size:"sm",variant:"ghost",onClick:$,children:"Clear"})]}),l.jsx(sk,{open:c,cwd:h,setCwd:v,page:y,setPage:x,perPage:k,setPerPage:N,totalPages:j,topDirs:m,loading:p,imagesOnly:b,setImagesOnly:E,search:g,setSearch:w,shownEntries:A,pickerSource:I,setPickerSource:B,onSelect:ee,onClose:d}),l.jsx(lk,{open:oe,onClose:()=>R(!1),title:i||"Preview",url:r,kind:"image"})]})}function ik({open:e,onClose:t,title:n,description:r,render:s,index:a=0,total:i=0,children:c}){const[u,d]=o.useState("idle"),h=o.useRef(null),v=o.useRef(null),y=k=>k?Array.from(k.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(N=>!N.hasAttribute("disabled")&&N.getAttribute("aria-hidden")!=="true"):[];if(o.useEffect(()=>{if(u==="queued"){const k=setTimeout(()=>d("idle"),1600);return()=>clearTimeout(k)}},[u]),o.useEffect(()=>{if(!e||typeof document>"u")return;const k=h.current;v.current=document.activeElement;const N=()=>{var g;const p=y(k)[0]||k;(g=p==null?void 0:p.focus)==null||g.call(p)},j=m=>{if(m.key==="Escape"){t==null||t();return}if(m.key!=="Tab"||!k)return;const p=y(k);if(!p.length){m.preventDefault(),k.focus();return}const g=p[0],w=p[p.length-1],b=document.activeElement;m.shiftKey&&b===g?(m.preventDefault(),w.focus()):!m.shiftKey&&b===w&&(m.preventDefault(),g.focus())};return requestAnimationFrame(N),k==null||k.addEventListener("keydown",j),()=>{var p;k==null||k.removeEventListener("keydown",j);const m=v.current;m&&document.contains(m)&&((p=m.focus)==null||p.call(m))}},[e,t]),!e)return null;const x=typeof s=="function"?s():c;return l.jsxs("div",{className:"spotlight-overlay",role:"dialog","aria-modal":"true",children:[l.jsx("div",{className:"spotlight-backdrop",onClick:t}),l.jsxs("div",{className:"spotlight-sheet",ref:h,tabIndex:-1,children:[l.jsxs("div",{className:"spotlight-header",children:[l.jsxs("div",{className:"spotlight-meta",children:[l.jsx("div",{className:"spotlight-kicker",children:"Focused control"}),l.jsx("div",{className:"spotlight-title",children:n||"Control"}),r?l.jsx("div",{className:"spotlight-hint",children:r}):null]}),l.jsx("button",{type:"button",className:"spotlight-close",onClick:t,"aria-label":"Close",children:l.jsx(os,{size:16})})]}),l.jsx("div",{className:"spotlight-body",children:x}),l.jsx("div",{className:"spotlight-footer",children:l.jsx("div",{className:"spotlight-footer-right",children:l.jsx(K,{size:"sm",variant:"muted",onClick:t,"aria-label":"Close",children:"Close"})})})]})]})}const Lo=o.forwardRef(function({title:t,kicker:n,meta:r,defaultOpen:s=!0,variant:a="card",className:i="",bodyClassName:c,children:u},d){const h=a==="bare",v=(h?["collapsible-section","collapsible-section--bare",i]:["ui-panel","collapsible-card",i]).filter(Boolean).join(" "),y=(h?["collapsible-section-body",c||"space-y-4"]:["collapsible-card-body",c||"space-y-4"]).filter(Boolean).join(" "),x=r!=null?l.jsx("div",{className:"collapsible-card-summary-meta",children:r}):null;return l.jsxs("details",{ref:d,className:v,open:s,children:[l.jsxs("summary",{className:h?"collapsible-section-summary":"collapsible-card-summary",children:[l.jsxs("div",{className:"flex flex-col gap-1",children:[n?l.jsx("span",{className:"ui-kicker",children:n}):null,l.jsx("span",{className:"text-sm font-semibold tracking-wide",children:t})]}),x,h?l.jsx("span",{className:"collapsible-section-chevron","aria-hidden":"true",children:l.jsx(nc,{size:16})}):null]}),l.jsx("div",{className:y,children:u})]})}),ok=/\.(safetensors|ckpt|pt|pth)$/i,ck=/\.([a-z0-9]{2,16})$/i,uk=e=>/[a-z]/i.test(e),sc=e=>e.replace(/\\/g,"/"),Iy=e=>{const{folder:t,base:n}=dk(e);if(!n)return e;if(!t)return n;const r=t.split(/\s+/).filter(Boolean),s=r[r.length-1]||"";if(s&&n.toLowerCase().startsWith(s.toLowerCase())){const a=n.slice(s.length);return a?`${t}${a}`:t}return`${t} ${n}`.trim()};function $y(e){if(typeof e!="string")return!1;const t=e.trim();if(!t)return!1;const r=sc(t).split("/").filter(Boolean).pop()||"";return ok.test(r)}function Pl(e){if(typeof e!="string")return!1;const t=e.trim();if(!t)return!1;const s=(sc(t).split("/").filter(Boolean).pop()||"").match(ck);return s?uk(s[1]):!1}function lc(e){if(typeof e!="string")return{folderPath:"",base:"",filename:""};const t=sc(e.trim());if(!t)return{folderPath:"",base:"",filename:""};const n=t.split("/").filter(Boolean),r=n.pop()||"",s=r.replace(/\.[^.]+$/,"");return{folderPath:n.join("/"),base:s,filename:r}}function dk(e){if(typeof e!="string")return{folder:"",base:""};const n=sc(e.trim()).split("/").filter(Boolean),s=(n.pop()||"").replace(/\.[^.]+$/,"");return{folder:n.join(" ").trim(),base:s}}function fk(e){return $y(e)?Iy(e):e}function pk(e){return Pl(e)?Iy(e):e}function rr(e){if(!Pl(e))return e;const{base:t}=lc(e);return t||pk(e)}const mk=(e="")=>{if(!e||e==="root")return"root";const t=e.split("/").filter(Boolean);return t[t.length-1]||e},hk=o.memo(function({workflows:t=[],selectedWorkflow:n,onWorkflowChange:r,workflowData:s,presets:a=[],presetName:i="",onPresetNameChange:c,selectedPresetId:u="",onPresetSelect:d,onPresetSave:h,onPresetDelete:v,presetStatus:y}){const x=Array.isArray(t)?t:[],k=Array.isArray(a)?a:[],[N,j]=o.useState("All"),m=o.useMemo(()=>x.map(T=>{const $=String(T||"");if(!Pl($))return{value:$,isFile:!1,base:"",folderPath:""};const{folderPath:ee,base:Z}=lc($);return{value:$,isFile:!0,base:Z,folderPath:ee||"root"}}),[x]),p=o.useMemo(()=>{const T=new Set(["All"]);return m.forEach($=>{$.isFile&&$.folderPath&&T.add($.folderPath)}),Array.from(T).sort(($,ee)=>$.localeCompare(ee))},[m]),g=p.length>2;o.useEffect(()=>{if(!g){N!=="All"&&j("All");return}p.includes(N)||j("All")},[g,N,p]);const w=o.useMemo(()=>{const T=new Map;return m.forEach($=>{if(!$.isFile||!$.base)return;const ee=$.base.toLowerCase();T.set(ee,(T.get(ee)||0)+1)}),T},[m]),b=o.useMemo(()=>{const T=[],$=g&&N==="All";return m.forEach(ee=>{if(!ee.isFile){T.push({value:ee.value,label:ee.value});return}if(g&&N!=="All"&&ee.folderPath!==N)return;let Z=ee.base||rr(ee.value)||ee.value;if($&&ee.base){const le=ee.base.toLowerCase();w.get(le)>1&&(Z=`${Z} (${mk(ee.folderPath)})`)}T.push({value:ee.value,label:Z})}),T},[m,N,w,g]),E=o.useMemo(()=>n?b.some(T=>String(T.value)===String(n)):!0,[b,n]),A=o.useMemo(()=>!n||E?b:[{value:n,label:rr(String(n))},...b],[E,n,b]),I=()=>{h()},B=()=>{v()};return l.jsxs(Lo,{title:l.jsxs(l.Fragment,{children:[l.jsx(No,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Workflow"]}),bodyClassName:"control-shell controls-body",defaultOpen:!1,className:"controls-panel",children:[l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"workflow-select",children:"Workflow"}),g?l.jsx(ct,{value:N,onChange:j,wrapperClassName:"mb-2","aria-label":"Workflow folder filter",size:"sm",options:p.map(T=>({value:T,label:T}))}):null,l.jsx(ct,{id:"workflow-select",value:n||"",onChange:r,"aria-label":"Workflow",size:"sm",placeholder:"Select workflow...",options:A})]}),l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"preset-select",children:"Preset"}),l.jsx(ct,{id:"preset-select",value:u||"",onChange:d,"aria-label":"Workflow preset",disabled:!s,size:"sm",placeholder:"Select preset...",options:k.map(T=>({value:T.id,label:T.name}))})]}),l.jsxs("div",{className:"flex flex-col gap-1.5",children:[l.jsx("label",{className:"text-[10px] uppercase tracking-wider text-[#9FB2D7B3] font-medium",htmlFor:"preset-name-input",children:"Preset name"}),l.jsx("input",{id:"preset-name-input",type:"text",value:i,onChange:T=>c(T.target.value),className:"ui-control ui-input",placeholder:"Name for new preset...","aria-label":"Preset name",disabled:!s})]}),l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsx(K,{size:"sm",variant:"primary",onClick:I,disabled:!s||!i.trim(),children:"Save preset"}),l.jsx(K,{size:"sm",variant:"muted",onClick:B,disabled:!s||!u,children:"Delete preset"})]}),y?l.jsx("div",{className:"text-xs text-[#6D8BFF]",children:y}):null]})]})});function gk({open:e,onClose:t,title:n,value:r,onChange:s,placeholder:a="",description:i}){const c=n||"Edit",u=o.useMemo(()=>`sheet-textarea-${Math.random().toString(36).slice(2,9)}`,[]);return l.jsxs(Wt,{open:e,onClose:t,title:c,variant:"fullscreen",footer:l.jsx(K,{variant:"primary",className:"w-full",onClick:t,children:"Done"}),children:[i?l.jsx("div",{className:"text-[12px] text-[rgba(159,178,215,0.75)] mb-3",children:i}):null,l.jsx("textarea",{id:u,value:r??"",onChange:d=>s==null?void 0:s(d.target.value),placeholder:a,className:"sheet-textarea ui-control ui-textarea",rows:12})]})}function ln(e){const t=Number(e);return Number.isFinite(t)?t.toFixed(2).replace(/\.?0+$/u,""):"1"}function My(e=""){const t=String(e||"");if(!t.trim())return[];const n=[];let r=0;for(;r<t.length;){for(;r<t.length&&/[\s,]/.test(t[r]);)r++;if(r>=t.length)break;let s=r,a=r,i="tag",c="";const u=t[r]==="(";if(u&&(s=r,r++),t[r]==="$"){i="alias";const v=r;for(r++;r<t.length&&t[r]!=="$"&&t[r]!==","&&t[r]!==`
`;)c+=t[r],r++;t[r]==="$"&&r++,u||(s=v)}else if(u){for(i="tag";r<t.length&&!(t[r]===":"||t[r]===`
`||t[r]===")");)c+=t[r],r++;c=c.trim()}else{i="tag";const v=r;for(;r<t.length&&!(t[r]===","||t[r]==="$"||t[r]===`
`||t[r]==="(");)c+=t[r],r++;c=c.trim(),s=v}if(u&&t[r]===":"){for(r++;r<t.length&&t[r]!==")"&&t[r]!==","&&t[r]!==`
`;)r++;t[r]===")"&&r++}u&&t[r]===")"&&r++,a=r;const d=c.trim(),h=i==="alias"&&/^:?[\d.]+$/u.test(d);d&&!h&&n.push({type:i,text:d,start:s,end:a})}return n}function Gr(e="",t){if(!t||typeof t.start!="number"||typeof t.end!="number")return null;const r=String(e||"").slice(t.start,t.end);if(!r.startsWith("(")||!r.includes(":"))return null;const s=r.lastIndexOf(":");if(s===-1)return null;const a=r.slice(s+1);if(!a.endsWith(")"))return null;const i=a.slice(0,-1).trim();if(!/^\d+(\.\d+)?$/u.test(i))return null;const c=Number.parseFloat(i);return Number.isFinite(c)?{weight:c,wrapperStart:t.start,wrapperEnd:t.end}:null}function Fy(e="",t,n){const r=String(e||"");if(!t||typeof t.start!="number"||typeof t.end!="number")return r;const s=n==null?null:Number(n),a=s===null||!Number.isFinite(s)||Math.abs(s-1)<1e-6,i=t.type==="alias"?`$${t.text}$`:t.text;if(a)return r.slice(0,t.start)+i+r.slice(t.end);const c=ln(s),u=`(${i}:${c})`;return r.slice(0,t.start)+u+r.slice(t.end)}function rd(e="",t,n,r){var y;if(n===r||n===null||r===null||!(t!=null&&t.length))return e;const s=String(e||""),a=t.map(x=>({start:x.start,end:x.end,text:s.slice(x.start,x.end)})),i=a.slice(0,-1).map((x,k)=>{const N=a[k+1];return s.slice(x.end,N.start)}),c=a.length?s.slice(0,a[0].start):"",u=a.length?s.slice(a[a.length-1].end):"",d=[...a],[h]=d.splice(n,1);d.splice(r,0,h);let v=c+(((y=d[0])==null?void 0:y.text)||"");for(let x=1;x<d.length;x++)v+=(i[x-1]??", ")+d[x].text;return v+=u,v}function Oy(e="",t){const n=String(e||"");if(!t||typeof t.start!="number"||typeof t.end!="number")return n;const r=n.slice(0,t.start).replace(/[\s,]*$/,""),s=n.slice(t.end).replace(/^[\s,]*/,"");return r?`${r}, ${s}`.trim():s.trim()}function Dy(e="",t,n){const r=String(e||"");if(!t||typeof t.start!="number"||typeof t.end!="number"||!n)return r;const s=r.slice(0,t.start),a=r.slice(t.end),i=s.replace(/[\s,]*$/,""),c=a.replace(/^[\s,]*/,"");return i&&c?`${i}, ${n}, ${c}`:i?`${i}, ${n}`:c?`${n}, ${c}`:n}function Js(e="",t){if(!t||typeof t.index!="number"||typeof t.length!="number")return null;const n=String(e||""),r=t.index,s=t.index+t.length;if(r<=0||n[r-1]!=="("||n[s]!==":")return null;let a=s+1,i="";for(;a<n.length&&n[a]!==")";)if(i+=n[a],a+=1,i.length>12)return null;if(a>=n.length||n[a]!==")")return null;const c=i.trim();if(!/^\d+(\.\d+)?$/u.test(c))return null;const u=Number.parseFloat(c);return Number.isFinite(u)?{weight:u,wrapperStart:r-1,wrapperEnd:a+1}:null}function Li(e="",t,n){const r=String(e||"");if(!t||typeof t.index!="number"||typeof t.length!="number")return r;const s=t.index,a=t.index+t.length,i=Js(r,t),c=n==null?null:Number(n),u=c===null||!Number.isFinite(c)||Math.abs(c-1)<1e-6;if(i){if(u)return r.slice(0,i.wrapperStart)+r.slice(s,a)+r.slice(i.wrapperEnd);const h=ln(c);return r.slice(0,a+1)+h+r.slice(i.wrapperEnd-1)}if(u)return r;const d=ln(c);return r.slice(0,s)+"("+r.slice(s,a)+":"+d+")"+r.slice(a)}function Ai(e,t,n){const r=Number(e);return Number.isFinite(r)?Math.max(t,Math.min(n,r)):t}function jm({open:e,onClose:t,title:n="Alias strength",tokenLabel:r="",weight:s=1,onApply:a,onRemoveWeight:i,onDeleteToken:c,onReplace:u,replaceLabel:d="Replace"}){const h=o.useMemo(()=>Ai(s||1,.2,2),[s]),[v,y]=o.useState(h);o.useEffect(()=>{e&&y(h)},[e,h]);const x=ln(v);return l.jsx(Wt,{open:e,onClose:t,title:n,footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(K,{variant:"muted",className:"w-full",onClick:t,children:"Cancel"}),l.jsx(K,{variant:"primary",className:"w-full",onClick:()=>{a==null||a(v),t==null||t()},children:"Done"})]}),children:l.jsxs("div",{className:"sheet-stack token-strength-sheet",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Alias"}),l.jsx("div",{className:"sheet-hint",children:r||""})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Strength"}),l.jsxs("div",{className:"token-strength-row",children:[l.jsx(K,{size:"sm",variant:"muted",onClick:()=>y(k=>Ai(k-.05,.2,2)),children:""}),l.jsxs("div",{className:"token-strength-value tabular-nums",children:[x,""]}),l.jsx(K,{size:"sm",variant:"muted",onClick:()=>y(k=>Ai(k+.05,.2,2)),children:"+"})]}),l.jsx("input",{type:"range",min:.2,max:2,step:.05,value:v,onChange:k=>y(Ai(k.target.value,.2,2)),className:"ui-range","aria-label":"Alias strength"}),l.jsx("div",{className:"sheet-hint token-strength-hint",children:"1.0 is normal. Increase to emphasize or reduce to soften."})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Actions"}),l.jsxs("div",{className:"token-strength-actions",children:[l.jsx(K,{size:"sm",variant:"ghost",onClick:()=>y(1),children:"Reset"}),u?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"token-strength-divider","aria-hidden":"true",children:"|"}),l.jsx(K,{size:"sm",variant:"ghost",onClick:()=>{u==null||u(),t==null||t()},children:d})]}):null,l.jsx("span",{className:"token-strength-divider","aria-hidden":"true",children:"|"}),l.jsx(K,{size:"sm",variant:"danger",onClick:()=>{c==null||c(),t==null||t()},children:"Delete"})]})]})]})})}function Ls(e){const t=String(e||"").trim();if(!t)return"";const n=t.toLowerCase(),r={scifi:"Sci-Fi",sci:"Sci",ui:"UI",vfx:"VFX",hdr:"HDR",dof:"DoF",bokeh:"Bokeh",vhs:"VHS",jpeg:"JPEG",jpg:"JPG",png:"PNG",gif:"GIF",webp:"WebP",api:"API",nsfw:"NSFW",sfw:"SFW",sfx:"SFX",fx:"FX",lora:"LoRA",loras:"LoRAs",ip:"IP",egirl:"E-girl",i2v:"I2V",t2i:"T2I",img2img:"Img2Img",txt2img:"Txt2Img",tts:"TTS",asmr:"ASMR",ai:"AI",highleg:"High-Leg","one-piece":"One-Piece","three-quarter":"Three-Quarter"};return r[n]?r[n]:/^\d+$/.test(n)?n:n==="3d"?"3D":n==="2d"?"2D":n.length===1?n.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1)}function yk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return n==="cinema"?"cinema":n==="game"?"game":n==="art"?"art":n==="stand"?"stand":n==="sit"?"sit":n==="lie"?"lie":n==="action"?"action":n==="nsfw"?"nsfw":t.startsWith("flirty_")?"flirty":t.startsWith("dynamic_")||t.startsWith("stealth_")||t.startsWith("athletic_")||t.startsWith("running_")||t.startsWith("walking_")?"action":t.startsWith("sleepy_")||t.startsWith("relaxed_")||t.startsWith("reclining_")||t.startsWith("sitting_")||t.startsWith("kneeling_")?"rest":t.startsWith("happy_")||t.startsWith("sad_")||t.startsWith("angry_")||t.startsWith("nervous_")||t.startsWith("smug_")||t.startsWith("surprised_")||t.startsWith("scared_")||t.startsWith("tipsy_")?"emotion":t.startsWith("composed_")||t.startsWith("contemplative_")||t.startsWith("looking_")?"posed":"everyday"}function vk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return n==="lingerie"?"lingerie":n==="swimwear"||n==="swim"?"swimwear":n==="costumes"||n==="tech"?"costumes":n==="uniform"?"uniform":n==="formal"?"formal":n==="alt"?"alt":n==="sensual"?"sensual":n==="trad"?"trad":n==="pro"?"pro":n==="sporty"?"sporty":n==="fantasy"?"fantasy":n==="casual"||n==="street"||n==="lounge"||n==="sporty"||n==="dress"?"everyday":n||"everyday"}function xk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return["fire","candlelight","embers"].includes(n)?"fire":["moonlight"].includes(n)?"night":["neon"].includes(n)?"neon":["studio","stage","sidelighting","dim"].includes(n)?"studio":["golden","sunbeam","dappled"].includes(n)?"natural":["lens","light"].includes(n)?"effects":n||"other"}function wk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return["penetration","oral","anal","masturbation","toys","handjob","footjob","paizuri","group","bdsm","femdom","maledom","lesbian","pregnant","water","public","clothed","cumshot","aftercare","kissing","teasing","specialty","positions","pov","ahegao","lactation","squirting","furniture","vehicle","flexible","tentacle","futanari","size","spanking","pegging"].includes(n)?n:"other"}function Sk(e=""){const t=String(e||"").trim().toLowerCase();if(!t)return"";const n=t.split("_")[0]||"";return["fantasy","scifi","horror","cyber","hist","waste","occult","myth"].includes(n)?n:"other"}function fl(e="",t=""){const n=String(e||"").trim(),r=String(t||"").trim().toLowerCase();if(!n)return"";if(r==="outfit")return vk(n)||"everyday";if(r==="pose")return yk(n)||"everyday";if(r==="lighting")return xk(n)||"effects";if(r==="nsfw")return wk(n)||"other";if(r==="char")return Sk(n)||"other";const s=n.indexOf("_");return s<=0?"":n.slice(0,s).trim()}function By(e=""){const t=String(e||"").trim();return t?t.includes(":")?t.split(":").slice(1).join(":"):t:""}function pl({token:e="",name:t=""}={}){const n=String(t||"").trim()||By(e);if(!n)return"";let s=n.replace(/_(\d+)$/u,"").split("_").filter(Boolean);if(s.length===0)return n;const a=[];for(let v=0;v<s.length;v++){const y=s[v],x=s[v+1];if(y&&x&&y.toLowerCase()==="one"&&x.toLowerCase()==="piece"){a.push("one-piece"),v+=1;continue}if(y&&x&&y.toLowerCase()==="three"&&x.toLowerCase()==="quarter"){a.push("three-quarter"),v+=1;continue}a.push(y)}if(s=a,Array.from(new Set(s.map(v=>String(v).toLowerCase()))).length===1)return Ls(s[0]);const c=s[0],u=s.slice(1),d=Ls(c),h=u.map(Ls).join(" ").trim();return h?h.toLowerCase()===d.toLowerCase()?u.length===1&&String(u[0]).toLowerCase()===String(c).toLowerCase()?d||n:s.map(Ls).join(" ").trim()||n:`${d} - ${h}`:s.map(Ls).join(" ").trim()||n}function uf(e){if(!e)return{subcategory:"",displayName:""};const t=e.name||"",n=e.token||"",r=By(n)||t,s=fl(r,e.category)||"other",a=pl({token:n,name:t})||n||t||"Alias";return{subcategory:s,displayName:a}}function Xt(e=""){const t=String(e||"").trim();return t?t==="All"?"All":{char:"SUBJECT - Characters",body:"SUBJECT - Body",outfit:"SUBJECT - Outfits",accessory:"SUBJECT - Accessories",pose:"ACTION - Poses",action:"ACTION - Actions",nsfw:"ACTION - NSFW",scene:"SCENE - Scenes",weather:"SCENE - Weather",prop:"SCENE - Props",camera:"COMPOSITION - Camera",lighting:"COMPOSITION - Lighting",style:"COMPOSITION - Style",mood:"COMPOSITION - Mood"}[t]||Ls(t):""}function gn(e=""){const t=String(e||"").trim();return t?t==="All"?"All":t.split(/[_-]+/u).filter(Boolean).map(n=>Ls(n)).join(" ").trim():""}function Nm({open:e,onClose:t,isPromptLike:n,pickerSearch:r,onSearchChange:s,pickerSearchRef:a,categories:i,pickerCategory:c,onCategoryChange:u,subcategories:d,pickerSubcategory:h,onSubcategoryChange:v,filteredAliases:y,visibleAliases:x,visibleCount:k,onShowMore:N,listItemVisibilityStyles:j,onInsertAlias:m}){return l.jsx(Wt,{open:e,onClose:t,title:n?"Insert alias":"Aliases",footer:l.jsx(K,{variant:"primary",className:"w-full",onClick:t,children:"Done"}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Search"}),l.jsxs("div",{className:"composer-filters",children:[l.jsx("input",{ref:a,type:"text",value:r,onChange:p=>s(p.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(ct,{value:c,onChange:u,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:["All",...i.filter(p=>p!=="All")].map(p=>({value:p,label:p==="All"?"Category: All":Xt(p)}))}),d.length>2?l.jsx(ct,{value:h,onChange:v,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:d.map(p=>({value:p,label:p==="All"?"All subcategories":gn(p)}))}):null]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Results"}),l.jsx("div",{className:"composer-alias-list",children:y.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[x.map(p=>l.jsxs("button",{type:"button",onClick:()=>m(p.token,{closeAfter:!n}),className:"composer-alias-item",style:j,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:p.displayName||p.token}),p.category?l.jsx("span",{className:"composer-alias-category",children:Xt(p.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",p.token,"$"]}),l.jsx("div",{className:"composer-alias-text",children:p.text})]},p.key)),k<y.length?l.jsxs(K,{variant:"muted",className:"w-full",onClick:N,children:["Show more (",y.length-k," left)"]}):null]})})]})]})})}const Cm={contentVisibility:"auto",containIntrinsicSize:"240px 120px"};function kk({name:e,label:t,description:n,value:r,onChange:s,onEnter:a,disabled:i=!1,multiline:c=!1,aliasOptions:u=[],aliasCatalog:d=[],onOpenComposer:h}){var Xe,ut;const v=o.useRef(null),y=o.useRef(null),x=o.useRef({start:null,end:null}),k=o.useRef(null),N=o.useRef(null),[j,m]=o.useState(null),[p,g]=o.useState(null),[w,b]=o.useState(!1),[E,A]=o.useState(""),I=o.useDeferredValue(E),[B,T]=o.useState("All"),[$,ee]=o.useState("All"),[Z]=o.useState([]),le=o.useRef(null),[Ce,me]=o.useState(!1),[oe,R]=o.useState(!1),[P,M]=o.useState(null),L=typeof r=="string"?r:String(r??"");o.useMemo(()=>Array.isArray(u)?u.filter(Boolean):[],[u]);const W=o.useMemo(()=>(Array.isArray(d)?d.filter(D=>D&&D.name):[]).map(D=>({...D,...uf(D)})),[d]),q=o.useMemo(()=>W,[W]),de=D=>{const X=D.target.value;s==null||s(X)},fe=D=>{if(!c&&D.key==="Enter"){D.preventDefault(),a==null||a(D.target.value,D);return}},ne=o.useMemo(()=>{const D=new Map;return q.forEach(X=>{X!=null&&X.token&&D.set(String(X.token).toLowerCase(),X)}),D},[q]),xe=o.useMemo(()=>{const D=new Set(["All"]);return W.forEach(X=>{X.category&&D.add(X.category)}),Array.from(D).sort((X,ke)=>X.localeCompare(ke))},[W]),G=o.useMemo(()=>{const D=new Set(["All"]);return q.forEach(X=>{(!B||B==="All"||X.category===B)&&X.subcategory&&D.add(X.subcategory)}),Array.from(D).sort((X,ke)=>X.localeCompare(ke))},[q,B]);o.useEffect(()=>{ee("All")},[B]);const O=o.useMemo(()=>{const D=L||"";if(!D||!D.includes("$"))return[];const X=[],ke=/\$([a-z0-9_:-]+)\$/gi;let ze;for(;ze=ke.exec(D);)X.push({token:ze[1],index:ze.index,length:ze[0].length});return X},[L]),H=()=>{try{const D=v.current;D?x.current={start:D.selectionStart??null,end:D.selectionEnd??null}:x.current={start:null,end:null}}catch{x.current={start:null,end:null}}y.current&&y.current.scrollIntoView({block:"center",behavior:"smooth"}),b(!0)},we=o.useMemo(()=>{const D=I.trim().toLowerCase();return q.filter(X=>{var ke,ze,$e,Ge;return B!=="All"&&(X.category||"")!==B||$!=="All"&&(X.subcategory||"other")!==$?!1:D?((ke=X.token)==null?void 0:ke.toLowerCase().includes(D))||((ze=X.text)==null?void 0:ze.toLowerCase().includes(D))||(($e=X.name)==null?void 0:$e.toLowerCase().includes(D))||((Ge=X.displayName)==null?void 0:Ge.toLowerCase().includes(D)):!0}).sort((X,ke)=>{const ze=(X.subcategory||"").toLowerCase(),$e=(ke.subcategory||"").toLowerCase();return ze!==$e?ze.localeCompare($e):X.token.localeCompare(ke.token)})},[q,B,$,I]),[he,Me]=o.useState(30),Re=o.useMemo(()=>we.slice(0,he),[we,he]);o.useEffect(()=>{Me(30)},[B,$,E,W]),o.useEffect(()=>{ee("All")},[B]);const Fe=(D,{closeAfter:X=!0}={})=>{var Te,lt;const ke=v.current,ze=`$${D}$`,$e=L||"",Ge=(Te=x.current)==null?void 0:Te.start,rt=(lt=x.current)==null?void 0:lt.end,qe=(ke==null?void 0:ke.selectionStart)??(typeof Ge=="number"?Ge:$e.length),U=(ke==null?void 0:ke.selectionEnd)??(typeof rt=="number"?rt:$e.length),ce=$e.slice(0,qe),je=$e.slice(U),Pe=ce.match(/[^\s]$/),z=je.match(/^[^\s]/),V=Pe&&Pe[0]!==","?", ":"",ae=z&&z[0]!==","?", ":"",ie=ce+V+ze+ae+je;s==null||s(ie);const Se=(ce+V+ze+ae).length;x.current={start:Se,end:Se},X&&(b(!1),requestAnimationFrame(()=>{var nt;(nt=ke==null?void 0:ke.blur)==null||nt.call(ke)}))},Oe=D=>{const X=L||"",ke=Js(X,D),ze=ke?ke.wrapperStart:D.index,$e=ke?ke.wrapperEnd:D.index+D.length,Ge=X.slice(0,ze).replace(/[\s,]*$/,""),rt=X.slice($e).replace(/^[\s,]*/,""),qe=Ge?`${Ge} ${rt}`.trim():rt.trim();s==null||s(qe)},Ze=D=>{if(!D)return;const X=ne.get(D.token.toLowerCase()),ke=(X==null?void 0:X.displayName)||D.token,ze=Js(L||"",D);M({tokenObj:D,displayName:ke,weight:(ze==null?void 0:ze.weight)??1}),R(!0),requestAnimationFrame(()=>{var $e,Ge;return(Ge=($e=v.current)==null?void 0:$e.blur)==null?void 0:Ge.call($e)})},re=o.useMemo(()=>(D,X)=>{var je;if(D===X||D===null||X===null||!(O!=null&&O.length))return;const ke=L||"",ze=O.map(Pe=>{const z=Js(ke,Pe),V=z?z.wrapperStart:Pe.index,ae=z?z.wrapperEnd:Pe.index+Pe.length;return{start:V,end:ae,text:ke.slice(V,ae)||`$${Pe.token}$`}}),$e=ze.slice(0,-1).map((Pe,z)=>{const V=ze[z+1];return ke.slice(Pe.end,V.start)}),Ge=ze.length?ke.slice(0,ze[0].start):"",rt=ze.length?ke.slice(ze[ze.length-1].end):"",qe=[...ze],[U]=qe.splice(D,1);qe.splice(X,0,U);let ce=Ge+(((je=qe[0])==null?void 0:je.text)||"");for(let Pe=1;Pe<qe.length;Pe+=1)ce+=($e[Pe-1]??", ")+qe[Pe].text;ce+=rt,s==null||s(ce)},[s,O,L]),_e=(D,X)=>{m(X),k.current=D.currentTarget,D.dataTransfer.effectAllowed="move",D.dataTransfer.setData("text/plain",String(X)),requestAnimationFrame(()=>{k.current&&k.current.classList.add("is-dragging")})},Y=(D,X)=>{D.preventDefault(),D.dataTransfer.dropEffect="move",X!==p&&g(X)},Ie=D=>{D!==p&&g(D)},te=D=>{j!==null&&D!==null&&j!==D&&re(j,D),m(null),g(null),k.current=null},Ne=()=>{k.current&&k.current.classList.remove("is-dragging"),te(p)},ge=(D,X)=>{D.preventDefault(),te(X)},ve=(D,X)=>{var $e,Ge;if(!((Ge=($e=D.target)==null?void 0:$e.closest)==null?void 0:Ge.call($e,".token-chip-drag-handle")))return;const ze=D.touches[0];N.current={idx:X,startX:ze.clientX,startY:ze.clientY,moved:!1}},ye=D=>{if(!N.current)return;const X=D.touches[0],ke=Math.abs(X.clientX-N.current.startX),ze=Math.abs(X.clientY-N.current.startY);if(ke<=10&&ze<=10)return;N.current.moved=!0,m(N.current.idx),D.preventDefault();const $e=y.current,Ge=$e?$e.querySelectorAll(".token-chip-draggable"):document.querySelectorAll(".token-chip-draggable"),rt=X.clientX,qe=X.clientY;for(let U=0;U<Ge.length;U++){const ce=Ge[U].getBoundingClientRect();if(rt>=ce.left&&rt<=ce.right&&qe>=ce.top&&qe<=ce.bottom){g(U);break}}},Ae=()=>{var D;(D=N.current)!=null&&D.moved&&j!==null&&p!==null&&j!==p&&re(j,p),N.current=null,m(null),g(null)},Q={id:e,name:e,value:L,onChange:de,disabled:i,className:"ui-control ui-input pr-10 text-[13px] sm:text-sm",placeholder:"","aria-label":t||e,"aria-describedby":n?`${e}-description`:void 0},Ke=()=>{b(!1),requestAnimationFrame(()=>{var D,X;(X=(D=v.current)==null?void 0:D.blur)==null||X.call(D)})},et=(()=>{const D=String(e||"").toLowerCase(),X=String(t||"").toLowerCase();return!!`${D} ${X}`.trim().includes("prompt")})();return c?l.jsxs("div",{className:"relative space-y-2",ref:y,children:[h&&!et?l.jsxs("div",{className:"stringinput-toolbar",children:[l.jsx(K,{size:"sm",variant:"muted",onClick:()=>h(e),children:"Open composer"}),W.length?l.jsx(K,{size:"sm",variant:"ghost",onClick:H,children:"Aliases"}):null,l.jsx(K,{size:"sm",variant:"ghost",onClick:()=>me(!0),children:"Expand"})]}):null,l.jsx("textarea",{ref:v,...Q,rows:3,wrap:"soft",onKeyDown:fe,className:Q.className+" resize-none min-h-[88px] max-h-[160px] leading-relaxed overflow-y-auto overflow-x-hidden break-words whitespace-pre-wrap",style:{whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere"}}),h&&et?l.jsx("div",{className:"stringinput-underbar",children:l.jsxs("div",{className:"stringinput-underbar-actions",children:[l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>h(e),children:"Open composer"}),W.length?l.jsx(K,{size:"xs",variant:"ghost",onClick:H,children:"Insert alias"}):null]})}):null,l.jsx(gk,{open:Ce,onClose:()=>me(!1),title:t||e,value:L,onChange:s,description:n}),O.length?l.jsxs("div",{className:"stringinput-tokens",children:[l.jsxs("div",{className:"stringinput-tokens-label",children:["Active aliases ",l.jsx("span",{className:"stringinput-tokens-hint",children:"(drag to reorder)"})]}),l.jsx("div",{className:"stringinput-tokens-list",children:O.map((D,X)=>{var qe;const ke=ne.get(D.token.toLowerCase()),ze=(ke==null?void 0:ke.displayName)||D.token,$e=j===X,Ge=p===X&&j!==null&&j!==X,rt=((qe=Js(L||"",D))==null?void 0:qe.weight)??1;return l.jsxs("div",{className:`ui-chip is-clickable token-chip token-chip-draggable ${$e?"is-dragging":""} ${Ge?"is-drop-target":""}`,title:`$${D.token}$`,role:"button",tabIndex:0,draggable:!0,onDragStart:U=>_e(U,X),onDragEnd:Ne,onDragEnter:()=>Ie(X),onDragOver:U=>Y(U,X),onDrop:U=>ge(U,X),onTouchStart:U=>ve(U,X),onTouchMove:ye,onTouchEnd:Ae,onClick:()=>{j===null&&Ze(D)},onKeyDown:U=>{(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),Ze(D))},children:[l.jsx("span",{className:"token-chip-drag-handle","aria-hidden":"true",children:l.jsx(Ma,{size:14})}),l.jsx("span",{className:"token-chip-label",children:ze}),Math.abs(rt-1)>1e-6?l.jsxs("span",{className:"token-chip-weight","aria-label":`Strength ${ln(rt)}x`,children:["",ln(rt)]}):null,l.jsx(K,{size:"mini",variant:"danger",onClick:U=>{U.stopPropagation(),Oe(D)},"aria-label":`Remove ${D.token}`,children:l.jsx(os,{size:12})})]},`${D.token}-${D.index}`)})})]}):null,l.jsx(jm,{open:oe,onClose:()=>R(!1),title:"Alias strength",tokenLabel:P?`${P.displayName}  $${(Xe=P.tokenObj)==null?void 0:Xe.token}$`:"",weight:(P==null?void 0:P.weight)??1,onApply:D=>{P!=null&&P.tokenObj&&(s==null||s(Li(L||"",P.tokenObj,D)))},onRemoveWeight:()=>{P!=null&&P.tokenObj&&(s==null||s(Li(L||"",P.tokenObj,null)))},onDeleteToken:()=>{P!=null&&P.tokenObj&&Oe(P.tokenObj)}}),w?l.jsx(Nm,{open:w,onClose:Ke,isPromptLike:et,pickerSearch:E,onSearchChange:A,pickerSearchRef:le,categories:xe,pickerCategory:B,onCategoryChange:T,subcategories:G,pickerSubcategory:$,onSubcategoryChange:ee,filteredAliases:we,visibleAliases:Re,visibleCount:he,onShowMore:()=>Me(D=>Math.min(D+30,we.length)),listItemVisibilityStyles:Cm,onInsertAlias:Fe}):null]}):l.jsxs("div",{className:"relative space-y-2",ref:y,children:[l.jsx("input",{...Q,type:"text",inputMode:"text",autoComplete:"off",onKeyDown:fe,className:Q.className+" min-h-[44px]",ref:v}),O.length?l.jsxs("div",{className:"stringinput-tokens",children:[l.jsxs("div",{className:"stringinput-tokens-label",children:["Active aliases ",l.jsx("span",{className:"stringinput-tokens-hint",children:"(drag to reorder)"})]}),l.jsx("div",{className:"stringinput-tokens-list",children:O.map((D,X)=>{var qe;const ke=ne.get(D.token.toLowerCase()),ze=(ke==null?void 0:ke.displayName)||D.token,$e=j===X,Ge=p===X&&j!==null&&j!==X,rt=((qe=Js(L||"",D))==null?void 0:qe.weight)??1;return l.jsxs("div",{className:`ui-chip is-clickable token-chip token-chip-draggable ${$e?"is-dragging":""} ${Ge?"is-drop-target":""}`,title:`$${D.token}$`,onClick:()=>{j===null&&Ze(D)},role:"button",tabIndex:0,draggable:!0,onDragStart:U=>_e(U,X),onDragEnd:Ne,onDragEnter:()=>Ie(X),onDragOver:U=>Y(U,X),onDrop:U=>ge(U,X),onTouchStart:U=>ve(U,X),onTouchMove:ye,onTouchEnd:Ae,onKeyDown:U=>{(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),Ze(D))},children:[l.jsx("span",{className:"token-chip-drag-handle","aria-hidden":"true",children:l.jsx(Ma,{size:14})}),l.jsx("span",{className:"token-chip-label",children:ze}),Math.abs(rt-1)>1e-6?l.jsxs("span",{className:"token-chip-weight","aria-label":`Strength ${ln(rt)}x`,children:["",ln(rt)]}):null,l.jsx(K,{size:"mini",variant:"danger",onClick:U=>{U.stopPropagation(),Oe(D)},"aria-label":`Remove ${D.token}`,children:l.jsx(os,{size:12})})]},`${D.token}-${D.index}`)})})]}):null,l.jsx(jm,{open:oe,onClose:()=>R(!1),title:"Alias strength",tokenLabel:P?`${P.displayName}  $${(ut=P.tokenObj)==null?void 0:ut.token}$`:"",weight:(P==null?void 0:P.weight)??1,onApply:D=>{P!=null&&P.tokenObj&&(s==null||s(Li(L||"",P.tokenObj,D)))},onRemoveWeight:()=>{P!=null&&P.tokenObj&&(s==null||s(Li(L||"",P.tokenObj,null)))},onDeleteToken:()=>{P!=null&&P.tokenObj&&Oe(P.tokenObj)}}),W.length?l.jsx(K,{size:"sm",variant:"ghost",className:"stringinput-trailing",onClick:()=>h?h(e):H(),title:h?"Open prompt composer":"Insert alias","aria-label":h?"Open prompt composer":"Insert alias",children:h?l.jsx(tc,{size:16}):l.jsx(ec,{size:16})}):null,l.jsx(Nm,{open:w,onClose:Ke,isPromptLike:et,pickerSearch:E,onSearchChange:A,pickerSearchRef:le,categories:xe,pickerCategory:B,onCategoryChange:T,subcategories:G,pickerSubcategory:$,onSubcategoryChange:ee,filteredAliases:we,visibleAliases:Re,visibleCount:he,onShowMore:()=>Me(D=>Math.min(D+30,we.length)),listItemVisibilityStyles:Cm,onInsertAlias:Fe})]})}const Uy=o.memo(kk),bm=e=>e==null?void 0:String(e).trim().replace(/[^A-Za-z0-9_-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||void 0;function jk({name:e,label:t,description:n,value:r,onChange:s,disabled:a=!1,min:i,max:c,step:u,isFloat:d=!1,inputId:h}){const v=u??(d?.01:1),y=h??bm(e),x=j=>{if(j===""||j===null||j===void 0)return"";const m=d?parseFloat(j):parseInt(j,10);return Number.isNaN(m)?"":m},k=j=>{const m=j.target.value,p=x(m);s==null||s(p)},N=j=>{if(j.key!=="ArrowUp"&&j.key!=="ArrowDown")return;j.preventDefault();const m=typeof r=="number"?r:x(String(r??""))||0,p=j.key==="ArrowUp"?v:-v;let g=m+p;if(typeof i=="number"&&(g=Math.max(i,g)),typeof c=="number"&&(g=Math.min(c,g)),d){const w=typeof v=="number"?(String(v).split(".")[1]||"").length:2;g=parseFloat(g.toFixed(Math.max(w,2)))}s==null||s(g)};return l.jsxs("div",{className:"w-full flex items-center gap-2",children:[l.jsx("input",{id:y,name:e,type:"number",inputMode:d?"decimal":"numeric",value:r??"",onChange:k,onKeyDown:N,disabled:a,min:i,max:c,step:v,"aria-label":t||e,"aria-describedby":n?`${y||bm(e)||e}-description`:void 0,className:"ui-control ui-input"}),typeof i=="number"||typeof c=="number"?l.jsxs("div",{className:"hidden sm:flex flex-col text-[10px] text-[#6A6FA8] text-right leading-tight",children:[typeof i=="number"&&l.jsxs("span",{children:["min ",i]}),typeof c=="number"&&l.jsxs("span",{children:["max ",c]})]}):null]})}const ga=o.memo(jk);function Nk({name:e,label:t,description:n,value:r,onChange:s,disabled:a=!1}){const i=!!r,c=()=>{a||s==null||s(!i)},u=d=>{(d.key===" "||d.key==="Enter")&&(d.preventDefault(),c())};return l.jsxs("button",{id:e,type:"button",role:"switch","aria-checked":i,"aria-label":t||e,"aria-describedby":n?`${e}-description`:void 0,onClick:c,onKeyDown:u,disabled:a,className:`ui-switch ${i?"is-on":""}`,children:[l.jsx("span",{className:"ui-switch-track",children:l.jsx("span",{className:"ui-switch-knob"})}),l.jsx("span",{className:"ui-switch-state",children:i?"On":"Off"})]})}const Vy=o.memo(Nk);function Ck(e,t){try{if(typeof window>"u"||!e)return null;const n=e.getItem(t);return n?JSON.parse(n):null}catch{return null}}function ac(e,t,n){try{if(typeof window>"u"||!e)return;e.setItem(t,JSON.stringify(n))}catch{}}function Kn(){try{return typeof window>"u"?null:window.sessionStorage||null}catch{return null}}function $l(){try{return typeof window>"u"?null:window.localStorage||null}catch{return null}}const Wy=750,Er=new Map,lr=new Map,ar=new Map,Sl=new Map,ir=new Map,or=new Map;function Hy(e){var t;if(lr.has(e)&&(clearTimeout(lr.get(e)),lr.delete(e)),ar.has(e)){try{(t=window.cancelIdleCallback)==null||t.call(window,ar.get(e))}catch{}ar.delete(e)}Er.has(e)&&(ac(Kn(),e,Er.get(e)),Er.delete(e))}function bk(e){var r;if(lr.has(e)&&(clearTimeout(lr.get(e)),lr.delete(e)),ar.has(e)){try{(r=window.cancelIdleCallback)==null||r.call(window,ar.get(e))}catch{}ar.delete(e)}const t=()=>{Er.has(e)&&(ac(Kn(),e,Er.get(e)),Er.delete(e))},n=setTimeout(()=>{lr.delete(e);try{if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const s=window.requestIdleCallback(()=>{ar.delete(e),t()},{timeout:2500});ar.set(e,s);return}}catch{}t()},Wy);lr.set(e,n)}function Ek(){Array.from(lr.values()).forEach(e=>clearTimeout(e)),lr.clear(),Array.from(ar.values()).forEach(e=>{var t;try{(t=window.cancelIdleCallback)==null||t.call(window,e)}catch{}}),ar.clear(),Array.from(Er.entries()).forEach(([e,t])=>{ac(Kn(),e,t)}),Er.clear(),Array.from(ir.values()).forEach(e=>clearTimeout(e)),ir.clear(),Array.from(or.values()).forEach(e=>{var t;try{(t=window.cancelIdleCallback)==null||t.call(window,e)}catch{}}),or.clear(),Array.from(Sl.entries()).forEach(([e,t])=>{try{const n=Kn();n&&n.setItem(e,t)}catch{}}),Sl.clear()}if(typeof window<"u"&&!window.__cozygenFormStateFlush){const e=()=>Ek();window.addEventListener("beforeunload",e),window.addEventListener("pagehide",e),window.__cozygenFormStateFlush=!0}function Lk(e){var r;if(!e)return{};const t=`${e}_formData`,n=Ck(Kn(),t);if(n&&typeof n=="object")return n;try{const s=$l();(r=s==null?void 0:s.removeItem)==null||r.call(s,t)}catch{}return{}}function Ao(e,t,n={}){var a;if(!e)return;const{immediate:r=!1}=n||{},s=`${e}_formData`;if(r){Hy(s),ac(Kn(),s,t||{});try{const i=$l();(a=i==null?void 0:i.removeItem)==null||a.call(i,s)}catch{}return}Er.set(s,t||{}),bk(s)}function Ak(e){e&&Hy(`${e}_formData`)}function Pk(e,t,n=Wy){var a;if(Sl.set(e,t),ir.has(e)&&(clearTimeout(ir.get(e)),ir.delete(e)),or.has(e)){try{(a=window.cancelIdleCallback)==null||a.call(window,or.get(e))}catch{}or.delete(e)}const r=()=>{const i=Sl.get(e);Sl.delete(e);try{const c=Kn();c&&c.setItem(e,i)}catch{}},s=setTimeout(()=>{ir.delete(e);try{if(typeof window<"u"&&typeof window.requestIdleCallback=="function"){const i=window.requestIdleCallback(()=>{or.delete(e),r()},{timeout:2e3});or.set(e,i);return}}catch{}r()},n);ir.set(e,s)}function zk(e,t={}){var s,a;const{immediate:n=!1}=t||{},r="cozygen_last_param";if(n){if(ir.has(r)&&(clearTimeout(ir.get(r)),ir.delete(r)),or.has(r)){try{(s=window.cancelIdleCallback)==null||s.call(window,or.get(r))}catch{}or.delete(r)}Sl.delete(r);try{const i=Kn();i&&i.setItem(r,e||"");const c=$l();(a=c==null?void 0:c.removeItem)==null||a.call(c,r)}catch{}return}Pk(r,e||"")}function _k(){var t,n;const e="cozygen_last_param";try{const r=Kn(),s=((t=r==null?void 0:r.getItem)==null?void 0:t.call(r,e))||"";if(s)return s;const a=$l();(n=a==null?void 0:a.removeItem)==null||n.call(a,e)}catch{}return""}function Ky(e,t){const n=e?String(e):"global",r=t?String(t):"";return`cozygen_dropdown_folder:${n}:${r}`}function Em(e,t){var r,s;const n=Ky(e,t);try{const a=Kn(),i=((r=a==null?void 0:a.getItem)==null?void 0:r.call(a,n))||"";if(i)return i;const c=$l();(s=c==null?void 0:c.removeItem)==null||s.call(c,n)}catch{}return""}function Tk(e,t,n){var s;const r=Ky(e,t);try{const a=Kn();a&&a.setItem(r,String(n||""));const i=$l();(s=i==null?void 0:i.removeItem)==null||s.call(i,r)}catch{}}function Rk({workflowName:e,name:t,label:n,description:r,value:s,onChange:a,disabled:i=!1,options:c=[]}){const u=s??"",[d,h]=o.useState(()=>Em(e,t)||"All");o.useEffect(()=>{const w=Em(e,t);h(w||"All")},[e,t]);const v=o.useMemo(()=>(c||[]).map(w=>typeof w=="string"?{value:w,label:w}:{value:w.value??w.name??"",label:w.label??w.name??String(w.value??"")}),[c]),y=w=>{const b=typeof(w==null?void 0:w.value)=="string"||typeof(w==null?void 0:w.value)=="number"?String(w.value):"",E=typeof(w==null?void 0:w.label)=="string"||typeof(w==null?void 0:w.label)=="number"?String(w.label):"";return Pl(b)?b:Pl(E)?E:""},x=o.useMemo(()=>v.map(w=>{const b=y(w);if(!b)return{opt:w,path:"",base:"",folderPath:""};const{folderPath:E,base:A}=lc(b);return{opt:w,path:b,base:A,folderPath:E||"root"}}),[v]),k=o.useMemo(()=>{const w=new Set(["All"]);return x.forEach(({path:b,folderPath:E})=>{b&&w.add(E||"root")}),Array.from(w).sort((b,E)=>b.localeCompare(E))},[x]),N=k.length>2;o.useEffect(()=>{if(!N){d!=="All"&&h("All");return}k.includes(d)||h("All")},[k,d,N]),o.useEffect(()=>{Tk(e,t,d)},[e,t,d]);const j=o.useMemo(()=>{const w=new Map;return x.forEach(({base:b})=>{if(!b)return;const E=b.toLowerCase();w.set(E,(w.get(E)||0)+1)}),w},[x]),m=o.useMemo(()=>{const w=[],b=N&&d==="All";return x.forEach(({opt:E,path:A,base:I,folderPath:B})=>{if(!A){w.push(E);return}const T=B||"root";if(N&&d!=="All"&&T!==d)return;let $=I||rr(A)||E.label;if(b&&I){const ee=I.toLowerCase();if(j.get(ee)>1){const Z=T==="root"?"root":T.split("/").pop()||T;$=`${$} (${Z})`}}w.push({...E,label:$})}),w.sort((E,A)=>String(E.label||"").localeCompare(String(A.label||"")))},[x,j,d,N]),p=o.useMemo(()=>u===""||u===null||u===void 0?!0:m.some(w=>String(w.value)===String(u)),[m,u]),g=w=>{const b=w&&w.target?w.target.value:w;a==null||a(b)};return l.jsxs("div",{className:"w-full space-y-2",children:[N?l.jsx("div",{className:"relative w-full",children:l.jsx(ct,{value:d,onChange:h,disabled:i,"aria-label":`Choose folder for ${n||t}`,size:"sm",options:k.map(w=>({value:w,label:w}))})}):null,l.jsx("div",{className:"relative w-full",children:l.jsx(ct,{id:t,name:t,value:u,onChange:g,disabled:i,"aria-label":n||t,"aria-describedby":r?`${t}-description`:void 0,placeholder:m.length>0&&(u===void 0||u==="")?"Select...":void 0,emptyLabel:"No matches",options:[...!p&&u!==""?[{value:u,label:rr(String(u))}]:[],...m]},`${t||"field"}:${d}`)})]})}const df=o.memo(Rk);function Lm(e=[]){return e.map(t=>typeof t=="string"?{value:t,label:t}:{value:t.value??t.name??"",label:t.label??t.name??String(t.value??"")})}function Am(e,t){if(!e)return null;const n=String(e);if(t==="high"){const r=n.match(/(.+)-high(\.[^.]*)?$/i);return r?r[1]:null}if(t==="low"){const r=n.match(/(.+)-low(\.[^.]*)?$/i);return r?r[1]:null}return null}function Ik(e){return e?e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/^./,t=>t.toUpperCase()):""}const $k=(...e)=>e.flat().map(n=>String(n??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")).filter(Boolean).join("-")||"field";function Mk({name:e,label:t,description:n,highParam:r,lowParam:s,highChoices:a=[],lowChoices:i=[],formData:c={},onChangeParam:u,highStrengthParam:d,lowStrengthParam:h,strengthValue:v,onChangeStrength:y,highStrengthValue:x,lowStrengthValue:k,onChangeHighStrength:N,onChangeLowStrength:j,disabled:m=!1}){const p=o.useMemo(()=>Lm(a),[a]),g=o.useMemo(()=>Lm(i),[i]),w=o.useMemo(()=>{const ne=new Map;g.forEach(G=>{const O=Am(G.value,"low");O&&(ne.has(O)||ne.set(O,G))});const xe=[];return p.forEach(G=>{const O=Am(G.value,"high");if(!O)return;const H=ne.get(O);H&&xe.push({base:O,label:Ik(O),highValue:G.value,lowValue:H.value})}),xe.sort((G,O)=>G.label.localeCompare(O.label)),xe},[p,g]),b=o.useMemo(()=>{const ne=c[r],xe=c[s];if(!ne||!xe)return"";const G=w.find(O=>O.highValue===ne&&O.lowValue===xe);return G?G.base:""},[c,r,s,w]),E=d||h||`${e}_strength`,A=o.useMemo(()=>$k(e||"lora",E||"strength"),[e,E]),I=!!(d||h),B=!!(d&&h),T=(ne,xe=1)=>typeof ne=="number"?ne:xe,$=T(typeof v=="number"?v:typeof x=="number"?x:typeof k=="number"?k:void 0,1),ee=T(typeof x=="number"?x:void 0,$),Z=T(typeof k=="number"?k:void 0,B?$:ee),le=B&&Math.abs(ee-Z)>1e-4,[Ce,me]=o.useState(le);o.useEffect(()=>{me(le)},[le,r,s]);const oe=ne=>{if(!u)return;const xe=w.find(G=>G.base===ne);xe&&(u(r,xe.highValue),u(s,xe.lowValue))};if(w.length===0)return l.jsxs("div",{className:"text-[11px] text-[#9DA3FFCC]",children:["No matching ",l.jsx("span",{className:"font-semibold",children:"-high"})," /"," ",l.jsx("span",{className:"font-semibold",children:"-low"})," LoRA pairs found."]});const R=`${A}-linked`,P=`${A}-high`,M=`${A}-low`,L=B?"Linked":"Strength",W=B?"Applies to high + low":d||h||"",q=(ne,xe)=>{const G=Array.isArray(ne)?ne:[ne];let O=!1;G.forEach(H=>{if(H==="high"&&typeof N=="function"){N(xe);return}if(H==="low"&&typeof j=="function"){j(xe);return}typeof y=="function"&&!O&&(y(xe),O=!0)})},de=ne=>{(d||!d&&!h)&&q("high",ne),h&&q("low",ne)},fe=()=>{B&&me(ne=>{const xe=!ne;return xe||de(typeof ee=="number"?ee:typeof Z=="number"?Z:$),xe})};return l.jsxs("div",{className:"space-y-2",children:[l.jsx(df,{name:`${e}_pair`,label:t,description:n,value:b||"",onChange:oe,disabled:m,options:w.map(ne=>({value:ne.base,label:ne.label}))}),I&&l.jsxs("div",{className:"space-y-1.5",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-[10px] uppercase tracking-[0.16em] text-[#9DA3FFCC]",children:"Strength"}),B&&l.jsx("button",{type:"button",className:"text-[10px] font-semibold tracking-[0.12em] uppercase text-[#E5E7FF]",onClick:fe,disabled:m,children:Ce?"Link values":"Split values"})]}),Ce&&B?l.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-3",children:[l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:P,className:"lora-strength-label is-high",children:[l.jsx("span",{className:"lora-strength-label-pill",children:"High"}),l.jsxs("span",{className:"lora-strength-label-text",children:["High strength",d&&l.jsx("span",{className:"lora-strength-label-hint",children:d})]})]}),l.jsx(ga,{name:`${E}_high`,label:"High strength",description:"",value:ee,onChange:ne=>q("high",ne),disabled:m,isFloat:!0,min:0,max:2,step:.05,inputId:P})]}),l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:M,className:"lora-strength-label is-low",children:[l.jsx("span",{className:"lora-strength-label-pill",children:"Low"}),l.jsxs("span",{className:"lora-strength-label-text",children:["Low strength",h&&l.jsx("span",{className:"lora-strength-label-hint",children:h})]})]}),l.jsx(ga,{name:`${E}_low`,label:"Low strength",description:"",value:Z,onChange:ne=>q("low",ne),disabled:m,isFloat:!0,min:0,max:2,step:.05,inputId:M})]})]}):l.jsxs("div",{className:"flex-1 max-w-[220px]",children:[l.jsxs("label",{htmlFor:R,className:"lora-strength-label is-linked",children:[l.jsx("span",{className:"lora-strength-label-pill",children:L}),l.jsxs("span",{className:"lora-strength-label-text",children:["LoRA strength",W&&l.jsx("span",{className:"lora-strength-label-hint",children:W})]})]}),l.jsx(ga,{name:E,label:"LoRA strength",description:"",value:$,onChange:de,disabled:m,isFloat:!0,min:0,max:2,step:.05,inputId:R})]})]})]})}function Fk(e,t){if(e.disabled!==t.disabled||e.name!==t.name||e.label!==t.label||e.description!==t.description||e.highParam!==t.highParam||e.lowParam!==t.lowParam||e.highStrengthParam!==t.highStrengthParam||e.lowStrengthParam!==t.lowStrengthParam||e.strengthValue!==t.strengthValue||e.highStrengthValue!==t.highStrengthValue||e.lowStrengthValue!==t.lowStrengthValue||e.highChoices!==t.highChoices||e.lowChoices!==t.lowChoices||e.onChangeParam!==t.onChangeParam||e.onChangeStrength!==t.onChangeStrength||e.onChangeHighStrength!==t.onChangeHighStrength||e.onChangeLowStrength!==t.onChangeLowStrength)return!1;const n=e.formData||{},r=t.formData||{};return!(n[e.highParam]!==r[t.highParam]||n[e.lowParam]!==r[t.lowParam])}const Gy=o.memo(Mk,Fk),Ok=16,Dk=[" - "," ","-","_"],Yy=e=>[...new Set(e.filter(Boolean))],Po=(e,t)=>{const n=String(e||"").trim(),r=Dk.map(s=>`${n}${s}${t}`);return r.push(`${n}${t}`),Yy(r)},Pm=(e,t)=>{const n=Po(`${e} Strength`,t),r=Po(e,t).map(s=>`${s} Strength`);return Yy([...n,...r])},zm=e=>String(e||"").toLowerCase().replace(/[\s_-]+/g,""),Pi=(e,t=[])=>{if(!e)return null;const n=Array.isArray(t)?t:[t];for(const s of n){if(!s)continue;const a=e.get(s);if(a)return{name:s,input:a}}const r=new Map;n.forEach(s=>{s&&r.set(zm(s),s)});for(const[s,a]of e.entries()){const i=zm(s);if(r.has(i))return{name:s,input:a}}return null},Bk=Array.from({length:Ok},(e,t)=>{const n=t+1,r=Po("Lora High",n),s=Po("Lora Low",n),a=Pm("Lora High",n),i=Pm("Lora Low",n);return{id:`video_lora_${n}`,label:`Video LoRA ${n}`,highParam:r[0],lowParam:s[0],highParamAliases:r,lowParamAliases:s,highStrengthParam:a[0],lowStrengthParam:i[0],highStrengthParamAliases:a,lowStrengthParamAliases:i}}),Uk=e=>{var r,s;const t=((r=e==null?void 0:e.inputs)==null?void 0:r.param_type)||((s=e==null?void 0:e.inputs)==null?void 0:s.Param_type),n=String(t||"STRING").toUpperCase();return["NUMBER","FLOAT","INT"].includes(n)?"NUMBER":["BOOLEAN","BOOL"].includes(n)?"BOOLEAN":["DROPDOWN","CHOICE","SELECT"].includes(n)?"DROPDOWN":"STRING"},Vk=e=>{const t=(e==null?void 0:e.inputs)||{};return t.label||t.display_name||t.title||t.param_name||(e==null?void 0:e.title)||(e==null?void 0:e.class_type)||"Parameter"},Wk=e=>{const t=(e==null?void 0:e.inputs)||{};return t.description||t.help||t.tooltip||t.doc||""},Zs=e=>{const t=(e==null?void 0:e.inputs)||{};return t.param_name||t.name||t.key||t.id||`param_${(e==null?void 0:e.id)||"unknown"}`},la=e=>{const t=(e==null?void 0:e.inputs)||{},n=t.choices||t.options||[],r=t.default_value??t.value??t.default_choice??(n&&n.length?n[0]:"")??"";return{paramName:Zs(e),label:Vk(e),description:Wk(e),paramType:Uk(e),multiline:!!t.multiline,min:typeof t.min=="number"?t.min:void 0,max:typeof t.max=="number"?t.max:void 0,step:typeof t.step=="number"?t.step:void 0,choices:n,defaultValue:r}},Hk=(e,t)=>{if((e==null?void 0:e.paramType)==="BOOLEAN")return t?"On":"Off";if(t==null||t==="")return"Empty";if(typeof t=="string"){const n=t.trim();if(!n)return"Empty";const r=240,s=140,a=n.length>r?n.slice(0,r):n,c=/[\r\n\t]/.test(a)||/\s{2,}/u.test(a)?a.replace(/\s+/gu," ").trim():a;if(c.length>s)return`${c.slice(0,s)}`;const u=fk(c);return n.length>r?`${u}`:u}return String(t)};function Kk({id:e,label:t,description:n,preview:r,expanded:s=!1,onToggle:a,children:i,trailing:c,className:u=""}){const d=typeof a=="function",h=e?`${e}-description`:void 0,v=e?`${e}-panel`:void 0,y=typeof t=="string"?t.trim().replace(/\s+/gu," ").replace(/:\s*$/u,""):t,x=typeof n=="string"?n.trim().replace(/\s+/gu," "):n,k=typeof r=="string"||typeof r=="number"?String(r):void 0,N=d?"button":"div",j=d?{type:"button",onClick:a,"aria-expanded":s,"aria-controls":v,"aria-describedby":x?h:void 0}:{};return l.jsxs("div",{className:["field-row",u].filter(Boolean).join(" "),children:[l.jsxs(N,{...j,className:["field-row-head",d?"is-collapsible":"is-static",s?"is-expanded":""].filter(Boolean).join(" "),children:[l.jsxs("div",{className:"field-row-main",children:[l.jsx("div",{className:"field-row-label",children:y}),x?l.jsx("div",{id:h,className:"field-row-description",children:x}):null]}),l.jsxs("div",{className:"field-row-trailing",children:[c?l.jsx("div",{className:"field-row-trailing-control",children:c}):null,r?l.jsx("div",{className:"field-row-preview",title:k,children:r}):null,d?l.jsx("div",{className:"field-row-chevron","aria-hidden":"true",children:l.jsx(nc,{size:16})}):null]})]}),d&&s?l.jsx("div",{id:v,className:"field-row-body",children:i}):null]})}const sd=o.memo(Kk);function Gk({paramName:e,cfg:t,formData:n,loraPair:r,collapsed:s,onToggle:a,formatPreview:i,onChangeParam:c,changeHandlers:u}){const{id:d,label:h,highParam:v,lowParam:y,highStrengthParam:x,lowStrengthParam:k,highCfg:N,lowCfg:j}=r,m=x?n[x]:void 0,p=k?n[k]:void 0,g=m??p??1,w=s?i(t,[n[v],n[y]].filter(Boolean).join("  ")):null,b=e?`param-${e}`:void 0;return l.jsx("div",{id:b,"data-param-name":e,"data-param-label":h||t.label,"data-param-type":"lora_pair",className:"settings-row",children:l.jsx(sd,{id:e,label:h||t.label,description:t.description,preview:w,expanded:!s,onToggle:a,children:s?null:l.jsx(Gy,{name:d||v,label:h||t.label,highParam:v,lowParam:y,highChoices:N.choices,lowChoices:j.choices,formData:n,onChangeParam:c,highStrengthParam:x,lowStrengthParam:k,strengthValue:g,highStrengthValue:m,lowStrengthValue:p,onChangeHighStrength:x?u.get(x):void 0,onChangeLowStrength:k?u.get(k):void 0,disabled:!1},`lora-${e}`)})})}function Yk({paramName:e,cfg:t,formData:n,workflowName:r,spotlightName:s,spotlightRenderKey:a,aliasOptions:i,aliasCatalog:c,onOpenComposer:u,changeHandlers:d,enterHandlers:h,collapsed:v,previewValue:y,onToggle:x}){const k=n[e],N={name:e,label:t.label,description:t.description,value:k,disabled:!1,defaultValue:t.defaultValue},j=(p=n,g=!1)=>{const w={...N,value:p==null?void 0:p[e]};return t.paramType==="NUMBER"?l.jsx(ga,{...w,inputId:e,onChange:d.get(e),min:t.min,max:t.max,step:t.step,isFloat:!0},`field-${e}-number-${a}`):t.paramType==="BOOLEAN"?l.jsx(Vy,{...w,onChange:d.get(e)},`field-${e}-bool-${a}`):t.paramType==="DROPDOWN"?l.jsx(df,{...w,workflowName:r,onChange:d.get(e),options:t.choices||[]},`field-${e}-dropdown-${a}`):l.jsx(Uy,{...w,aliasOptions:i,aliasCatalog:c,onOpenComposer:u,onChange:d.get(e),onEnter:h.get(e),multiline:t.multiline||s===e||g},`field-${e}-string-${a}`)},m=e?`param-${e}`:void 0;return t.paramType==="BOOLEAN"?l.jsx("div",{id:m,"data-param-name":e,"data-param-label":t.label,"data-param-type":"single",className:"settings-row",children:l.jsx(sd,{id:e,label:t.label,description:t.description,trailing:j(n,!0)})}):l.jsx("div",{id:m,"data-param-name":e,"data-param-label":t.label,"data-param-type":"single",className:"settings-row",children:l.jsx(sd,{id:e,label:t.label,description:t.description,preview:y,expanded:!v,onToggle:x,children:v?null:j(n,!0)})})}function Qk({inputs:e=[],formData:t={},onFormChange:n,workflowName:r,onParamEdited:s,onSpotlight:a,compactControls:i=!0,collapseAllKey:c=0,collapseAllCollapsed:u=!0,lastEditedParam:d="",spotlightName:h="",onCloseSpotlight:v=()=>{},onVisibleParamsChange:y=()=>{},aliasOptions:x=[],aliasCatalog:k=[],onOpenComposer:N}){const[j,m]=o.useState({}),[p,g]=o.useState(0),w=o.useRef(t);o.useEffect(()=>{w.current=t},[t]);const b=o.useCallback((P,M)=>Hk(P,M),[]),E=o.useCallback((P,M)=>{!n||!P||(n(P,M),s==null||s(P),m(L=>(L==null?void 0:L[P])===!1?L:{...L,[P]:!1}))},[n,s]),A=o.useCallback(P=>{P&&m(M=>({...M,[P]:!(M!=null&&M[P])}))},[]),I=o.useMemo(()=>e||[],[e]),B=o.useMemo(()=>{const P=new Map;return(I||[]).forEach(M=>{const L=Zs(M);L&&P.set(L,W=>E(L,W))}),P},[E,I]),T=o.useMemo(()=>{const P=new Map;return(I||[]).forEach(M=>{const L=Zs(M);L&&P.set(L,(W,q)=>{var de,fe;E(L,W),(fe=(de=q==null?void 0:q.target)==null?void 0:de.blur)==null||fe.call(de),h===L&&(v==null||v())})}),P},[E,v,h,I]),$=o.useMemo(()=>{const P=new Map;return(I||[]).forEach(M=>{const L=Zs(M);L&&P.set(L,()=>A(L))}),P},[A,I]);o.useEffect(()=>{const P={};(e||[]).forEach(M=>{const L=Zs(M);L&&(P[L]=u)}),d&&(P[d]=!1),m(P)},[c,u,e,d]);const ee=o.useMemo(()=>{const P=new Map;return(e||[]).forEach(M=>{const L=Zs(M);L&&P.set(L,M)}),P},[e]),Z=o.useMemo(()=>{const P=[];return Bk.forEach(M=>{const L=Pi(ee,M.highParamAliases||M.highParam),W=Pi(ee,M.lowParamAliases||M.lowParam);if(!L||!W)return;const q=L.input,de=W.input,fe=la(q),ne=la(de);if(fe.paramType!=="DROPDOWN"||ne.paramType!=="DROPDOWN")return;const xe=fe.choices||[],G=ne.choices||[];if(!xe.length||!G.length)return;const O=Pi(ee,M.highStrengthParamAliases||M.highStrengthParam),H=Pi(ee,M.lowStrengthParamAliases||M.lowStrengthParam);P.push({...M,highParam:L.name,lowParam:W.name,highStrengthParam:O==null?void 0:O.name,lowStrengthParam:H==null?void 0:H.name,highInput:q,lowInput:de,highCfg:fe,lowCfg:ne})}),P},[ee]),le=o.useMemo(()=>{const P=new Map;return Z.forEach(M=>{P.set(M.highParam,M)}),P},[Z]),Ce=o.useMemo(()=>{const P=new Set;return Z.forEach(M=>{P.add(M.highParam),P.add(M.lowParam),M.highStrengthParam&&P.add(M.highStrengthParam),M.lowStrengthParam&&P.add(M.lowStrengthParam)}),P},[Z]),me=o.useMemo(()=>{const P=[];return(I||[]).forEach(M=>{const L=la(M),W=L.paramName,q=le.get(W);if(q){P.push({name:W,label:q.label||L.label,description:L.description,render:de=>{const fe=de||w.current||{},ne=q.highStrengthParam?fe[q.highStrengthParam]:void 0,xe=q.lowStrengthParam?fe[q.lowStrengthParam]:void 0,G=ne??xe??1;return l.jsx(Gy,{name:q.id||q.highParam,label:q.label||L.label,highParam:q.highParam,lowParam:q.lowParam,highChoices:q.highCfg.choices,lowChoices:q.lowCfg.choices,formData:fe,onChangeParam:E,highStrengthParam:q.highStrengthParam,lowStrengthParam:q.lowStrengthParam,strengthValue:G,highStrengthValue:ne,lowStrengthValue:xe,onChangeHighStrength:q.highStrengthParam?B.get(q.highStrengthParam):void 0,onChangeLowStrength:q.lowStrengthParam?B.get(q.lowStrengthParam):void 0,disabled:!1},`lora-${W}-${p}`)}});return}Ce.has(W)||P.push({name:W,label:L.label,description:L.description,render:de=>{const fe=de||w.current||{},ne={name:W,label:L.label,description:L.description,value:fe[W],defaultValue:L.defaultValue,disabled:!1};return L.paramType==="NUMBER"?l.jsx(ga,{...ne,onChange:B.get(W),min:L.min,max:L.max,step:L.step,isFloat:!0},`field-${W}-number-${p}`):L.paramType==="BOOLEAN"?l.jsx(Vy,{...ne,onChange:B.get(W)},`field-${W}-bool-${p}`):L.paramType==="DROPDOWN"?l.jsx(df,{...ne,workflowName:r,onChange:B.get(W),options:L.choices||[]},`field-${W}-dropdown-${p}`):l.jsx(Uy,{...ne,aliasOptions:x,aliasCatalog:k,onOpenComposer:N,onChange:B.get(W),onEnter:T.get(W),multiline:L.multiline},`field-${W}-string-${p}`)}})}),P},[I,le,Ce,p,r,x,k,N,E,B,T,h,v]),oe=o.useMemo(()=>{const P=new Map;return me.forEach(M=>P.set(M.name,M)),P},[me]);o.useEffect(()=>{y==null||y(me.map(P=>P.name))},[me,y]);const R=o.useCallback(P=>{const M=me.map(fe=>fe.name),L=oe.get(P);if(!L)return;const W=M.indexOf(P),q=W>0?M[W-1]:null,de=W>=0&&W<M.length-1?M[W+1]:null;g(fe=>fe+1),a==null||a({name:P,label:L.label,description:L.description,render:fe=>L.render(fe||w.current),order:M,index:W>=0?W:0,total:M.length,onPrev:q?()=>R(q):null,onNext:de?()=>R(de):null})},[oe,a,me]);return l.jsx("div",{className:"settings-list",children:I.map(P=>{const M=la(P),L=M.paramName,W=le.get(L);if(W){const fe=i?j[L]??!0:!!j[L];return l.jsx(Gk,{paramName:L,cfg:M,formData:t,loraPair:W,collapsed:fe,onToggle:$.get(L),formatPreview:b,onChangeParam:E,changeHandlers:B},`lora_pair_${W.id||W.highParam}`)}if(Ce.has(L))return null;const q=i?j[L]??!0:!!j[L],de=q?b(M,t[L]):null;return l.jsx(Yk,{paramName:L,cfg:M,formData:t,workflowName:r,spotlightName:h,spotlightRenderKey:p,aliasOptions:x,aliasCatalog:k,onOpenComposer:N,changeHandlers:B,enterHandlers:T,collapsed:q,previewValue:de,onToggle:$.get(L)},L)})})}function qk(e){return(e||[]).map(t=>{var n;if(["CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput","CozyGenChoiceInput"].includes(t.class_type)){let r=t.class_type.replace("CozyGen","").replace("Input","").toUpperCase();return r==="CHOICE"&&(r="DROPDOWN"),{...t,inputs:{...t.inputs,param_type:r,Multiline:((n=t.inputs)==null?void 0:n.display_multiline)||!1}}}return t})}function Xk({workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,sectionRef:s,compactControls:a=!1,collapseAllState:i=null,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:h,aliasOptions:v=[],aliasCatalog:y=[],onOpenComposer:x}){const k=o.useMemo(()=>qk((t||[]).filter(N=>N.class_type!=="CozyGenImageInput")),[t]);return l.jsx("section",{className:"settings-surface scroll-mt-24",ref:s,children:l.jsx(Qk,{workflowName:e,inputs:k,formData:n,onFormChange:r,compactControls:a,collapseAllKey:(i==null?void 0:i.key)??0,collapseAllCollapsed:(i==null?void 0:i.collapsed)??!0,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:h,aliasOptions:v,aliasCatalog:y,onOpenComposer:x})})}function Jk({workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,parameterSectionRef:s,compactControls:a=!0,collapseAllState:i=null,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:h,aliasOptions:v=[],aliasCatalog:y=[],onOpenComposer:x}){return l.jsx(Xk,{workflowName:e,dynamicInputs:t,formData:n,onFormChange:r,sectionRef:s,compactControls:a,collapseAllState:i,onSpotlight:c,spotlightName:u,onCloseSpotlight:d,onVisibleParamsChange:h,aliasOptions:v,aliasCatalog:y,onOpenComposer:x})}function _m(e){try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return""}}function Zk({open:e,onClose:t,logs:n=[],onClear:r}){const s=o.useMemo(()=>(n||[]).map(a=>`[${_m(a.ts)}] ${String(a.level||"info").toUpperCase()} ${a.message}`).join(`
`),[n]);return l.jsx(Wt,{open:e,onClose:t,title:"Run logs",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(K,{variant:"muted",className:"w-full",onClick:()=>{var a,i;try{(i=(a=navigator.clipboard)==null?void 0:a.writeText)==null||i.call(a,s||"")}catch{}},children:"Copy"}),l.jsx(K,{variant:"ghost",className:"w-full",onClick:r,children:"Clear"}),l.jsx(K,{variant:"primary",className:"w-full",onClick:t,children:"Close"})]}),children:l.jsx("pre",{className:"runlog-pre",children:n!=null&&n.length?n.map((a,i)=>l.jsxs("div",{className:`runlog-line is-${a.level||"info"}`,children:[l.jsx("span",{className:"runlog-ts",children:_m(a.ts)}),l.jsx("span",{className:"runlog-msg",children:a.message})]},`${a.ts}-${i}`)):"No logs yet."})})}const ej="cozygen_field_order_v1";function tj(e,t){if(!e)return t;try{const n=JSON.parse(e);return n&&typeof n=="object"?n:t}catch{return t}}function nj(){if(typeof window>"u")return{};try{return tj(window.localStorage.getItem(ej),{})}catch{return{}}}function rj(e){if(Array.isArray(e))return{order:e.filter(Boolean),hidden:{}};if(!e||typeof e!="object")return{order:[],hidden:{}};const t=Array.isArray(e.order)?e.order.filter(Boolean):[],n=e.hidden&&typeof e.hidden=="object"?e.hidden:{};return{order:t,hidden:n}}function sj(e){if(!e)return{order:[],hidden:{}};const n=nj()[e];return rj(n)}function lj(e,t){let n=Array.isArray(t)?t:[];if(!e||n.length===0)return n;const{order:r,hidden:s}=sj(e);if(r&&r.length){const a=new Map;n.forEach(c=>{var d;const u=(d=c==null?void 0:c.inputs)==null?void 0:d.param_name;u&&!a.has(u)&&a.set(u,c)});const i=[];r.forEach(c=>{const u=a.get(c);u&&(i.push(u),a.delete(c))}),n.forEach(c=>{var d;const u=(d=c==null?void 0:c.inputs)==null?void 0:d.param_name;if(!u){i.push(c);return}a.has(u)&&(i.push(c),a.delete(u))}),n=i}return n=n.filter(a=>{var c;const i=(c=a==null?void 0:a.inputs)==null?void 0:c.param_name;return i?!s[i]:!0}),n}function aj(){const[e,t]=o.useState([]),[n,r]=o.useState(null),[s,a]=o.useState(!0),[i,c]=o.useState(null);o.useEffect(()=>{let d=!1;async function h(){a(!0),c(null);try{const v=await vS();if(d)return;const y=(v==null?void 0:v.workflows)||[];t(y);let x=null;try{if(x=typeof window<"u"?sessionStorage.getItem("selectedWorkflow"):null,typeof window<"u")try{localStorage.removeItem("selectedWorkflow")}catch{}}catch{x=null}if(x&&y.includes(x))r(x);else if(y.length>0){r(y[0]);try{typeof window<"u"&&sessionStorage.setItem("selectedWorkflow",y[0])}catch{}}else r(null)}catch(v){if(d)return;console.error("Failed to load workflows",v),c(v)}finally{d||a(!1)}}return h(),()=>{d=!0}},[]);const u=o.useCallback(d=>{r(d);try{if(typeof window<"u"&&sessionStorage.setItem("selectedWorkflow",d),typeof window<"u")try{localStorage.removeItem("selectedWorkflow")}catch{}}catch{}},[]);return{workflows:e,selectedWorkflow:n,selectWorkflow:u,loading:s,error:i}}const ij={clip_name1:"clip",clip_name2:"clip",unet_name:"unet",vae_name:"vae",sampler_name:"sampler",scheduler:"scheduler"},oj=["CozyGenDynamicInput","CozyGenImageInput","CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput","CozyGenChoiceInput"];function cj(e){const[t,n]=o.useState(null),[r,s]=o.useState([]),[a,i]=o.useState({}),[c,u]=o.useState(!1),[d,h]=o.useState(null);o.useEffect(()=>{if(!e){n(null),s([]),i({});return}let k=!1;const N=new AbortController;async function j(){u(!0),h(null);try{typeof performance<"u"&&performance.mark&&performance.mark("cozygen:workflow:load")}catch{}try{const m=await xS(e,{signal:N.signal});if(k)return;for(const E in m){const A=m[E];A.class_type==="CozyGenImageInput"&&!A.inputs.param_name&&(A.inputs.param_name="Image Input"),m[E].id=E}n(m);const p=Object.values(m).filter(E=>oj.includes(E.class_type)),g=await Promise.all(p.map(async E=>{const A=E.class_type==="CozyGenDynamicInput"&&E.inputs.param_type==="DROPDOWN",I=E.class_type==="CozyGenChoiceInput";if(A||I){const B=E.inputs.param_name;let T=E.inputs.choice_type||E.properties&&E.properties.choice_type;if(!T&&A&&(T=ij[B]),T)try{const $=await qu(T,{signal:N.signal,refresh:T==="loras"});E.inputs.choices=$.choices||[]}catch($){($==null?void 0:$.name)!=="AbortError"&&console.error(`Choices for ${B} failed`,$),E.inputs.choices=[]}}return E}));if(k)return;s(g);const w=Lk(e),b={};g.forEach(E=>{const A=E.inputs.param_name;if(!A)return;if(w[A]!==void 0){b[A]=w[A];return}let I;if(["CozyGenDynamicInput","CozyGenFloatInput","CozyGenIntInput","CozyGenStringInput"].includes(E.class_type)){if(I=E.inputs.default_value,E.class_type==="CozyGenIntInput"){const B=parseInt(I,10);I=Number.isNaN(B)?0:B}else if(E.class_type==="CozyGenFloatInput"){const B=parseFloat(I);I=Number.isNaN(B)?0:B}}else if(E.class_type==="CozyGenChoiceInput"){const B=E.inputs.choices||[];I=B.length?B[0]:""}else E.class_type,I="";b[A]=I}),i(b);try{typeof performance<"u"&&performance.measure&&(performance.mark("cozygen:workflow:ready"),performance.measure(`cozygen:workflow:ready:${e||"unknown"}`,"cozygen:workflow:load","cozygen:workflow:ready"))}catch{}}catch(m){if(k)return;console.error("Failed to load workflow",m),h(m),n(null),s([])}finally{k||u(!1)}}return j(),()=>{Ak(e),k=!0,N.abort()}},[e]);const v=o.useMemo(()=>r.filter(k=>k.class_type==="CozyGenImageInput"),[r]),y=v[0]||null,x=o.useCallback((k,N)=>{i(j=>{const m={...j,[k]:N};return e&&Ao(e,m),m})},[e]);return{workflowData:t,dynamicInputs:r,imageInputs:v,primaryImageInput:y,formData:a,setFormData:i,handleFormChange:x,loading:c,error:d}}function ff(){const[e,t]=o.useState(()=>typeof document>"u"?!0:document.visibilityState!=="hidden");return o.useEffect(()=>{if(typeof document>"u")return;const n=()=>{t(document.visibilityState!=="hidden")};return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)},[]),e}const Tm="::";function ya(e){const t={};return Object.entries(e||{}).forEach(([n,r])=>{const s=String(n||"").trim();if(!s||typeof r!="string")return;const a=r.trim();a&&(t[s]=a)}),t}function pf(e){const t=new Map;return Object.entries(ya(e)).forEach(([n,r])=>{const s=n.toLowerCase();t.set(s,r),s.includes(Tm)&&t.set(s.replace(Tm,":"),r)}),t}function ml(e,t){if(typeof e!="string"||!e.includes("$"))return e;const n=t instanceof Map?t:pf(t);return n.size?e.replace(/\$([a-z0-9_:-]+)\$/gi,(r,s)=>{const a=n.get(s.toLowerCase());return typeof a=="string"?a:r}):e}function uj(e,t){const n=t instanceof Map?t:pf(t);if(!n.size||!e||typeof e!="object")return e;let r=!1;const s={};return Object.entries(e).forEach(([a,i])=>{if(typeof i=="string"){const c=ml(i,n);s[a]=c,c!==i&&(r=!0)}else s[a]=i}),r?s:e}function mf(e){return e?JSON.parse(JSON.stringify(e)):{}}function dj(e,t,n){const r=mf(e),s={...n||{}};if(!t||!Array.isArray(t))return{workflow:r,formData:s};for(const a of t){if(!a||!a.id||!a.inputs||!r[a.id])continue;const i=a.inputs.param_name;if(!i||a.class_type==="CozyGenImageInput")continue;let c=s[i];const u=r[a.id];if(!u||!u.inputs)continue;const d=a.class_type;c===void 0&&(d==="CozyGenChoiceInput"?c=a.inputs.value??a.inputs.default_choice??(a.inputs.choices&&a.inputs.choices[0])??"":c=a.inputs.default_value),c===void 0&&(c=""),s[i]=c,d==="CozyGenFloatInput"||d==="CozyGenIntInput"||d==="CozyGenStringInput"||d==="CozyGenDynamicInput"?u.inputs.default_value=c:d==="CozyGenChoiceInput"&&(u.inputs.value=c)}return{workflow:r,formData:s}}const hf=["seed","noise_seed"],Qy=["ckpt_name","checkpoint","ckpt","model_name"],ld=["lora_name"],qy=["width","image_width"],Xy=["height","image_height"],fj=/(prompt|positive|text)/i,pj=/(negative|neg)/i,Ml=e=>String(e||"").toLowerCase(),Fa=e=>(e==null?void 0:e.class_type)==="CozyGenDynamicInput"||(e==null?void 0:e.class_type)==="CozyGenChoiceInput",Oa=e=>{var t;return Ml((t=e==null?void 0:e.inputs)==null?void 0:t.choice_type)},zo=(e,t)=>{e!=null&&e.inputs&&("default_value"in e.inputs&&(e.inputs.default_value=t),"value"in e.inputs&&(e.inputs.value=t))},Jy=e=>Ml(e==null?void 0:e.class_type).includes("checkpoint"),Zy=e=>Ml(e==null?void 0:e.class_type).includes("lora"),ev=e=>Ml(e==null?void 0:e.class_type).includes("seed"),gf=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;const t=parseInt(String(e),10);return Number.isFinite(t)?t:null},pr=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;const t=parseInt(String(e),10);return Number.isFinite(t)?t:null},zi=e=>e!=null&&e.inputs?"default_value"in e.inputs?pr(e.inputs.default_value):"value"in e.inputs?pr(e.inputs.value):null:null,_o=e=>{var t;return Ml((t=e==null?void 0:e.inputs)==null?void 0:t.param_name)},mj=e=>{var t;return String(((t=e==null?void 0:e.inputs)==null?void 0:t.param_name)||"").trim()},_i=(e,t)=>{if(!(e!=null&&e.inputs))return!1;let n=!1;return"default_value"in e.inputs&&pr(e.inputs.default_value)!==null&&(e.inputs.default_value=t,n=!0),"value"in e.inputs&&pr(e.inputs.value)!==null&&(e.inputs.value=t,n=!0),n},hj=e=>{const t=String(e||"").trim();return!t||pj.test(t)?!1:fj.test(t)},gj=e=>{if(!e)return[];const t=[];return typeof e.default_value=="string"&&t.push("default_value"),typeof e.value=="string"&&e.value!==e.default_value&&t.push("value"),t},yj=e=>Ml(e==null?void 0:e.class_type).includes("textencode"),Rm=(e,t)=>{if(!(e!=null&&e.inputs))return!1;let n=!1;return hf.forEach(r=>{if(!(r in e.inputs))return;const s=e.inputs[r];Array.isArray(s)||gf(s)!==null&&(e.inputs[r]=t,n=!0)}),n},vj=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(hf.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}gf(a)!==null&&(r.inputs[s]=t)}),ev(r)&&Rm(r,t))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Rm(s,t)})},xj=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(Fa(r)&&Oa(r)==="checkpoints"&&zo(r,t),Jy(r)&&Qy.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}(typeof a=="string"||typeof a=="number")&&(r.inputs[s]=t)}))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Fa(s)&&Oa(s)==="checkpoints"&&zo(s,t)})},wj=(e,t)=>{const n=new Set;Object.values(e||{}).forEach(r=>{r!=null&&r.inputs&&(Fa(r)&&Oa(r)==="loras"&&zo(r,t),(Zy(r)||ld.some(s=>s in r.inputs))&&ld.forEach(s=>{if(!(s in r.inputs))return;const a=r.inputs[s];if(Array.isArray(a)&&a.length){n.add(a[0]);return}(typeof a=="string"||typeof a=="number")&&(r.inputs[s]=t)}))}),n.forEach(r=>{const s=e==null?void 0:e[r];s&&Fa(s)&&Oa(s)==="loras"&&zo(s,t)})},Sj=(e,t,n)=>{if(t===null&&n===null)return;const r=new Set,s=new Set;Object.values(e||{}).forEach(a=>{if(!(a!=null&&a.inputs))return;const i=a.inputs,c=_o(a);t!==null&&c==="width"&&_i(a,t),n!==null&&c==="height"&&_i(a,n),t!==null&&qy.forEach(u=>{if(!(u in i))return;const d=i[u];if(Array.isArray(d)&&d.length){r.add(d[0]);return}pr(d)!==null&&(i[u]=t)}),n!==null&&Xy.forEach(u=>{if(!(u in i))return;const d=i[u];if(Array.isArray(d)&&d.length){s.add(d[0]);return}pr(d)!==null&&(i[u]=n)})}),r.forEach(a=>{const i=e==null?void 0:e[a];i&&_i(i,t)}),s.forEach(a=>{const i=e==null?void 0:e[a];i&&_i(i,n)})};function tv(e){if(!e)return[];const t=Object.entries(e||{}).sort((r,s)=>{const a=Number(r[0]),i=Number(s[0]);return Number.isFinite(a)&&Number.isFinite(i)?a-i:String(r[0]).localeCompare(String(s[0]))}),n=[];return t.forEach(([r,s])=>{if(!(s!=null&&s.inputs))return;const a=s.inputs,i=String((s==null?void 0:s.class_type)||""),c=mj(s),u=_o(s);if(u&&hj(u)){const d=gj(a);if(d.length){const h=a[d[0]];typeof h=="string"&&n.push({id:String(r),key:`${r}:${d[0]}`,label:c||`Prompt ${r}`,text:h,fields:d,classType:i})}return}yj(s)&&typeof a.text=="string"&&n.push({id:String(r),key:`${r}:text`,label:`${i||"Text Encode"} ${r}`,text:a.text,fields:["text"],classType:i})}),n}function kj(e,t=[],n={},r={}){if(!e||!t.length)return e;const{mutate:s=!1}=r||{},a=s?e:mf(e);return t.forEach(i=>{var d;if(!(i!=null&&i.id)||!((d=i==null?void 0:i.fields)!=null&&d.length))return;const c=typeof(n==null?void 0:n[i.key])=="string"?n[i.key]:i.text;if(typeof c!="string")return;const u=a==null?void 0:a[i.id];u!=null&&u.inputs&&i.fields.forEach(h=>{typeof u.inputs[h]=="string"&&(u.inputs[h]=c)})}),a}function jj(e){const t={hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null},n=new Set,r=new Set;return Object.values(e||{}).forEach(s=>{const a=(s==null?void 0:s.inputs)||{};if(a){if(hf.forEach(i=>{i in a&&(t.hasSeed=!0)}),Jy(s)&&(t.hasCheckpoint=!0,Qy.forEach(i=>{const c=a[i];typeof c=="string"&&c&&n.add(c)})),Zy(s)||ld.some(i=>i in a)){t.hasLora=!0;const i=a.lora_name;typeof i=="string"&&i&&r.add(i)}if(Fa(s)){const i=Oa(s),c=a.default_value??a.value;i==="checkpoints"&&(t.hasCheckpoint=!0,typeof c=="string"&&c&&n.add(c)),i==="loras"&&(t.hasLora=!0,typeof c=="string"&&c&&r.add(c))}if(ev(s)&&"seed"in a&&(t.hasSeed=!0),t.width===null&&_o(s)==="width"){const i=zi(s);i!==null&&(t.width=i)}if(t.height===null&&_o(s)==="height"){const i=zi(s);i!==null&&(t.height=i)}t.width===null&&qy.forEach(i=>{if(!(i in a)||t.width!==null)return;const c=a[i];if(Array.isArray(c)&&c.length){const d=e==null?void 0:e[c[0]],h=zi(d);h!==null&&(t.width=h);return}const u=pr(c);u!==null&&(t.width=u)}),t.height===null&&Xy.forEach(i=>{if(!(i in a)||t.height!==null)return;const c=a[i];if(Array.isArray(c)&&c.length){const d=e==null?void 0:e[c[0]],h=zi(d);h!==null&&(t.height=h);return}const u=pr(c);u!==null&&(t.height=u)})}}),t.checkpoint=n.values().next().value||"",t.loras=Array.from(r),t.hasSize=t.width!==null||t.height!==null,t}function Im(e,t={}){if(!e)return e;const n=mf(e),{seedMode:r="keep",seedValue:s=null,checkpoint:a=null,lora:i=null,width:c=null,height:u=null}=t;if(r&&r!=="keep"){const v=r==="random"?Math.floor(Math.random()*4294967295):gf(s);v!==null&&vj(n,v)}a&&xj(n,a),i&&wj(n,i);const d=pr(c),h=pr(u);return(d!==null||h!==null)&&Sj(n,d,h),n}const Nj=/\$[a-z0-9_:-]+\$/i;function Cj({selectedWorkflow:e,workflowData:t,dynamicInputs:n,imageInputs:r,formData:s,setFormData:a,promptAliases:i=null}){const c=ff(),[u,d]=o.useState(!1),[h,v]=o.useState(!1),[y,x]=o.useState(0),[k,N]=o.useState(0),[j,m]=o.useState("Idle"),[p,g]=o.useState("idle"),[w,b]=o.useState([]),E=o.useRef({ts:0,value:0,max:0}),A=o.useRef(null),I=o.useRef({value:0,max:0}),B=o.useRef(null),T=o.useRef(null),$=o.useRef(t),ee=o.useRef(s),Z=o.useRef(!1),le=o.useRef(0),Ce=o.useRef(0),me=o.useRef("idle"),oe=o.useRef(null),R=o.useRef(null);o.useEffect(()=>{$.current=t},[t]),o.useEffect(()=>{Z.current=h},[h]),o.useEffect(()=>{le.current=y},[y]),o.useEffect(()=>{Ce.current=k},[k]),o.useEffect(()=>{me.current=p},[p]),o.useEffect(()=>{ee.current=s},[s]);const P=()=>{oe.current&&(clearTimeout(oe.current),oe.current=null)},M=()=>{R.current&&(clearTimeout(R.current),R.current=null)},L=()=>{T.current&&(clearTimeout(T.current),T.current=null)},W=()=>{A.current&&(cancelAnimationFrame(A.current),A.current=null)},q=o.useCallback((H,we,he=null)=>{const Me={ts:Date.now(),level:H||"info",message:String(we||""),extra:he||null};b(Re=>{const Fe=[...Re||[],Me];return Fe.length>250?Fe.slice(Fe.length-250):Fe})},[]),de=o.useCallback(()=>b([]),[]),fe=()=>{if(!(typeof window>"u"||typeof window.dispatchEvent!="function"))try{window.dispatchEvent(new CustomEvent("cozygen:queue-finished"))}catch{}},ne=()=>{M(),R.current=setTimeout(()=>{Z.current||(g("idle"),m("Idle"),x(0),N(0))},8e3)},xe=o.useCallback(()=>{P(),d(!1),v(!1),x(0),N(0),m("Finished"),g("finished"),q("success","Finished"),ne(),fe()},[q]),G=o.useCallback((H="Error")=>{P(),d(!1),v(!1),m(H),g("error"),q("error",H||"Error"),ne()},[q]);o.useEffect(()=>{P(),!(!h||!k||k<=0||y<k)&&(oe.current=setTimeout(()=>{const H=Z.current,we=le.current,he=Ce.current,Me=me.current;H&&he>0&&we>=he&&Me!=="finished"&&Me!=="error"&&xe()},800))},[h,y,k,xe]),o.useEffect(()=>{if(typeof window>"u"||!c&&!h)return;let H=!1,we=1e3;const he=()=>{if(H||!c&&!Z.current)return;const Me=window.location.protocol==="https:"?"wss":"ws",Re=window.location.host,Fe=af(),Oe=`${Me}://${Re}/ws${Fe?`?token=${encodeURIComponent(Fe)}`:""}`,Ze=new WebSocket(Oe);B.current=Ze,Ze.onopen=()=>{we=1e3},Ze.onmessage=re=>{var Ie,te,Ne;if(typeof re.data!="string")return;let _e;try{_e=JSON.parse(re.data)}catch{return}const Y=_e.type;if(Y==="cozygen_batch_ready"){xe();return}if(Y==="execution_success"||Y==="execution_finished"){Z.current&&xe();return}if(Y==="execution_error"||Y==="execution_interrupted"){q("error","Execution error"),G("Execution error");return}if(Y==="status"){const ge=_e.data||{},ve=ge.status||ge,ye=ve.exec_info||ge.exec_info||ve;if(ye&&Z.current){const Ae=ye.queue_remaining??ye.queue_pending??ye.queue_remaining_items??0;(ye.queue_running??ye.running??0)===0&&Ae===0&&xe()}return}if(Y==="executing"){M(),g("running");const ge=(Ie=_e.data)==null?void 0:Ie.node,ve=$.current;if(ge&&ve&&ve[ge]){const ye=ve[ge],Ae=ye.title||ye.class_type||"Node";q("info",`Executing: ${Ae}`,{nodeId:ge}),m(`Executing: ${Ae}`)}else q("info","Executing"),m("Executing");return}if(Y==="progress"){const ge=((te=_e.data)==null?void 0:te.value)??0,ve=((Ne=_e.data)==null?void 0:Ne.max)??0;I.current={value:ge,max:ve},A.current||(A.current=window.requestAnimationFrame(()=>{A.current=null;const Ke=I.current;x(Ke.value),N(Ke.max)}));const ye=Date.now(),Ae=E.current;ye-Ae.ts>2500&&(ge!==Ae.value||ve!==Ae.max)&&ve>0&&(E.current={ts:ye,value:ge,max:ve},q("info",`Progress: ${ge}/${ve}`));return}},Ze.onclose=()=>{H||!c&&!Z.current||(L(),T.current=setTimeout(he,we),we=Math.min(Math.ceil(we*1.6),15e3))}};return he(),()=>{H=!0,P(),M(),L(),W(),B.current&&(B.current.onclose=null,B.current.close())}},[q,G,xe,c,h]);const O=o.useCallback(async(H={})=>{if(!t)return;const{overrides:we=null,persistFormState:he=!0}=H||{};P(),M(),d(!0),v(!0),m("Queuing prompt"),g("queued"),x(0),N(0),q("info","Queuing prompt",{workflow:e||""});const Me=ee.current||{},Re=we?{...Me,...we||{}}:Me,Fe=uj(Re,i||{}),{workflow:Oe,formData:Ze}=dj(t,n||[],Fe||{}),re={...Ze,...Re};he&&e&&Ao(e,re),he&&a(re);const _e=r||[];for(const Y of _e){if(!Y||!Y.id||!Y.inputs)continue;const Ie=Y.inputs.param_name;if(!Ie)continue;const te=re[Ie];if(!te){alert(`Please upload or select an image for "${Ie}" before generating.`),G("Missing image input");return}Oe[Y.id]&&Oe[Y.id].inputs&&(Oe[Y.id].inputs.image_filename=te)}try{const Y=tv(Oe),Ie={};Y.length&&Y.forEach(ge=>{const ve=Re==null?void 0:Re[ge.label],ye=typeof ve=="string"?ve:ge.text;typeof ye=="string"&&Nj.test(ye)&&(Ie[ge.key]=ye)});const te=Co();if(Object.keys(Ie).length)try{await jo({promptId:te,promptRaw:Ie})}catch{}let Ne=Oe;if(i){const ge=ve=>{if(typeof ve=="string")return ml(ve,i);if(Array.isArray(ve))return ve.map(ye=>ge(ye));if(ve&&typeof ve=="object"){const ye=Array.isArray(ve)?[]:{};return Object.entries(ve).forEach(([Ae,Q])=>{ye[Ae]=ge(Q)}),ye}return ve};try{Ne=ge(Oe)}catch{Ne=Oe}}Zu({workflowName:e,workflow:Ne,timestamp:Date.now(),promptRaw:Object.keys(Ie).length?Ie:null}),await ko({prompt:Ne,prompt_id:te}),q("info","Prompt queued")}catch(Y){console.error("Failed to queue prompt",Y),Y!=null&&Y.unauthorized?(q("error","Session expired. Please sign in again."),G("Session expired. Please sign in again."),window.location.hash="#/login"):(q("error","Error queuing prompt"),G("Error queuing prompt"))}},[t,n,r,i,e,a,G,q]);return{isLoading:u,progressValue:y,progressMax:k,statusText:j,statusPhase:p,handleGenerate:O,logEntries:w,clearLogs:de}}const nv="cozygen_prompt_aliases",rv="cozygen_alias_categories",sv="cozygen_alias_category_list";function $m(){if(typeof window>"u")return{};try{const e=window.localStorage.getItem(nv);return e?JSON.parse(e)||{}:{}}catch{return{}}}function Kc(e){if(!(typeof window>"u"))try{window.localStorage.setItem(nv,JSON.stringify(e||{}))}catch{}}function Mm(){if(typeof window>"u")return{};try{const e=window.localStorage.getItem(rv);return e?JSON.parse(e)||{}:{}}catch{return{}}}function Gc(e){if(!(typeof window>"u"))try{window.localStorage.setItem(rv,JSON.stringify(e||{}))}catch{}}function Fm(){if(typeof window>"u")return[];try{const e=window.localStorage.getItem(sv);return Array.isArray(JSON.parse(e))?JSON.parse(e):[]}catch{return[]}}function Yc(e){if(!(typeof window>"u"))try{window.localStorage.setItem(sv,JSON.stringify(e||[]))}catch{}}function lv(){const[e,t]=o.useState(()=>$m()),[n,r]=o.useState(()=>Mm()),[s,a]=o.useState(()=>Fm()),[i,c]=o.useState(!1),[u,d]=o.useState(!1),[h,v]=o.useState(null),y=o.useCallback(async()=>{c(!0),v(null);try{const j=await jS(),m=ya((j==null?void 0:j.items)||j||{}),p=(j==null?void 0:j.categories)||{},g=Array.isArray(j==null?void 0:j.categoryList)?j.categoryList:[];t(m),r(p),a(g),Kc(m),Gc(p),Yc(g)}catch(j){console.error("Failed to load prompt aliases",j),v(j);const m=ya($m()),p=Mm(),g=Fm();t(m),r(p),a(g)}finally{c(!1)}},[]),x=o.useCallback(async j=>{const m=(j==null?void 0:j.items)||j||{},p=(j==null?void 0:j.categories)||n||{},g=Array.isArray(j==null?void 0:j.categoryList)&&j.categoryList.length?j.categoryList:s.length?s:Array.from(new Set(Object.values(p).filter(Boolean))),w=ya(m||{});d(!0),v(null);try{await NS({items:w,categories:p,categoryList:g}),t(w),r(p),a(g),Kc(w),Gc(p),Yc(g)}catch(b){throw console.error("Failed to save prompt aliases",b),v(b),Kc(w),Gc(p),Yc(g),b}finally{d(!1)}},[n,s]);o.useEffect(()=>{y()},[y]);const k=o.useMemo(()=>{const j=pf(e),m=new Map(j);return Object.entries(n||{}).forEach(([p,g])=>{const w=String(g||"").trim();w&&(e!=null&&e[p])&&m.set(`${w}:${p}`,e[p])}),m},[e,n]),N=o.useMemo(()=>{const j=new Set,m=[];return k.forEach((p,g)=>{let w=g.includes("::")?g.replace("::",":"):g;const b=w.split(":");b.length>=3&&b[0]&&b[1]&&b[0].toLowerCase()===b[1].toLowerCase()&&(w=[b[0],...b.slice(2)].join(":"));const E=w.toLowerCase();j.has(E)||(j.add(E),m.push(w))}),m},[k]);return{aliases:e,aliasCategories:n,categoryList:s,aliasLookup:k,aliasOptions:N,loading:i,saving:u,error:h,refreshAliases:y,persistAliases:x}}const av=o.createContext(null);function yf(){const e=o.useContext(av);if(!e)throw new Error("useStudioContext must be used within a StudioProvider");return e}function bj({children:e}){const{workflows:t,selectedWorkflow:n,selectWorkflow:r,loading:s,error:a}=aj(),{workflowData:i,dynamicInputs:c,imageInputs:u,primaryImageInput:d,formData:h,setFormData:v,handleFormChange:y,loading:x,error:k}=cj(n),N=lv(),j=o.useMemo(()=>{const ee=[];return Object.entries(N.aliases||{}).forEach(([Z,le])=>{const Ce=String(Z).split("::"),me=Ce.length>1,oe=N.aliasCategories&&N.aliasCategories[Z]||(me?Ce[0]:""),R=me?Ce.slice(1).join("::"):Z,P={key:Z,name:R,category:oe,text:le,token:oe?`${oe}:${R}`:R};ee.push({...P,...uf(P)})}),ee},[N.aliases,N.aliasCategories]),m=o.useMemo(()=>lj(n,c),[n,c]),p=o.useMemo(()=>{const ee=(m||c||[]).filter(R=>(R==null?void 0:R.class_type)!=="CozyGenImageInput"),Z=/\b(checkpoint|ckpt|lora|model|vae|embedding|clip|sampler|scheduler|seed)\b/i,le=R=>{const P=String((R==null?void 0:R.paramName)||"").toLowerCase(),M=String((R==null?void 0:R.label)||"").toLowerCase(),L=`${P} ${M}`,W=h==null?void 0:h[R==null?void 0:R.paramName],q=typeof W=="string"?W:"";let de=0;return L.includes("prompt")&&(de+=100),L.includes("negative")&&L.includes("prompt")&&(de-=15),R!=null&&R.multiline&&(de+=10),q.includes("$")&&(de+=20),Z.test(L)&&(de-=200),$y(q)&&(de-=200),de};if(typeof(h==null?void 0:h.prompt)=="string")return"prompt";const Ce=ee.map(R=>la(R)).filter(R=>(R==null?void 0:R.paramType)==="STRING"&&(R==null?void 0:R.paramName));if(!Ce.length)return"prompt";let me=Ce[0],oe=le(me);for(let R=1;R<Ce.length;R+=1){const P=Ce[R],M=le(P);M>oe&&(me=P,oe=M)}return(me==null?void 0:me.paramName)||"prompt"},[c,h,m]),{isLoading:g,progressValue:w,progressMax:b,statusText:E,statusPhase:A,handleGenerate:I,logEntries:B,clearLogs:T}=Cj({selectedWorkflow:n,workflowData:i,dynamicInputs:c,imageInputs:u,formData:h,setFormData:v,promptAliases:N.aliasLookup});o.useEffect(()=>{if(A==="finished"&&!(typeof window>"u")){try{window.localStorage.setItem("cozygen_gallery_pending","1")}catch{}window.dispatchEvent(new Event("cozygen:gallery-pending"))}},[A]),o.useEffect(()=>{if(typeof window>"u")return;const ee=A==="queued"||A==="running"||g;try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:ee}}))}catch{}},[A,g]);const $=o.useMemo(()=>({workflows:t,selectedWorkflow:n,selectWorkflow:r,workflowsLoading:s,workflowsError:a,workflowData:i,dynamicInputs:c,orderedDynamicInputs:m,imageInputs:u,primaryImageInput:d,formData:h,setFormData:v,handleFormChange:y,workflowLoading:x,workflowError:k,promptFieldName:p,aliasOptions:N.aliasOptions,aliasCatalog:j,aliasLookup:N.aliasLookup,aliasCategories:N.aliasCategories,aliasLoading:N.loading,aliasSaving:N.saving,aliasError:N.error,refreshAliases:N.refreshAliases,persistAliases:N.persistAliases,isLoading:g,progressValue:w,progressMax:b,statusText:E,statusPhase:A,handleGenerate:I,logEntries:B,clearLogs:T}),[t,n,r,s,a,i,c,m,u,d,h,v,y,x,k,p,N.aliasOptions,N.aliasLookup,N.aliasCategories,j,N.loading,N.saving,N.error,N.refreshAliases,N.persistAliases,g,w,b,E,A,I,B,T]);return l.jsx(av.Provider,{value:$,children:e})}function Ej(){const e=Ir(),{workflows:t=[],selectedWorkflow:n,selectWorkflow:r,workflowData:s,dynamicInputs:a=[],imageInputs:i=[],formData:c,setFormData:u,handleFormChange:d,aliasOptions:h,aliasCatalog:v,isLoading:y,progressValue:x,progressMax:k,statusText:N,statusPhase:j,handleGenerate:m,logEntries:p,clearLogs:g,promptFieldName:w,orderedDynamicInputs:b}=yf(),E=o.useRef(null),A=o.useRef(null),[I,B]=o.useState(()=>_k()),[T,$]=o.useState(null),ee=(T==null?void 0:T.name)||"",Z=o.useCallback(()=>$(null),[]),[le,Ce]=o.useState(!1),[me,oe]=o.useState([]),[R,P]=o.useState([]),[M,L]=o.useState(""),[W,q]=o.useState(""),[de,fe]=o.useState(""),ne=o.useRef(new Map),xe=o.useCallback((te="")=>{const ge=`?field=${encodeURIComponent(te||w||"prompt")}`;e(`/compose${ge}`)},[e,w]),G=o.useCallback(te=>{!te||te===n||(n&&Ao(n,c||{},{immediate:!0}),L(""),q(""),fe(""),r(te))},[c,n,r]),O=o.useMemo(()=>{const Ne=[...b||[],...i||[]].map(ge=>{var ve;return(ve=ge==null?void 0:ge.inputs)==null?void 0:ve.param_name}).filter(ge=>ge&&typeof ge=="string");return new Set(Ne)},[b,i]),H=o.useCallback(te=>{q(te);const Ne=R.find(ye=>ye.id===te);if(L((Ne==null?void 0:Ne.name)||""),!te||!(Ne!=null&&Ne.values)||!n){te||fe("");return}const ge=O,ve={};Object.entries(Ne.values).forEach(([ye,Ae])=>{(!ge.size||ge.has(ye))&&(ve[ye]=Ae)}),u(ye=>{const Ae={...ye,...ve};return Ao(n,Ae,{immediate:!0}),Ae}),fe(`Applied "${Ne.name}".`)},[O,R,n,u]),we=i||[],he=!!(s&&n),Me=we.length>0,Re=o.useCallback((te,Ne)=>{const ge=ne.current;Ne&&te&&ge.set(te,Ne);const ve=me.length?me:(Ne==null?void 0:Ne.order)||[],ye=ve.length,Ae=ye>0?ve.indexOf(te):-1,Q=Ae>0?ve[Ae-1]:null,Ke=Ae>=0&&Ae<ye-1?ve[Ae+1]:null,et=Q?ge.get(Q):null,Xe=Ke?ge.get(Ke):null;return{...Ne,index:Ae>=0?Ae:0,total:ye,onPrev:et?()=>$(Re(Q,et)):null,onNext:Xe?()=>$(Re(Ke,Xe)):null,onRender:m}},[me,m]),Fe=o.useCallback(te=>{const Ne=te||[];oe(ge=>ge.length===Ne.length&&ge.every((ve,ye)=>ve===Ne[ye])?ge:Ne)},[]),Oe=o.useCallback(te=>{const Ne=te||"";B(Ne),zk(Ne)},[]),Ze=o.useCallback(te=>{te!=null&&te.name&&$(Re(te.name,te))},[Re]),re=o.useCallback(async te=>{if(!te){P([]),q("");return}try{const Ne=await CS(te),ge=Array.isArray(Ne==null?void 0:Ne.presets)?Ne.presets:[];P(ge),q(ve=>ve&&ge.some(ye=>ye.id===ve)?ve:"")}catch(Ne){console.error("Failed to load workflow presets",Ne),P([]),fe("Presets unavailable.")}},[]);o.useEffect(()=>{re(n)},[n,re]);const _e=o.useCallback(async()=>{if(!n)return;const te=M.trim();if(!te){fe("Name a preset to save.");return}const Ne={},ge=O;Object.entries(c||{}).forEach(([Ae,Q])=>{(!ge.size||ge.has(Ae))&&(Ne[Ae]=Q)});const ve=R.find(Ae=>Ae.id===W),ye=ve&&ve.name.toLowerCase()===te.toLowerCase()?ve.id:void 0;try{const Ae=await bS(n,{id:ye,name:te,values:Ne}),Q=Array.isArray(Ae==null?void 0:Ae.presets)?Ae.presets:[],Ke=Ae==null?void 0:Ae.preset;P(Q),Ke!=null&&Ke.id&&q(Ke.id),fe(`Saved "${te}".`)}catch(Ae){console.error("Failed to save preset",Ae),fe("Save failed.")}},[O,c,M,R,W,n]),Y=o.useCallback(async()=>{if(!(!n||!W))try{const te=await ES(n,W),Ne=Array.isArray(te==null?void 0:te.presets)?te.presets:[];P(Ne),q(""),fe("Preset deleted.")}catch(te){console.error("Failed to delete preset",te),fe("Delete failed.")}},[W,n]),Ie=o.useCallback(()=>{var te;return(te=T==null?void 0:T.render)==null?void 0:te.call(T,c)},[T,c]);return o.useEffect(()=>{const te=()=>{!he||y||m()};return window.addEventListener("cozygen:request-render",te),()=>window.removeEventListener("cozygen:request-render",te)},[m,he,y]),!t||t.length===0?l.jsx("div",{className:"page-shell",children:l.jsx("div",{className:"ui-card px-3 py-3 sm:px-4 sm:py-4",children:l.jsx("p",{className:"text-sm text-[#9DA3FFCC]",children:"No workflows found. Drop a workflow file in CozyGen and refresh."})})}):l.jsxs("div",{className:"page-shell page-stack has-dock controls-page",children:[l.jsxs("div",{className:"page-bar controls-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Controls"}),l.jsx("div",{className:"page-bar-actions",children:I?l.jsxs("span",{className:"controls-meta",children:["Last: ",I]}):null})]}),l.jsxs("section",{className:"controls-board",children:[l.jsx(hk,{workflows:t,selectedWorkflow:n,onWorkflowChange:G,workflowData:s,presets:R,presetName:M,onPresetNameChange:L,selectedPresetId:W,onPresetSelect:H,onPresetSave:_e,onPresetDelete:Y,presetStatus:de}),Me?l.jsx(Lo,{ref:A,className:"controls-panel",title:l.jsxs(l.Fragment,{children:[l.jsx(MS,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Images"]}),bodyClassName:"control-shell controls-body",defaultOpen:!1,children:s?l.jsx("div",{className:"grid grid-cols-1 gap-3 lg:grid-cols-2",children:we.map(te=>l.jsx(ak,{input:te,value:c[te.inputs.param_name]||"",onFormChange:d},te.id))}):null}):null,l.jsx(Lo,{title:l.jsxs(l.Fragment,{children:[l.jsx(Ly,{size:18,className:"inline-block mr-2 align-text-bottom"}),"Parameters"]}),bodyClassName:"control-shell controls-body",defaultOpen:!0,className:"controls-panel",children:s?l.jsx(Jk,{workflowName:n,dynamicInputs:b,formData:c,onFormChange:d,parameterSectionRef:E,compactControls:!0,lastEditedParam:I,spotlightName:ee,onCloseSpotlight:Z,onVisibleParamsChange:Fe,aliasOptions:h,aliasCatalog:v,onOpenComposer:xe,onParamEdited:Oe,onSpotlight:Ze}):l.jsxs("div",{className:"empty-state-inline",children:[l.jsx("span",{className:"empty-state-arrow",children:l.jsx(FS,{size:20})}),l.jsx("span",{children:"Select a workflow above to get started"})]})})]}),l.jsxs("div",{className:"controls-status-strip",children:[l.jsxs("div",{className:"controls-status-left",children:[l.jsx("span",{className:`controls-status-dot is-${j||"idle"}`,"aria-hidden":"true"}),l.jsxs("div",{className:"controls-status-text",children:[l.jsx("span",{className:"controls-status-phase",children:j||"idle"}),l.jsx("span",{className:"controls-status-msg",children:N||"Idle"})]})]}),l.jsxs("div",{className:"controls-status-right",children:[y&&k>0?l.jsx("div",{className:"controls-status-meter","aria-label":"Progress",children:l.jsx("div",{className:"controls-status-meter-fill",style:{width:`${Math.max(0,Math.min(100,Math.round((x||0)/k*100)))}%`}})}):null,l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>Ce(!0),children:"Logs"})]})]}),l.jsx("section",{className:"dock-panel ui-card",children:l.jsx(QS,{busy:y,progressValue:x,progressMax:k,statusText:N,statusPhase:j,primaryLabel:"Render",onPrimary:m,primaryDisabled:!he,onLogs:()=>Ce(!0)})}),l.jsx(ik,{open:!!T,onClose:Z,title:T==null?void 0:T.label,description:T==null?void 0:T.description,render:Ie,index:(T==null?void 0:T.index)??0,total:(T==null?void 0:T.total)??0,onPrev:(T==null?void 0:T.onPrev)||null,onNext:(T==null?void 0:T.onNext)||null,onRender:(T==null?void 0:T.onRender)||null,children:null}),l.jsx(Zk,{open:le,onClose:()=>Ce(!1),logs:p,onClear:g})]})}function Lj(){return l.jsx("div",{className:"page-shell page-stack",children:l.jsxs("section",{className:"home-hero",children:[l.jsx("span",{className:"home-hero-orb is-warm","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-orb is-cool","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-spark","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-beam","aria-hidden":"true"}),l.jsx("span",{className:"home-hero-ring","aria-hidden":"true"}),l.jsxs("div",{className:"home-hero-inner home-hero-full",children:[l.jsx("div",{className:"home-hero-kicker",children:"CozyGen Studio"}),l.jsx("h1",{className:"home-hero-title",children:"Creative studio for prompt-first storytelling"}),l.jsx("p",{className:"home-hero-description",children:"CozyGen is a quiet, cinematic workspace for people who sketch with wordsshape the mood, stage the scene, then send it down the render runway without losing your flow."}),l.jsxs("div",{className:"home-info-grid",children:[l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Control as composition"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Dial the palette, tempo, and texture in one place. The controls read like a creative brief, not a checklist."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Alias & tag storyboards"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Save characters, atmospheres, and motifs as building blocks, then arrange them like panels in a storyboard."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Gallery inspiration"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Pin your strongest frames, compare variations, and carry the aesthetic through to your next scene."})]}),l.jsxs("article",{className:"ui-card",children:[l.jsx("h3",{className:"text-xs uppercase tracking-[0.12em] text-[rgba(159,178,215,0.8)]",children:"Render runway"}),l.jsx("p",{className:"mt-1 text-[0.78rem] leading-relaxed text-[rgba(204,217,255,0.75)]",children:"Stack iterations like takes on a set. Keep composing while the queue runs in the background."})]})]})]})]})})}const Aj=e=>l.jsxs("svg",{viewBox:"0 0 24 24",width:"14",height:"14","aria-hidden":"true",...e,children:[l.jsx("rect",{x:"3",y:"5",width:"10",height:"14",rx:"2.5",ry:"2.5",fill:"none",stroke:"currentColor",strokeWidth:"1.3"}),l.jsx("rect",{x:"7",y:"3",width:"10",height:"14",rx:"2.5",ry:"2.5",fill:"none",stroke:"currentColor",strokeWidth:"1.3",opacity:"0.8"}),l.jsx("circle",{cx:"12",cy:"11",r:"2.3",fill:"currentColor",opacity:"0.9"})]});function Pj({subfolder:e,crumbs:t=[],dirChips:n=[],onBack:r,onRoot:s,onCrumb:a,onSelectDir:i}){const c=!e;return l.jsxs("div",{className:"gallery-nav",children:[l.jsx("div",{className:"gallery-crumbs",role:"navigation","aria-label":"Gallery path",children:t.map((u,d)=>l.jsxs(o.Fragment,{children:[l.jsx("span",{className:"text-[#6A6FA8]",children:"/"}),l.jsx(K,{size:"xs",variant:"chip",onClick:()=>a==null?void 0:a(u.path),"aria-current":d===t.length-1?"page":void 0,children:u.name})]},u.path||u.name||d))}),l.jsxs("div",{className:"gallery-dir-chips",children:[l.jsxs(K,{size:"xs",variant:"chip",onClick:()=>s==null?void 0:s(),disabled:c,"aria-label":"Go to output root",title:"Output root",children:[l.jsx(Aj,{}),"Output"]}),n.map(u=>l.jsx(K,{size:"xs",variant:"chip",onClick:()=>i==null?void 0:i(u.subfolder),children:u.filename||u.subfolder||"Collection"},u.subfolder||u.filename))]})]})}const zj=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e),_j=({src:e,poster:t,autoPlay:n})=>{const r=o.useRef(null),s=ff();return o.useEffect(()=>{const a=r.current;a&&(a.pause(),a.currentTime=0,a.load())},[e]),o.useEffect(()=>{const a=r.current;if(!a)return;let i;const c=()=>{const d=a.play();d&&typeof d.catch=="function"&&d.catch(()=>{})},u=()=>{a.pause()};return n?s?typeof window<"u"&&"IntersectionObserver"in window?(i=new IntersectionObserver(h=>{h.forEach(v=>{v.isIntersecting?c():u()})},{threshold:.65}),i.observe(a)):c():u():(u(),a.currentTime=0),()=>{i&&i.disconnect(),u()}},[n,e,s]),e?l.jsx("video",{ref:r,src:e,poster:t||void 0,muted:!0,playsInline:!0,loop:!0,preload:n?"metadata":"none",className:"w-full h-auto max-h-[80vh] rounded-2xl object-contain bg-black/40"}):l.jsx("div",{className:"flex items-center justify-center py-16 text-[11px] text-[#9DA3FFCC]",children:"No preview available"})},Om={contentVisibility:"auto",containIntrinsicSize:"260px 320px"};function Tj({item:e,onSelect:t,onDelete:n,onRerun:r,onQuickRerun:s,isDeleting:a=!1,isQuickRunning:i=!1,variant:c="grid",autoPlay:u=!1}){if(!e)return null;const d=e.type==="directory",h=e.filename||"",v=e.subfolder||"",y=h||v||"Unknown",x=e.mtime??e.modified??e.updated_at??e.created_at,k=x?`&v=${encodeURIComponent(String(x))}`:"",N=()=>{t&&t(e)},j=c==="feed"?768:384,m=!d&&h?`/cozygen/thumb?type=output&subfolder=${encodeURIComponent(v)}&filename=${encodeURIComponent(h)}${k}&w=`:null,p=m?`${m}${j}`:null,g=m?c==="feed"?`${m}384 384w, ${m}768 768w`:`${m}192 192w, ${m}384 384w`:null,w=c==="feed"?"(max-width: 768px) 92vw, 768px":"(max-width: 640px) 45vw, (max-width: 1024px) 30vw, 240px",b=!d&&h?(()=>{const me=e.type&&e.type!=="directory"?e.type:"output",oe=e.mtime?`&v=${encodeURIComponent(String(e.mtime))}`:"";return`/view?filename=${encodeURIComponent(h)}&subfolder=${encodeURIComponent(v)}&type=${encodeURIComponent(me)}${oe}`})():null,E=zj(h),A=!!n&&!d,I=(e==null?void 0:e.meta)||{},B=!!(I!=null&&I.has_prompt||I!=null&&I.prompt||I!=null&&I.model||Array.isArray(I==null?void 0:I.loras)&&I.loras.length),T=typeof h=="string"&&h.toLowerCase().endsWith(".png"),$=!!r&&!d&&B&&T,ee=!!s&&!d&&B&&T,Z=me=>{me.stopPropagation(),n==null||n(e)},le=me=>{me.stopPropagation(),r==null||r(e)},Ce=me=>{me.stopPropagation(),s==null||s(e)};if(d)return l.jsx("button",{type:"button",onClick:N,className:"gallery-dir-tile",style:Om,children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"h-7 w-7 rounded-lg bg-gradient-to-br from-[#6B5BFF] to-[#FF4F9A] opacity-80 group-hover:opacity-100 flex items-center justify-center text-[11px] text-white",children:""}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("div",{className:"text-[11px] font-medium text-[#E5E7FF] truncate",children:y}),l.jsx("div",{className:"text-[10px] text-[#9DA3FFCC] truncate",children:"Collection"})]})]})});if(c==="feed"){const me={contentVisibility:"auto",containIntrinsicSize:"520px 720px"};return l.jsxs("div",{className:"gallery-feed-item",style:me,children:[l.jsxs("button",{type:"button",onClick:N,className:"gallery-feed-media",children:[l.jsx("div",{className:"relative w-full flex items-center justify-center bg-[#020312]",children:E?l.jsx(_j,{src:b,poster:p,autoPlay:u}):p?l.jsx("img",{src:p,srcSet:g||void 0,sizes:w,alt:y,className:"w-full h-auto max-h-[80vh] rounded-2xl object-contain bg-black/40",loading:"lazy",decoding:"async"}):l.jsx("div",{className:"flex items-center justify-center py-16 text-[11px] text-[#9DA3FFCC]",children:"No preview available"})}),l.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[#05071680] opacity-0 group-hover:opacity-100 transition-opacity"}),E&&l.jsx("div",{className:"pointer-events-none absolute left-2 top-2 rounded-md bg-[#050716CC] px-2 py-[1px] text-[10px] text-[#CFFAFE] border border-[#3EF0FF80]",children:"Video"})]}),A?l.jsx(K,{size:"mini",variant:"muted",iconOnly:!0,className:"gallery-tile-delete",onClick:Z,disabled:a,"aria-label":"Delete item",title:a?"Deleting":"Delete item",children:l.jsx(Xu,{size:12})}):null,ee?l.jsx(K,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-quickrun",onClick:Ce,disabled:i,"aria-label":"Quick re-run",title:"Re-run with random seed",children:l.jsx(Ju,{size:12})}):null,$?l.jsx(K,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-rerun",onClick:le,"aria-label":"Tweak",title:"Tweak",children:l.jsx(hm,{size:12})}):null]})}return l.jsxs("div",{className:"gallery-tile",style:Om,children:[l.jsx("button",{type:"button",onClick:N,className:"gallery-tile-button",children:l.jsxs("div",{className:"gallery-tile-media",children:[p?l.jsx("img",{src:p,srcSet:g||void 0,sizes:w,alt:y,className:"gallery-tile-img",loading:"lazy",decoding:"async"}):l.jsx("div",{className:"gallery-tile-empty",children:"No preview"}),E&&l.jsx("div",{className:"gallery-badge",children:"Video"})]})}),A?l.jsx(K,{size:"mini",variant:"muted",iconOnly:!0,className:"gallery-tile-delete",onClick:Z,disabled:a,"aria-label":"Delete item",title:a?"Deleting":"Delete item",children:l.jsx(Xu,{size:12})}):null,ee?l.jsx(K,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-quickrun",onClick:Ce,disabled:i,"aria-label":"Quick re-run",title:"Re-run with random seed",children:l.jsx(Ju,{size:12})}):null,$?l.jsx(K,{size:"mini",variant:"ghost",iconOnly:!0,className:"gallery-tile-rerun",onClick:le,"aria-label":"Tweak",title:"Tweak",children:l.jsx(hm,{size:12})}):null]})}const Dm=o.memo(Tj),Qc=30,Rj=20;function Bm(e,t,n){const r=Number(e);return Number.isFinite(r)?Math.max(t,Math.min(n,r)):t}function ad({open:e,onClose:t,mode:n="edit",tokenType:r="alias",tokenLabel:s="",tokenDisplay:a="",weight:i=1,onWeightChange:c,deferWeightApply:u=!1,onDelete:d,onAdd:h,aliases:v=[],aliasCategories:y=[],aliasLoading:x=!1,tags:k=[],tagLoading:N=!1,tagHasMore:j=!1,onLoadTags:m,onLoadMoreTags:p,replacementSearch:g="",onReplacementSearchChange:w,onReplace:b,activeCategory:E="All",onCategoryChange:A}){const I=n==="add",B=o.useMemo(()=>Bm(i||1,.2,2),[i]),[T,$]=o.useState(B),[ee,Z]=o.useState(!1),[le,Ce]=o.useState(r),[me,oe]=o.useState(Qc),[R,P]=o.useState("All"),M=o.useRef(null);o.useEffect(()=>{e&&($(B),Z(I),Ce(r),oe(Qc))},[e,B,r,I]),o.useEffect(()=>{oe(Qc)},[g,E,le]),o.useEffect(()=>{P("All")},[le,E]);const L=re=>{if(!re)return"other";const _e=fl(re.name||re.token||"",re.category||"");return String(re.subcategory||_e||"").trim()||"other"},W=re=>re&&String(re.category||"").trim()||"other",q=o.useMemo(()=>{if(le!=="alias")return[{value:"All",label:"All subcategories"}];const re=new Set(["All"]);return v.forEach(Y=>{E!=="All"&&(Y!=null&&Y.category)&&Y.category!==E||re.add(L(Y))}),Array.from(re).sort((Y,Ie)=>Y.localeCompare(Ie)).map(Y=>({value:Y,label:Y==="other"?"Other":gn(Y)||Y}))},[v,E,le]),de=o.useMemo(()=>{if(le!=="tag")return[{value:"All",label:"All categories"}];const re=new Set(["All"]);return k.forEach(Y=>{re.add(W(Y))}),Array.from(re).sort((Y,Ie)=>Y.localeCompare(Ie)).map(Y=>({value:Y,label:Y==="other"?"Other":gn(Y)||Y}))},[k,le]),fe=le==="alias"?q:de;o.useEffect(()=>{fe.some(re=>re.value===R)||P("All")},[fe,R]),o.useEffect(()=>{e&&(ee||I)&&le==="tag"&&(m==null||m())},[e,ee,le,m,I]);const ne=o.useCallback(re=>{const _e=re.target;!_e||!(_e.scrollHeight-_e.scrollTop-_e.clientHeight<100)||(oe(Ie=>Ie+Rj),le==="tag"&&j&&!N&&(p==null||p()))},[le,j,N,p]),xe=o.useCallback(re=>{const _e=Bm(re,.2,2);$(_e),u||c==null||c(_e)},[u,c]),G=o.useCallback(re=>{xe(parseFloat(re.target.value))},[xe]),O=o.useMemo(()=>{const re=String(g||"").trim().toLowerCase();return le==="alias"?v.filter(_e=>{if(E!=="All"&&(_e.category||"")!==E||R!=="All"&&L(_e)!==R)return!1;if(!re)return!0;const Y=String(_e.displayName||_e.name||"").toLowerCase(),Ie=String(_e.token||"").toLowerCase();return Y.includes(re)||Ie.includes(re)}):k.filter(_e=>R!=="All"&&W(_e)!==R?!1:re?String(_e.tag||"").toLowerCase().includes(re):!0)},[le,g,E,v,k,R]),H=o.useMemo(()=>{if(!O.length)return O;const re=[...O];return re.sort((_e,Y)=>{const Ie=ye=>String(ye.displayName||ye.name||ye.tag||ye.token||"").trim().toLowerCase();if(le==="alias"){const ye=L(_e),Ae=L(Y);if(ye!==Ae)return ye.localeCompare(Ae);const Q=Ie(_e),Ke=Ie(Y);return Q!==Ke?Q.localeCompare(Ke):0}const te=W(_e),Ne=W(Y);if(te!==Ne)return te.localeCompare(Ne);const ge=Ie(_e),ve=Ie(Y);return ge.localeCompare(ve)}),re},[O,le]),we=le==="alias"?x:N,he=H.length===0&&!we,Me=le==="alias"?Xt:gn,Re=ln(T),Fe=r==="alias",Oe=I?"Add to Prompt":Fe?"Edit Alias":"Edit Tag",Ze=re=>{Ce(re),A==null||A("All"),w==null||w(""),re==="tag"&&(m==null||m())};return l.jsx(Wt,{open:e,onClose:t,title:Oe,children:l.jsxs("div",{className:"token-edit-sheet",children:[!I&&l.jsxs("div",{className:"token-edit-identity",children:[l.jsx("span",{className:"token-edit-type-badge","data-type":r,children:Fe?"$":"#"}),l.jsxs("div",{className:"token-edit-name",children:[l.jsx("span",{className:"token-edit-display",children:a||s}),Fe&&s&&s!==a&&l.jsxs("span",{className:"token-edit-token",children:["$",s,"$"]})]})]}),!I&&l.jsxs("div",{className:"token-edit-section",children:[l.jsxs("div",{className:"token-edit-strength-row",children:[l.jsx("span",{className:"token-edit-section-label",children:"Strength"}),l.jsxs("div",{className:"token-edit-strength-controls",children:[l.jsx("button",{type:"button",className:"token-edit-strength-btn",onClick:()=>xe(T-.05),disabled:T<=.2,"aria-label":"Decrease strength",children:""}),l.jsxs("span",{className:"token-edit-strength-value",children:[Re,""]}),l.jsx("button",{type:"button",className:"token-edit-strength-btn",onClick:()=>xe(T+.05),disabled:T>=2,"aria-label":"Increase strength",children:"+"})]})]}),l.jsx("input",{type:"range",min:.2,max:2,step:.05,value:T,onChange:G,className:"ui-range token-edit-slider","aria-label":"Token strength"}),l.jsxs("div",{className:"token-edit-strength-hint",children:[T<.8?"Softened":T>1.2?"Emphasized":"Normal"," influence"]})]}),l.jsxs("div",{className:"token-edit-section",children:[!I&&l.jsxs("button",{type:"button",className:`token-edit-replace-toggle ${ee?"is-active":""}`,onClick:()=>Z(!ee),children:[l.jsx("span",{className:"token-edit-section-label",children:"Replace with"}),l.jsx("span",{className:"token-edit-toggle-icon",children:ee?"":"+"})]}),(ee||I)&&l.jsxs("div",{className:"token-edit-replace-panel",children:[l.jsxs("div",{className:"token-edit-type-toggle",children:[l.jsxs("button",{type:"button",className:`token-edit-type-btn ${le==="alias"?"is-active":""}`,onClick:()=>Ze("alias"),children:[l.jsx("span",{className:"token-edit-type-icon",children:"$"}),"Aliases"]}),l.jsxs("button",{type:"button",className:`token-edit-type-btn ${le==="tag"?"is-active":""}`,onClick:()=>Ze("tag"),children:[l.jsx("span",{className:"token-edit-type-icon",children:"#"}),"Tags"]})]}),l.jsx("div",{className:"token-edit-filter-row",children:l.jsx("input",{type:"search",value:g,onChange:re=>w==null?void 0:w(re.target.value),placeholder:le==="alias"?"Search aliases":"Search tags",className:"ui-control ui-input token-edit-search"})}),l.jsxs("div",{className:"token-edit-filter-row",children:[le==="alias"&&y.length>1&&l.jsx("select",{value:E,onChange:re=>A==null?void 0:A(re.target.value),className:"ui-control ui-select token-edit-category-select","aria-label":"Filter by category",children:y.map(re=>l.jsx("option",{value:re,children:re==="All"?"All Categories":Xt(re)},re))}),fe.length>1&&l.jsx(ct,{value:R,onChange:P,size:"sm","aria-label":le==="alias"?"Filter by subcategory":"Filter by category",options:fe,wrapperClassName:"token-edit-sort-select"})]}),l.jsx("div",{ref:M,className:"token-edit-replace-list",onScroll:ne,children:we&&H.length===0?l.jsx("div",{className:"token-edit-replace-empty",children:"Loading"}):he?l.jsx("div",{className:"token-edit-replace-empty",children:g?"No matches found":`No ${le==="alias"?"aliases":"tags"} available`}):l.jsxs(l.Fragment,{children:[H.slice(0,me).map(re=>{const _e=re.key||re.token||re.tag||re.displayName,Y=re.displayName||re.name||re.tag||re.token,Ie=!!re.token;return l.jsxs("button",{type:"button",className:"token-edit-replace-item",onClick:()=>{const te={...re,type:Ie?"alias":"tag"};I?h==null||h(te):b==null||b(te),t==null||t()},children:[l.jsx("span",{className:"token-edit-replace-type-icon","data-type":Ie?"alias":"tag",children:Ie?"$":"#"}),l.jsx("span",{className:"token-edit-replace-name",children:Y}),re.category&&l.jsx("span",{className:"token-edit-replace-category",children:Me(re.category)})]},_e)}),me<H.length&&l.jsxs("div",{className:"token-edit-replace-more",children:[H.length-me," more available"]}),le==="tag"&&j&&me>=H.length&&l.jsx("div",{className:"token-edit-replace-more",children:N?"Loading more":"Scroll for more"})]})})]})]}),l.jsxs("div",{className:"token-edit-actions",children:[l.jsx("button",{type:"button",className:"token-edit-apply",onClick:()=>{!I&&u&&(c==null||c(T)),t==null||t()},children:I?"Done":"Apply"}),!I&&l.jsx("button",{type:"button",className:"token-edit-delete",onClick:()=>{d==null||d(),t==null||t()},children:"Remove from prompt"})]})]})})}const iv=o.memo(function({id:t,name:n,category:r,text:s,isSelected:a,onOpen:i,visibilityStyle:c}){const u=o.useCallback(()=>{i(t)},[t,i]),d=pl({name:n})||n||"Untitled",h=r?`${r}:${n}`:n,v=`${(s||"").slice(0,140)}${(s||"").length>140?"":""}`;return l.jsxs("button",{type:"button",role:"listitem",className:`composer-alias-item ${a?"is-selected":""}`,onClick:u,style:c,"data-virtual-row":"true",children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:d}),r?l.jsx("span",{className:"composer-alias-category",children:Xt(r)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",h||"alias","$"]}),l.jsx("div",{className:"composer-alias-text",children:v||""})]})}),ov=o.memo(function({tag:t,category:n,count:r,isCollected:s,onToggle:a,visibilityStyle:i}){const c=o.useCallback(u=>{u.stopPropagation(),a(t)},[a,t]);return l.jsxs("button",{type:"button",className:`composer-alias-item composer-tag-item ${s?"is-collected":""}`,onClick:c,style:i,"data-virtual-row":"true",children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name composer-tag-name",children:l.jsx("code",{className:"composer-tag-code",children:t})}),n?l.jsx("span",{className:"composer-alias-category",children:gn(n)}):null]}),l.jsx("div",{className:"composer-alias-token composer-tag-count",children:Number(r||0).toLocaleString()})]})});function Ij({filename:e,locationLabel:t,isClip:n,url:r,canRerun:s,rerunOpen:a,canQuickRerun:i,quickRerunBusy:c,canDelete:u,deleteBusy:d,metaRows:h,metaOpen:v,onToggleMeta:y,onToggleRerun:x,onQuickRerun:k,onDelete:N,onClose:j,closeButtonRef:m}){return l.jsxs("header",{className:"media-viewer-head",children:[l.jsxs("div",{className:"media-viewer-head-bar bottom-sheet-head",children:[l.jsxs("div",{className:"media-viewer-meta",children:[l.jsx("div",{className:"media-viewer-title",title:e,children:e}),l.jsxs("div",{className:"media-viewer-sub",children:[l.jsx("span",{className:"media-chip",children:t}),l.jsx("span",{className:`media-chip ${n?"is-clip":"is-still"}`,children:n?"Video":"Image"})]})]}),l.jsx("button",{ref:m,type:"button",className:"bottom-sheet-close media-viewer-close",onClick:j,"aria-label":"Close",children:l.jsx(os,{size:16})})]}),l.jsxs("div",{className:"media-viewer-actions",children:[l.jsx(K,{as:"a",href:r,target:"_blank",rel:"noreferrer",variant:"ghost",size:"sm",children:"Open"}),h.length?l.jsx(K,{variant:"ghost",size:"sm",onClick:y,"aria-expanded":v,children:"Meta"}):null,s?l.jsx(K,{variant:"ghost",size:"sm",onClick:x,"aria-expanded":a,"aria-label":"Tweak generation",children:"Tweak"}):null,i?l.jsx(K,{variant:"ghost",size:"sm",iconOnly:!0,className:"media-viewer-action-icon media-viewer-action-quickrun",onClick:k,disabled:c,"aria-label":"Re-run with random seed",title:"Re-run with random seed",children:c?l.jsx("span",{className:"loading-spinner","aria-hidden":"true"}):l.jsx(Ju,{size:16})}):null,u?l.jsx(K,{variant:"ghost",size:"sm",iconOnly:!0,className:"media-viewer-action-icon media-viewer-action-delete",onClick:N,disabled:d,"aria-label":"Delete item",title:"Delete item",children:d?l.jsx("span",{className:"loading-spinner","aria-hidden":"true"}):l.jsx(Xu,{size:16})}):null]})]})}function $j({metaRows:e=[]}){return e.length?l.jsx("div",{className:"media-viewer-info","aria-label":"Generation metadata",children:e.map(t=>l.jsxs("div",{className:"media-info-row",children:[l.jsx("span",{className:"media-info-label",children:t.label}),l.jsx("span",{className:`media-info-value ${t.isPrompt?"is-prompt":""}`,children:t.value})]},t.label))}):null}function Mj({showNav:e,canPrev:t,canNext:n,onPrev:r,onNext:s,isClip:a,url:i,filename:c}){return l.jsxs("div",{className:"media-viewer-stage",children:[e?l.jsx("button",{type:"button",className:`media-stage-nav is-left ${t?"":"is-disabled"}`,onClick:r,"aria-label":"Previous",disabled:!t,children:l.jsx(Ay,{size:18})}):null,l.jsx("div",{className:"media-viewer-frame",children:a?l.jsx("video",{src:i,controls:!0,className:"media-viewer-media",autoPlay:!0,muted:!0,playsInline:!0}):l.jsx("img",{src:i,alt:c,className:"media-viewer-media",decoding:"async"})}),e?l.jsx("button",{type:"button",className:`media-stage-nav is-right ${n?"":"is-disabled"}`,onClick:s,"aria-label":"Next",disabled:!n,children:l.jsx(nc,{size:18})}):null]})}const Fj=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e),Um={contentVisibility:"auto",containIntrinsicSize:"240px 120px"},Oj=e=>{if(!e)return"";const t=e.filename||"",n=e.subfolder||"",r=e.type||"output",s=e.mtime?`&v=${encodeURIComponent(String(e.mtime))}`:"";return`/view?filename=${encodeURIComponent(t)}&subfolder=${encodeURIComponent(n)}&type=${encodeURIComponent(r)}${s}`},Vm=e=>{if(!Pl(e))return null;const{folderPath:t,base:n}=lc(e);return{folderPath:t||"root",base:n||""}},Wm=(e="")=>{if(!e||e==="root")return"root";const t=e.split("/").filter(Boolean);return t[t.length-1]||e};function Dj({isOpen:e,media:t,onClose:n,onPrev:r,onNext:s,onDeleted:a,total:i=0,canPrev:c=!1,canNext:u=!1,autoOpenRerunKey:d="",onRerunAutoOpen:h}){var Qf,qf,Xf;const{aliasCatalog:v=[],aliasLookup:y,aliasLoading:x,aliasError:k}=yf(),N=o.useRef(!1),j=o.useRef(null),[m,p]=o.useState(!1),[g,w]=o.useState(!1),[b,E]=o.useState(!1),[A,I]=o.useState(!1),[B,T]=o.useState(!1),$=o.useRef(null),ee=o.useRef(null),Z=o.useRef(!1),le=o.useRef(null),[Ce,me]=o.useState(!1),[oe,R]=o.useState(null),[P,M]=o.useState(!1),[L,W]=o.useState(null),q=o.useRef("rerun"),[de,fe]=o.useState("random"),[ne,xe]=o.useState(""),[G,O]=o.useState(""),[H,we]=o.useState(""),[he,Me]=o.useState(""),[Re,Fe]=o.useState(""),[Oe,Ze]=o.useState("All"),[re,_e]=o.useState("All"),[Y,Ie]=o.useState(""),[te,Ne]=o.useState(""),[ge,ve]=o.useState({hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null}),[ye,Ae]=o.useState([]),[Q,Ke]=o.useState(null),[et,Xe]=o.useState({}),[ut,D]=o.useState(""),[X,ke]=o.useState(""),[ze,$e]=o.useState("elements"),[Ge,rt]=o.useState("alias"),[qe,U]=o.useState(""),ce=o.useDeferredValue(qe),[je,Pe]=o.useState("All"),[z,V]=o.useState("All"),[ae,ie]=o.useState(30),[Se,Te]=o.useState(""),[lt,nt]=o.useState(""),At=o.useDeferredValue(lt),[Kt,bt]=o.useState(""),[ot,ps]=o.useState("count"),[Zt,Fl]=o.useState(""),[Mr,Us]=o.useState([]),[en,Gn]=o.useState([]),[Gt,mr]=o.useState(0),[yt,Rn]=o.useState(0),[In,Yn]=o.useState(!1),[vn,Fr]=o.useState(!1),[ms,hr]=o.useState(""),[Vs,hs]=o.useState(""),tn=o.useRef(null),Mt=o.useRef(null),[bn,Qn]=o.useState(!1),[st,Pt]=o.useState(null),[qn,gr]=o.useState(!1),[gs,ys]=o.useState(""),vs=o.useDeferredValue(gs),[Ka,Ws]=o.useState("All"),[vt,yr]=o.useState(null),[xn,jt]=o.useState(null),vr=o.useRef(null),ht=o.useRef(null),[xr,Hs]=o.useState(!1),[$n,Or]=o.useState(""),[Ga,Ol]=o.useState(!1),[xs,Ks]=o.useState(""),[ws,Ss]=o.useState([]),[Gs,Ya]=o.useState([]),Dr=o.useRef(null),Xn=o.useRef(null),Dl=o.useRef(""),Qa=f=>f?Array.from(f.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(S=>!S.hasAttribute("disabled")&&S.getAttribute("aria-hidden")!=="true"):[];o.useEffect(()=>{if(!e)return;const f=S=>{S.key==="Escape"&&(n==null||n()),S.key==="ArrowLeft"&&c&&(r==null||r()),S.key==="ArrowRight"&&u&&(s==null||s())};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[e,n,s,r,c,u]),o.useEffect(()=>{var f;e&&(p(!1),me(!1),R(null),M(!1),W(null),q.current="rerun",E(!1),I(!1),fe("random"),xe(""),O(""),we(""),Me(""),Fe(""),Ze("All"),_e("All"),ve({hasSeed:!1,hasCheckpoint:!1,hasLora:!1,checkpoint:"",loras:[],hasSize:!1,width:null,height:null}),Ae([]),Ke(null),Xe({}),D(""),ke(""),$e("elements"),rt("alias"),U(""),Pe("All"),V("All"),ie(30),Te(""),nt(""),bt(""),ps("count"),Fl(""),Us([]),Gn([]),mr(0),Rn(0),Yn(!1),Fr(!1),hr(""),hs(""),Qn(!1),Pt(null),gr(!1),Hs(!1),Or(""),Ol(!1),Ks(""),Ss([]),Ya([]),Dr.current=null,Xn.current&&(Xn.current.abort(),Xn.current=null),(f=ht.current)!=null&&f.timer&&(clearTimeout(ht.current.timer),ht.current=null),tn.current&&(tn.current.abort(),tn.current=null),Mt.current&&(Mt.current.abort(),Mt.current=null),Z.current=!0,le.current&&clearTimeout(le.current),le.current=setTimeout(()=>{Z.current=!1,le.current=null},250))},[e,t]),o.useEffect(()=>()=>{var f;le.current&&(clearTimeout(le.current),le.current=null),(f=ht.current)!=null&&f.timer&&(clearTimeout(ht.current.timer),ht.current=null),tn.current&&(tn.current.abort(),tn.current=null),Mt.current&&(Mt.current.abort(),Mt.current=null)},[]),o.useEffect(()=>{if(!e||typeof document>"u")return;const f=$.current;ee.current=document.activeElement;const S=()=>{var Be;const J=Qa(f),ue=j.current||J[0]||f;(Be=ue==null?void 0:ue.focus)==null||Be.call(ue)},F=J=>{if(J.key!=="Tab"||!f)return;const ue=Qa(f);if(!ue.length){J.preventDefault(),f.focus();return}const Be=ue[0],Je=ue[ue.length-1],Ue=document.activeElement;J.shiftKey&&Ue===Be?(J.preventDefault(),Je.focus()):!J.shiftKey&&Ue===Je&&(J.preventDefault(),Be.focus())};return requestAnimationFrame(S),f==null||f.addEventListener("keydown",F),()=>{var ue;f==null||f.removeEventListener("keydown",F);const J=ee.current;J&&document.contains(J)&&((ue=J.focus)==null||ue.call(J))}},[e]);const qa=!!t,Xa=t?Oj(t):"",oc=(t==null?void 0:t.subfolder)||"Gallery",Bl=Fj((t==null?void 0:t.filename)||""),Ja=i>1,Ft=(t==null?void 0:t.meta)||{},Ul=[Ft!=null&&Ft.model?{label:"Model",value:Ft.model}:null,Ft!=null&&Ft.prompt?{label:"Prompt",value:Ft.prompt,isPrompt:!0}:null,Array.isArray(Ft==null?void 0:Ft.loras)&&Ft.loras.length?{label:"LoRAs",value:Ft.loras.join(", ")}:null].filter(Boolean),cc=!!((Qf=t==null?void 0:t.meta)!=null&&Qf.has_prompt||Ul.length),uc=typeof(t==null?void 0:t.filename)=="string"&&t.filename.toLowerCase().endsWith(".png"),Mn=qa&&cc&&uc,dc=qa,Za=o.useMemo(()=>[{key:"random",label:"Random"},{key:"keep",label:"Keep"},{key:"custom",label:"Custom"}],[]),Vl=o.useMemo(()=>{if(de!=="custom")return null;const f=parseInt(String(ne),10);return Number.isFinite(f)?f:null},[ne,de]),C=de!=="custom"||Vl!==null,_=o.useMemo(()=>{if(!String(G||"").trim())return null;const f=parseInt(String(G),10);return Number.isFinite(f)&&f>0?f:null},[G]),pe=o.useMemo(()=>{if(!String(H||"").trim())return null;const f=parseInt(String(H),10);return Number.isFinite(f)&&f>0?f:null},[H]),Le=(!String(G||"").trim()||_!==null)&&(!String(H||"").trim()||pe!==null),Ve=!!String(G||"").trim()&&_===null,De=!!String(H||"").trim()&&pe===null,We=ge.checkpoint||(Ft==null?void 0:Ft.model)||"",Ee=Array.isArray(ge.loras)?ge.loras:[],Ye=We?rr(We):"",Jn=Ee.length?Ee.map(f=>rr(f)).join(", "):"",nn=o.useMemo(()=>(ws||[]).map(f=>{const S=String(f||"");return{value:S,meta:Vm(S)}}),[ws]),wr=o.useMemo(()=>(Gs||[]).map(f=>{const S=String(f||"");return{value:S,meta:Vm(S)}}),[Gs]),ks=o.useMemo(()=>{const f=new Set(["All"]);return nn.forEach(({meta:S})=>{S!=null&&S.folderPath&&f.add(S.folderPath)}),Array.from(f).sort((S,F)=>S.localeCompare(F))},[nn]),js=o.useMemo(()=>{const f=new Set(["All"]);return wr.forEach(({meta:S})=>{S!=null&&S.folderPath&&f.add(S.folderPath)}),Array.from(f).sort((S,F)=>S.localeCompare(F))},[wr]),Et=ks.length>2,Rt=js.length>2;o.useEffect(()=>{if(!Et){Oe!=="All"&&Ze("All");return}ks.includes(Oe)||Ze("All")},[Oe,ks,Et]),o.useEffect(()=>{if(!Rt){re!=="All"&&_e("All");return}js.includes(re)||_e("All")},[re,js,Rt]);const xf=o.useMemo(()=>{const f=new Map;return nn.forEach(({meta:S})=>{if(!(S!=null&&S.base))return;const F=S.base.toLowerCase();f.set(F,(f.get(F)||0)+1)}),f},[nn]),wf=o.useMemo(()=>{const f=new Map;return wr.forEach(({meta:S})=>{if(!(S!=null&&S.base))return;const F=S.base.toLowerCase();f.set(F,(f.get(F)||0)+1)}),f},[wr]),ei=o.useMemo(()=>{const f=[],S=Et&&Oe==="All";return nn.forEach(({value:F,meta:J})=>{if(!J){f.push({value:F,label:F});return}if(Et&&Oe!=="All"&&J.folderPath!==Oe)return;let ue=J.base||rr(F)||F;if(S&&J.base){const Be=J.base.toLowerCase();xf.get(Be)>1&&(ue=`${ue} (${Wm(J.folderPath)})`)}f.push({value:F,label:ue})}),f},[nn,Oe,xf,Et]),ti=o.useMemo(()=>{const f=[],S=Rt&&re==="All";return wr.forEach(({value:F,meta:J})=>{if(!J){f.push({value:F,label:F});return}if(Rt&&re!=="All"&&J.folderPath!==re)return;let ue=J.base||rr(F)||F;if(S&&J.base){const Be=J.base.toLowerCase();wf.get(Be)>1&&(ue=`${ue} (${Wm(J.folderPath)})`)}f.push({value:F,label:ue})}),f},[wr,re,wf,Rt]),Sf=o.useMemo(()=>he?ei.some(f=>String(f.value)===String(he)):!0,[ei,he]),kf=o.useMemo(()=>Re?ti.some(f=>String(f.value)===String(Re)):!0,[ti,Re]),jf=o.useMemo(()=>{let f=ei;if(he&&!Sf&&(f=[{value:he,label:rr(String(he))},...f]),Y.trim()){const S=Y.toLowerCase().trim();f=f.filter(F=>String(F.label).toLowerCase().includes(S)||String(F.value).toLowerCase().includes(S))}return f},[he,Sf,ei,Y]),Nf=o.useMemo(()=>{let f=ti;if(Re&&!kf&&(f=[{value:Re,label:rr(String(Re))},...f]),te.trim()){const S=te.toLowerCase().trim();f=f.filter(F=>String(F.label).toLowerCase().includes(S)||String(F.value).toLowerCase().includes(S))}return f},[Re,kf,ti,te]),Cf=o.useCallback(async f=>{const S=f==null?void 0:f.hasCheckpoint,F=f==null?void 0:f.hasLora;if(!S&&!F)return;Xn.current&&Xn.current.abort();const J=new AbortController;Xn.current=J,Ol(!0),Ks("");try{const[ue,Be]=await Promise.all([S&&!ws.length?qu("checkpoints",{signal:J.signal}):null,F&&!Gs.length?qu("loras",{signal:J.signal}):null]);ue!=null&&ue.choices&&Ss(ue.choices),Be!=null&&Be.choices&&Ya(Be.choices)}catch(ue){if((ue==null?void 0:ue.name)==="AbortError")return;Ks("Unable to load model choices right now.")}finally{Xn.current===J&&(Xn.current=null),Ol(!1)}},[ws.length,Gs.length]),fc=o.useRef(ye),ni=o.useRef(Q),pc=o.useRef(et);o.useEffect(()=>{fc.current=ye},[ye]),o.useEffect(()=>{ni.current=Q},[Q]),o.useEffect(()=>{pc.current=et},[et]);const ri=o.useCallback(async()=>{var f;if(!t)throw new Error("media_missing");if(Dr.current)return{prompt:Dr.current,info:ge,targets:fc.current,rawMap:ni.current};Hs(!0),Or("");try{const S=await SS({filename:t.filename,subfolder:t.subfolder||""}),F=S==null?void 0:S.prompt;if(!F)throw new Error("prompt_missing");const J=jj(F),ue=tv(F),Be=S==null?void 0:S.cozygen_prompt_raw,Je=Be&&typeof Be=="object"?Be:null;if(Ae(ue),Ke(Je),ue.length){const Ue={};ue.forEach(He=>{const zt=Je&&typeof Je[He.key]=="string"?Je[He.key]:He.text;Ue[He.key]=zt}),Xe(Ue),D(He=>He&&Ue[He]?He:ue[0].key)}else Xe({}),D("");return Dr.current=F,ve(J),{prompt:F,info:J,targets:ue,rawMap:Je}}catch(S){const F=((f=S==null?void 0:S.payload)==null?void 0:f.error)||(S==null?void 0:S.message)||"Unable to load prompt metadata.";throw Or(F),S}finally{Hs(!1)}},[t==null?void 0:t.filename,t==null?void 0:t.subfolder,ge]),si=o.useCallback(async()=>{if(Mn){M(!1),me(!0),p(!1),W(null),R(null),E(!1),Ze("All"),_e("All");try{const f=await ri(),S=f==null?void 0:f.info;O(F=>String(F||"").trim()?F:(S==null?void 0:S.width)!==null&&(S==null?void 0:S.width)!==void 0?String(S.width):""),we(F=>String(F||"").trim()?F:(S==null?void 0:S.height)!==null&&(S==null?void 0:S.height)!==void 0?String(S.height):""),await Cf(f==null?void 0:f.info)}catch{}}},[Mn,Cf,ri]),bf=o.useCallback(()=>{if(Mn){if(Ce){me(!1),R(null);return}si()}},[Mn,si,Ce]),dv=o.useCallback(()=>{me(!1),R(null),p(f=>!f)},[]),Ef=o.useCallback(f=>{f&&R(f)},[]),Ys=o.useCallback(()=>{R(null)},[]);o.useEffect(()=>{if(!e){Dl.current="";return}if(!d||!(t!=null&&t.filename))return;const f=`${t.subfolder||""}|${t.filename}`;f===d&&Dl.current!==f&&(Dl.current=f,si(),h==null||h())},[d,e,t==null?void 0:t.filename,t==null?void 0:t.subfolder,h,si]),o.useCallback(()=>{W(null),q.current="rerun",me(!1),R(null),M(!0)},[]);const fv=o.useCallback(()=>{ys(""),Ws("All"),gr(!0)},[]);o.useCallback((f,S)=>{f&&(q.current=P?"editor":"rerun",$e(f.type==="alias"?"aliases":"tags"),W({element:f,displayName:S||f.text||""}),me(!1),R(null),M(!0))},[P]);const pv=o.useCallback(()=>{M(!1),W(null),$e("elements"),q.current="rerun"},[]),mv=o.useCallback(()=>{M(!1),W(null),$e("elements"),p(!1),me(!0),R(null),q.current="rerun"},[]),Lf=Ce||P,li=Ge==="raw"&&(y==null?void 0:y.size),Af=o.useMemo(()=>!Lf||!ye.length?[]:ye.map(f=>{const S=et==null?void 0:et[f.key],F=typeof S=="string"?S:f.text||"",J=li?ml(F,y):F,ue=My(J||"");return{...f,text:J,rawText:F,elements:ue}}),[ye,et,Lf,li,y]),Fn=o.useMemo(()=>Af.filter(f=>String(f.text||"").trim().length>0),[Af]);o.useEffect(()=>{if(!Fn.length){D("");return}Fn.some(S=>S.key===ut)||D(Fn[0].key)},[Fn,ut]);const at=o.useMemo(()=>Fn.length?Fn.find(S=>S.key===ut)||Fn[0]:null,[Fn,ut]),ai=(at==null?void 0:at.text)||"",Wl=o.useMemo(()=>(Fn||[]).map(f=>({value:f.key,label:f.label})),[Fn]),un=(at==null?void 0:at.elements)||[],Pf=o.useMemo(()=>un.some(f=>(f==null?void 0:f.type)==="alias"),[un]),zf=o.useMemo(()=>{if(Pf)return!0;const f=at==null?void 0:at.key;if(!f||!Q)return!1;const S=Q[f];return typeof S=="string"&&S.includes("$")},[at==null?void 0:at.key,Pf,Q]),hv=o.useMemo(()=>[{key:"elements",label:"Elements",icon:l.jsx(tc,{size:14})},{key:"aliases",label:"Aliases",icon:l.jsx(Ey,{size:14})},{key:"tags",label:"Tags",icon:l.jsx(ec,{size:14})}],[]),gv=o.useMemo(()=>[{key:"alias",label:"Alias"},{key:"raw",label:"Raw"}],[]),Br=P;o.useMemo(()=>{if(!(L!=null&&L.element))return"";const f=L.element,S=L.displayName||f.text||"";return f.type==="alias"?`${S}  $${f.text}$`:S||f.text},[L]);const _f=L?"Replace prompt element":"Add prompt element",yv=L?"Replace with tag or $alias$":"Add tag or $alias$",ii=Fn.length>0,vv=Wl.length>1||zf,xv=!xr&&!$n&&ii,mc=o.useMemo(()=>{const f=new Set;return un.forEach(S=>{if((S==null?void 0:S.type)!=="tag")return;const F=String(S.text||"").trim().toLowerCase();F&&f.add(F)}),f},[un]),hc=o.useMemo(()=>{const f=new Set;return un.forEach(S=>{if((S==null?void 0:S.type)!=="alias")return;const F=String(S.text||"").trim().toLowerCase();F&&f.add(F)}),f},[un]),Zn=o.useMemo(()=>Array.isArray(v)?v.map(f=>{if(!f)return null;const S=String(f.token||f.name||"").trim();if(!S)return null;const F=f.displayName||pl({token:S,name:f.name});return{...f,key:f.key||S,token:S,displayName:F,subcategory:f.subcategory||""}}).filter(Boolean):[],[v]),wv=o.useMemo(()=>{const f=new Map;return Zn.forEach(S=>{if(!(S!=null&&S.token))return;const F=String(S.token||"").trim().toLowerCase();if(!F)return;const J=S.displayName||pl({token:S.token,name:S.name});J&&f.set(F,J)}),f},[Zn]),gc=o.useMemo(()=>{const f=new Set;return Zn.forEach(F=>{const J=String(F.category||"").trim();J&&f.add(J)}),["All",...Array.from(f).sort((F,J)=>F.localeCompare(J))]},[Zn]),Tf=o.useMemo(()=>{const f=new Set;return Zn.forEach(F=>{if(je!=="All"&&F.category!==je)return;const J=String(F.subcategory||"").trim();J&&f.add(J)}),["All",...Array.from(f).sort((F,J)=>F.localeCompare(J))]},[Zn,je]),Hl=o.useMemo(()=>{const f=String(ce||"").trim().toLowerCase();return Zn.filter(S=>{if(je!=="All"&&(S.category||"")!==je||z!=="All"&&(S.subcategory||"")!==z)return!1;if(!f)return!0;const F=String(S.displayName||"").toLowerCase(),J=String(S.token||"").toLowerCase(),ue=String(S.text||"").toLowerCase();return F.includes(f)||J.includes(f)||ue.includes(f)})},[Zn,je,z,ce]),Sv=o.useMemo(()=>Hl.slice(0,ae),[Hl,ae]),Kl=o.useMemo(()=>{const f=Number.parseInt(String(Zt||""),10);return Number.isFinite(f)&&f>0?f:0},[Zt]),kv=o.useMemo(()=>Array.isArray(Mr)?Mr.map(f=>{if(!f)return null;if(typeof f=="string"){const J=f.trim();return J?{value:J,label:gn(J)}:null}const S=String(f.key||"").trim();if(!S)return null;const F=Number(f.actual||f.count||0);return{value:S,label:`${gn(S)} (${F.toLocaleString()})`}}).filter(Boolean):[],[Mr]);o.useEffect(()=>{V("All")},[je]),o.useEffect(()=>{ie(30)},[je,z,ce]),o.useEffect(()=>{if(!Br||ze!=="tags"||Mr.length>0)return;let f=!1;return of().then(S=>{f||Us(Array.isArray(S==null?void 0:S.categories)?S.categories:[])}).catch(()=>{f||Us([])}),()=>{f=!0}},[Br,ze,Mr.length]);const Rf=o.useCallback(async()=>{if(!Br||ze!=="tags")return;tn.current&&tn.current.abort(),Mt.current&&(Mt.current.abort(),Mt.current=null);const f=new AbortController;tn.current=f;try{Yn(!0),hr("");const S=await cr({q:At,category:Kt,sort:ot,minCount:Kl,limit:40,offset:0},{signal:f.signal}),F=Array.isArray(S==null?void 0:S.items)?S.items:[];Gn(F),mr(Number((S==null?void 0:S.total)||0)),Rn(F.length)}catch(S){if((S==null?void 0:S.name)==="AbortError")return;hr("Unable to load tags right now."),Gn([]),mr(0),Rn(0)}finally{Yn(!1)}},[At,Br,ze,Kt,Kl,ot]),oi=o.useCallback(async()=>{if(In)return;tn.current&&tn.current.abort();const f=new AbortController;tn.current=f;try{Yn(!0),hr("");const S=await cr({q:vs,category:"",sort:"count",minCount:"",limit:100,offset:0},{signal:f.signal}),F=Array.isArray(S==null?void 0:S.items)?S.items:[];Gn(F),mr(Number((S==null?void 0:S.total)||0)),Rn(F.length)}catch(S){if((S==null?void 0:S.name)==="AbortError")return;hr("Unable to load tags right now."),Gn([]),mr(0),Rn(0)}finally{Yn(!1)}},[vs,In]),If=o.useCallback(async()=>{if(In||vn||en.length>=Gt)return;Mt.current&&Mt.current.abort();const f=new AbortController;Mt.current=f;try{Fr(!0);const S=await cr({q:vs,category:"",sort:"count",minCount:"",limit:100,offset:yt},{signal:f.signal}),F=Array.isArray(S==null?void 0:S.items)?S.items:[];Gn(J=>[...J,...F]),mr(Number((S==null?void 0:S.total)||0)),Rn(yt+F.length)}catch(S){if((S==null?void 0:S.name)==="AbortError")return;hr("Unable to load more tags.")}finally{Fr(!1)}},[vs,en.length,In,vn,yt,Gt]),jv=o.useCallback(async()=>{if(!Br||ze!=="tags"||In||vn||en.length>=Gt)return;Mt.current&&Mt.current.abort();const f=new AbortController;Mt.current=f;try{Fr(!0);const S=await cr({q:At,category:Kt,sort:ot,minCount:Kl,limit:40,offset:yt},{signal:f.signal}),F=Array.isArray(S==null?void 0:S.items)?S.items:[];Gn(J=>[...J,...F]),mr(Number((S==null?void 0:S.total)||0)),Rn(yt+F.length)}catch(S){if((S==null?void 0:S.name)==="AbortError")return;hr("Unable to load more tags.")}finally{Fr(!1)}},[At,Br,ze,Kt,en.length,In,vn,Kl,yt,ot,Gt]);o.useEffect(()=>{if(!Br||ze!=="tags")return;const f=window.setTimeout(()=>{Rf()},250);return()=>window.clearTimeout(f)},[Br,ze,At,Kt,ot,Kl,Rf]),o.useEffect(()=>{ze!=="elements"&&(yr(null),jt(null))},[ze]),o.useEffect(()=>{if(!bn&&!qn)return;const f=window.setTimeout(()=>{oi()},300);return()=>window.clearTimeout(f)},[vs,bn,qn,oi]);const rn=o.useCallback(f=>{at!=null&&at.key&&Xe(S=>{const F=typeof(S==null?void 0:S[at.key])=="string"?S[at.key]:at.rawText||at.text||"",J=li?ml(F,y):F,ue=typeof f=="function"?f(J):String(f||"");return ue===J?S:{...S,[at.key]:ue}})},[at,y,li]),$f=o.useCallback((f,S,F)=>{if(!f)return!1;const J=String(F||"").trim();return J?(rn(ue=>{const Be=typeof ue=="string"?ue:"";if(!Be||typeof f.start!="number"||typeof f.end!="number")return Be;const Je=Gr(Be,f),Ue=J.replace(/^\$|\$$/g,""),He=S==="alias"?`$${Ue}$`:Ue,zt=Je?`(${He}:${ln(Je.weight)})`:He;return Be.slice(0,f.start)+zt+Be.slice(f.end)}),!0):!1},[rn]),Ns=o.useCallback((f,S,F)=>{const J=L==null?void 0:L.element;if(!J)return!1;const ue=String(S||"").trim();return!ue||!$f(J,f,ue)?!1:(W(null),Qn(!1),Pt(null),f==="alias"?Te(`Replaced with ${F||ue.replace(/^\$|\$$/g,"")}`):hs(`Replaced with ${F||ue.replace(/^\$|\$$/g,"")}`),$e("elements"),q.current==="editor"?(M(!0),me(!1)):(M(!1),me(!0)),q.current="rerun",!0)},[L,$f,Qn,Pt,$e,M,me]),Qs=o.useCallback(f=>{const S=String(f||"").trim();S&&rn(F=>{const J=F.trim();return J?`${J.replace(/[\s,]*$/,"")}, ${S}`.trim():S})},[rn]),Mf=o.useCallback(()=>{const f=String(X||"").trim();if(!f)return;const S=f.split(",").map(ue=>ue.trim()).filter(Boolean),F=S[0];if(!F)return;if(L!=null&&L.element){const ue=F.match(/^\$([a-z0-9_:-]+)\$$/i);ue?Ns("alias",ue[1],ue[1]):Ns("tag",F,F),ke("");return}const J=S.join(", ");J&&(Qs(J),ke(""))},[X,Qs,Ns,L]),Nv=o.useCallback((f,S)=>{const F=String(f||"").trim();if(!F)return;if(L!=null&&L.element){Ns("alias",F,S||F);return}const J=F.toLowerCase();if(hc.has(J)){Te(`Already added: ${S||F}`);return}Qs(`$${F}$`),Te(`Added: ${S||F}`)},[Qs,hc,Ns,L]),Cv=o.useCallback(f=>{const S=String(f||"").trim();if(!S)return;if(L!=null&&L.element){Ns("tag",S,S);return}const F=S.toLowerCase();if(mc.has(F)){hs(`Already added: ${S}`);return}Qs(S),hs(`Added: ${S}`)},[Qs,mc,Ns,L]);o.useEffect(()=>{if(!Se)return;const f=window.setTimeout(()=>Te(""),1600);return()=>window.clearTimeout(f)},[Se]),o.useEffect(()=>{if(!Vs)return;const f=window.setTimeout(()=>hs(""),1600);return()=>window.clearTimeout(f)},[Vs]);const ci=o.useCallback((f,S)=>{if(!f)return;const F=Gr(ai||"",f),J=(F==null?void 0:F.weight)??1;Pt({element:f,displayName:S,weight:J}),ys(""),Ws("All"),Qn(!0)},[ai]),bv=o.useCallback(f=>{f&&(rn(S=>Oy(S||"",f)),Qn(!1),Pt(null))},[rn]),ui=o.useCallback((f,S)=>{f===null||S===null||f===S||rn(F=>rd(F||"",un,f,S))},[un,rn]),Ff=(f,S)=>{yr(S),jt(S),f!=null&&f.dataTransfer&&(f.dataTransfer.effectAllowed="move",f.dataTransfer.setData("text/plain",String(S)))},Of=(f,S)=>{f.preventDefault(),!(vt===null||S===xn)&&(jt(S),f!=null&&f.dataTransfer&&(f.dataTransfer.dropEffect="move"))},Df=()=>{vt!==null&&xn!==null&&vt!==xn&&ui(vt,xn),yr(null),jt(null)},Bf=()=>{xn!==null&&jt(null)},Uf=(f,S)=>{f.preventDefault(),vt!==null&&vt!==S&&ui(vt,S),yr(null),jt(null)},Vf=o.useCallback((f,S)=>{var Be,Je;if(!((Je=(Be=f.target)==null?void 0:Be.closest)==null?void 0:Je.call(Be,".composer-token-drag-handle, .rerun-token-grip")))return;const J=f.touches[0],ue=window.setTimeout(()=>{ht.current&&(ht.current.active=!0,yr(S),jt(S))},240);ht.current={idx:S,startX:J.clientX,startY:J.clientY,active:!1,timer:ue}},[]),Wf=o.useCallback(f=>{var He,zt;if(!ht.current)return;const S=f.touches[0],F=Math.abs(S.clientX-ht.current.startX),J=Math.abs(S.clientY-ht.current.startY);if(!ht.current.active){(F>8||J>8)&&(window.clearTimeout(ht.current.timer),ht.current=null);return}f.preventDefault();let ue=[];const Be=vr.current;if(Be&&(ue=Be.querySelectorAll(".composer-token-draggable")),!ue.length){const Nt=(zt=(He=f.target)==null?void 0:He.closest)==null?void 0:zt.call(He,".rerun-chip-row");Nt&&(ue=Nt.querySelectorAll(".rerun-token-drag"))}const Je=S.clientX,Ue=S.clientY;for(let Nt=0;Nt<ue.length;Nt+=1){const _t=ue[Nt].getBoundingClientRect();if(Je>=_t.left&&Je<=_t.right&&Ue>=_t.top&&Ue<=_t.bottom){jt(Nt);break}}},[]),Hf=o.useCallback(()=>{var f,S;(f=ht.current)!=null&&f.timer&&window.clearTimeout(ht.current.timer),(S=ht.current)!=null&&S.active&&vt!==null&&xn!==null&&vt!==xn&&ui(vt,xn),ht.current=null,yr(null),jt(null)},[vt,xn,ui]),Kf=o.useCallback(()=>{var f;(f=ht.current)!=null&&f.timer&&window.clearTimeout(ht.current.timer),ht.current=null,yr(null),jt(null)},[]),qs=f=>{if(!(typeof window>"u"))try{window.dispatchEvent(new CustomEvent("cozygen:render-state",{detail:{active:f}}))}catch{}},Ev=async()=>{var f;if(!(!t||g||!Mn)){if(!C){alert("Enter a valid seed value.");return}if(!Le){alert("Enter valid width and height values.");return}w(!0),qs(!0);try{const{prompt:S}=await ri();let J=Im(S,{seedMode:de,seedValue:de==="custom"?Vl:null,checkpoint:he||null,lora:Re||null,width:_,height:pe});ye.length&&(J=kj(J,ye,et,{mutate:!0}));const ue={};ye.length&&ye.forEach(Ue=>{const He=et==null?void 0:et[Ue.key];typeof He=="string"&&/\$[a-z0-9_:-]+\$/i.test(He)&&(ue[Ue.key]=He)});const Be=Co();if(Object.keys(ue).length)try{await jo({promptId:Be,promptRaw:ue})}catch{}let Je=J;if(y&&y.size){const Ue=He=>{if(typeof He=="string")return ml(He,y);if(Array.isArray(He))return He.map(zt=>Ue(zt));if(He&&typeof He=="object"){const zt=Array.isArray(He)?[]:{};return Object.entries(He).forEach(([Nt,_t])=>{zt[Nt]=Ue(_t)}),zt}return He};try{Je=Ue(J)}catch{Je=J}}Zu({workflowName:t.filename||"gallery",workflow:Je,timestamp:Date.now(),promptRaw:Object.keys(ue).length?ue:null}),await ko({prompt:Je,prompt_id:Be}),qs(!1),E(!0),setTimeout(()=>{E(!1)},1500)}catch(S){if(qs(!1),S!=null&&S.unauthorized){window.location.hash="#/login";return}const F=((f=S==null?void 0:S.payload)==null?void 0:f.error)||(S==null?void 0:S.message)||"Unable to tweak this item.";alert(F)}finally{w(!1)}}},Lv=async()=>{var f;if(!(!t||B||!Mn)){T(!0),qs(!0);try{const S=Dr.current?{prompt:Dr.current,targets:fc.current,rawMap:ni.current}:await ri(),{prompt:F,targets:J=[],rawMap:ue=null}=S;let Je=Im(F,{seedMode:"random",seedValue:null,checkpoint:null,lora:null,width:_,height:pe}),Ue=Je;if(y&&y.size){const Nt=_t=>{if(typeof _t=="string")return ml(_t,y);if(Array.isArray(_t))return _t.map(er=>Nt(er));if(_t&&typeof _t=="object"){const er=Array.isArray(_t)?[]:{};return Object.entries(_t).forEach(([Bt,Iv])=>{er[Bt]=Nt(Iv)}),er}return _t};try{Ue=Nt(Je)}catch{Ue=Je}}const He=Co(),zt={};if((J.length||pc.current)&&J.forEach(Nt=>{const _t=pc.current||{},er=ue||ni.current,Bt=er&&typeof Nt.key=="string"&&typeof er[Nt.key]=="string"?er[Nt.key]:_t[Nt.key]||Nt.text;typeof Bt=="string"&&/\$[a-z0-9_:-]+\$/i.test(Bt)&&(zt[Nt.key]=Bt)}),Object.keys(zt).length)try{await jo({promptId:He,promptRaw:zt})}catch{}Zu({workflowName:t.filename||"gallery",workflow:Ue,timestamp:Date.now(),promptRaw:Object.keys(zt).length?zt:null}),await ko({prompt:Ue,prompt_id:He}),qs(!1)}catch(S){if(qs(!1),S!=null&&S.unauthorized){window.location.hash="#/login";return}const F=((f=S==null?void 0:S.payload)==null?void 0:f.error)||(S==null?void 0:S.message)||"Unable to re-run this item.";alert(F)}finally{T(!1)}}},Av=async()=>{var S;if(!(!(t!=null&&t.filename)||!window.confirm("Delete this item? This cannot be undone."))){I(!0);try{await Ny({filename:t.filename,subfolder:t.subfolder||""}),a==null||a(),n==null||n()}catch(F){if(F!=null&&F.unauthorized){window.location.hash="#/login";return}const J=((S=F==null?void 0:F.payload)==null?void 0:S.error)||(F==null?void 0:F.message)||"Unable to delete this item.";alert(J)}finally{I(!1)}}},Gf=o.useMemo(()=>Zn.map(f=>({key:f.key||f.token,token:f.token,displayName:f.displayName||f.name||f.token,category:f.category,name:f.name})),[Zn]),Yf=o.useMemo(()=>en.map(f=>({key:`${f.tag}-${f.category}`,tag:f.tag,displayName:f.tag,category:f.category,count:f.count})),[en]),Pv=o.useCallback(f=>{if(!(st!=null&&st.element))return;const S=f.type==="alias"?"alias":"tag",F=f.token||f.tag||"";rn(J=>{const ue=String(J||""),Be=Gr(ue,st.element),Je=String(F||"").replace(/^\$|\$$/g,"").trim();if(!Je)return ue;const Ue=S==="alias"?`$${Je}$`:Je,He=Be?`(${Ue}:${ln(Be.weight)})`:Ue;return Dy(ue,st.element,He)}),Qn(!1),Pt(null)},[st,rn]),zv=o.useCallback(f=>{st!=null&&st.element&&(rn(S=>Fy(S||"",st.element,f)),Pt(S=>S?{...S,weight:f}:null))},[st==null?void 0:st.element,rn]),_v=l.jsx(ad,{open:bn,onClose:()=>{Qn(!1),Pt(null)},mode:"edit",tokenType:((qf=st==null?void 0:st.element)==null?void 0:qf.type)||"tag",tokenLabel:((Xf=st==null?void 0:st.element)==null?void 0:Xf.text)||"",tokenDisplay:(st==null?void 0:st.displayName)||"",weight:(st==null?void 0:st.weight)??1,onWeightChange:zv,onDelete:()=>{st!=null&&st.element&&bv(st.element)},aliases:Gf,aliasCategories:gc,aliasLoading:x,tags:Yf,tagLoading:In||vn,tagHasMore:en.length<Gt,onLoadTags:oi,onLoadMoreTags:If,replacementSearch:gs,onReplacementSearchChange:ys,onReplace:Pv,activeCategory:Ka,onCategoryChange:Ws}),Tv=o.useCallback(f=>{f.type==="alias"&&f.token?rn(S=>{const F=(S||"").trim();return F?`${F}, $${f.token}$`:`$${f.token}$`}):f.tag&&rn(S=>{const F=(S||"").trim();return F?`${F}, ${f.tag}`:f.tag}),gr(!1)},[rn]),Rv=l.jsx(ad,{open:qn,onClose:()=>gr(!1),mode:"add",tokenType:"alias",aliases:Gf,aliasCategories:gc,aliasLoading:x,tags:Yf,tagLoading:In||vn,tagHasMore:en.length<Gt,onLoadTags:oi,onLoadMoreTags:If,replacementSearch:gs,onReplacementSearchChange:ys,onAdd:Tv,activeCategory:Ka,onCategoryChange:Ws});return!t||!e||typeof document>"u"?null:tf.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"react-modal-overlay",role:"presentation",onPointerDown:f=>{N.current=f.target===f.currentTarget},onClick:f=>{N.current&&f.target===f.currentTarget&&(Z.current||n==null||n())},children:l.jsx("div",{className:"react-modal-content media-viewer-dialog",ref:$,role:"dialog","aria-modal":"true","aria-label":"Preview",onClick:f=>f.stopPropagation(),tabIndex:-1,children:l.jsxs("div",{className:"media-viewer-panel",children:[l.jsx(Ij,{filename:t.filename,locationLabel:oc,isClip:Bl,url:Xa,canRerun:Mn,rerunOpen:Ce,canQuickRerun:Mn,quickRerunBusy:B,canDelete:dc,deleteBusy:A,metaRows:Ul,metaOpen:m,onToggleMeta:dv,onToggleRerun:bf,onQuickRerun:Lv,onDelete:Av,onClose:n,closeButtonRef:j}),l.jsxs("div",{className:"media-viewer-body",children:[l.jsx("div",{className:`media-viewer-drawer ${m?"is-open":""}`,children:l.jsx($j,{metaRows:Ul})}),l.jsx("div",{className:`media-viewer-drawer ${Ce?"is-open":""}`,children:Ce?l.jsxs("div",{className:"media-viewer-info rerun-info","aria-label":"Tweak options",children:[l.jsxs("div",{className:"media-info-row rerun-info-row rerun-controls-row",children:[l.jsx("span",{className:"media-info-label",children:"Seed & Size"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(Lo,{title:"Adjust",defaultOpen:!1,variant:"bare",className:"rerun-collapsible",bodyClassName:"rerun-collapsible-body",children:l.jsxs("div",{className:"rerun-control-stack",children:[l.jsxs("div",{className:"rerun-control-group",children:[l.jsx(fr,{ariaLabel:"Seed mode",value:de,onChange:fe,size:"sm",layout:"auto",wrap:!0,items:Za}),de==="custom"?l.jsx("input",{type:"number",inputMode:"numeric",className:"ui-control ui-input",placeholder:"Enter seed",value:ne,onChange:f=>xe(f.target.value)}):null,l.jsx("div",{className:"sheet-hint text-xs text-[#9DA3FFCC]",children:de==="random"?"Randomize each run":"Keep or customize the seed used in the prompt."})]}),ge.hasSize?l.jsx("div",{className:"rerun-control-group",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"number",inputMode:"numeric",min:1,step:1,className:"ui-control ui-input flex-1",placeholder:"Width",value:G,onChange:f=>O(f.target.value),"aria-label":"Width","aria-invalid":Ve}),l.jsx("span",{className:"text-xs text-[#9DA3FF99]","aria-hidden":"true",children:""}),l.jsx("input",{type:"number",inputMode:"numeric",min:1,step:1,className:"ui-control ui-input flex-1",placeholder:"Height",value:H,onChange:f=>we(f.target.value),"aria-label":"Height","aria-invalid":De})]})}):null]})})})]}),ge.hasCheckpoint?l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"Model"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(K,{variant:"bare",className:"w-full justify-start text-left text-[0.8rem] whitespace-normal break-words",onClick:()=>Ef("model"),"aria-label":"Change model","aria-haspopup":"dialog","aria-expanded":oe==="model",children:he||We||""})})]}):null,l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"Prompt"}),l.jsxs("div",{className:"media-info-value rerun-info-value",children:[xr?l.jsx("div",{className:"rerun-info-empty",children:"Loading prompt"}):null,$n?l.jsx("div",{className:"rerun-info-empty rerun-info-error",children:$n}):null,!xr&&!$n&&!ii?l.jsx("div",{className:"rerun-info-empty",children:"No prompt text found for this image."}):null,xv?l.jsxs(l.Fragment,{children:[vv?l.jsxs("div",{className:"rerun-prompt-controls",children:[Wl.length>1?l.jsx(ct,{value:(at==null?void 0:at.key)||"",onChange:D,"aria-label":"Prompt source",size:"sm",wrapperClassName:"rerun-select",options:Wl}):null,zf?l.jsx(fr,{ariaLabel:"Alias display",value:Ge,onChange:rt,items:gv,size:"sm",layout:"auto",className:"rerun-alias-toggle"}):null]}):null,l.jsx("div",{className:`media-info-value is-prompt rerun-prompt-box ${vt!==null?"is-reordering":""}`,role:"list",children:l.jsxs("div",{className:"ui-chip-row rerun-chip-row",children:[un.length?un.map((f,S)=>{const F=String(f.text||"").trim().toLowerCase(),J=wv.get(F)||`$${f.text}$`,ue=y==null?void 0:y.get(F),Be=typeof ue=="string"&&ue.trim()?ue:`$${f.text}$`,Je=f.type==="alias"?Ge==="alias"?J:Be:f.text,Ue=f.type==="alias"&&pl({token:f.text})||f.text,He=Gr(ai||"",f),zt=(He==null?void 0:He.weight)??1,Nt=Math.abs(zt-1)>1e-6,_t=vt===S,er=xn===S&&vt!==null&&vt!==S;return l.jsxs("span",{role:"button",tabIndex:0,draggable:!0,className:`ui-chip is-clickable rerun-token rerun-token-drag max-w-full whitespace-normal leading-snug ${f.type==="alias"?"is-alias":"is-raw"} ${_t?"is-dragging":""} ${er?"is-drop-target":""}`,onDragStart:Bt=>Ff(Bt,S),onDragEnd:Df,onDragOver:Bt=>Of(Bt,S),onDragLeave:Bf,onDrop:Bt=>Uf(Bt,S),onTouchStart:Bt=>Vf(Bt,S),onTouchMove:Wf,onTouchEnd:Hf,onTouchCancel:Kf,onClick:()=>{vt===null&&ci(f,Ue)},onKeyDown:Bt=>{(Bt.key==="Enter"||Bt.key===" ")&&(Bt.preventDefault(),ci(f,Ue))},title:f.type==="alias"?`Alias: $${f.text}$`:`Tag: ${f.text}`,children:[l.jsx("span",{className:"rerun-token-grip","aria-hidden":"true",children:l.jsx(Ma,{size:8})}),l.jsx("span",{className:"break-words",children:Je}),Nt?l.jsxs("span",{className:"rerun-chip-weight",children:[ln(zt),""]}):null]},`${f.type}-${f.text}-${f.start}`)}):null,l.jsx("button",{type:"button",className:"ui-chip is-clickable rerun-token rerun-token-add",onClick:fv,"aria-label":"Add alias or tag",title:"Add alias or tag",children:"+"})]})})]}):null]})]}),ge.hasLora?l.jsxs("div",{className:"media-info-row rerun-info-row",children:[l.jsx("span",{className:"media-info-label",children:"LoRAs"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:l.jsx(K,{variant:"bare",className:"w-full justify-start text-left text-[0.8rem] whitespace-normal break-words",onClick:()=>Ef("lora"),"aria-label":"Change LoRA","aria-haspopup":"dialog","aria-expanded":oe==="lora",children:Re||(Ee.length?Ee.join(", "):"")})})]}):null,l.jsxs("div",{className:"media-info-row rerun-info-row rerun-actions-row",children:[l.jsx("span",{className:"media-info-label",children:"Run"}),l.jsx("div",{className:"media-info-value rerun-info-value",children:b?l.jsxs("div",{className:"rerun-success",children:[l.jsx("svg",{className:"rerun-success-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Render queued successfully!"]}):l.jsxs("div",{className:"rerun-actions",children:[l.jsx(K,{variant:"muted",size:"sm",onClick:bf,children:"Close"}),l.jsx(K,{variant:"primary",size:"sm",onClick:Ev,disabled:g||xr||!!$n||!C||!Le,children:g?"Tweaking":"Run"})]})})]})]}):null}),l.jsx(Mj,{showNav:Ja,canPrev:c,canNext:u,onPrev:r,onNext:s,isClip:Bl,url:Xa,filename:t.filename})]})]})})}),l.jsx(Wt,{open:P,onClose:pv,title:"Edit prompt",variant:"fullscreen",footer:l.jsx("div",{className:"flex gap-2",children:l.jsx(K,{variant:"muted",className:"w-full",onClick:mv,children:"Back to tweak"})}),children:l.jsxs("div",{className:"sheet-stack",children:[xr?l.jsx("div",{className:"composer-alias-empty",children:"Loading prompt"}):null,$n?l.jsx("div",{className:"text-xs text-[#FF8F70]",children:$n}):null,!xr&&!$n&&ii?l.jsxs(l.Fragment,{children:[Wl.length>1?l.jsx(ct,{value:(at==null?void 0:at.key)||"",onChange:D,"aria-label":"Prompt source",size:"sm",options:Wl}):null,l.jsx(fr,{ariaLabel:"Prompt element view",value:ze,onChange:$e,items:hv,size:"sm"}),ze==="elements"?l.jsxs("div",{className:"composer-panel composer-panel-compose is-visible",children:[l.jsx("div",{className:"composer-editor",children:l.jsxs("div",{className:"composer-input-row",children:[l.jsx("input",{type:"text",value:X,onChange:f=>ke(f.target.value),onKeyDown:f=>{f.key==="Enter"&&(f.preventDefault(),Mf())},className:"composer-input ui-control ui-input is-compact",placeholder:yv,"aria-label":_f,disabled:!at}),l.jsx(K,{size:"icon",variant:"ghost",onClick:Mf,disabled:!X.trim()||!at,"aria-label":_f,children:"+"})]})}),l.jsxs("div",{className:"composer-tokens",children:[l.jsx("div",{className:"composer-tokens-header",children:l.jsxs("span",{className:"composer-tokens-label",children:["Elements",l.jsx("span",{className:"composer-tokens-count",children:un.length})]})}),l.jsx("span",{className:"composer-tokens-hint",children:"Drag to reorder  Tap to edit"}),un.length?l.jsx("div",{ref:vr,className:`composer-tokens-list ${vt!==null?"is-dragging":""}`,style:{"--composer-elements":un.length},children:un.map((f,S)=>{const F=f.type==="alias"&&pl({token:f.text})||f.text,J=Gr(ai||"",f),ue=(J==null?void 0:J.weight)??1,Be=vt===S,Je=xn===S&&vt!==null&&vt!==S;return l.jsxs("span",{className:`composer-token composer-token-draggable ${f.type==="alias"?"is-alias":"is-tag"} ${Be?"is-dragging":""} ${Je?"is-drop-target":""}`,role:"button",tabIndex:0,draggable:!0,title:f.type==="alias"?`Alias: $${f.text}$`:`Tag: ${f.text}`,onDragStart:Ue=>Ff(Ue,S),onDragEnd:Df,onDragOver:Ue=>Of(Ue,S),onDragLeave:Bf,onDrop:Ue=>Uf(Ue,S),onTouchStart:Ue=>Vf(Ue,S),onTouchMove:Wf,onTouchEnd:Hf,onTouchCancel:Kf,onClick:()=>{vt===null&&ci(f,F)},onKeyDown:Ue=>{Ue.target===Ue.currentTarget&&(Ue.key==="Enter"||Ue.key===" ")&&(Ue.preventDefault(),ci(f,F))},children:[l.jsx("span",{className:"composer-token-order",children:S+1}),l.jsx("span",{className:"composer-token-drag-handle","aria-hidden":"true",children:l.jsx(Ma,{size:10})}),l.jsx("span",{className:"composer-token-name",children:F}),f.type==="alias"&&l.jsx("span",{className:"composer-token-type",children:"$"}),Math.abs(ue-1)>1e-6&&l.jsxs("span",{className:"composer-token-weight",children:[ln(ue),""]})]},`${f.type}-${f.text}-${f.start}`)})}):l.jsx("div",{className:"composer-empty",children:"No elements yet."})]})]}):null,ze==="aliases"?l.jsxs("div",{className:"composer-panel composer-panel-aliases is-visible",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{type:"text",value:qe,onChange:f=>U(f.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>U(""),disabled:!qe,children:"Clear"})]}),l.jsx(ct,{value:je,onChange:Pe,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:gc.map(f=>({value:f,label:f==="All"?"Category: All":Xt(f)}))}),Tf.length>2?l.jsx(ct,{value:z,onChange:V,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:Tf.map(f=>({value:f,label:f==="All"?"All subcategories":gn(f)}))}):null]}),Se?l.jsx("div",{className:"composer-tag-collection-status",role:"status",children:Se}):null,l.jsx("div",{className:"composer-alias-list",role:"list",children:x?l.jsx("div",{className:"composer-alias-empty",children:"Loading aliases"}):k?l.jsx("div",{className:"composer-alias-empty",children:"Unable to load aliases."}):Hl.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[Sv.map(f=>l.jsx(iv,{id:f.key,name:f.name||f.token,category:f.category,text:f.text,isSelected:hc.has(String(f.token||"").toLowerCase()),onOpen:()=>Nv(f.token,f.displayName),visibilityStyle:Um},f.key)),ae<Hl.length?l.jsxs(K,{variant:"muted",className:"w-full",onClick:()=>ie(f=>f+30),children:["Show more (",Hl.length-ae," left)"]}):null]})})]}):null,ze==="tags"?l.jsxs("div",{className:"composer-panel composer-panel-tags is-visible",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{type:"search",value:lt,onChange:f=>nt(f.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>nt(""),disabled:!lt,children:"Clear"})]}),l.jsx(ct,{value:Kt,onChange:bt,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...kv]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(ct,{value:ot,onChange:ps,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"rerun-min-count",children:"Minimum count"}),l.jsx("input",{id:"rerun-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:Zt,onChange:f=>{const S=f.target.value;(S===""||Number(S)>=0)&&Fl(S)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),ms?l.jsx("div",{className:"composer-tags-error",children:ms}):null,Vs?l.jsx("div",{className:"composer-tag-collection-status",role:"status",children:Vs}):null,l.jsx("div",{className:"composer-alias-list composer-tags-grid",role:"list",children:In?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):en.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[en.map(f=>l.jsx(ov,{tag:f.tag,category:f.category,count:f.count,isCollected:mc.has(String(f.tag||"").toLowerCase()),onToggle:Cv,visibilityStyle:Um},`${f.tag}-${f.category}`)),en.length<Gt?l.jsx(K,{variant:"muted",className:"w-full",onClick:jv,disabled:vn,children:vn?"Loading more":`Show more (${Gt-en.length} left)`}):null]})})]}):null]}):null,!xr&&!$n&&!ii?l.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:"No prompt text found for this image."}):null]})}),l.jsx(Wt,{open:oe==="model",onClose:()=>{Ys(),Ie("")},title:"Select model",children:l.jsx("div",{className:"model-picker",children:Ga?l.jsx("div",{className:"model-picker-loading",children:"Loading models"}):xs?l.jsx("div",{className:"model-picker-error",children:xs}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"model-picker-search",children:l.jsx("input",{type:"search",placeholder:"Search models",className:"model-picker-input",value:Y,onChange:f=>Ie(f.target.value),"aria-label":"Search models"})}),Et&&!Y?l.jsx("div",{className:"model-picker-folders",children:ks.map(f=>l.jsx("button",{type:"button",className:`model-picker-folder-chip ${Oe===f?"is-active":""}`,onClick:()=>Ze(f),children:f==="All"?"All":f.split("/").pop()},f))}):null,l.jsxs("div",{className:"model-picker-current",children:[l.jsx("span",{className:"model-picker-current-label",children:"Current"}),l.jsx("span",{className:"model-picker-current-value",children:Ye||"Default"})]}),l.jsxs("div",{className:"model-picker-list",children:[Y?null:l.jsxs("button",{type:"button",className:`model-picker-item ${he?"":"is-selected"}`,onClick:()=>{Me(""),Ie(""),Ys()},children:[l.jsx("span",{className:"model-picker-item-icon",children:""}),l.jsx("span",{className:"model-picker-item-name",children:"Keep current"})]}),jf.length===0&&Y?l.jsxs("div",{className:"model-picker-empty",children:['No models match "',Y,'"']}):null,jf.map(f=>l.jsxs("button",{type:"button",className:`model-picker-item ${he===f.value?"is-selected":""}`,onClick:()=>{Me(f.value),Ie(""),Ys()},children:[l.jsx("span",{className:"model-picker-item-icon",children:""}),l.jsx("span",{className:"model-picker-item-name",children:f.label}),he===f.value&&l.jsx("span",{className:"model-picker-item-check",children:""})]},f.value))]})]})})}),l.jsx(Wt,{open:oe==="lora",onClose:()=>{Ys(),Ne("")},title:"Select LoRA",children:l.jsx("div",{className:"model-picker",children:Ga?l.jsx("div",{className:"model-picker-loading",children:"Loading LoRAs"}):xs?l.jsx("div",{className:"model-picker-error",children:xs}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"model-picker-search",children:l.jsx("input",{type:"search",placeholder:"Search LoRAs",className:"model-picker-input",value:te,onChange:f=>Ne(f.target.value),"aria-label":"Search LoRAs"})}),Rt&&!te?l.jsx("div",{className:"model-picker-folders",children:js.map(f=>l.jsx("button",{type:"button",className:`model-picker-folder-chip ${re===f?"is-active":""}`,onClick:()=>_e(f),children:f==="All"?"All":f.split("/").pop()},f))}):null,l.jsxs("div",{className:"model-picker-current",children:[l.jsx("span",{className:"model-picker-current-label",children:"Current"}),l.jsx("span",{className:"model-picker-current-value",children:Jn||"None"})]}),l.jsxs("div",{className:"model-picker-list",children:[te?null:l.jsxs("button",{type:"button",className:`model-picker-item ${Re?"":"is-selected"}`,onClick:()=>{Fe(""),Ne(""),Ys()},children:[l.jsx("span",{className:"model-picker-item-icon",children:""}),l.jsx("span",{className:"model-picker-item-name",children:"Keep current"})]}),Nf.length===0&&te?l.jsxs("div",{className:"model-picker-empty",children:['No LoRAs match "',te,'"']}):null,Nf.map(f=>l.jsxs("button",{type:"button",className:`model-picker-item ${Re===f.value?"is-selected":""}`,onClick:()=>{Fe(f.value),Ne(""),Ys()},children:[l.jsx("span",{className:"model-picker-item-icon",children:""}),l.jsx("span",{className:"model-picker-item-name",children:f.label}),Re===f.value&&l.jsx("span",{className:"model-picker-item-check",children:""})]},f.value))]})]})})}),_v,Rv]}),document.body)}const Bj=(e="")=>e.startsWith("."),Uj=(e="")=>/\.(png|jpe?g|gif|webp|bmp|tif?f)$/i.test(e),Vj=(e="")=>/\.(mp4|webm|mov|mkv)$/i.test(e);function Wj(){const e=ff(),t=(G,O="")=>{try{return typeof window<"u"&&localStorage.getItem(G)||O}catch{return O}},n=(G,O)=>{try{typeof window<"u"&&localStorage.setItem(G,O)}catch{}},[r,s]=o.useState(t("galleryPath","")),[a,i]=o.useState([]),[c,u]=o.useState(!1),[d,h]=o.useState(!1),[v,y]=o.useState(""),[x,k]=o.useState(1),[N,j]=o.useState(1),[m,p]=o.useState(()=>{const G=t("galleryPageSize","30"),O=parseInt(G,10);return Number.isFinite(O)?O:30}),[g,w]=o.useState("all"),[b,E]=o.useState(!1),[A,I]=o.useState(""),[B,T]=o.useState(()=>t("galleryRecursive","0")==="1"),[$,ee]=o.useState(0);o.useEffect(()=>{let G=!1;const O=new AbortController;return(async()=>{u(!0),y("");try{typeof performance<"u"&&performance.mark&&performance.mark("cozygen:gallery:fetch")}catch{}try{const we=await jy(r,x,m,b,B,g,$,{signal:O.signal,includeMeta:!0});if(G)return;we&&we.items?(i(we.items),j(we.total_pages||1),y("")):(i([]),j(1));try{typeof performance<"u"&&performance.measure&&(performance.mark("cozygen:gallery:ready"),performance.measure("cozygen:gallery:first-paint","cozygen:gallery:fetch","cozygen:gallery:ready"))}catch{}}catch(we){if((we==null?void 0:we.name)==="AbortError")return;console.error("Failed to load gallery",we),G||y("Unable to load gallery right now."),G||(i([]),j(1))}finally{!G&&!O.signal.aborted&&(u(!1),h(!0))}})(),n("galleryPath",r),n("galleryPageSize",String(m)),()=>{G=!0,O.abort()}},[r,x,m,$,b,B,g]);const Z=o.useMemo(()=>{if(!r)return[];const G=r.replace(/\\/g,"/").split("/").filter(Boolean),O=[];for(let H=0;H<G.length;H++)O.push({name:G[H],path:G.slice(0,H+1).join("/")});return O},[r]),le=o.useMemo(()=>a.filter(G=>G.type==="directory").map(G=>({filename:G.filename,subfolder:G.subfolder})),[a]),Ce=o.useMemo(()=>{const G=(A||"").trim().toLowerCase();return a.filter(O=>{const H=(O.filename||"").toLowerCase();return!(!b&&Bj(H)||O.type!=="directory"&&(g==="image"&&!Uj(H)||g==="video"&&!Vj(H))||G&&!H.includes(G))})},[a,b,g,A]),me=o.useMemo(()=>Ce.filter(G=>G.type!=="directory"),[Ce]),oe=o.useCallback(()=>{if(!r)return;const G=r.replace(/\\/g,"/").lastIndexOf("/"),O=G===-1?"":r.slice(0,G);s(O),k(1)},[r]),R=o.useCallback(()=>{s(""),k(1)},[]),P=o.useCallback(G=>{s(G||""),k(1)},[]),M=o.useCallback(G=>{s(G),k(1)},[]),L=o.useCallback(G=>{const O=parseInt(String(G),10)||30;p(O),k(1)},[]),W=o.useCallback(G=>{w(G),k(1)},[]),q=o.useCallback(G=>{const O=!!G;T(O),k(1),n("galleryRecursive",O?"1":"0")},[]),de=o.useCallback(G=>{I(G),k(1)},[]),fe=o.useCallback(()=>{ee(G=>G+1)},[]),ne=o.useRef(null),xe=o.useCallback(()=>{ne.current||(ne.current=window.setTimeout(()=>{ne.current=null,fe()},400))},[fe]);return o.useEffect(()=>{const G=()=>fe();return typeof window<"u"&&window.addEventListener&&window.addEventListener("cozygen:queue-finished",G),()=>{typeof window<"u"&&window.removeEventListener&&window.removeEventListener("cozygen:queue-finished",G)}},[fe]),o.useEffect(()=>{if(typeof window>"u"||!e)return;let G=!1,O,H,we=8e3;const he=()=>{H&&(clearTimeout(H),H=null)},Me=(Fe=8e3)=>{he(),H=window.setTimeout(()=>{G||(xe(),Me(we))},Fe)};return(()=>{if(!("EventSource"in window)){Me();return}const Fe=new URLSearchParams({subfolder:r||"",recursive:B?"1":"0",show_hidden:b?"1":"0"});O=new EventSource(`/cozygen/api/gallery/stream?${Fe.toString()}`),O.onmessage=()=>{G||xe()},O.onerror=()=>{O&&(O.close(),O=null),we=Math.min(Math.ceil(we*1.4),2e4),Me()}})(),()=>{G=!0,he(),ne.current&&(clearTimeout(ne.current),ne.current=null),O&&(O.close(),O=null)}},[r,B,b,xe,e]),o.useEffect(()=>{e&&fe()},[e,fe]),{path:r,items:a,loading:c,hasLoaded:d,error:v,page:x,totalPages:N,perPage:m,kind:g,showHidden:b,query:A,recursive:B,crumbs:Z,dirChips:le,filtered:Ce,mediaItems:me,setPage:k,setPerPage:L,setShowHidden:E,setQuery:de,setKind:W,setRecursive:q,goBack:oe,goRoot:R,goToPath:P,selectDir:M,refresh:fe}}function Hj(e){const[t,n]=o.useState(!1),[r,s]=o.useState(null);o.useEffect(()=>{if(!e||e.length===0){s(null),n(!1);return}s(x=>x==null?x:x>=e.length?e.length-1:x)},[e]);const a=o.useCallback(x=>{if(!e||!e.length||!x)return;const k=e.indexOf(x);k!==-1&&(s(k),n(!0))},[e]),i=o.useCallback(()=>{n(!1),s(null)},[]),c=o.useCallback(()=>{!e||!e.length||s(x=>x==null||x>=e.length-1?x:x+1)},[e]),u=o.useCallback(()=>{!e||!e.length||s(x=>x==null||x<=0?x:x-1)},[e]),d=r!=null&&r>=0&&e&&r<e.length?e[r]:null,h=(e==null?void 0:e.length)||0,v=r!==null&&r>0,y=r!==null&&r<h-1;return{viewerOpen:t,viewerIndex:r,currentMedia:d,total:h,canPrev:v,canNext:y,open:a,close:i,next:c,prev:u,setViewerOpen:n}}const Hm="cozygen_gallery_view_mode",Km="cozygen_gallery_feed_autoplay";function Kj(e,t){const n=o.useRef(null),[r,s]=o.useState(0),[a,i]=o.useState({width:0,cols:0,top:0,viewport:typeof window<"u"&&window.innerHeight||800}),c=y=>{if(!y||typeof window>"u")return null;let x=y.parentElement;for(;x;){const k=window.getComputedStyle(x);if(k.overflowY==="auto"||k.overflowY==="scroll")return x;x=x.parentElement}return window};o.useEffect(()=>{if(!t)return;const y=n.current;if(!y||typeof window>"u"||typeof ResizeObserver>"u")return;const x=c(y)||window,k=()=>{const p=y.getBoundingClientRect(),g=p.width||y.clientWidth||1,w=Math.max(1,Math.floor(g/160)),b=x===window?window.scrollY||0:x.scrollTop||0,E=x===window?{top:0}:x.getBoundingClientRect(),A=x===window?p.top+(window.scrollY||0):p.top-E.top+b,I=x===window?window.innerHeight||800:x.clientHeight||800;i(B=>B.width===g&&B.cols===w&&B.top===A&&B.viewport===I?B:{width:g,cols:w,top:A,viewport:I}),s(b)};k();const N=new ResizeObserver(()=>k());N.observe(y),window.addEventListener("resize",k);let j=!1;const m=()=>{j||(j=!0,window.requestAnimationFrame(()=>{j=!1;const p=x===window?window.scrollY||0:x.scrollTop||0;s(p)}))};return x.addEventListener("scroll",m,{passive:!0}),()=>{N.disconnect(),window.removeEventListener("resize",k),x.removeEventListener("scroll",m)}},[t]);const u=t&&a.cols>0&&e.length>60,{visibleItems:d,topSpacer:h,bottomSpacer:v}=o.useMemo(()=>{if(!u)return{visibleItems:e,topSpacer:0,bottomSpacer:0};const y=a.width/a.cols,x=Math.max(180,Math.ceil(y*1.25)+32),k=Math.ceil(e.length/a.cols),N=Math.max(0,r-a.top),j=Math.max(0,Math.floor(N/x)-2),m=Math.min(k,Math.ceil((N+a.viewport)/x)+2),p=j*a.cols,g=Math.min(e.length,m*a.cols);return{visibleItems:e.slice(p,g),topSpacer:j*x,bottomSpacer:Math.max(0,(k-m)*x)}},[e,a,r,u]);return{containerRef:n,visibleItems:d,topSpacer:h,bottomSpacer:v,virtualized:u}}function Gj(){const{path:e,loading:t,hasLoaded:n,page:r,totalPages:s,perPage:a,kind:i,showHidden:c,recursive:u,error:d,crumbs:h,dirChips:v,filtered:y,mediaItems:x,setPage:k,setPerPage:N,setShowHidden:j,setKind:m,setRecursive:p,goBack:g,goRoot:w,goToPath:b,selectDir:E,refresh:A}=Wj(),{viewerOpen:I,currentMedia:B,total:T,canPrev:$,canNext:ee,open:Z,close:le,next:Ce,prev:me}=Hj(x),[oe,R]=o.useState(()=>{if(typeof window>"u")return"grid";const Q=window.localStorage.getItem(Hm);return Q==="feed"||Q==="grid"?Q:"grid"}),[P,M]=o.useState(()=>typeof window>"u"?!1:window.localStorage.getItem(Km)==="true"),[L,W]=o.useState(""),[q,de]=o.useState(""),[fe,ne]=o.useState(!1);o.useEffect(()=>{try{window.localStorage.setItem(Hm,oe)}catch{}},[oe]),o.useEffect(()=>{try{window.localStorage.setItem(Km,P?"true":"false")}catch{}},[P]);const xe=o.useCallback(async()=>{try{await PS(),A(),alert("Cache cleared successfully! Thumbnails will be regenerated.")}catch(Q){alert("Failed to clear cache: "+(Q.message||"Unknown error"))}},[A]),G=o.useCallback(async()=>{var et;if(fe)return;const Q=e?`folder "${e}"`:"the gallery root";if(window.confirm(`Delete all media in ${Q}? This cannot be undone.`)){ne(!0);try{await kS({subfolder:e,recursive:!0,confirm:"delete-all"}),A(),alert("Deleted all media in the gallery.")}catch(Xe){if(Xe!=null&&Xe.unauthorized){window.location.hash="#/login";return}const ut=((et=Xe==null?void 0:Xe.payload)==null?void 0:et.error)||(Xe==null?void 0:Xe.message)||"Unable to delete gallery media.";alert(ut)}finally{ne(!1)}}},[fe,e,A]),O=o.useCallback(Q=>(Q==null?void 0:Q.type)==="directory"?`dir:${Q.subfolder||Q.filename}`:`${Q.subfolder||""}|${Q.filename}`,[]),H=o.useCallback(Q=>{if(Q.type==="directory"){E(Q.subfolder);return}de(""),Z(Q)},[Z,E]),we=o.useCallback(Q=>{!Q||Q.type==="directory"||(de(O(Q)),Z(Q))},[O,Z]),he=o.useCallback(async Q=>{var ut;if(!Q||Q.type==="directory"||!Q.filename)return;const Ke=Q.filename||"this item";if(!window.confirm(`Delete "${Ke}"? This cannot be undone.`))return;const Xe=O(Q);W(Xe);try{await Ny({filename:Q.filename,subfolder:Q.subfolder||""}),A()}catch(D){if(D!=null&&D.unauthorized){window.location.hash="#/login";return}const X=((ut=D==null?void 0:D.payload)==null?void 0:ut.error)||(D==null?void 0:D.message)||"Unable to delete this item.";alert(X)}finally{W("")}},[O,A]),Me=oe==="grid",[Re,Fe]=o.useState(!1),Oe=o.useMemo(()=>[{key:"all",label:"All"},{key:"image",label:"Images"},{key:"video",label:"Videos"}],[]),Ze=o.useMemo(()=>[{key:"grid",ariaLabel:"Grid view",icon:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[l.jsx("rect",{x:"1",y:"1",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"9",y:"1",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"1",y:"9",width:"6",height:"6",rx:"1"}),l.jsx("rect",{x:"9",y:"9",width:"6",height:"6",rx:"1"})]})},{key:"feed",ariaLabel:"Feed view",icon:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[l.jsx("rect",{x:"2",y:"1",width:"12",height:"5",rx:"1"}),l.jsx("rect",{x:"2",y:"8",width:"12",height:"5",rx:"1"})]})}],[]);o.useEffect(()=>{try{window.localStorage.setItem("cozygen_gallery_pending","0")}catch{}window.dispatchEvent(new Event("cozygen:gallery-viewed"))},[]);const re=t&&!n,_e=t&&n,Y=`${y.length} items`,Ie=re?"Loading":Y,te=!!d,{containerRef:Ne,visibleItems:ge,topSpacer:ve,bottomSpacer:ye,virtualized:Ae}=Kj(y,Me);return l.jsxs("div",{className:"page-shell gallery-shell",children:[l.jsx("div",{className:"screen-sticky gallery-header",children:l.jsxs("div",{className:"gallery-header-inner",children:[l.jsxs("div",{className:"page-bar gallery-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Gallery"}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx("span",{className:"gallery-status",children:Ie}),l.jsx(fr,{ariaLabel:"View mode",value:oe,onChange:R,layout:"icon",size:"sm",items:Ze}),l.jsx(K,{size:"xs",className:"mobile-only",onClick:()=>Fe(!0),children:"Filters"})]})]}),l.jsx("div",{className:"gallery-nav-row",children:l.jsx(Pj,{subfolder:e,crumbs:h,dirChips:v,onBack:g,onRoot:w,onCrumb:Q=>b(Q),onSelectDir:Q=>E(Q)})}),l.jsxs("div",{className:"gallery-toolbar",children:[l.jsx("div",{className:"gallery-toolbar-left",children:l.jsx(fr,{ariaLabel:"Filter by type",value:i,onChange:m,size:"sm",items:Oe})}),l.jsxs("div",{className:"gallery-toolbar-right",children:[l.jsxs("div",{className:"gallery-options",children:[l.jsx(K,{size:"icon",active:u,pressed:u,onClick:()=>p(Q=>!Q),title:u?"Showing subfolders":"This folder only","aria-label":"Toggle subfolders",children:u?l.jsx(No,{size:16}):l.jsx(gm,{size:16})}),l.jsx(K,{size:"icon",active:c,pressed:c,onClick:()=>j(Q=>!Q),title:c?"Showing hidden":"Hiding hidden","aria-label":"Toggle hidden items",children:c?l.jsx(ym,{size:16}):l.jsx(vm,{size:16})}),oe==="feed"&&l.jsx(K,{size:"icon",active:P,pressed:P,onClick:()=>M(Q=>!Q),title:P?"Autoplay on":"Autoplay off","aria-label":"Toggle autoplay",children:P?l.jsx(xm,{size:16}):l.jsx(wm,{size:16})}),l.jsx(K,{size:"icon",onClick:A,title:"Refresh","aria-label":"Refresh gallery",children:l.jsx(Ki,{size:16})})]}),l.jsx(K,{size:"xs",variant:"danger",onClick:G,disabled:fe,"aria-label":"Delete all gallery media",children:fe?"Deleting":"Delete all"}),l.jsx(K,{size:"xs",onClick:xe,title:"Clear thumbnail cache","aria-label":"Clear cache",children:"Clear Cache"})]})]}),l.jsx("div",{className:"gallery-pagination",children:l.jsxs("div",{className:"gallery-pagination-controls",children:[l.jsx(K,{size:"icon",variant:"ghost",onClick:()=>k(Q=>Math.max(1,Q-1)),disabled:r<=1||t,"aria-label":"Previous page",children:l.jsx(Ay,{size:16})}),l.jsxs("span",{className:"gallery-page-indicator",children:[r," / ",s]}),l.jsx(K,{size:"icon",variant:"ghost",onClick:()=>k(Q=>Q<s?Q+1:Q),disabled:r>=s||t,"aria-label":"Next page",children:l.jsx(nc,{size:16})}),l.jsx(ct,{value:a,onChange:Q=>N(parseInt(Q,10)||30),className:"gallery-page-size","aria-label":"Items per page",size:"sm",options:[15,30,60,120]})]})})]})}),re&&y.length===0?l.jsx("div",{className:"gallery-grid-responsive",children:Array.from({length:8}).map((Q,Ke)=>l.jsxs("div",{className:"gallery-skeleton-item",children:[l.jsx("div",{className:"gallery-skeleton-thumb skeleton"}),l.jsx("div",{className:"gallery-skeleton-label skeleton skeleton-text"})]},Ke))}):te&&y.length===0?l.jsxs("div",{className:"gallery-empty",role:"alert",children:[l.jsx("div",{className:"gallery-empty-icon",children:l.jsx(Sm,{size:48})}),l.jsx("div",{className:"gallery-empty-title",children:"Gallery unavailable"}),l.jsx("div",{className:"gallery-empty-desc",children:d}),l.jsx(K,{size:"sm",variant:"primary",className:"mt-4",onClick:A,children:"Retry"})]}):y.length===0?l.jsxs("div",{className:"gallery-empty",children:[l.jsx("div",{className:"gallery-empty-icon",children:l.jsx(Sm,{size:48})}),l.jsx("div",{className:"gallery-empty-title",children:"No media found"}),l.jsx("div",{className:"gallery-empty-desc",children:i!=="all"?`No ${i}s match your filters. Try selecting "All" or adjusting your search.`:"This folder is empty. Render something new or navigate to a different folder."})]}):Me?l.jsx("div",{className:"w-full overflow-hidden",children:l.jsxs("div",{className:"gallery-grid-responsive",ref:Ne,children:[Ae&&ve>0?l.jsx("div",{"aria-hidden":!0,style:{gridColumn:"1 / -1",height:`${ve}px`}}):null,ge.map(Q=>l.jsx(Dm,{item:Q,onSelect:H,onDelete:he,onRerun:we,isDeleting:O(Q)===L,variant:"grid",autoPlay:!1},O(Q))),Ae&&ye>0?l.jsx("div",{"aria-hidden":!0,style:{gridColumn:"1 / -1",height:`${ye}px`}}):null]})}):l.jsx("div",{className:"flex flex-col gap-6 items-center",children:x.map(Q=>l.jsx("div",{className:"w-full flex justify-center",children:l.jsx(Dm,{item:Q,onSelect:H,onDelete:he,onRerun:we,isDeleting:O(Q)===L,variant:"feed",autoPlay:P})},O(Q)))}),l.jsx(Dj,{isOpen:I,media:B,onClose:le,onPrev:me,onNext:Ce,onDeleted:A,total:T,canPrev:$,canNext:ee,autoOpenRerunKey:q,onRerunAutoOpen:()=>de("")}),l.jsx(Wt,{open:Re,onClose:()=>Fe(!1),title:"Gallery filters",contentClassName:"gallery-filters-sheet",footer:l.jsx(K,{variant:"primary",className:"w-full",onClick:()=>Fe(!1),children:"Done"}),children:l.jsxs("div",{className:"sheet-stack gallery-filters-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Type"}),l.jsx(fr,{ariaLabel:"Filter by type",value:i,onChange:m,size:"sm",items:Oe})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Options"}),l.jsxs("div",{className:"gallery-filter-actions",children:[l.jsx(K,{size:"sm",variant:u?"primary":"muted",onClick:()=>p(Q=>!Q),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[u?l.jsx(No,{size:14}):l.jsx(gm,{size:14}),l.jsx("span",{children:u?"Subfolders":"This folder"})]})}),l.jsx(K,{size:"sm",variant:c?"primary":"muted",onClick:()=>j(Q=>!Q),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[c?l.jsx(ym,{size:14}):l.jsx(vm,{size:14}),l.jsx("span",{children:c?"Hidden on":"Hidden off"})]})}),oe==="feed"?l.jsx(K,{size:"sm",variant:P?"primary":"muted",onClick:()=>M(Q=>!Q),children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[P?l.jsx(xm,{size:14}):l.jsx(wm,{size:14}),l.jsx("span",{children:P?"Autoplay":"No autoplay"})]})}):null,l.jsx(K,{size:"sm",variant:"ghost",onClick:A,children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[l.jsx(Ki,{size:14}),l.jsx("span",{children:"Refresh"})]})}),l.jsx(K,{size:"sm",variant:"ghost",onClick:xe,title:"Clear thumbnail cache",children:l.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[l.jsx(Ki,{size:14}),l.jsx("span",{children:"Clear cache"})]})}),l.jsx(K,{size:"sm",variant:"danger",onClick:G,disabled:fe,"aria-label":"Delete all gallery media",children:fe?"Deleting":"Delete all"})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Page size"}),l.jsxs("div",{className:"gallery-filter-page",children:[l.jsx(ct,{value:a,onChange:Q=>N(parseInt(Q,10)||30),"aria-label":"Items per page",size:"sm",options:[15,30,60,120]}),l.jsxs("div",{className:"sheet-hint",children:[_e?l.jsx("span",{className:"loading-spinner","aria-hidden":"true"}):null,l.jsxs("span",{children:[Ie,"  Page ",r," of ",s]})]}),l.jsxs("div",{className:"gallery-filter-pagination",children:[l.jsx(K,{variant:"muted",className:"w-full",onClick:()=>k(Q=>Math.max(1,Q-1)),disabled:r<=1||t,children:"Prev"}),l.jsx(K,{variant:"muted",className:"w-full",onClick:()=>k(Q=>Q<s?Q+1:Q),disabled:r>=s||t,children:"Next"})]})]})]})]})})]})}const Yj=()=>typeof window>"u"?800:window.innerHeight||800,Qj=e=>{if(!e||typeof window>"u")return null;let t=e.parentElement;for(;t;){const n=window.getComputedStyle(t);if(n.overflowY==="auto"||n.overflowY==="scroll")return t;t=t.parentElement}return window};function vf({itemCount:e,enabled:t=!0,estimateRowHeight:n=72,overscan:r=6,minItems:s=80}={}){const a=o.useRef(null),i=o.useRef(n),[c,u]=o.useState({top:0,scrollTop:0,viewport:Yj(),rowHeight:n});o.useEffect(()=>{if(!t)return;const N=a.current;if(!N||typeof window>"u"||typeof ResizeObserver>"u")return;const j=Qj(N)||window,m=()=>{const b=N.getBoundingClientRect(),E=j===window?window.scrollY||0:j.scrollTop||0,A=j===window?{top:0}:j.getBoundingClientRect(),I=j===window?b.top+(window.scrollY||0):b.top-A.top+E,B=j===window?window.innerHeight||800:j.clientHeight||800;u(T=>T.top===I&&T.scrollTop===E&&T.viewport===B&&T.rowHeight===i.current?T:{top:I,scrollTop:E,viewport:B,rowHeight:i.current})};m();const p=new ResizeObserver(()=>m());p.observe(N),window.addEventListener("resize",m);let g=!1;const w=()=>{g||(g=!0,window.requestAnimationFrame(()=>{g=!1;const b=j===window?window.scrollY||0:j.scrollTop||0;u(E=>E.scrollTop===b&&E.rowHeight===i.current?E:{...E,scrollTop:b,rowHeight:i.current})}))};return j.addEventListener("scroll",w,{passive:!0}),()=>{p.disconnect(),window.removeEventListener("resize",m),j.removeEventListener("scroll",w)}},[t]),o.useEffect(()=>{if(!t||typeof window>"u")return;let N=0;const j=()=>{const m=a.current;if(!m)return;const p=m.querySelector('[data-virtual-row="true"]');if(!p)return;const g=p.getBoundingClientRect(),w=Math.max(24,Math.round(g.height||0));w&&Math.abs(w-i.current)>2&&(i.current=w,u(b=>({...b,rowHeight:w})))};return N=window.requestAnimationFrame(j),()=>{N&&window.cancelAnimationFrame(N)}},[t,e,c.scrollTop]);const d=!!(t&&e>s),{startIndex:h,endIndex:v,topSpacer:y,bottomSpacer:x}=o.useMemo(()=>{if(!d)return{startIndex:0,endIndex:e,topSpacer:0,bottomSpacer:0};const N=c.rowHeight||n,j=Math.max(0,c.scrollTop-c.top),m=Math.max(0,Math.floor(j/N)-r),p=Math.min(e,Math.ceil((j+c.viewport)/N)+r);return{startIndex:m,endIndex:p,topSpacer:m*N,bottomSpacer:Math.max(0,(e-p)*N)}},[e,c,r,n,d]),k=v>=e-Math.max(6,r*2);return{containerRef:a,startIndex:h,endIndex:v,topSpacer:y,bottomSpacer:x,virtualized:d,isNearEnd:k}}const qj={contentVisibility:"auto",containIntrinsicSize:"240px 120px"},Xj=o.memo(function({tag:t,category:n,count:r,isCollected:s,onSelectTag:a,addToCollection:i,removeFromCollection:c,setStatus:u}){const d=o.useCallback(()=>{const h=String(t||"");if(a){a(h),u(`Added: ${h}`);return}s?(c(h),u(`Removed: ${h}`)):(i(h),u(`Added: ${h}`))},[i,s,a,c,u,t]);return l.jsx("div",{className:"tag-library-row",role:"listitem",style:qj,"data-virtual-row":"true",children:l.jsxs("button",{type:"button",className:`composer-alias-item tag-library-item ${!a&&s?"is-collected":""}`,onClick:d,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name tag-library-name",children:l.jsx("code",{className:"tag-library-code",children:t})}),n?l.jsx("span",{className:"composer-alias-category",children:gn(n)}):null]}),l.jsx("div",{className:"composer-alias-token",children:Number(r||0).toLocaleString()})]})})});function Jj(e){var n,r;const t=String(e||"");if(!t)return!1;try{return(r=(n=navigator.clipboard)==null?void 0:n.writeText)==null||r.call(n,t),!0}catch{return!1}}function Gm({open:e,onClose:t,onSelectTag:n,initialQuery:r="",title:s="Tag library",contextTitle:a="",contextToken:i="",contextText:c="",contextTagCount:u=null,inline:d=!1}){const[h,v]=o.useState(r||""),[y,x]=o.useState(""),[k,N]=o.useState("count"),[j,m]=o.useState(""),[p,g]=o.useState([]),[w,b]=o.useState([]),[E,A]=o.useState(0),[I,B]=o.useState(0),[T,$]=o.useState(!1),[ee,Z]=o.useState(!1),[le,Ce]=o.useState(""),[me,oe]=o.useState(""),R=o.useRef(null),P=o.useRef(null),M=o.useRef(new Map),L=o.useRef(new Map),[W,q]=o.useState([]),[de,fe]=o.useState(!1),[ne,xe]=o.useState(null),[G,O]=o.useState(null),H=o.useRef(null),we=o.useRef(null),he=o.useRef(null),Me=o.useRef(null),Re=o.useRef(null),Fe=w.length<E,Oe=d||e,{containerRef:Ze,startIndex:re,endIndex:_e,topSpacer:Y,bottomSpacer:Ie,virtualized:te,isNearEnd:Ne}=vf({itemCount:w.length,enabled:Oe,estimateRowHeight:74,overscan:8,minItems:90}),ge=te?w.slice(re,_e):w,ve=o.useMemo(()=>W.join(", "),[W]),ye=o.useMemo(()=>new Set(W.map(U=>U.toLowerCase())),[W]),Ae=o.useMemo(()=>{const U=Number.parseInt(String(j||""),10);return Number.isFinite(U)&&U>0?U:0},[j]),Q=o.useCallback((U,ce,je,Pe,z,V)=>[U||"",ce||"",je||"",String(Pe||0),String(z||0),String(V||0)].join("::"),[]),Ke=o.useCallback(()=>{const U=M.current;if(U.size<=50)return;const ce=Array.from(U.entries());ce.sort((je,Pe)=>{var z,V;return(((z=je[1])==null?void 0:z.ts)||0)-(((V=Pe[1])==null?void 0:V.ts)||0)}),ce.slice(0,Math.max(0,ce.length-50)).forEach(([je])=>U.delete(je))},[]),et=o.useCallback(U=>{const ce=String(U||"").trim();ce&&q(je=>new Set(je.map(z=>z.toLowerCase())).has(ce.toLowerCase())?je:[...je,ce])},[]),Xe=o.useCallback(U=>{const ce=String(U||"").trim().toLowerCase();ce&&q(je=>je.filter(Pe=>Pe.toLowerCase()!==ce))},[]),ut=o.useCallback(()=>{q([]),oe("Cleared collected tags.")},[]),D=o.useCallback(()=>{var ce,je;if(!W.length){oe("No tags to copy.");return}if(Jj(ve)){oe(`Copied ${W.length} tag${W.length===1?"":"s"}.`);return}const U=he.current;if(U)try{U.value=ve,U.removeAttribute("readonly"),U.select(),U.setSelectionRange(0,ve.length);const Pe=document.execCommand&&document.execCommand("copy");if(U.setAttribute("readonly","readonly"),(je=(ce=window.getSelection())==null?void 0:ce.removeAllRanges)==null||je.call(ce),Pe){oe(`Copied ${W.length} tag${W.length===1?"":"s"}.`);return}}catch{}oe("Copy not available on this browser.")},[W,ve]),X=o.useCallback((U,ce)=>{q(je=>{const Pe=[...je],[z]=Pe.splice(U,1);return Pe.splice(ce,0,z),Pe})},[]);o.useCallback((U,ce)=>{xe(ce),Me.current=U.target,U.dataTransfer.effectAllowed="move",U.dataTransfer.setData("text/plain",ce.toString()),requestAnimationFrame(()=>{Me.current&&Me.current.classList.add("is-dragging")})},[]),o.useCallback(()=>{Me.current&&Me.current.classList.remove("is-dragging"),ne!==null&&G!==null&&ne!==G&&X(ne,G),xe(null),O(null),Me.current=null},[ne,G,X]),o.useCallback((U,ce)=>{U.preventDefault(),U.dataTransfer.dropEffect="move",O(ce)},[]),o.useCallback(()=>{},[]),o.useCallback((U,ce)=>{const je=U.touches[0];Re.current={idx:ce,startX:je.clientX,startY:je.clientY,moved:!1}},[]),o.useCallback(U=>{if(!Re.current)return;const ce=U.touches[0],je=Math.abs(ce.clientX-Re.current.startX),Pe=Math.abs(ce.clientY-Re.current.startY);if(je>10||Pe>10){Re.current.moved=!0,xe(Re.current.idx),U.preventDefault();const z=document.querySelectorAll(".tag-collection-chip"),V=ce.clientX,ae=ce.clientY;for(let ie=0;ie<z.length;ie++){const Se=z[ie].getBoundingClientRect();if(V>=Se.left&&V<=Se.right&&ae>=Se.top&&ae<=Se.bottom){O(ie);break}}}},[]),o.useCallback(()=>{var U;(U=Re.current)!=null&&U.moved&&ne!==null&&G!==null&&ne!==G&&X(ne,G),Re.current=null,xe(null),O(null)},[ne,G,X]);const ke=o.useCallback(async({nextQuery:U,nextCategory:ce,nextSort:je,nextMinCount:Pe}={})=>{var Kt;const z=typeof U=="string"?U:h,V=typeof ce=="string"?ce:y,ae=typeof je=="string"?je:k,ie=typeof Pe=="number"?Pe:Ae,Se=Q(z,V,ae,ie,80,0),Te=Date.now(),lt=M.current.get(Se);if(lt&&Te-lt.ts<5*60*1e3){b(lt.items||[]),A(Number(lt.total||0)),B(0),Ce(""),oe(""),$(!1);return}const nt=L.current.get(Se);if(nt){try{const bt=await nt;b((bt==null?void 0:bt.items)||[]),A(Number((bt==null?void 0:bt.total)||0)),B(0),Ce(""),oe("")}catch{}return}$(!0),Ce(""),oe(""),B(0),R.current&&R.current.key!==Se&&R.current.controller.abort();const At=new AbortController;R.current={controller:At,key:Se};try{const bt=cr({q:z,category:V,sort:ae,minCount:ie,limit:80,offset:0},{signal:At.signal});L.current.set(Se,bt);const ot=await bt;M.current.set(Se,{items:(ot==null?void 0:ot.items)||[],total:Number((ot==null?void 0:ot.total)||0),ts:Date.now()}),Ke(),b((ot==null?void 0:ot.items)||[]),A(Number((ot==null?void 0:ot.total)||0))}catch(bt){if((bt==null?void 0:bt.name)==="AbortError")return;console.error("Failed to search tags",bt),Ce("Unable to load tags right now."),b([]),A(0)}finally{L.current.delete(Se),((Kt=R.current)==null?void 0:Kt.key)===Se&&(R.current=null),$(!1)}},[Q,y,Ae,h,k,Ke]),ze=o.useCallback(async()=>{var ae;if(T||ee||!Fe)return;const U=I+80,ce=Q(h,y,k,Ae,80,U),je=Date.now(),Pe=M.current.get(ce);if(Pe&&je-Pe.ts<5*60*1e3){b(ie=>[...ie,...Pe.items||[]]),A(Number(Pe.total||0)),B(U),Z(!1);return}const z=L.current.get(ce);if(z){try{const ie=await z,Se=(ie==null?void 0:ie.items)||[];b(Te=>[...Te,...Se]),A(Number((ie==null?void 0:ie.total)||0)),B(U)}catch{}return}Z(!0),Ce(""),P.current&&P.current.key!==ce&&P.current.controller.abort();const V=new AbortController;P.current={controller:V,key:ce};try{const ie=cr({q:h,category:y,sort:k,minCount:Ae,limit:80,offset:U},{signal:V.signal});L.current.set(ce,ie);const Se=await ie,Te=(Se==null?void 0:Se.items)||[];M.current.set(ce,{items:Te,total:Number((Se==null?void 0:Se.total)||0),ts:Date.now()}),Ke(),b(lt=>[...lt,...Te]),A(Number((Se==null?void 0:Se.total)||0)),B(U)}catch(ie){if((ie==null?void 0:ie.name)==="AbortError")return;console.error("Failed to load more tags",ie),Ce("Unable to load more tags.")}finally{L.current.delete(ce),((ae=P.current)==null?void 0:ae.key)===ce&&(P.current=null),Z(!1)}},[Q,Fe,y,T,ee,Ae,I,h,k,Ke]);o.useEffect(()=>{if(!Oe)return;Ce(""),oe("");let U=!1;return(async()=>{try{const ce=await of();if(U)return;g(Array.isArray(ce==null?void 0:ce.categories)?ce.categories:[])}catch(ce){console.error("Failed to load tag categories",ce),U||g([])}})(),()=>{U=!0}},[Oe]),o.useEffect(()=>{Oe&&(v(r||""),x(""),N("count"),m(""),b([]),A(0),B(0),$(!1),Z(!1),Ce(""),oe(""),q([]))},[r,Oe]),o.useEffect(()=>{if(!Oe)return;const U=window.setTimeout(()=>{ke()},220);return()=>window.clearTimeout(U)},[y,Oe,Ae,h,ke,k]),o.useEffect(()=>()=>{var U,ce,je,Pe;R.current&&((ce=(U=R.current.controller)==null?void 0:U.abort)==null||ce.call(U)),P.current&&((Pe=(je=P.current.controller)==null?void 0:je.abort)==null||Pe.call(je))},[]),o.useEffect(()=>{if(!Oe||te)return;const U=H.current;if(!U||typeof IntersectionObserver>"u")return;const ce=new IntersectionObserver(je=>{const Pe=je[0];Pe!=null&&Pe.isIntersecting&&ze()},{threshold:.1});return ce.observe(U),()=>ce.disconnect()},[Oe,ze]),o.useEffect(()=>{te&&(!Fe||T||ee||Ne&&ze())},[te,Fe,T,ee,Ne,ze]);const $e=o.useMemo(()=>d?null:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(K,{variant:"muted",className:"w-full",onClick:t,children:"Done"}),l.jsx(K,{variant:"ghost",className:"w-full",onClick:()=>ke(),disabled:T||ee,children:l.jsxs("span",{className:"inline-flex items-center gap-2",children:[l.jsx(Ki,{size:14}),"Refresh"]})})]}),[d,T,ee,t,ke]),Ge=!!(n&&(a||i||c)),rt=Number.isFinite(u)?`${u} tags`:"",qe=l.jsxs("div",{className:`sheet-stack ${d?"ui-card":""}`,children:[Ge?l.jsxs("div",{className:"tag-library-context",children:[l.jsxs("div",{className:"tag-library-context-head",children:[l.jsxs("div",{className:"min-w-0",children:[l.jsx("div",{className:"sheet-label",children:"Adding to alias"}),l.jsx("div",{className:"tag-library-context-title",children:a||"Alias"}),i?l.jsx("div",{className:"tag-library-context-token",children:i}):null]}),l.jsx(K,{size:"xs",variant:"muted",onClick:t,children:"Back"})]}),l.jsx("div",{className:"tag-library-context-preview",children:c||""}),rt?l.jsx("div",{className:"tag-library-context-meta",children:rt}):null]}):null,l.jsxs("div",{className:"sheet-section",children:[d?null:l.jsx("div",{className:"sheet-label",children:"Browse"}),l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:we,type:"search",value:h,onChange:U=>v(U.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>v(""),disabled:!h,children:"Clear"})]}),l.jsx(ct,{value:y,onChange:x,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...p.map(U=>({value:U.key,label:`${gn(U.key)} (${Number(U.actual||U.count||0).toLocaleString()})`}))]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(ct,{value:k,onChange:N,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"tag-library-min-count",children:"Minimum count"}),l.jsx("input",{id:"tag-library-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:j,onChange:U=>{const ce=U.target.value;(ce===""||Number(ce)>=0)&&m(ce)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),me?l.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:me}):null,le?l.jsx("div",{className:"text-xs text-[#FF8F70]",children:le}):null]}),l.jsx("div",{className:"composer-alias-list tag-library-grid",role:"list",ref:Ze,children:T?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):w.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[te&&Y>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Y}px`}}):null,ge.map(U=>l.jsx(Xj,{tag:U.tag,category:U.category,count:U.count,isCollected:ye.has(String(U.tag||"").toLowerCase()),onSelectTag:n,addToCollection:et,removeFromCollection:Xe,setStatus:oe},`${U.tag}-${U.category}`)),te&&Ie>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Ie}px`}}):null,te?null:l.jsx("div",{ref:H,className:"composer-sentinel"}),ee?l.jsx("div",{className:"composer-alias-empty",children:"Loading more"}):null]})})]});return Oe?d?l.jsxs("section",{className:"tag-library-surface",children:[s?l.jsx("div",{className:"sheet-label tag-library-page-title",children:s}):null,qe,n?null:l.jsxs("div",{className:"tag-collection-bar","aria-live":"polite",children:[l.jsxs("div",{className:"tag-collection-bar-main",children:[l.jsx("div",{className:"tag-collection-bar-title",children:"Tags"}),l.jsx("div",{className:"tag-collection-bar-count","aria-live":"polite",children:W.length===0?"No tags selected":`${W.length} selected`})]}),l.jsx(K,{size:"icon",variant:"ghost",onClick:()=>fe(!0),"aria-label":"Manage collected tags",children:l.jsx(OS,{size:16})}),l.jsx("textarea",{ref:he,value:ve,onChange:U=>{const ce=U.target.value.split(",").map(z=>z.trim()).filter(Boolean),je=new Set,Pe=[];ce.forEach(z=>{const V=z.toLowerCase();je.has(V)||(je.add(V),Pe.push(z))}),q(Pe)},className:"sr-only","aria-label":"Collected tags text"})]}),n?null:l.jsx(Wt,{open:de,onClose:()=>fe(!1),title:"Collected tags",variant:"sheet",shouldCloseOnOverlayClick:!0,children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsxs("div",{className:"sheet-label",children:["Tags (",W.length,")"]}),l.jsxs("div",{className:"tag-collection-codeblock",children:[l.jsx("pre",{className:"tag-collection-pre",children:ve||""}),l.jsx(K,{size:"icon",variant:"ghost",className:"absolute top-2 right-2",onClick:D,disabled:W.length===0,"aria-label":"Copy collected tags",children:l.jsx(DS,{size:16})}),l.jsx("textarea",{ref:he,value:ve,readOnly:!0,className:"sr-only","aria-label":"Collected tags text"})]}),W.length?l.jsx("div",{className:"tag-collection-chips",children:W.map((U,ce)=>l.jsxs("span",{className:"ui-chip is-accent is-clickable tag-collection-chip",onClick:()=>Xe(U),role:"button",tabIndex:0,onKeyDown:je=>{je.target===je.currentTarget&&(je.key==="Enter"||je.key===" ")&&(je.preventDefault(),Xe(U))},children:[l.jsx("code",{className:"ui-chip-code",children:U}),l.jsx(K,{size:"mini",variant:"danger","aria-label":`Remove ${U}`,onClick:je=>{je.stopPropagation(),Xe(U)},children:l.jsx(os,{size:12})})]},`${U}-${ce}`))}):l.jsx("div",{className:"sheet-hint",children:"No tags collected yet."})]}),l.jsxs("div",{className:"sheet-section flex gap-2",children:[l.jsx(K,{variant:"muted",className:"w-full",onClick:()=>fe(!1),children:"Close"}),l.jsx(K,{variant:"ghost",className:"w-full",onClick:ut,disabled:W.length===0,children:"Clear"})]})]})})]}):l.jsx(Wt,{open:e,onClose:t,title:s,variant:"fullscreen",contentClassName:"tag-library-sheet",footer:$e,shouldCloseOnOverlayClick:!1,children:qe}):null}function Zj({inline:e=!1}){const t=Ir(),[n]=lf(),r=n.get("q")||"",s=o.useMemo(()=>r?`Tag Library  ${r}`:"Tag Library",[r]);return e?l.jsx(Gm,{inline:!0,initialQuery:r,title:"",onSelectTag:null}):l.jsxs("div",{className:"page-shell page-stack",children:[l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:s}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx(K,{size:"xs",onClick:()=>t("/library?tab=aliases"),children:"Aliases"}),l.jsx(K,{size:"xs",onClick:()=>t("/compose"),children:"Composer"})]})]}),l.jsx(Gm,{inline:!0,initialQuery:r,title:"Browse",onSelectTag:null})]})}function e1(e,t=!1){const n=()=>typeof window>"u"||!window.matchMedia?t:window.matchMedia(e).matches,[r,s]=o.useState(n);return o.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const a=window.matchMedia(e),i=()=>s(a.matches);return i(),typeof a.addEventListener=="function"?(a.addEventListener("change",i),()=>a.removeEventListener("change",i)):(a.addListener(i),()=>a.removeListener(i))},[e]),r}const To="::",t1=()=>`alias-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,jr=e=>String(e||"").split(",").map(t=>t.trim()).filter(Boolean),ic=e=>(e||[]).map(t=>String(t||"").trim()).filter(Boolean).join(", "),n1=(e,t)=>{const n=String(t||"").trim();if(!n)return String(e||"");const r=jr(e);return new Set(r.map(a=>a.toLowerCase())).has(n.toLowerCase())||r.push(n),ic(r)},r1=(e,t)=>{const n=String(t||"").trim().toLowerCase();if(!n)return String(e||"");const r=jr(e).filter(s=>s.toLowerCase()!==n);return ic(r)},s1=(e,t,n)=>{const r=String(t||"").trim().toLowerCase(),s=String(n||"").trim();if(!r||!s)return String(e||"");const a=jr(e).map(u=>u.toLowerCase()===r?s:u),i=new Set,c=[];return a.forEach(u=>{const d=String(u||"").trim().toLowerCase();!d||i.has(d)||(i.add(d),c.push(u))}),ic(c)},qc=(e,t={})=>Object.entries(ya(e)).map(([n,r],s)=>{const[a,i]=String(n).includes(To)?n.split(To):["",n],c=i||n,u=t[n]||t[c]||a||"";return{id:`existing-${s}-${n}`,name:c,text:r,category:u}}),Ym=e=>{const t={};return e.forEach(n=>{const r=String((n==null?void 0:n.name)||"").trim(),s=typeof(n==null?void 0:n.text)=="string"?n.text.trim():"";if(r&&s){const a=String((n==null?void 0:n.category)||"").trim(),i=a?`${a}${To}${r}`:r;t[i]=s}}),t},Qm=e=>{const t={};return e.forEach(n=>{const r=String((n==null?void 0:n.name)||"").trim(),s=typeof(n==null?void 0:n.category)=="string"?n.category.trim():"";if(r){const a=s?`${s}${To}${r}`:r;t[a]=s}}),t},l1={contentVisibility:"auto",containIntrinsicSize:"240px 120px"};function a1({inline:e=!1}){var Pe;const t=Ir(),{aliases:n,aliasCategories:r,categoryList:s,loading:a,saving:i,error:c,persistAliases:u}=lv(),[d,h]=o.useState(()=>qc(n,r)),[v,y]=o.useState(()=>Array.isArray(s)?s:[]),[x,k]=o.useState("All"),[N,j]=o.useState("All"),[m,p]=o.useState(""),g=o.useDeferredValue(m),[w,b]=o.useState(""),[E,A]=o.useState(!1),[I,B]=o.useState(!1),[T,$]=o.useState({loading:!1,invalid:[],suggestions:{}}),[ee,Z]=o.useState(!1),[le,Ce]=o.useState(null),[me,oe]=o.useState(""),R=o.useRef(null),P=o.useRef(null),[M,L]=o.useState(!1),[W,q]=o.useState(""),[de,fe]=o.useState(""),ne=e1("(min-width: 1024px)");o.useEffect(()=>{if(M)return;const z=qc(n,r||{});h(z),w&&!z.some(V=>V.id===w)&&(b(""),A(!1))},[r,M]),o.useEffect(()=>{M||Array.isArray(s)&&y(s)},[s,M]),o.useEffect(()=>{if(M)return;const z=qc(n,r||{});h(z),w&&!z.some(V=>V.id===w)&&(b(""),A(!1))},[n,r,w,M]);const xe=o.useMemo(()=>Ym(d),[d]),G=()=>{const z={id:t1(),name:"",text:"",category:""};h(V=>[...V,z]),b(z.id),oe(""),L(!0),A(!0)},O=(z,V,ae)=>{L(!0),h(ie=>ie.map((Se,Te)=>Te===z?{...Se,[V]:ae}:Se))},H=z=>{L(!0),h(V=>{var ie;const ae=V.filter((Se,Te)=>Te!==z);return(ae.length===0||w===((ie=V[z])==null?void 0:ie.id))&&(b(""),A(!1)),ae})},we=async()=>{oe("");try{const z=new Map;if(d.forEach(ae=>{jr((ae==null?void 0:ae.text)||"").forEach(Se=>{const Te=String(Se).toLowerCase();Te&&(z.has(Te)||z.set(Te,{tag:Se,rows:[]}),z.get(Te).rows.push(ae.id))})}),z.size){const ae=Array.from(z.values()).map(ie=>ie.tag);try{const ie=await Wc(ae),Se=Array.isArray(ie==null?void 0:ie.invalid)?ie.invalid:[],Te=new Set(Se.map(lt=>String(lt).toLowerCase()));if(Te.size){const lt=d.map(nt=>{const Kt=jr((nt==null?void 0:nt.text)||"").filter(ot=>Te.has(String(ot).toLowerCase()));if(!Kt.length)return null;const bt=nt.category?`${nt.category}:${nt.name}`:nt.name;return{id:nt.id,token:bt,friendlyName:formatAliasFriendlyName({name:nt.name})||nt.name||"Untitled",category:nt.category||"",invalid:Kt}}).filter(Boolean);Ce({invalid:Se,invalidLower:Array.from(Te),rows:lt,suggestions:(ie==null?void 0:ie.suggestions)||{}}),Z(!0),oe("Fix invalid tags before saving.");return}}catch(ie){console.error("Unable to validate tags",ie),oe("Unable to validate tags right now.");return}}const V=Qm(d);await u({items:xe,categories:V,categoryList:v}),L(!1),oe("Saved.")}catch{oe("Unable to save right now.")}},he=o.useMemo(()=>{const z=g.trim().toLowerCase(),ae=[...d.filter(ie=>{const Se=(ie.category||"").trim();if(x===""&&Se||x!=="All"&&x!==""&&Se!==x)return!1;const Te=fl(ie.name||"",ie.category||"");if(N!=="All"&&Te!==N)return!1;if(!z)return!0;const lt=Se?`${Se}:${ie.name}`:ie.name;return(ie.name||"").toLowerCase().includes(z)||(ie.text||"").toLowerCase().includes(z)||(Se||"").toLowerCase().includes(z)||(lt||"").toLowerCase().includes(z)})];return ae.sort((ie,Se)=>(ie.name||"").localeCompare(Se.name||"")),ae},[d,x,N,g]),{containerRef:Me,startIndex:Re,endIndex:Fe,topSpacer:Oe,bottomSpacer:Ze,virtualized:re}=vf({itemCount:he.length,enabled:!0,estimateRowHeight:86,overscan:8,minItems:120}),_e=re?he.slice(Re,Fe):he,Y=he.find(z=>z.id===w)||d.find(z=>z.id===w)||null,Ie=Y?Y.category?`${Y.category}:${Y.name}`:Y.name||"alias":"",te=Y&&(formatAliasFriendlyName({name:Y.name})||Y.name)||"Alias",Ne=Ie?`$${Ie}$`:"$alias$",ge=he.length?he:d,ve=Y?ge.findIndex(z=>z.id===Y.id):-1,ye=ve>0?ge[ve-1]:null,Ae=ve>=0&&ve<ge.length-1?ge[ve+1]:null,Q=z=>{z&&(b(z.id),A(!0),oe(""))},Ke=o.useMemo(()=>{const z=new Set(v||[]);return d.forEach(V=>{V.category&&z.add(V.category)}),Array.from(z).sort((V,ae)=>Xt(V).localeCompare(Xt(ae)))},[d,v]),et=o.useMemo(()=>{const z=new Set;return d.forEach(V=>{const ae=(V.category||"").trim();if(x===""&&ae||x!=="All"&&x!==""&&ae!==x)return;const ie=fl(V.name||"",V.category||"");ie&&z.add(ie)}),Array.from(z).sort((V,ae)=>V.localeCompare(ae))},[d,x]);o.useEffect(()=>{N!=="All"&&(et.includes(N)||j("All"))},[et,N]),o.useEffect(()=>{fe("")},[w]);const Xe=o.useMemo(()=>jr((Y==null?void 0:Y.text)||""),[Y==null?void 0:Y.text]),ut=o.useMemo(()=>{const z=Array.isArray(T==null?void 0:T.invalid)?T.invalid:[];return new Set(z.map(V=>String(V).toLowerCase()))},[T]);o.useEffect(()=>{if(!Y||!(E||ne))return;const z=Xe,V=[],ae=new Set;if(z.forEach(Te=>{const lt=String(Te).toLowerCase();!lt||ae.has(lt)||(ae.add(lt),V.push(Te))}),!V.length){$({loading:!1,invalid:[],suggestions:{}});return}let ie=!1;const Se=window.setTimeout(async()=>{$(Te=>({...Te,loading:!0}));try{const Te=await Wc(V);if(ie)return;$({loading:!1,invalid:Array.isArray(Te==null?void 0:Te.invalid)?Te.invalid:[],suggestions:(Te==null?void 0:Te.suggestions)||{}})}catch(Te){console.error("Failed to validate tags",Te),ie||$({loading:!1,invalid:[],suggestions:{}})}},260);return()=>{ie=!0,window.clearTimeout(Se)}},[E,ne,Y,Xe]);const D=z=>{var ae,ie;const V=String(z||"");if(!V)return!1;try{return(ie=(ae=navigator.clipboard)==null?void 0:ae.writeText)==null||ie.call(ae,V),!0}catch{return!1}},X=(z="")=>{const V=new URLSearchParams;V.set("tab","tags"),z&&V.set("q",z),t(`/library?${V.toString()}`)},ke=()=>{var ie;if(!Y)return;const z=jr(de);if(!z.length){oe("Enter a tag to add.");return}const V=d.findIndex(Se=>Se.id===Y.id);if(V===-1)return;let ae=((ie=d[V])==null?void 0:ie.text)||"";z.forEach(Se=>{ae=n1(ae,Se)}),O(V,"text",ae),fe(""),oe(`Added ${z.length} tag${z.length===1?"":"s"}.`)},ze=async()=>{const z=W.trim();if(!z){oe("Enter a category name.");return}const V=Array.from(new Set([...v||[],z]));y(V),q(""),oe("Category added.");const ae=Ym(d),ie=Qm(d);L(!0);try{await u({items:ae,categories:ie,categoryList:V}),L(!1),oe("Category saved.")}catch{oe("Unable to save right now.")}},$e=o.useCallback(z=>{z&&(b(z.id),A(!0),oe(""))},[]),Ge=o.useMemo(()=>{const z=new Map;return d.forEach(V=>{V!=null&&V.id&&z.set(V.id,V)}),z},[d]),rt=o.useCallback(z=>{const V=Ge.get(z);V&&$e(V)},[$e,Ge]),qe=()=>{ne&&b(""),A(!1),oe("")};o.useMemo(()=>{const z=d.length,V=he.length;return a&&z===0?"Loading":z===V?`${z} aliases`:`${V} of ${z} aliases`},[d.length,he.length,a]),o.useEffect(()=>{const z=V=>{var nt,At;if(V.defaultPrevented)return;const ae=V.target,ie=(ae==null?void 0:ae.tagName)||"",Se=["INPUT","TEXTAREA","SELECT"].includes(ie)||(ae==null?void 0:ae.isContentEditable),Te=String(V.key||"").toLowerCase(),lt=V.metaKey||V.ctrlKey;if(lt&&Te==="s"){V.preventDefault(),M&&!i&&we();return}if(lt&&Te==="n"){V.preventDefault(),G();return}if(!Se&&Te==="/"){V.preventDefault(),(At=(nt=P.current)==null?void 0:nt.focus)==null||At.call(nt);return}Te==="escape"&&E&&!ne&&(V.preventDefault(),qe())};return window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)},[G,qe,M,E,we,ne,i]);const U=l.jsxs("div",{className:"flex gap-2",children:[l.jsx(K,{variant:"muted",className:"w-full",onClick:qe,children:ne?"Clear selection":"Close"}),l.jsx(K,{variant:"primary",className:"w-full",onClick:we,disabled:i||!M,children:i?"Saving":M?"Save":"Saved"})]}),ce=Y?l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"alias-editor-toolbar",children:[l.jsxs("div",{className:"alias-editor-heading",children:[l.jsx("div",{className:"alias-editor-title",children:te}),l.jsx("div",{className:"alias-editor-meta",children:Ne})]}),l.jsxs("div",{className:"alias-editor-actions",children:[l.jsx(K,{size:"xs",variant:"muted",onClick:()=>Q(ye),disabled:!ye,title:"Previous alias",children:"Prev"}),l.jsx(K,{size:"xs",variant:"muted",onClick:()=>Q(Ae),disabled:!Ae,title:"Next alias",children:"Next"}),l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>{Ie&&D(Ne)?oe("Token copied."):oe("Copy not available on this browser.")},title:"Copy token",children:"Copy token"})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Token"}),l.jsx("div",{className:"composer-token",children:Ne}),fl(Y.name||"",Y.category||"")?l.jsxs("div",{className:"sheet-hint",children:["Subcategory: ",gn(fl(Y.name||"",Y.category||""))]}):null]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Friendly name"}),l.jsx("div",{className:"composer-field",children:te})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Alias name"}),l.jsx("input",{ref:R,type:"text",value:Y.name||"",onChange:z=>{const V=d.findIndex(ae=>ae.id===Y.id);V!==-1&&O(V,"name",z.target.value)},placeholder:"e.g. cherry_fruit",className:"sheet-input ui-control ui-input"})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Category"}),l.jsx(ct,{value:Y.category||"",onChange:z=>{const V=d.findIndex(ae=>ae.id===Y.id);V!==-1&&O(V,"category",z)},size:"sm",searchThreshold:0,options:[{value:"",label:"Uncategorized"},...Ke.filter(Boolean).map(z=>({value:z,label:Xt(z)}))]}),l.jsx(K,{size:"xs",variant:"muted",onClick:()=>B(!0),children:"Manage categories"})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Expands to"}),l.jsx("textarea",{value:Y.text,onChange:z=>{const V=d.findIndex(ae=>ae.id===Y.id);V!==-1&&O(V,"text",z.target.value)},placeholder:"Prompt text for this alias",className:"sheet-textarea ui-control ui-textarea is-compact",rows:6}),l.jsxs("div",{className:"tag-quick-add",children:[l.jsx("input",{type:"text",value:de,onChange:z=>fe(z.target.value),onKeyDown:z=>{z.key==="Enter"&&(z.preventDefault(),ke())},placeholder:"Add tags (comma separated)",className:"ui-control ui-input tag-quick-input","aria-label":"Add tags"}),l.jsx(K,{size:"sm",variant:"primary",onClick:ke,disabled:!de.trim(),children:"Add"})]}),l.jsxs("div",{className:"tag-editor-actions",children:[l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>X(""),children:l.jsxs("span",{className:"inline-flex items-center gap-2",children:[l.jsx(ec,{size:14}),"Open tag library"]})}),l.jsx(K,{size:"xs",variant:"muted",onClick:()=>{$(V=>({...V,loading:!0}));const z=jr(Y.text||"");Wc(z).then(V=>{$({loading:!1,invalid:Array.isArray(V==null?void 0:V.invalid)?V.invalid:[],suggestions:(V==null?void 0:V.suggestions)||{}})}).catch(()=>$({loading:!1,invalid:[],suggestions:{}}))},disabled:T.loading,title:"Validate against danbooru_tags.md",children:T.loading?"Validating":"Validate"})]}),Xe.length?l.jsx("div",{className:"tag-chip-list","aria-label":"Alias tags",children:Xe.map(z=>{const V=ut.has(String(z).toLowerCase());return l.jsxs("span",{className:`ui-chip ${V?"is-invalid":""}`,children:[l.jsx("code",{className:"ui-chip-code",children:z}),l.jsx(K,{size:"mini",variant:"danger",onClick:()=>{const ae=d.findIndex(ie=>ie.id===Y.id);ae!==-1&&O(ae,"text",r1(Y.text||"",z))},"aria-label":`Remove ${z}`,title:"Remove",children:l.jsx(os,{size:12})})]},z)})}):l.jsx("div",{className:"sheet-hint",children:"Tip: Use the Tag library to add validated tags quickly."}),!T.loading&&Array.isArray(T.invalid)&&T.invalid.length?l.jsxs("div",{className:"tag-invalid-panel",role:"alert",children:[l.jsxs("div",{className:"tag-invalid-title",children:["Invalid tags (",T.invalid.length,")"]}),l.jsx("div",{className:"tag-invalid-body",children:T.invalid.map(z=>{var ae;const V=((ae=T==null?void 0:T.suggestions)==null?void 0:ae[z])||[];return l.jsxs("div",{className:"tag-invalid-row",children:[l.jsxs("div",{className:"tag-invalid-tag",children:[l.jsx("code",{children:z}),l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>X(z),children:"Find"})]}),Array.isArray(V)&&V.length?l.jsx("div",{className:"tag-invalid-suggestions",children:V.slice(0,6).map(ie=>l.jsx(K,{size:"xs",variant:"chip",onClick:()=>{const Se=d.findIndex(Te=>Te.id===Y.id);Se!==-1&&O(Se,"text",s1(Y.text||"",z,ie))},title:`Replace ${z} with ${ie}`,children:ie},`${z}-${ie}`))}):l.jsx("div",{className:"sheet-hint",children:"No suggestions found for this tag."})]},z)})})]}):null]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx(K,{variant:"danger",onClick:()=>{const z=d.findIndex(V=>V.id===Y.id);z!==-1&&(H(z),A(!1))},children:"Delete alias"}),l.jsx("div",{className:"sheet-hint",children:"Deleting removes it from your library. Use Save changes to persist."})]})]}):l.jsx("div",{className:"alias-editor-empty",children:"Select an alias to edit, or create a new one."}),je=e?"page-stack alias-page":"page-shell page-stack alias-page";return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:je,children:[e?null:l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Aliases"}),l.jsxs("div",{className:"page-bar-actions",children:[l.jsx(K,{size:"xs",onClick:()=>X(m||""),title:"Browse danbooru tags",children:"Tags"}),l.jsx(K,{size:"xs",variant:"primary",onClick:G,children:"Add"})]})]}),l.jsx("div",{className:"library-toolbar screen-sticky",children:l.jsxs("div",{className:"library-toolbar-inner",children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:P,type:"search",value:m,onChange:z=>p(z.target.value),className:"composer-search ui-control ui-input",placeholder:"Search aliases","aria-label":"Search aliases"}),l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>p(""),disabled:!m,children:"Clear"})]}),l.jsx(ct,{wrapperClassName:"composer-subcategory-select",value:x,onChange:k,"aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"All",label:"Category: All"},{value:"",label:"Uncategorized"},...Ke.filter(Boolean).map(z=>({value:z,label:Xt(z)}))]}),l.jsx(ct,{wrapperClassName:"composer-subcategory-select",value:N,onChange:j,"aria-label":"Filter by subcategory",size:"sm",searchThreshold:0,options:[{value:"All",label:"Subcategory: All"},...et.map(z=>({value:z,label:gn(z)}))]}),e?l.jsx(K,{size:"sm",variant:"primary",onClick:G,children:"Add alias"}):null,M?l.jsx(K,{size:"sm",variant:"primary",onClick:we,disabled:i,children:i?"Saving":"Save changes"}):null]}),c?l.jsx("div",{className:"library-toolbar-status is-error",children:"Could not load aliases. Try again later."}):null,me?l.jsx("div",{className:"library-toolbar-status",children:me}):null]})}),l.jsxs("div",{className:"alias-layout",children:[l.jsx("div",{className:"alias-list",children:d.length===0&&!a?l.jsx("section",{className:"ui-panel text-center py-16",children:l.jsx("p",{className:"text-base text-[rgba(159,178,215,0.8)]",children:"No aliases yet. Add your first one."})}):l.jsxs("div",{className:"composer-alias-list",role:"list",ref:Me,children:[he.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases match your filters."}):null,re&&Oe>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Oe}px`}}):null,_e.map(z=>l.jsx(iv,{id:z.id,name:z.name,category:(z.category||"").trim(),text:z.text||"",isSelected:w===z.id,onOpen:rt,visibilityStyle:l1},z.id)),re&&Ze>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Ze}px`}}):null]})}),l.jsx("aside",{className:"alias-editor-panel",children:l.jsxs("div",{className:"alias-editor-card ui-panel",children:[ce,Y?l.jsx("div",{className:"alias-editor-footer",children:U}):null]})})]})]}),l.jsx(Wt,{open:E&&!!Y&&!ne,onClose:qe,title:"Alias",variant:"fullscreen",footer:U,children:ce}),l.jsx(Wt,{open:I,onClose:()=>{B(!1),q(""),oe("")},title:"Categories",variant:"sheet",footer:l.jsx("div",{className:"sheet-hint",children:"Categories help you organize aliases and improve the Insert alias picker."}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Add category"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:W,onChange:z=>q(z.target.value),placeholder:"e.g. styles",className:"sheet-input ui-control ui-input"}),l.jsx(K,{size:"sm",variant:"primary",onClick:ze,children:"Add"})]})]}),l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Existing"}),Ke.length===0?l.jsx("div",{className:"sheet-hint",children:"No categories yet."}):l.jsx(ct,{value:"",onChange:z=>{z&&(k(z),B(!1))},size:"sm",searchThreshold:0,placeholder:"Select a category",options:Ke.filter(Boolean).map(z=>({value:z,label:Xt(z)}))})]})]})}),l.jsx(Wt,{open:ee,onClose:()=>Z(!1),title:"Fix invalid tags",variant:"fullscreen",footer:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(K,{variant:"muted",className:"w-full",onClick:()=>Z(!1),children:"Close"}),l.jsx(K,{variant:"primary",className:"w-full",onClick:()=>{const z=new Set(((le==null?void 0:le.invalidLower)||[]).map(V=>String(V).toLowerCase()));if(!z.size){Z(!1);return}h(V=>V.map(ae=>{const Se=jr((ae==null?void 0:ae.text)||"").filter(lt=>!z.has(String(lt).toLowerCase())),Te=ic(Se);return Te===((ae==null?void 0:ae.text)||"")?ae:{...ae,text:Te}})),L(!0),Z(!1),oe("Removed invalid tags. Review and save again.")},children:"Remove invalid tags"})]}),children:l.jsxs("div",{className:"sheet-stack",children:[l.jsx("div",{className:"sheet-section",children:l.jsxs("div",{className:"sheet-hint",children:["These aliases contain tags not found in ",l.jsx("code",{className:"font-mono",children:"danbooru_tags.md"}),". Fix them before saving."]})}),(Pe=le==null?void 0:le.rows)!=null&&Pe.length?l.jsxs("div",{className:"sheet-section",children:[l.jsx("div",{className:"sheet-label",children:"Aliases with issues"}),l.jsx("div",{className:"composer-alias-list",role:"list",children:le.rows.map(z=>l.jsxs("button",{type:"button",role:"listitem",className:"composer-alias-item",onClick:()=>{b(z.id),A(!0),Z(!1)},children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:z.friendlyName}),z.category?l.jsx("span",{className:"composer-alias-category",children:Xt(z.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",z.token,"$"]}),l.jsx("div",{className:"tag-invalid-inline",children:z.invalid.map(V=>l.jsx("span",{className:"ui-chip is-invalid",children:l.jsx("code",{className:"ui-chip-code",children:V})},`${z.id}-${V}`))})]},z.id))})]}):null]})})]})}const cv="cozygen_library_tab",i1=new Set(["tags","aliases"]),uv=e=>i1.has(e)?e:"",o1=()=>{if(typeof window>"u")return"";try{return uv(window.localStorage.getItem(cv)||"")}catch{return""}};function c1(){const[e,t]=lf(),n=uv(e.get("tab")),[r,s]=o.useState(()=>{const i=o1();return n||i||"tags"}),a=o.useMemo(()=>[{key:"tags",label:"Tags"},{key:"aliases",label:"Aliases"}],[]);return o.useEffect(()=>{n&&n!==r&&s(n)},[r,n]),o.useEffect(()=>{try{typeof window<"u"&&window.localStorage.setItem(cv,r)}catch{}if(n!==r){const i=new URLSearchParams(e);i.set("tab",r),t(i,{replace:!0})}},[r,n,e,t]),l.jsxs("div",{className:"page-shell page-stack",children:[l.jsxs("div",{className:"page-bar",children:[l.jsx("h1",{className:"page-bar-title",children:"Library"}),l.jsx("div",{className:"page-bar-actions",children:l.jsx(fr,{ariaLabel:"Library tabs",value:r,onChange:s,items:a,size:"sm",layout:"auto"})})]}),r==="tags"?l.jsx(Zj,{inline:!0}):null,r==="aliases"?l.jsx(a1,{inline:!0}):null]})}function qm({className:e="",style:t,label:n,status:r,applyLabel:s,onClear:a,onApply:i,disabled:c=!1}){return l.jsxs("div",{className:`composer-tag-collection-bar ${e}`.trim(),style:t,children:[l.jsxs("div",{children:[l.jsx("div",{className:"composer-tag-collection-label",children:n}),r?l.jsx("div",{className:"composer-tag-collection-status",children:r}):null]}),l.jsxs("div",{className:"composer-tag-collection-actions",children:[l.jsx(K,{size:"xs",variant:"muted",onClick:a,disabled:c,children:"Clear"}),l.jsx(K,{size:"xs",variant:"primary",onClick:i,disabled:c,children:s})]})]})}const Xm={contentVisibility:"auto",containIntrinsicSize:"260px 140px"};function u1({open:e=!1,onClose:t,value:n="",onChange:r,aliasOptions:s=[],aliasCatalog:a=[],fieldLabel:i="Prompt",variant:c="sheet"}){var Za,Vl;const u=o.useRef(null),d=o.useRef(null),h=o.useRef(null),v=o.useRef(null),[y,x]=o.useState(n),[k,N]=o.useState(""),j=o.useDeferredValue(k),[m,p]=o.useState("All"),[g,w]=o.useState("All"),[b,E]=o.useState(30),[A,I]=o.useState("compose"),B=c==="page",T=B||e,[$,ee]=o.useState(null),[Z,le]=o.useState(null),[Ce,me]=o.useState(null),oe=o.useRef(null),R=o.useRef(null),[P,M]=o.useState(!1),[L,W]=o.useState(null),[q,de]=o.useState(""),fe=o.useDeferredValue(q),[ne,xe]=o.useState("All"),[G,O]=o.useState([]),[H,we]=o.useState(0),[he,Me]=o.useState(0),[Re,Fe]=o.useState(!1),[Oe,Ze]=o.useState(!1),re=o.useRef(null),_e=o.useRef(null),Y=o.useRef(null),Ie=o.useRef(null),[te,Ne]=o.useState(""),[ge,ve]=o.useState(""),[ye,Ae]=o.useState("count"),[Q,Ke]=o.useState(""),[et,Xe]=o.useState([]),[ut,D]=o.useState([]),[X,ke]=o.useState(0),[ze,$e]=o.useState(0),[Ge,rt]=o.useState(!1),[qe,U]=o.useState(!1),[ce,je]=o.useState(""),Pe=o.useRef(null),z=o.useRef(null),V=o.useRef(new Map),ae=o.useRef(new Map),ie=o.useMemo(()=>{const C=Number.parseInt(String(Q||""),10);return Number.isFinite(C)&&C>0?C:0},[Q]),[Se,Te]=o.useState([]),[lt,nt]=o.useState(""),[At,Kt]=o.useState([]),[bt,ot]=o.useState(""),ps=o.useMemo(()=>{if(!y)return{text:"",parts:[]};const C=new Map;if((a||[]).forEach(We=>{if(!We)return;const Ee=String(We.token||"").trim().toLowerCase(),Ye=typeof We.text=="string"?We.text.trim():"";!Ee||!Ye||C.set(Ee,Ye)}),!C.size||!y.includes("$"))return{text:y,parts:[{text:y,isAlias:!1}]};const _=[],pe=/\$([a-z0-9_:-]+)\$/gi;let Le=0,Ve;for(;(Ve=pe.exec(y))!==null;){const We=Ve.index;We>Le&&_.push({text:y.slice(Le,We),isAlias:!1});const Ee=String(Ve[1]||"").toLowerCase(),Ye=C.get(Ee);typeof Ye=="string"?_.push({text:Ye,isAlias:!0}):_.push({text:Ve[0],isAlias:!1}),Le=pe.lastIndex}return Le<y.length&&_.push({text:y.slice(Le),isAlias:!1}),{text:_.map(We=>We.text).join(""),parts:_}},[a,y]);o.useEffect(()=>{e&&(x(n),I("compose"),N(""),p("All"),w("All"),E(30),ee(null),le(null),me(null),M(!1),W(null),de(""),xe("All"),O([]),we(0),Me(0),Fe(!1),Ze(!1),gs(""),Ne(""),ve(""),Ae("count"),Ke(""),D([]),ke(0),$e(0),rt(!1),U(!1),je(""))},[e,n]),o.useEffect(()=>{if($===null||typeof document>"u")return;const C=document.querySelector("main.app-content"),_={htmlOverscroll:document.documentElement.style.overscrollBehavior,bodyOverscroll:document.body.style.overscrollBehavior,bodyOverflow:document.body.style.overflow,scrollOverflow:C==null?void 0:C.style.overflow,scrollTouch:C==null?void 0:C.style.touchAction,scrollOverscroll:C==null?void 0:C.style.overscrollBehavior};return document.documentElement.style.overscrollBehavior="none",document.body.style.overscrollBehavior="none",document.body.style.overflow="hidden",C&&(C.style.overflow="hidden",C.style.touchAction="none",C.style.overscrollBehavior="none"),()=>{document.documentElement.style.overscrollBehavior=_.htmlOverscroll||"",document.body.style.overscrollBehavior=_.bodyOverscroll||"",document.body.style.overflow=_.bodyOverflow||"",C&&(C.style.overflow=_.scrollOverflow||"",C.style.touchAction=_.scrollTouch||"",C.style.overscrollBehavior=_.scrollOverscroll||"")}},[$]);const Zt=o.useMemo(()=>(Array.isArray(a)?a.filter(C=>C&&C.name):[]).map(C=>({...C,...uf(C)})),[a]),Fl=o.useMemo(()=>{const C=new Map;return Zt.forEach(_=>{_!=null&&_.token&&C.set(String(_.token).toLowerCase(),_)}),C},[Zt]),Mr=o.useMemo(()=>{const C=new Set(["All"]);return Zt.forEach(_=>{_.category&&C.add(_.category)}),Array.from(C).sort((_,pe)=>Xt(_).localeCompare(Xt(pe)))},[Zt]),Us=o.useMemo(()=>{const C=new Set(["All"]);return Zt.forEach(_=>{(!m||m==="All"||_.category===m)&&_.subcategory&&C.add(_.subcategory)}),Array.from(C).sort((_,pe)=>_.localeCompare(pe))},[Zt,m]),en=o.useMemo(()=>["All",...Mr.filter(C=>C!=="All")],[Mr]),Gn=o.useMemo(()=>["All",...Us.filter(C=>C!=="All")],[Us]),Gt=o.useMemo(()=>{const C=j.trim().toLowerCase();return Zt.filter(_=>{var pe,Le,Ve,De;return m!=="All"&&(_.category||"")!==m||g!=="All"&&(_.subcategory||"other")!==g?!1:C?((pe=_.token)==null?void 0:pe.toLowerCase().includes(C))||((Le=_.text)==null?void 0:Le.toLowerCase().includes(C))||((Ve=_.name)==null?void 0:Ve.toLowerCase().includes(C))||((De=_.displayName)==null?void 0:De.toLowerCase().includes(C)):!0}).sort((_,pe)=>{const Le=(_.subcategory||"").toLowerCase(),Ve=(pe.subcategory||"").toLowerCase();if(Le!==Ve)return Le.localeCompare(Ve);const De=(_.displayName||_.name||_.token||"").toLowerCase(),We=(pe.displayName||pe.name||pe.token||"").toLowerCase();return De.localeCompare(We)})},[Zt,m,g,j]),mr=o.useMemo(()=>Gt.slice(0,b),[Gt,b]);o.useEffect(()=>{E(30)},[m,g,k,Zt]),o.useEffect(()=>{w("All")},[m]),o.useEffect(()=>{const C=h.current;if(!C)return;const _=new IntersectionObserver(pe=>{pe[0].isIntersecting&&b<Gt.length&&E(Ve=>Math.min(Ve+20,Gt.length))},{threshold:.1});return _.observe(C),()=>_.disconnect()},[b,Gt.length]);const yt=o.useMemo(()=>typeof y!="string"?[]:My(y),[y]);o.useEffect(()=>{if(!e||A!=="tags"||et.length>0)return;let C=!1;return(async()=>{try{const _=await of();if(C)return;Xe(Array.isArray(_==null?void 0:_.categories)?_.categories:[])}catch(_){console.error("Failed to load tag categories",_),C||Xe([])}})(),()=>{C=!0}},[e,A,et.length]);const Rn=o.useCallback(async()=>{if(Re)return;re.current&&re.current.abort();const C=new AbortController;re.current=C;try{Fe(!0);const _=await cr({q:fe,category:"",sort:"count",minCount:"",limit:100,offset:0},{signal:C.signal}),pe=Array.isArray(_==null?void 0:_.items)?_.items:[];O(pe),we(Number((_==null?void 0:_.total)||0)),Me(pe.length)}catch(_){if((_==null?void 0:_.name)==="AbortError")return;O([]),we(0),Me(0)}finally{Fe(!1)}},[fe,Re]),In=o.useCallback(async()=>{if(Re||Oe||G.length>=H)return;_e.current&&_e.current.abort();const C=new AbortController;_e.current=C;try{Ze(!0);const _=await cr({q:fe,category:"",sort:"count",minCount:"",limit:100,offset:he},{signal:C.signal}),pe=Array.isArray(_==null?void 0:_.items)?_.items:[];O(Le=>[...Le,...pe]),we(Number((_==null?void 0:_.total)||0)),Me(he+pe.length)}catch(_){if((_==null?void 0:_.name)==="AbortError")return}finally{Ze(!1)}},[fe,G.length,Re,Oe,he,H]),Yn=o.useCallback((C,_,pe,Le,Ve,De)=>[C||"",_||"",pe||"",String(Le||0),String(Ve||0),String(De||0)].join("::"),[]),vn=o.useCallback(()=>{const C=V.current;if(C.size<=50)return;const _=Array.from(C.entries());_.sort((pe,Le)=>{var Ve,De;return(((Ve=pe[1])==null?void 0:Ve.ts)||0)-(((De=Le[1])==null?void 0:De.ts)||0)}),_.slice(0,Math.max(0,_.length-50)).forEach(([pe])=>C.delete(pe))},[]),Fr=o.useCallback(async({nextQuery:C,nextCategory:_,nextSort:pe,nextMinCount:Le}={})=>{var js;const Ve=typeof C=="string"?C:te,De=typeof _=="string"?_:ge,We=typeof pe=="string"?pe:ye,Ee=typeof Le=="number"?Le:ie,Ye=Yn(Ve,De,We,Ee,80,0),Jn=Date.now(),nn=V.current.get(Ye);if(nn&&Jn-nn.ts<5*60*1e3){D(nn.items||[]),ke(Number(nn.total||0)),$e(0),je(""),rt(!1);return}const wr=ae.current.get(Ye);if(wr){try{const Et=await wr;D((Et==null?void 0:Et.items)||[]),ke(Number((Et==null?void 0:Et.total)||0)),$e(0),je("")}catch{}return}rt(!0),je(""),$e(0),Pe.current&&Pe.current.key!==Ye&&Pe.current.controller.abort();const ks=new AbortController;Pe.current={controller:ks,key:Ye};try{const Et=cr({q:Ve,category:De,sort:We,minCount:Ee,limit:80,offset:0},{signal:ks.signal});ae.current.set(Ye,Et);const Rt=await Et;V.current.set(Ye,{items:(Rt==null?void 0:Rt.items)||[],total:Number((Rt==null?void 0:Rt.total)||0),ts:Date.now()}),vn(),D((Rt==null?void 0:Rt.items)||[]),ke(Number((Rt==null?void 0:Rt.total)||0))}catch(Et){if((Et==null?void 0:Et.name)==="AbortError")return;console.error("Failed to search tags",Et),je("Unable to load tags right now."),D([]),ke(0)}finally{ae.current.delete(Ye),((js=Pe.current)==null?void 0:js.key)===Ye&&(Pe.current=null),rt(!1)}},[Yn,ge,ie,te,ye,vn]),ms=o.useCallback(async()=>{var We;if(Ge||qe||ut.length>=X)return;const C=ze+80,_=Yn(te,ge,ye,ie,80,C),pe=Date.now(),Le=V.current.get(_);if(Le&&pe-Le.ts<5*60*1e3){D(Ee=>[...Ee,...Le.items||[]]),ke(Number(Le.total||0)),$e(C),U(!1);return}const Ve=ae.current.get(_);if(Ve){try{const Ee=await Ve,Ye=(Ee==null?void 0:Ee.items)||[];D(Jn=>[...Jn,...Ye]),ke(Number((Ee==null?void 0:Ee.total)||0)),$e(C)}catch{}return}U(!0),je(""),z.current&&z.current.key!==_&&z.current.controller.abort();const De=new AbortController;z.current={controller:De,key:_};try{const Ee=cr({q:te,category:ge,sort:ye,minCount:ie,limit:80,offset:C},{signal:De.signal});ae.current.set(_,Ee);const Ye=await Ee,Jn=(Ye==null?void 0:Ye.items)||[];V.current.set(_,{items:Jn,total:Number((Ye==null?void 0:Ye.total)||0),ts:Date.now()}),vn(),D(nn=>[...nn,...Jn]),ke(Number((Ye==null?void 0:Ye.total)||0)),$e(C)}catch(Ee){if((Ee==null?void 0:Ee.name)==="AbortError")return;console.error("Failed to load more tags",Ee),je("Unable to load more tags.")}finally{ae.current.delete(_),((We=z.current)==null?void 0:We.key)===_&&(z.current=null),U(!1)}},[Yn,ge,Ge,qe,ie,ze,te,ye,ut.length,X,vn]);o.useEffect(()=>{if(!e||A!=="tags")return;const C=window.setTimeout(()=>{Fr()},220);return()=>window.clearTimeout(C)},[e,A,te,ge,ye,ie,Fr]),o.useEffect(()=>()=>{var C,_,pe,Le,Ve,De,We,Ee;Pe.current&&((_=(C=Pe.current.controller)==null?void 0:C.abort)==null||_.call(C)),z.current&&((Le=(pe=z.current.controller)==null?void 0:pe.abort)==null||Le.call(pe)),re.current&&((De=(Ve=re.current).abort)==null||De.call(Ve)),_e.current&&((Ee=(We=_e.current).abort)==null||Ee.call(We))},[]),o.useEffect(()=>{if(!P)return;const C=window.setTimeout(()=>{Rn()},250);return()=>window.clearTimeout(C)},[P,fe,Rn]);const{containerRef:hr,startIndex:Vs,endIndex:hs,topSpacer:tn,bottomSpacer:Mt,virtualized:bn,isNearEnd:Qn}=vf({itemCount:ut.length,enabled:e&&A==="tags",estimateRowHeight:70,overscan:8,minItems:90}),st=bn?ut.slice(Vs,hs):ut;o.useEffect(()=>{if(!e||A!=="tags"||bn)return;const C=Ie.current;if(!C||typeof IntersectionObserver>"u")return;const _=new IntersectionObserver(pe=>{const Le=pe[0];Le!=null&&Le.isIntersecting&&ms()},{threshold:.1});return _.observe(C),()=>_.disconnect()},[e,A,bn,ms]),o.useEffect(()=>{bn&&(Ge||qe||ut.length>=X||Qn&&ms())},[bn,Ge,qe,ut.length,X,Qn,ms]);const Pt=o.useCallback(C=>{x(_=>{const Le=typeof C=="function"?C(typeof _=="string"?_:""):String(C||"");return c==="page"&&(r==null||r(Le)),Le})},[r,c]),qn=o.useCallback(C=>{const _=String(C||"").trim();if(_&&(Pt(pe=>{const Le=pe.length,Ve=pe.length,De=pe.slice(0,Le),We=pe.slice(Ve),Ee=De.match(/[^\s]$/),Ye=We.match(/^[^\s]/),Jn=Ee&&Ee[0]!==","?", ":"",nn=Ye&&Ye[0]!==","?", ":"";return De+Jn+_+nn+We}),u.current))try{u.current.blur()}catch{}},[Pt]),[gr,gs]=o.useState(""),ys=o.useCallback(()=>{const C=String(gr||"").trim();if(!C)return;const pe=C.split(",").map(Le=>Le.trim()).filter(Boolean).join(", ");pe&&(qn(pe),gs(""),I("compose"))},[gr,qn]),vs=o.useCallback(()=>{Te([]),nt("Cleared collected tags.")},[]),Ka=o.useCallback(()=>{if(!Se.length){nt("No tags to apply.");return}qn(Se.join(", ")),nt(`Applied ${Se.length} tag${Se.length===1?"":"s"}.`),Te([]),I("compose")},[Se,qn]),Ws=o.useCallback(C=>{const _=String(C||"").trim();_&&Te(pe=>{const Le=_.toLowerCase();return pe.some(De=>De.toLowerCase()===Le)?(nt(`Removed: ${_}`),pe.filter(De=>De.toLowerCase()!==Le)):(nt(`Selected: ${_}`),[...pe,_])})},[]),vt=o.useCallback(C=>{const _=String(C||"").trim();_&&Kt(pe=>{const Le=_.toLowerCase();return pe.some(De=>De.toLowerCase()===Le)?(ot(`Removed: ${_}`),pe.filter(De=>De.toLowerCase()!==Le)):(ot(`Selected: ${_}`),[...pe,_])})},[]),yr=o.useCallback(()=>{Kt([]),ot("Cleared selected aliases.")},[]),xn=o.useCallback(()=>{if(!At.length){ot("No aliases to apply.");return}const C=At.map(_=>`$${_}$`).join(", ");qn(C),ot(`Applied ${At.length} alias${At.length===1?"":"es"}.`),Kt([]),I("compose")},[At,qn]),jt=A==="tags"?{kind:"tag",count:Se.length,status:lt,onClear:vs,onApply:Ka}:A==="aliases"?{kind:"alias",count:At.length,status:bt,onClear:yr,onApply:xn}:null,vr=(jt==null?void 0:jt.count)||0,ht=jt?`${vr} ${jt.kind==="alias"?vr===1?"alias":"aliases":vr===1?jt.kind:`${jt.kind}s`} selected`:"",xr=!B&&vr>0,Hs=B&&vr>0,$n=Hs?{"--composer-selection-offset":"var(--bottom-nav-height, 64px)"}:void 0,Or=jt?{label:ht,status:jt.status,onClear:jt.onClear,onApply:jt.onApply,applyLabel:"Insert",disabled:!vr}:null,Ga=xr&&Or?l.jsx(qm,{...Or,className:"is-footer"}):null,Ol=Hs&&Or?l.jsx(qm,{...Or,className:"is-floating",style:$n}):null,xs=C=>{Pt(_=>Oy(_||"",C))},Ks=o.useCallback((C,_)=>{if(!(yt!=null&&yt.length))return;const pe=C+_;pe<0||pe>=yt.length||(Pt(Le=>rd(Le||"",yt,C,pe)),me(pe))},[yt,Pt]),ws=C=>{if(!C)return;let _=C.text;if(C.type==="alias"){const Le=Fl.get(C.text.toLowerCase());_=(Le==null?void 0:Le.displayName)||C.text}const pe=Gr(y||"",C);W({element:C,displayName:_,weight:(pe==null?void 0:pe.weight)??1}),de(""),xe("All"),M(!0)},Ss=o.useCallback((C,_)=>{C===_||C===null||_===null||yt!=null&&yt.length&&Pt(pe=>rd(pe||"",yt,C,_))},[yt,Pt]),Gs=o.useCallback((C,_)=>{ee(_),oe.current=C.target,C.dataTransfer.effectAllowed="move",C.dataTransfer.setData("text/plain",_.toString()),requestAnimationFrame(()=>{oe.current&&oe.current.classList.add("is-dragging")})},[]),Ya=o.useCallback(()=>{oe.current&&oe.current.classList.remove("is-dragging"),$!==null&&Z!==null&&$!==Z&&Ss($,Z),ee(null),le(null),oe.current=null},[$,Z,Ss]),Dr=o.useCallback((C,_)=>{C.preventDefault(),C.dataTransfer.dropEffect="move",_!==Z&&le(_)},[Z]),Xn=o.useCallback(()=>{},[]),Dl=o.useCallback((C,_)=>{var De,We;if(!((We=(De=C.target)==null?void 0:De.closest)==null?void 0:We.call(De,".composer-token-drag-handle")))return;const Le=C.touches[0],Ve=window.setTimeout(()=>{R.current&&(R.current.active=!0,ee(_),le(_))},240);R.current={idx:_,startX:Le.clientX,startY:Le.clientY,active:!1,timer:Ve}},[]),Qa=o.useCallback(C=>{if(!R.current)return;const _=C.touches[0],pe=Math.abs(_.clientX-R.current.startX),Le=Math.abs(_.clientY-R.current.startY);if(!R.current.active){(pe>8||Le>8)&&(window.clearTimeout(R.current.timer),R.current=null);return}C.preventDefault();const Ve=document.querySelectorAll(".composer-token-draggable"),De=_.clientX,We=_.clientY;for(let Ee=0;Ee<Ve.length;Ee++){const Ye=Ve[Ee].getBoundingClientRect();if(De>=Ye.left&&De<=Ye.right&&We>=Ye.top&&We<=Ye.bottom){le(Ee);break}}},[]),qa=o.useCallback(()=>{var C,_;(C=R.current)!=null&&C.timer&&window.clearTimeout(R.current.timer),(_=R.current)!=null&&_.active&&$!==null&&Z!==null&&$!==Z&&Ss($,Z),R.current=null,ee(null),le(null)},[$,Z,Ss]),Xa=o.useCallback(()=>{var C;(C=R.current)!=null&&C.timer&&window.clearTimeout(R.current.timer),R.current=null,ee(null),le(null)},[]),oc=()=>{r==null||r(y),t==null||t()},Bl=()=>{t==null||t()};if(!T)return null;const Ja=l.jsxs("div",{className:`composer-shell ${B?"ui-card":""}`,children:[l.jsx(fr,{ariaLabel:"Composer tabs",value:A,onChange:I,items:[{key:"compose",label:"Compose",icon:l.jsx(tc,{size:14})},{key:"aliases",label:"Aliases",icon:l.jsx(Ey,{size:14})},{key:"tags",label:"Tags",icon:l.jsx(ec,{size:14})}]}),l.jsxs("div",{className:`composer-panel composer-panel-compose ${A==="compose"?"is-visible":""}`,children:[l.jsx("div",{className:"composer-editor",children:l.jsxs("div",{className:"composer-input-row",children:[l.jsx("input",{ref:u,type:"text",value:gr,onChange:C=>gs(C.target.value),onKeyDown:C=>{C.key==="Enter"&&(C.preventDefault(),ys())},className:"composer-input ui-control ui-input is-compact",placeholder:"Add prompt text","aria-label":"Add prompt text"}),l.jsx(K,{size:"icon",variant:"ghost",onClick:ys,disabled:!gr.trim(),"aria-label":"Add prompt text",children:"+"})]})}),l.jsxs("div",{className:"composer-tokens",children:[l.jsxs("div",{className:"composer-tokens-header",children:[l.jsxs("span",{className:"composer-tokens-label",children:["Elements",l.jsx("span",{className:"composer-tokens-count",children:yt.length})]}),l.jsx("span",{className:"composer-tokens-hint",children:"Drag to reorder  Tap to adjust"})]}),yt.length?l.jsx("div",{ref:v,className:`composer-tokens-list ${$!==null?"is-dragging":""}`,style:{"--composer-elements":yt.length},children:yt.map((C,_)=>{let pe=C.text;if(C.type==="alias"){const Ee=Fl.get(C.text.toLowerCase());pe=(Ee==null?void 0:Ee.displayName)||C.text}const Le=$===_,Ve=Z===_&&$!==null&&$!==_,De=Gr(y||"",C),We=(De==null?void 0:De.weight)??1;return l.jsxs("span",{className:`composer-token composer-token-draggable ${C.type==="alias"?"is-alias":"is-tag"} ${Le?"is-dragging":""} ${Ve?"is-drop-target":""} ${Ce===_?"is-selected":""}`,title:C.type==="alias"?`Alias: $${C.text}$`:`Tag: ${C.text}`,role:"button",tabIndex:0,draggable:!0,onDragStart:Ee=>Gs(Ee,_),onDragEnd:Ya,onDragOver:Ee=>Dr(Ee,_),onDragLeave:Xn,onTouchStart:Ee=>Dl(Ee,_),onTouchMove:Qa,onTouchEnd:qa,onTouchCancel:Xa,onClick:()=>{$===null&&(me(_),ws(C))},onKeyDown:Ee=>{if(Ee.target===Ee.currentTarget&&(Ee.key==="Enter"||Ee.key===" ")){if(Ee.preventDefault(),$!==null)return;me(_),ws(C)}},children:[l.jsx("span",{className:"composer-token-order",children:_+1}),l.jsx("span",{className:"composer-token-drag-handle","aria-hidden":"true",children:l.jsx(Ma,{size:10})}),l.jsx("span",{className:"composer-token-name",children:pe}),C.type==="alias"&&l.jsx("span",{className:"composer-token-type",children:"$"}),Math.abs(We-1)>1e-6&&l.jsxs("span",{className:"composer-token-weight",children:[ln(We),""]}),l.jsxs("div",{className:"composer-token-shift",role:"group","aria-label":"Reorder token",children:[l.jsx(K,{size:"mini",variant:"ghost",onClick:Ee=>{Ee.stopPropagation(),Ks(_,-1)},"aria-label":"Move up",disabled:_===0,children:""}),l.jsx(K,{size:"mini",variant:"ghost",onClick:Ee=>{Ee.stopPropagation(),Ks(_,1)},"aria-label":"Move down",disabled:_===yt.length-1,children:""})]}),l.jsx(K,{size:"mini",variant:"danger",onClick:Ee=>{Ee.stopPropagation(),xs(C)},"aria-label":`Remove ${C.text}`,children:l.jsx(os,{size:9})})]},`${C.type}-${C.text}-${C.start}`)})}):l.jsx("div",{className:"composer-empty",children:"No elements yet."})]}),l.jsxs("div",{className:"composer-expanded",children:[l.jsxs("div",{className:"composer-expanded-header",children:[l.jsx("span",{className:"composer-expanded-label",children:"Expanded prompt"}),l.jsx("span",{className:"composer-expanded-meta",children:ps.text?`${ps.text.length} chars`:"Empty"})]}),l.jsx("div",{className:"composer-expanded-box","aria-label":"Expanded prompt",children:ps.text?ps.parts.map((C,_)=>C.isAlias?l.jsx("span",{className:"composer-expanded-alias",children:C.text},`alias-${_}`):l.jsx("span",{children:C.text},`text-${_}`)):"No prompt yet."})]})]}),l.jsxs("div",{className:`composer-panel composer-panel-aliases ${A==="aliases"?"is-visible":""}`,children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:d,type:"text",value:k,onChange:C=>N(C.target.value),placeholder:"Search aliases",className:"composer-search ui-control ui-input","aria-label":"Search aliases"}),l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>N(""),disabled:!k,children:"Clear"})]}),l.jsx(ct,{value:m,onChange:p,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:en.map(C=>({value:C,label:C==="All"?"Category: All":Xt(C)}))}),Gn.length>2&&l.jsx(ct,{value:g,onChange:w,wrapperClassName:"composer-subcategory-select",size:"sm",searchThreshold:0,options:Gn.map(C=>({value:C,label:C==="All"?"All subcategories":gn(C)}))})]}),l.jsx("div",{className:"composer-alias-list",children:Gt.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No aliases found."}):l.jsxs(l.Fragment,{children:[mr.map(C=>l.jsxs("button",{type:"button",onClick:()=>vt(C.token),className:`composer-alias-item ${At.some(_=>_.toLowerCase()===C.token.toLowerCase())?"is-collected":""}`,style:Xm,children:[l.jsxs("div",{className:"composer-alias-header",children:[l.jsx("div",{className:"composer-alias-name",children:C.displayName||C.token}),C.category?l.jsx("span",{className:"composer-alias-category",children:Xt(C.category)}):null]}),l.jsxs("div",{className:"composer-alias-token",children:["$",C.token,"$"]}),l.jsx("div",{className:"composer-alias-text",children:C.text})]},C.key)),b<Gt.length&&l.jsx("div",{ref:h,className:"composer-sentinel"})]})})]}),l.jsxs("div",{className:`composer-panel composer-panel-tags ${A==="tags"?"is-visible":""}`,onClick:C=>C.stopPropagation(),children:[l.jsxs("div",{className:"composer-filters",children:[l.jsxs("div",{className:"input-with-action",children:[l.jsx("input",{ref:Y,type:"search",value:te,onChange:C=>Ne(C.target.value),placeholder:"Search tags (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),l.jsx(K,{size:"xs",variant:"ghost",onClick:()=>Ne(""),disabled:!te,children:"Clear"})]}),l.jsx(ct,{value:ge,onChange:ve,wrapperClassName:"composer-subcategory-select","aria-label":"Filter by category",size:"sm",searchThreshold:0,options:[{value:"",label:"Category: All"},...et.map(C=>({value:C.key,label:`${gn(C.key)} (${Number(C.actual||C.count||0).toLocaleString()})`}))]}),l.jsxs("div",{className:"composer-sort-row",children:[l.jsx(ct,{value:ye,onChange:Ae,wrapperClassName:"composer-subcategory-select","aria-label":"Sort tags",size:"sm",options:[{value:"count",label:"Sort: Popular"},{value:"alpha",label:"Sort: AZ"}]}),l.jsxs("div",{className:"composer-min-count",children:[l.jsx("span",{className:"composer-filter-divider","aria-hidden":"true",children:"|"}),l.jsx("label",{className:"composer-min-count-label",htmlFor:"composer-min-count",children:"Minimum count"}),l.jsx("input",{id:"composer-min-count",type:"number",inputMode:"numeric",min:0,step:1,value:Q,onChange:C=>{const _=C.target.value;(_===""||Number(_)>=0)&&Ke(_)},className:"ui-control ui-input is-compact composer-min-count-input",placeholder:"0"})]})]})]}),ce?l.jsx("div",{className:"composer-tags-error",children:ce}):null,l.jsx("div",{className:"composer-alias-list composer-tags-grid",role:"list",ref:hr,children:Ge?l.jsx("div",{className:"composer-alias-empty",children:"Loading tags"}):ut.length===0?l.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):l.jsxs(l.Fragment,{children:[bn&&tn>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${tn}px`}}):null,st.map(C=>l.jsx(ov,{tag:C.tag,category:C.category,count:C.count,isCollected:Se.some(_=>_.toLowerCase()===String(C.tag||"").toLowerCase()),onToggle:Ws,visibilityStyle:Xm},`${C.tag}-${C.category}`)),bn&&Mt>0?l.jsx("div",{"aria-hidden":!0,style:{height:`${Mt}px`}}):null,ut.length<X&&!bn?l.jsx("div",{ref:Ie,className:"composer-sentinel"}):null,qe?l.jsx("div",{className:"composer-alias-empty",children:"Loading more"}):null]})})]})]}),Ft=o.useMemo(()=>Zt.map(C=>({key:C.key||C.token,token:C.token,displayName:C.displayName||C.name||C.token,category:C.category,subcategory:C.subcategory,name:C.name})),[Zt]),Ul=o.useMemo(()=>G.map(C=>({key:`${C.tag}-${C.category}`,tag:C.tag,displayName:C.tag,category:C.category,count:C.count})),[G]),cc=o.useCallback(C=>{if(!(L!=null&&L.element))return;const _=C.type==="alias"?"alias":"tag",pe=C.token||C.tag||"";Pt(Le=>{const Ve=String(Le||""),De=Gr(Ve,L.element),We=String(pe||"").replace(/^\$|\$$/g,"").trim();if(!We)return Ve;const Ee=_==="alias"?`$${We}$`:We,Ye=De?`(${Ee}:${ln(De.weight)})`:Ee;return Dy(Ve,L.element,Ye)}),M(!1),W(null)},[L,Pt]),uc=o.useCallback(C=>{L!=null&&L.element&&(Pt(_=>Fy(_||"",L.element,C)),W(_=>_?{..._,weight:C}:null))},[L,Pt]),Mn=l.jsx(ad,{open:P,onClose:()=>{M(!1),W(null)},mode:"edit",tokenType:((Za=L==null?void 0:L.element)==null?void 0:Za.type)||"tag",tokenLabel:((Vl=L==null?void 0:L.element)==null?void 0:Vl.text)||"",tokenDisplay:(L==null?void 0:L.displayName)||"",weight:(L==null?void 0:L.weight)??1,onWeightChange:uc,deferWeightApply:!0,onDelete:()=>{L!=null&&L.element&&xs(L.element)},aliases:Ft,aliasCategories:en,aliasLoading:!1,tags:Ul,tagLoading:Re||Oe,tagHasMore:G.length<H,onLoadTags:Rn,onLoadMoreTags:In,replacementSearch:q,onReplacementSearchChange:de,onReplace:cc,activeCategory:ne,onCategoryChange:xe}),dc=l.jsx("div",{className:"page-bar composer-bar",children:l.jsx("h1",{className:"page-bar-title",children:i||"Prompt"})});return B?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"page-shell page-stack",children:[dc,Ja]}),Ol,Mn]}):l.jsxs(l.Fragment,{children:[l.jsx(Wt,{open:e,onClose:Bl,title:"Composer",variant:"fullscreen",shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,footer:l.jsxs("div",{className:"composer-footer-stack",children:[Ga,l.jsxs("div",{className:"flex gap-2",children:[l.jsx(K,{variant:"muted",className:"w-full",onClick:Bl,children:"Cancel"}),l.jsx(K,{variant:"primary",className:"w-full",onClick:oc,children:"Apply"})]})]}),children:Ja}),Mn]})}function d1(){const e=Ir(),[t]=lf(),{formData:n,handleFormChange:r,aliasOptions:s,aliasCatalog:a,promptFieldName:i,handleGenerate:c,workflowData:u,selectedWorkflow:d,isLoading:h}=yf(),y=t.get("field")||i||"prompt",x=(n==null?void 0:n[y])||"";return o.useEffect(()=>{if(!(typeof document>"u"))return document.body.classList.add("no-pull-refresh"),document.documentElement.classList.add("no-pull-refresh"),()=>{document.body.classList.remove("no-pull-refresh"),document.documentElement.classList.remove("no-pull-refresh")}},[]),o.useEffect(()=>{const k=()=>{!u||!d||h||c()};return window.addEventListener("cozygen:request-render",k),()=>window.removeEventListener("cozygen:request-render",k)},[c,h,d,u]),l.jsx(u1,{open:!0,onClose:()=>e("/controls"),value:x,onChange:k=>r(y,k),aliasOptions:s,aliasCatalog:a,fieldLabel:y,variant:"page"})}function f1(){var m,p;const{authed:e,ready:t,login:n}=Zo(),r=Ir(),a=((p=(m=yn().state)==null?void 0:m.from)==null?void 0:p.pathname)||"/studio",[i,c]=o.useState(""),[u,d]=o.useState(""),[h,v]=o.useState(""),[y,x]=o.useState(!1),[k,N]=o.useState(!1);o.useEffect(()=>{try{localStorage.getItem("cozygen_idle_logout")&&(N(!0),localStorage.removeItem("cozygen_idle_logout"))}catch{}},[]),o.useEffect(()=>{t&&e&&r(a,{replace:!0})},[t,e,a,r]);const j=async g=>{g.preventDefault(),v(""),x(!0);try{await n(i,u),r(a,{replace:!0})}catch(w){w!=null&&w.unauthorized?v("Invalid username or password."):v("Unable to sign in. Please try again.")}finally{x(!1)}};return l.jsx("div",{className:"login-shell",children:l.jsxs("div",{className:"ui-card w-full max-w-[420px] p-6 sm:p-7",children:[l.jsxs("div",{className:"login-brand",children:[l.jsx(by,{size:34}),l.jsxs("div",{className:"min-w-0",children:[l.jsx("div",{className:"login-title",children:"Sign in"}),l.jsx("div",{className:"login-subtitle",children:"Continue to CozyGen Studio"})]})]}),l.jsxs("form",{className:"login-form",onSubmit:j,children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"login-username",className:"login-label",children:"Username"}),l.jsx("input",{id:"login-username",type:"text",className:"ui-control ui-input",value:i,onChange:g=>c(g.target.value),autoComplete:"username",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"login-password",className:"login-label",children:"Password"}),l.jsx("input",{id:"login-password",type:"password",className:"ui-control ui-input",value:u,onChange:g=>d(g.target.value),autoComplete:"current-password",required:!0})]}),h?l.jsx("div",{className:"ui-alert",children:h}):k?l.jsx("div",{className:"ui-alert is-warn",children:"You were signed out due to inactivity. Please sign in again."}):null,l.jsx(K,{type:"submit",disabled:y,variant:"primary",className:"w-full",children:y?"Signing in":"Sign in"})]}),l.jsxs("p",{className:"login-footnote",children:["Access is protected by CozyGen auth. Set ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_USER"})," /"," ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_PASS"})," on the server to enable."]})]})})}function p1({containerRef:e}){const{pathname:t,hash:n}=yn();return o.useEffect(()=>{if(n)return;const r=e==null?void 0:e.current;if(r&&typeof r.scrollTo=="function"){r.scrollTo({top:0,left:0,behavior:"auto"});return}typeof window<"u"&&window.scrollTo(0,0)},[t,n,e]),null}function m1({children:e}){const{authed:t,ready:n}=Zo(),r=yn();return n?t?e:l.jsx(xo,{to:"/login",state:{from:r},replace:!0}):l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 text-slate-200",children:l.jsxs("div",{className:"page-loading",children:[l.jsx("span",{className:"loading-spinner lg","aria-hidden":"true"}),l.jsx("span",{className:"sr-only",children:"Checking session"})]})})}function Jm({tab:e}){const t=yn(),n=new URLSearchParams(t.search||"");n.set("tab",e);const r=n.toString();return l.jsx(xo,{to:`/library?${r}`,replace:!0})}function h1(){const{pathname:e}=yn(),t=Ir(),{defaultCreds:n,authed:r}=Zo(),s=e==="/login",a=o.useRef(null),i=!s;return o.useEffect(()=>{if(!r)return;const c=u=>{var v;const d=String(((v=u==null?void 0:u.detail)==null?void 0:v.fieldName)||"").trim(),h=d?`?field=${encodeURIComponent(d)}`:"";t(`/compose${h}`)};return window.addEventListener("cozygen:open-composer",c),()=>window.removeEventListener("cozygen:open-composer",c)},[r,t]),l.jsxs("div",{className:"app-shell",children:[!s&&l.jsx(BS,{}),!s&&r&&n&&l.jsxs("div",{className:"flex-shrink-0 bg-amber-500/10 text-amber-200 border-b border-amber-400/50 px-4 py-2 text-sm text-center",children:["Default CozyGen credentials are still in use. Change ",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_USER"})," /",l.jsx("code",{className:"font-mono",children:"COZYGEN_AUTH_PASS"})," on the server."]}),l.jsx(p1,{containerRef:a}),l.jsxs("div",{className:"app-body",children:[l.jsx("main",{ref:a,className:s?"app-content is-login":"app-content",children:l.jsxs(tS,{children:[l.jsx(En,{path:"/login",element:l.jsx(f1,{})}),l.jsxs(En,{element:l.jsx(m1,{children:l.jsx(bj,{children:l.jsx(Z0,{})})}),children:[l.jsx(En,{path:"/",element:l.jsx(xo,{to:"/studio",replace:!0})}),l.jsx(En,{path:"/studio",element:l.jsx(Lj,{})}),l.jsx(En,{path:"/controls",element:l.jsx(Ej,{})}),l.jsx(En,{path:"/compose",element:l.jsx(d1,{})}),l.jsx(En,{path:"/gallery",element:l.jsx(Gj,{})}),l.jsx(En,{path:"/library",element:l.jsx(c1,{})}),l.jsx(En,{path:"/aliases",element:l.jsx(Jm,{tab:"aliases"})}),l.jsx(En,{path:"/tags",element:l.jsx(Jm,{tab:"tags"})})]}),l.jsx(En,{path:"*",element:l.jsx(xo,{to:"/studio",replace:!0})})]})}),i?l.jsx(GS,{}):null]})]})}function g1(){return l.jsx(uS,{children:l.jsx(TS,{children:l.jsx(h1,{})})})}Xc.createRoot(document.getElementById("root")).render(l.jsx(aa.StrictMode,{children:l.jsx(g1,{})}));

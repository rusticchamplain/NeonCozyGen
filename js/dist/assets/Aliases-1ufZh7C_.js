import{r as n,C as be,D as Me,j as e,z as Ae,c as ie,E as ge}from"./index-BHgq2Ao1.js";import{a as le,u as ze,d as ae,f as X,e as he,n as Oe}from"./usePromptAliases-DLcvEuec.js";import{B as ne}from"./BottomSheet-GpOlSyzm.js";function Ne(c){var l,g;const m=String(c||"");if(!m)return!1;try{return(g=(l=navigator.clipboard)==null?void 0:l.writeText)==null||g.call(l,m),!0}catch{try{const h=document.createElement("textarea");return h.value=m,h.style.position="fixed",h.style.left="-9999px",h.style.top="-9999px",document.body.appendChild(h),h.focus(),h.select(),document.execCommand("copy"),document.body.removeChild(h),!0}catch{return!1}}}function Ue({open:c,onClose:m,onSelectTag:l,initialQuery:g="",title:h="Tag library"}){const[v,k]=n.useState(g||""),[C,r]=n.useState(""),[j,B]=n.useState("count"),[Y,S]=n.useState([]),[O,T]=n.useState([]),[_,R]=n.useState(0),[ee,A]=n.useState(0),[L,M]=n.useState(!1),[N,Q]=n.useState(!1),[V,U]=n.useState(""),[W,E]=n.useState(""),Z=n.useRef(null),P=n.useRef(null),G=O.length<_,y=n.useCallback(async({nextQuery:a,nextCategory:f,nextSort:z}={})=>{const p=typeof a=="string"?a:v,H=typeof f=="string"?f:C,$=typeof z=="string"?z:j;M(!0),U(""),E(""),A(0);try{const b=await be({q:p,category:H,sort:$,limit:80,offset:0});T((b==null?void 0:b.items)||[]),R(Number((b==null?void 0:b.total)||0))}catch(b){console.error("Failed to search tags",b),U("Unable to load tags right now."),T([]),R(0)}finally{M(!1)}},[C,v,j]),w=n.useCallback(async()=>{if(L||N||!G)return;const a=ee+80;Q(!0),U("");try{const f=await be({q:v,category:C,sort:j,limit:80,offset:a}),z=(f==null?void 0:f.items)||[];T(p=>[...p,...z]),R(Number((f==null?void 0:f.total)||0)),A(a)}catch(f){console.error("Failed to load more tags",f),U("Unable to load more tags.")}finally{Q(!1)}},[G,C,L,N,ee,v,j]);n.useEffect(()=>{if(!c)return;U(""),E("");let a=!1;return(async()=>{try{const f=await Me();if(a)return;S(Array.isArray(f==null?void 0:f.categories)?f.categories:[])}catch(f){console.error("Failed to load tag categories",f),a||S([])}})(),()=>{a=!0}},[c]),n.useEffect(()=>{c&&(k(g||""),r(""),B("count"),T([]),R(0),A(0),M(!1),Q(!1),U(""),E(""),requestAnimationFrame(()=>{var a,f;return(f=(a=P.current)==null?void 0:a.focus)==null?void 0:f.call(a,{preventScroll:!0})}))},[c,g]),n.useEffect(()=>{if(!c)return;const a=window.setTimeout(()=>{y()},220);return()=>window.clearTimeout(a)},[c,v,C,j,y]),n.useEffect(()=>{if(!c)return;const a=Z.current;if(!a||typeof IntersectionObserver>"u")return;const f=new IntersectionObserver(z=>{const p=z[0];p!=null&&p.isIntersecting&&w()},{threshold:.1});return f.observe(a),()=>f.disconnect()},[c,w]);const ce=n.useMemo(()=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"ui-button is-muted w-full",onClick:m,children:"Done"}),e.jsx("button",{type:"button",className:"ui-button is-ghost w-full",onClick:()=>y(),disabled:L||N,children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Ae,{size:14}),"Refresh"]})})]}),[L,N,m,y]),q=_?`${O.length.toLocaleString()} / ${_.toLocaleString()}`:`${O.length.toLocaleString()}`;return e.jsx(ne,{open:c,onClose:m,title:h,variant:"fullscreen",footer:ce,shouldCloseOnOverlayClick:!1,children:e.jsxs("div",{className:"sheet-stack",children:[e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Browse"}),e.jsxs("div",{className:"composer-filters",children:[e.jsx("input",{ref:P,type:"search",value:v,onChange:a=>k(a.target.value),placeholder:"Search tags… (e.g. smile, city, sword)",className:"composer-search ui-control ui-input","aria-label":"Search tags"}),e.jsxs("select",{value:C,onChange:a=>r(a.target.value),className:"composer-subcategory-select ui-control ui-select is-compact","aria-label":"Filter by category",children:[e.jsx("option",{value:"",children:"Category: All"}),Y.map(a=>e.jsxs("option",{value:a.key,children:[le(a.key)," (",Number(a.actual||a.count||0).toLocaleString(),")"]},a.key))]}),e.jsxs("select",{value:j,onChange:a=>B(a.target.value),className:"composer-subcategory-select ui-control ui-select is-compact","aria-label":"Sort tags",children:[e.jsx("option",{value:"count",children:"Sort: Popular"}),e.jsx("option",{value:"alpha",children:"Sort: A–Z"})]})]}),e.jsxs("div",{className:"sheet-hint",children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ie,{size:14}),"Tap a tag to ",l?"add it to the alias":"copy it"]}),e.jsx("span",{className:"ml-3 opacity-80",children:q})]}),W?e.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:W}):null,V?e.jsx("div",{className:"text-xs text-[#FF8F70]",children:V}):null]}),e.jsx("div",{className:"composer-alias-list",role:"list",children:L?e.jsx("div",{className:"composer-alias-empty",children:"Loading tags…"}):O.length===0?e.jsx("div",{className:"composer-alias-empty",children:"No tags found."}):e.jsxs(e.Fragment,{children:[O.map(a=>e.jsxs("div",{className:"tag-library-row",role:"listitem",children:[e.jsxs("button",{type:"button",className:"composer-alias-item tag-library-item",onClick:()=>{if(l){l(String(a.tag||"")),E(`Added: ${a.tag}`);return}Ne(a.tag)?E(`Copied: ${a.tag}`):E("Copy not available on this browser.")},children:[e.jsxs("div",{className:"composer-alias-header",children:[e.jsx("div",{className:"composer-alias-name tag-library-name",children:e.jsx("code",{className:"tag-library-code",children:a.tag})}),a.category?e.jsx("span",{className:"composer-alias-category",children:le(a.category)}):null]}),e.jsx("div",{className:"composer-alias-token",children:Number(a.count||0).toLocaleString()})]}),e.jsx("button",{type:"button",className:"ui-button is-tiny is-ghost tag-library-copy",onClick:()=>{Ne(a.tag)?E(`Copied: ${a.tag}`):E("Copy not available on this browser.")},"aria-label":`Copy ${a.tag}`,title:"Copy",children:"Copy"})]},`${a.tag}-${a.category}`)),e.jsx("div",{ref:Z,className:"composer-sentinel"}),N?e.jsx("div",{className:"composer-alias-empty",children:"Loading more…"}):null]})})]})})}const oe="::";function qe(){return`alias-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`}function D(c){return String(c||"").split(",").map(m=>m.trim()).filter(Boolean)}function re(c){return(c||[]).map(m=>String(m||"").trim()).filter(Boolean).join(", ")}function De(c,m){const l=String(m||"").trim();if(!l)return String(c||"");const g=D(c);return new Set(g.map(v=>v.toLowerCase())).has(l.toLowerCase())||g.push(l),re(g)}function Be(c,m){const l=String(m||"").trim().toLowerCase();if(!l)return String(c||"");const g=D(c).filter(h=>h.toLowerCase()!==l);return re(g)}function Ve(c,m,l){const g=String(m||"").trim().toLowerCase(),h=String(l||"").trim();if(!g||!h)return String(c||"");const v=D(c).map(r=>r.toLowerCase()===g?h:r),k=new Set,C=[];return v.forEach(r=>{const j=String(r||"").trim().toLowerCase();!j||k.has(j)||(k.add(j),C.push(r))}),re(C)}function fe(c,m={}){return Object.entries(Oe(c)).map(([l,g],h)=>{const[v,k]=String(l).includes(oe)?l.split(oe):["",l],C=k||l,r=m[l]||m[C]||v||"";return{id:`existing-${h}-${l}`,name:C,text:g,category:r}})}function Ce(c){const m={};return c.forEach(l=>{const g=String((l==null?void 0:l.name)||"").trim(),h=typeof(l==null?void 0:l.text)=="string"?l.text.trim():"";if(g&&h){const v=String((l==null?void 0:l.category)||"").trim(),k=v?`${v}${oe}${g}`:g;m[k]=h}}),m}function Se(c){const m={};return c.forEach(l=>{const g=String((l==null?void 0:l.name)||"").trim(),h=typeof(l==null?void 0:l.category)=="string"?l.category.trim():"";if(g){const v=h?`${h}${oe}${g}`:g;m[v]=h}}),m}function We(){var ve;const{aliases:c,aliasCategories:m,categoryList:l,loading:g,saving:h,error:v,persistAliases:k,refreshAliases:C}=ze(),[r,j]=n.useState(()=>fe(c,m)),[B,Y]=n.useState(()=>Array.isArray(l)?l:[]),[S,O]=n.useState("All"),[T,_]=n.useState("All"),[R,ee]=n.useState(""),[A,L]=n.useState(""),[M,N]=n.useState(!1),[Q,V]=n.useState(!1),[U,W]=n.useState(!1),[E,Z]=n.useState(""),[P,G]=n.useState(""),[y,w]=n.useState({loading:!1,invalid:[],suggestions:{}}),[ce,q]=n.useState(!1),[a,f]=n.useState(null),[z,p]=n.useState(""),H=n.useRef(null),[$,b]=n.useState(!1),[xe,de]=n.useState("");n.useEffect(()=>{if($)return;const t=fe(c,m||{});j(t),A&&!t.some(s=>s.id===A)&&(L(""),N(!1))},[m,$]),n.useEffect(()=>{$||Array.isArray(l)&&Y(l)},[l,$]),n.useEffect(()=>{if($)return;const t=fe(c,m||{});j(t),A&&!t.some(s=>s.id===A)&&(L(""),N(!1))},[c,m,A,$]);const Le=n.useMemo(()=>Ce(r),[r]),ke=()=>{const t={id:qe(),name:"",text:"",category:""};j(s=>[...s,t]),L(t.id),p(""),b(!0),N(!0)},K=(t,s,i)=>{b(!0),j(o=>o.map((x,u)=>u===t?{...x,[s]:i}:x))},Te=t=>{b(!0),j(s=>{var o;const i=s.filter((x,u)=>u!==t);return(i.length===0||A===((o=s[t])==null?void 0:o.id))&&(L(""),N(!1)),i})},pe=async()=>{p("");try{const t=new Map;if(r.forEach(i=>{D((i==null?void 0:i.text)||"").forEach(x=>{const u=String(x).toLowerCase();u&&(t.has(u)||t.set(u,{tag:x,rows:[]}),t.get(u).rows.push(i.id))})}),t.size){const i=Array.from(t.values()).map(o=>o.tag);try{const o=await ge(i),x=Array.isArray(o==null?void 0:o.invalid)?o.invalid:[],u=new Set(x.map(F=>String(F).toLowerCase()));if(u.size){const F=r.map(I=>{const je=D((I==null?void 0:I.text)||"").filter(Re=>u.has(String(Re).toLowerCase()));if(!je.length)return null;const we=I.category?`${I.category}:${I.name}`:I.name;return{id:I.id,token:we,friendlyName:he({name:I.name})||I.name||"Untitled",category:I.category||"",invalid:je}}).filter(Boolean);f({invalid:x,invalidLower:Array.from(u),rows:F,suggestions:(o==null?void 0:o.suggestions)||{}}),q(!0),p("Fix invalid tags before saving.");return}}catch(o){console.error("Unable to validate tags",o),p("Unable to validate tags right now.");return}}const s=Se(r);await k({items:Le,categories:s,categoryList:B}),b(!1),p("Saved.")}catch{p("Unable to save right now.")}},J=n.useMemo(()=>{const t=R.trim().toLowerCase(),i=[...r.filter(o=>{const x=(o.category||"").trim();if(S===""&&x||S!=="All"&&S!==""&&x!==S)return!1;const u=ae(o.name||"",o.category||"");if(T!=="All"&&u!==T)return!1;if(!t)return!0;const F=x?`${x}:${o.name}`:o.name;return(o.name||"").toLowerCase().includes(t)||(o.text||"").toLowerCase().includes(t)||(x||"").toLowerCase().includes(t)||(F||"").toLowerCase().includes(t)})];return i.sort((o,x)=>(o.name||"").localeCompare(x.name||"")),i},[r,S,T,R]),d=J.find(t=>t.id===A)||r.find(t=>t.id===A)||null,te=n.useMemo(()=>{const t=new Set(B||[]);return r.forEach(s=>{s.category&&t.add(s.category)}),Array.from(t).sort((s,i)=>s.localeCompare(i))},[r,B]),ue=n.useMemo(()=>{const t=new Set;return r.forEach(s=>{const i=(s.category||"").trim();if(S===""&&i||S!=="All"&&S!==""&&i!==S)return;const o=ae(s.name||"",s.category||"");o&&t.add(o)}),Array.from(t).sort((s,i)=>s.localeCompare(i))},[r,S]);n.useEffect(()=>{T!=="All"&&(ue.includes(T)||_("All"))},[ue,T]),n.useEffect(()=>{M&&H.current&&H.current.focus()},[M,A]);const se=n.useMemo(()=>D((d==null?void 0:d.text)||""),[d==null?void 0:d.text]),$e=n.useMemo(()=>{const t=Array.isArray(y==null?void 0:y.invalid)?y.invalid:[];return new Set(t.map(s=>String(s).toLowerCase()))},[y]);n.useEffect(()=>{if(!M||!d)return;const t=se,s=[],i=new Set;if(t.forEach(u=>{const F=String(u).toLowerCase();!F||i.has(F)||(i.add(F),s.push(u))}),!s.length){w({loading:!1,invalid:[],suggestions:{}});return}let o=!1;const x=window.setTimeout(async()=>{w(u=>({...u,loading:!0}));try{const u=await ge(s);if(o)return;w({loading:!1,invalid:Array.isArray(u==null?void 0:u.invalid)?u.invalid:[],suggestions:(u==null?void 0:u.suggestions)||{}})}catch(u){console.error("Failed to validate tags",u),o||w({loading:!1,invalid:[],suggestions:{}})}},260);return()=>{o=!0,window.clearTimeout(x)}},[M,d,se]);const me=({query:t="",targetId:s=""}={})=>{Z(String(t||"")),G(String(s||"")),W(!0)},Fe=async()=>{const t=xe.trim();if(!t){p("Enter a category name.");return}const s=Array.from(new Set([...B||[],t]));Y(s),de(""),p("Category added.");const i=Ce(r),o=Se(r);b(!0);try{await k({items:i,categories:o,categoryList:s}),b(!1),p("Category saved.")}catch{p("Unable to save right now.")}},Ie=t=>{t&&(L(t.id),N(!0),p(""))},ye=()=>{N(!1),p("")},Ee=n.useMemo(()=>{const t=r.length,s=J.length;return g?"Loading…":t===s?`${t} aliases`:`${s} of ${t} aliases`},[r.length,J.length,g]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-shell page-stack",children:[e.jsx("div",{className:"screen-sticky",children:e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("header",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"ui-kicker",children:"Library"}),e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(ie,{size:18}),e.jsx("span",{className:"truncate",children:"Aliases"})]}),e.jsx("div",{className:"text-[11px] text-[#9DA3FFCC] mt-1",children:Ee})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"ui-button is-tiny is-muted",onClick:()=>V(!0),children:"Categories"}),e.jsx("button",{type:"button",className:"ui-button is-tiny is-ghost",onClick:()=>me({query:R||"",targetId:""}),title:"Browse danbooru tags",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ie,{size:14}),"Tags"]})}),e.jsx("button",{type:"button",className:"ui-button is-tiny is-ghost",onClick:C,disabled:g,title:"Refresh",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Ae,{size:14}),"Refresh"]})}),e.jsx("button",{type:"button",className:"ui-button is-tiny is-primary",onClick:ke,children:"Add"})]})]}),e.jsxs("div",{className:"composer-filters",children:[e.jsx("input",{type:"search",value:R,onChange:t=>ee(t.target.value),className:"composer-search ui-control ui-input",placeholder:"Search aliases","aria-label":"Search aliases"}),e.jsxs("select",{className:"composer-subcategory-select ui-control ui-select is-compact",value:S,onChange:t=>O(t.target.value),"aria-label":"Filter by category",children:[e.jsx("option",{value:"All",children:"Category: All"}),e.jsx("option",{value:"",children:"Uncategorized"}),te.map(t=>e.jsx("option",{value:t,children:t?X(t):"Uncategorized"},t||"uncat"))]}),e.jsxs("select",{className:"composer-subcategory-select ui-control ui-select is-compact",value:T,onChange:t=>_(t.target.value),"aria-label":"Filter by subcategory",children:[e.jsx("option",{value:"All",children:"Subcategory: All"}),ue.map(t=>e.jsx("option",{value:t,children:le(t)},t))]}),$?e.jsx("button",{type:"button",className:"ui-button is-compact is-primary",onClick:pe,disabled:h,children:h?"Saving…":"Save changes"}):null]}),v?e.jsx("div",{className:"text-xs text-[#FF8F70]",children:"Could not load aliases. Try again later."}):null,z?e.jsx("div",{className:"text-xs text-[#9DA3FFCC]",children:z}):null]})}),r.length===0&&!g?e.jsx("section",{className:"ui-panel text-center py-16",children:e.jsx("p",{className:"text-base text-[rgba(159,178,215,0.8)]",children:"No aliases yet. Add your first one."})}):e.jsxs("div",{className:"composer-alias-list",role:"list",children:[J.length===0?e.jsx("div",{className:"composer-alias-empty",children:"No aliases match your filters."}):null,J.map(t=>{const s=(t.category||"").trim(),i=s?`${s}:${t.name}`:t.name,o=(t.text||"").slice(0,140)+((t.text||"").length>140?"…":"");return e.jsxs("button",{type:"button",role:"listitem",className:"composer-alias-item",onClick:()=>Ie(t),children:[e.jsxs("div",{className:"composer-alias-header",children:[e.jsx("div",{className:"composer-alias-name",children:he({name:t.name})||t.name||"Untitled"}),s?e.jsx("span",{className:"composer-alias-category",children:X(s)}):null]}),e.jsxs("div",{className:"composer-alias-token",children:["$",i||"alias","$"]}),e.jsx("div",{className:"composer-alias-text",children:o||"—"})]},t.id)})]})]}),e.jsx(ne,{open:M&&!!d,onClose:ye,title:"Alias",variant:"fullscreen",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"ui-button is-muted w-full",onClick:ye,children:"Close"}),e.jsx("button",{type:"button",className:"ui-button is-primary w-full",onClick:pe,disabled:h||!$,children:h?"Saving…":$?"Save":"Saved"})]}),children:d?e.jsxs("div",{className:"sheet-stack",children:[e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Token"}),e.jsxs("div",{className:"composer-token",children:["$",d.category?`${d.category}:${d.name}`:d.name||"alias","$"]}),ae(d.name||"",d.category||"")?e.jsxs("div",{className:"sheet-hint",children:["Subcategory: ",le(ae(d.name||"",d.category||""))]}):null]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Friendly name"}),e.jsx("div",{className:"composer-field",children:he({name:d.name})||d.name||"Alias"})]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Alias name"}),e.jsx("input",{ref:H,type:"text",value:d.name||"",onChange:t=>{const s=r.findIndex(i=>i.id===d.id);s!==-1&&K(s,"name",t.target.value)},placeholder:"e.g. cherry_fruit",className:"sheet-input ui-control ui-input"})]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Category"}),e.jsxs("select",{value:d.category||"",onChange:t=>{const s=r.findIndex(i=>i.id===d.id);s!==-1&&K(s,"category",t.target.value)},className:"sheet-select ui-control ui-select",children:[e.jsx("option",{value:"",children:"Uncategorized"}),te.map(t=>e.jsx("option",{value:t,children:t?X(t):"Uncategorized"},t||"uncat"))]}),e.jsx("button",{type:"button",className:"ui-button is-tiny is-muted",onClick:()=>V(!0),children:"Manage categories"})]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Expands to"}),e.jsx("textarea",{value:d.text,onChange:t=>{const s=r.findIndex(i=>i.id===d.id);s!==-1&&K(s,"text",t.target.value)},placeholder:"Prompt text for this alias",className:"sheet-textarea ui-control ui-textarea is-compact",rows:6}),e.jsxs("div",{className:"tag-editor-actions",children:[e.jsx("button",{type:"button",className:"ui-button is-tiny is-ghost",onClick:()=>me({query:"",targetId:d.id}),children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ie,{size:14}),"Browse tags"]})}),e.jsx("button",{type:"button",className:"ui-button is-tiny is-muted",onClick:()=>{w(s=>({...s,loading:!0}));const t=D(d.text||"");ge(t).then(s=>{w({loading:!1,invalid:Array.isArray(s==null?void 0:s.invalid)?s.invalid:[],suggestions:(s==null?void 0:s.suggestions)||{}})}).catch(()=>w({loading:!1,invalid:[],suggestions:{}}))},disabled:y.loading,title:"Validate against danbooru_tags.md",children:y.loading?"Validating…":"Validate"})]}),se.length?e.jsx("div",{className:"tag-chip-list","aria-label":"Alias tags",children:se.map(t=>{const s=$e.has(String(t).toLowerCase());return e.jsxs("span",{className:`tag-chip ${s?"is-invalid":""}`,children:[e.jsx("code",{className:"tag-chip-code",children:t}),e.jsx("button",{type:"button",className:"tag-chip-remove",onClick:()=>{const i=r.findIndex(o=>o.id===d.id);i!==-1&&K(i,"text",Be(d.text||"",t))},"aria-label":`Remove ${t}`,title:"Remove",children:"×"})]},t)})}):e.jsx("div",{className:"sheet-hint",children:"Tip: Use the Tag library to add validated tags quickly."}),!y.loading&&Array.isArray(y.invalid)&&y.invalid.length?e.jsxs("div",{className:"tag-invalid-panel",role:"alert",children:[e.jsxs("div",{className:"tag-invalid-title",children:["Invalid tags (",y.invalid.length,")"]}),e.jsx("div",{className:"tag-invalid-body",children:y.invalid.map(t=>{var i;const s=((i=y==null?void 0:y.suggestions)==null?void 0:i[t])||[];return e.jsxs("div",{className:"tag-invalid-row",children:[e.jsxs("div",{className:"tag-invalid-tag",children:[e.jsx("code",{children:t}),e.jsx("button",{type:"button",className:"ui-button is-tiny is-ghost",onClick:()=>me({query:t,targetId:d.id}),children:"Find"})]}),Array.isArray(s)&&s.length?e.jsx("div",{className:"tag-invalid-suggestions",children:s.slice(0,6).map(o=>e.jsx("button",{type:"button",className:"tag-suggestion",onClick:()=>{const x=r.findIndex(u=>u.id===d.id);x!==-1&&K(x,"text",Ve(d.text||"",t,o))},title:`Replace ${t} with ${o}`,children:o},`${t}-${o}`))}):e.jsx("div",{className:"sheet-hint",children:"No suggestions found for this tag."})]},t)})})]}):null]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("button",{type:"button",className:"ui-button is-danger",onClick:()=>{const t=r.findIndex(s=>s.id===d.id);t!==-1&&(Te(t),N(!1))},children:"Delete alias"}),e.jsx("div",{className:"sheet-hint",children:"Deleting removes it from your library. Use Save changes to persist."})]})]}):null}),e.jsx(ne,{open:Q,onClose:()=>{V(!1),de(""),p("")},title:"Categories",variant:"sheet",footer:e.jsx("div",{className:"sheet-hint",children:"Categories help you organize aliases and improve the Insert alias picker."}),children:e.jsxs("div",{className:"sheet-stack",children:[e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Add category"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:xe,onChange:t=>de(t.target.value),placeholder:"e.g. styles",className:"sheet-input ui-control ui-input"}),e.jsx("button",{type:"button",className:"ui-button is-primary is-compact",onClick:Fe,children:"Add"})]})]}),e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Existing"}),te.length===0?e.jsx("div",{className:"sheet-hint",children:"No categories yet."}):e.jsxs("select",{className:"sheet-select ui-control ui-select",defaultValue:"",onChange:t=>{const s=t.target.value;s&&(O(s),V(!1))},children:[e.jsx("option",{value:"",children:"Select a category…"}),te.map(t=>e.jsx("option",{value:t,children:X(t)},t))]})]})]})}),e.jsx(Ue,{open:U,onClose:()=>{W(!1),Z(""),G("")},initialQuery:E,title:P?"Tag library — add to alias":"Tag library",onSelectTag:P?t=>{var i;const s=r.findIndex(o=>o.id===P);s!==-1&&K(s,"text",De(((i=r[s])==null?void 0:i.text)||"",t))}:null}),e.jsx(ne,{open:ce,onClose:()=>q(!1),title:"Fix invalid tags",variant:"fullscreen",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"ui-button is-muted w-full",onClick:()=>q(!1),children:"Close"}),e.jsx("button",{type:"button",className:"ui-button is-primary w-full",onClick:()=>{const t=new Set(((a==null?void 0:a.invalidLower)||[]).map(s=>String(s).toLowerCase()));if(!t.size){q(!1);return}j(s=>s.map(i=>{const x=D((i==null?void 0:i.text)||"").filter(F=>!t.has(String(F).toLowerCase())),u=re(x);return u===((i==null?void 0:i.text)||"")?i:{...i,text:u}})),b(!0),q(!1),p("Removed invalid tags. Review and save again.")},children:"Remove invalid tags"})]}),children:e.jsxs("div",{className:"sheet-stack",children:[e.jsx("div",{className:"sheet-section",children:e.jsxs("div",{className:"sheet-hint",children:["These aliases contain tags not found in ",e.jsx("code",{className:"font-mono",children:"danbooru_tags.md"}),". Fix them before saving."]})}),(ve=a==null?void 0:a.rows)!=null&&ve.length?e.jsxs("div",{className:"sheet-section",children:[e.jsx("div",{className:"sheet-label",children:"Aliases with issues"}),e.jsx("div",{className:"composer-alias-list",role:"list",children:a.rows.map(t=>e.jsxs("button",{type:"button",role:"listitem",className:"composer-alias-item",onClick:()=>{L(t.id),N(!0),q(!1)},children:[e.jsxs("div",{className:"composer-alias-header",children:[e.jsx("div",{className:"composer-alias-name",children:t.friendlyName}),t.category?e.jsx("span",{className:"composer-alias-category",children:X(t.category)}):null]}),e.jsxs("div",{className:"composer-alias-token",children:["$",t.token,"$"]}),e.jsx("div",{className:"tag-invalid-inline",children:t.invalid.map(s=>e.jsx("span",{className:"tag-chip is-invalid",children:e.jsx("code",{className:"tag-chip-code",children:s})},`${t.id}-${s}`))})]},t.id))})]}):null]})})]})}export{We as default};
